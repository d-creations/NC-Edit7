var Ta=Object.defineProperty;var La=(g,e,t)=>e in g?Ta(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var fe=(g,e,t)=>La(g,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))n(p);new MutationObserver(p=>{for(const f of p)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&n(y)}).observe(document,{childList:!0,subtree:!0});function t(p){const f={};return p.integrity&&(f.integrity=p.integrity),p.referrerPolicy&&(f.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?f.credentials="include":p.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(p){if(p.ep)return;p.ep=!0;const f=t(p);fetch(p.href,f)}})();class Ra{constructor(){fe(this,"services",new Map);fe(this,"initializing",new Set)}register(e,t,n={}){if(this.services.has(e))throw new Error(`Service already registered: ${String(e)}`);this.services.set(e,{factory:t,singleton:n.singleton??!0,dependencies:n.dependencies})}registerClass(e,t,n={}){this.register(e,()=>{const p=n.dependencies?.map(f=>this.get(f))??[];return new t(...p)},n)}get(e){const t=this.services.get(e);if(!t)throw new Error(`Service not registered: ${String(e)}`);if(this.initializing.has(e))throw new Error(`Circular dependency detected for service: ${String(e)}`);if(t.singleton&&t.instance)return t.instance;try{this.initializing.add(e);const n=t.factory();return t.singleton&&(t.instance=n),n}finally{this.initializing.delete(e)}}has(e){return this.services.has(e)}tryGet(e){try{return this.get(e)}catch{return}}async initializeAll(){const e=[];for(const[t,n]of this.services)if(n.singleton){const p=this.get(t);if(this.isInitializable(p)){const f=p.init();f instanceof Promise&&e.push(f)}}await Promise.all(e)}async disposeAll(){const e=[];for(const t of this.services.values())if(t.instance&&this.isDisposable(t.instance)){const n=t.instance.dispose();n instanceof Promise&&e.push(n)}await Promise.all(e),this.services.clear()}clear(e){const t=this.services.get(e);t&&(t.instance=void 0)}reset(){this.services.clear(),this.initializing.clear()}isInitializable(e){return typeof e=="object"&&e!==null&&"init"in e&&typeof e.init=="function"}isDisposable(e){return typeof e=="object"&&e!==null&&"dispose"in e&&typeof e.dispose=="function"}}let ar=null;function Ln(){return ar||(ar=new Ra),ar}const be={EventBus:Symbol("EventBus"),StateService:Symbol("StateService"),MachineService:Symbol("MachineService"),ParserService:Symbol("ParserService"),ExecutedProgramService:Symbol("ExecutedProgramService"),BackendGateway:Symbol("BackendGateway"),PlotService:Symbol("PlotService"),UserPreferenceService:Symbol("UserPreferenceService"),CommandService:Symbol("CommandService"),DiagnosticsService:Symbol("DiagnosticsService"),CloudAgentService:Symbol("CloudAgentService")};class Da{constructor(){fe(this,"handlers",new Map);fe(this,"eventHistory",[]);fe(this,"maxHistorySize",100)}on(e,t){this.handlers.has(e)||this.handlers.set(e,new Set);const n=this.handlers.get(e);return n.add(t),()=>{n.delete(t),n.size===0&&this.handlers.delete(e)}}once(e,t){const n=this.on(e,p=>{n(),t(p)});return n}emit(e){const t=this.handlers.get(e.type);if(t){const n=Array.from(t);for(const p of n)try{p(e)}catch(f){console.error(`Error in event handler for ${e.type}:`,f)}}this.eventHistory.push(e),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift()}off(e){this.handlers.delete(e)}clear(){this.handlers.clear()}listenerCount(e){return this.handlers.get(e)?.size??0}eventTypes(){return Array.from(this.handlers.keys())}getHistory(e,t){let n=this.eventHistory;return e&&(n=n.filter(p=>p.type===e)),t&&t>0?n.slice(-t):[...n]}clearHistory(){this.eventHistory=[]}}class Ia{constructor(e){fe(this,"state");this.eventBus=e,this.state=this.createInitialState()}createInitialState(){return{machines:new Map,channels:new Map,activeChannels:[],settings:this.createDefaultSettings()}}createDefaultSettings(){return{theme:"light",editorFontSize:14,autoSave:!0,layoutPreferences:{channelLayout:"grid",plotPosition:"right",defaultKeywordSide:"left",defaultTimeGutterSide:"right"}}}getSnapshot(){return{...this.state,machines:new Map(this.state.machines),channels:new Map(this.state.channels),activeChannels:[...this.state.activeChannels],settings:{...this.state.settings}}}registerMachine(e){this.state.machines.set(e.id,e)}getMachine(e){return this.state.machines.get(e)}getAllMachines(){return Array.from(this.state.machines.values())}setGlobalMachine(e){this.state.globalMachineId=e;for(const[t,n]of this.state.channels)(!n.machineId||n.machineId===this.state.globalMachineId)&&this.setChannelMachine(t,e);this.eventBus.emit({type:"machine:changed",timestamp:Date.now(),payload:{machineId:e}})}getGlobalMachine(){return this.state.globalMachineId}createChannel(e,t){const n=t||this.state.globalMachineId;if(!n)throw new Error("No machine ID provided and no global machine set");const p={id:e,isActive:!1,machineId:n,program:"",timeline:{programLines:[],totalTime:0,currentLine:0},syncEvents:[],uiConfig:{keywordPanelSide:this.state.settings.layoutPreferences.defaultKeywordSide,timeGutterSide:this.state.settings.layoutPreferences.defaultTimeGutterSide,variableDrawerOpen:!1,toolOverlayOpen:!1,activeTab:"program"}};this.state.channels.set(e,p)}getChannel(e){return this.state.channels.get(e)}getAllChannels(){return Array.from(this.state.channels.values())}updateChannel(e,t){const n=this.state.channels.get(e);if(!n)throw new Error(`Channel not found: ${e}`);const p={...n,...t};this.state.channels.set(e,p),this.eventBus.emit({type:"channel:state-changed",timestamp:Date.now(),payload:{channelId:e,state:p}})}setChannelMachine(e,t){this.updateChannel(e,{machineId:t}),this.eventBus.emit({type:"machine:changed",timestamp:Date.now(),payload:{channelId:e,machineId:t}})}activateChannel(e){this.updateChannel(e,{isActive:!0}),this.state.activeChannels.includes(e)||this.state.activeChannels.push(e)}deactivateChannel(e){this.updateChannel(e,{isActive:!1}),this.state.activeChannels=this.state.activeChannels.filter(t=>t!==e)}getActiveChannels(){return this.state.activeChannels.map(e=>this.state.channels.get(e)).filter(e=>e!==void 0)}toggleChannel(e){const t=this.getChannel(e);t&&(t.isActive?this.deactivateChannel(e):this.activateChannel(e))}updateSettings(e){this.state.settings={...this.state.settings,...e}}getSettings(){return{...this.state.settings}}resetSettings(){this.state.settings=this.createDefaultSettings()}clear(){this.state=this.createInitialState()}loadSnapshot(e){this.state={machines:new Map(e.machines),channels:new Map(e.channels),globalMachineId:e.globalMachineId,activeChannels:[...e.activeChannels],settings:{...e.settings}}}}class Pa{constructor(e){fe(this,"config");fe(this,"abortControllers",new Map);this.config={baseUrl:e?.baseUrl||"/ncplot7py/scripts/cgiserver.cgi",timeout:e?.timeout||3e4,retryAttempts:e?.retryAttempts||2,retryDelay:e?.retryDelay||1e3}}async listMachines(){const e={action:"list_machines"},t=await this.post(e,"list-machines");if(!t.machines)throw new Error("Invalid response: missing machines array");return t.machines}async executePrograms(e){const n={machinedata:e.map(p=>this.validateProgram(p))};return await this.post(n,"execute-programs")}async post(e,t){let n=null;for(let p=0;p<=this.config.retryAttempts;p++)try{return await this.fetchWithTimeout(e,t)}catch(f){if(n=f instanceof Error?f:new Error(String(f)),f instanceof DOMException&&f.name==="AbortError")throw f;p<this.config.retryAttempts&&await this.delay(this.config.retryDelay*(p+1))}throw new Error(`Request failed after ${this.config.retryAttempts+1} attempts: ${n?.message}`)}async fetchWithTimeout(e,t){this.cancel(t);const n=new AbortController;this.abortControllers.set(t,n);const p=setTimeout(()=>{n.abort()},this.config.timeout);try{const f=await fetch(this.config.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:n.signal});if(!f.ok)throw new Error(`HTTP error ${f.status}: ${f.statusText}`);const y=await f.json();if(y.message_TEST)throw new Error(`Server error: ${y.message_TEST.join(", ")}`);return y}finally{clearTimeout(p),this.abortControllers.delete(t)}}validateProgram(e){const t=e.program.replace(/[(){}]/g,"").trim(),n=["SB12RG_F","FANUC_T","SR20JII_F","SB12RG_B","SR20JII_B","ISO_MILL"];if(!n.includes(e.machineName))throw new Error(`Invalid machine name: ${e.machineName}. Must be one of: ${n.join(", ")}`);return{...e,program:t,canalNr:String(e.canalNr)}}cancel(e){const t=this.abortControllers.get(e);t&&(t.abort(),this.abortControllers.delete(e))}cancelAll(){for(const e of this.abortControllers.values())e.abort();this.abortControllers.clear()}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}delay(e){return new Promise(t=>setTimeout(t,e))}}class Na{constructor(e,t){fe(this,"machines",new Map);fe(this,"lastFetch",0);fe(this,"cacheDuration",5*60*1e3);fe(this,"loadingPromise",null);this.backendGateway=e}async init(){await this.fetchMachines()}async fetchMachines(e=!1){const t=Date.now();return!e&&this.machines.size>0&&t-this.lastFetch<this.cacheDuration?Array.from(this.machines.values()):this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{const n=await this.backendGateway.listMachines();this.machines.clear();for(const p of n){const f=this.convertToMachineProfile(p);this.machines.set(f.id,f)}return this.lastFetch=t,Array.from(this.machines.values())}finally{this.loadingPromise=null}})(),this.loadingPromise)}async getMachine(e,t=!0){let n=this.machines.get(e);return!n&&t&&(await this.fetchMachines(),n=this.machines.get(e)),n}getAllMachines(){return Array.from(this.machines.values())}isLoaded(){return this.machines.size>0}clearCache(){this.machines.clear(),this.lastFetch=0}convertToMachineProfile(e){const{machineName:t,controlType:n}=e;let p="MILL";n.includes("TURN")||t.includes("_T")?p="TURN":(n.includes("MILL")||t.includes("_F")||t.includes("_B"))&&(p="MILL");let f=1;return(t.includes("SB12RG")||t.includes("SR20JII"))&&(f=2),{id:t,name:t,controlType:p,availableChannels:f,axes:this.getDefaultAxes(p),feedLimits:this.getDefaultFeedLimits(p),defaultTools:[]}}getDefaultAxes(e){return e==="TURN"?[{name:"X",type:"LINEAR",minPosition:-200,maxPosition:200,units:"MM"},{name:"Z",type:"LINEAR",minPosition:-500,maxPosition:0,units:"MM"},{name:"C",type:"ROTARY",minPosition:0,maxPosition:360,units:"DEGREE"}]:[{name:"X",type:"LINEAR",minPosition:-500,maxPosition:500,units:"MM"},{name:"Y",type:"LINEAR",minPosition:-500,maxPosition:500,units:"MM"},{name:"Z",type:"LINEAR",minPosition:-300,maxPosition:300,units:"MM"}]}getDefaultFeedLimits(e){return e==="TURN"?{minFeed:1,maxFeed:3e3,rapidFeed:15e3,units:"MM_PER_MIN"}:{minFeed:1,maxFeed:5e3,rapidFeed:2e4,units:"MM_PER_MIN"}}}class ka{constructor(e,t){fe(this,"workers",new Map);fe(this,"useWorker",!1);fe(this,"cloudAgentService");this.eventBus=e,this.cloudAgentService=t}async parse(e,t){if(this.cloudAgentService){const n=this.cloudAgentService.shouldDelegateParsing(t);if(n.shouldDelegate){console.log(`[ParserService] Delegating parsing to cloud agent: ${n.reason}`);const p=await this.cloudAgentService.delegateParsing({channelId:e,program:t,machineId:"ISO_MILL"});if(p.success&&p.data)return console.log(`[ParserService] Cloud parsing completed in ${p.processingTime}ms`),p.data;console.log(`[ParserService] Cloud parsing failed, falling back to local: ${p.error}`)}}return this.useWorker?this.parseInWorker(e,t):this.parseSync(e,t)}async parseSync(e,t){const n=t.split(`
`),p=[],f=[],y=[],m=[],l=[/\b(G0|G1|G2|G3|G4|G90|G91|M3|M4|M5|M6|M30)\b/gi,/\b(T\d+)\b/gi];n.forEach((a,s)=>{const o=s+1;l.forEach(c=>{const h=a.matchAll(c);for(const d of h)p.push({keyword:d[0].toUpperCase(),lineNumber:o,context:a.trim()})});const i=a.match(/T(\d+)/i);if(i&&i[1]){const c=parseInt(i[1],10),h=a.match(/Q([\d.-]+)/i),d=a.match(/R([\d.-]+)/i);f.push({toolNumber:c,qParameter:h&&h[1]?parseFloat(h[1]):void 0,rParameter:d&&d[1]?parseFloat(d[1]):void 0,lineNumber:o})}a.match(/\bM200\b/i)&&y.push({lineNumber:o,code:"M200",channels:[e],timingOffset:0,type:"WAIT"}),a.trim()&&!a.match(/^[NGMTXYZIJKFRQPSabcdefghijklmnopqrstuvwxyz0-9\s.;()+-]+$/i)&&m.push({lineNumber:o,column:0,severity:"WARNING",message:"Line contains potentially invalid characters"})});const u={faultDetected:m.length>0,faults:m.length>0?m:void 0},r={keywords:p,variableSnapshot:{registers:new Map,lastUpdated:Date.now()},toolRegisters:f,timingMetadata:{estimatedCycleTime:0,feedRates:[],rapidMoves:0},syncEvents:y};return this.eventBus.emit({type:"parse:completed",timestamp:Date.now(),payload:{channelId:e,result:u,artifacts:r}}),{result:u,artifacts:r}}async parseInWorker(e,t){return this.parseSync(e,t)}cancel(e){const t=this.workers.get(e);t&&(t.terminate(),this.workers.delete(e))}cancelAll(){for(const e of this.workers.values())e&&e.terminate();this.workers.clear()}dispose(){this.cancelAll()}}class Oa{constructor(e,t,n,p){fe(this,"cloudAgentService");this.backendGateway=e,this.stateService=t,this.eventBus=n,this.cloudAgentService=p}async executeChannel(e){const t=this.stateService.getChannel(e);if(!t)throw new Error(`Channel not found: ${e}`);const n=this.stateService.getMachine(t.machineId);if(!n)throw new Error(`Machine not found: ${t.machineId}`);const p=[{program:t.program,machineName:n.id,canalNr:e}];return this.execute(p,e)}async executeMultipleChannels(e){const t=[];for(const p of e){const f=this.stateService.getChannel(p);if(!f)throw new Error(`Channel not found: ${p}`);const y=this.stateService.getMachine(f.machineId);if(!y)throw new Error(`Machine not found: ${f.machineId}`);t.push({program:f.program,machineName:y.id,canalNr:p})}const n=new Map;try{const p=await this.backendGateway.executePrograms(t);for(const f of e){const y=this.processServerResponse(p,f);n.set(f,y),this.eventBus.emit({type:"execution:completed",timestamp:Date.now(),payload:{channelId:f,result:y}}),this.stateService.updateChannel(f,{executedResult:y})}}catch(p){throw console.error("Failed to execute programs:",p),p}return n}async execute(e,t){try{if(this.cloudAgentService){const f=this.cloudAgentService.shouldDelegateExecution(e);if(f.shouldDelegate){console.log(`[ExecutedProgramService] Delegating execution to cloud: ${f.reason}`);const y=await this.cloudAgentService.delegateExecution({programs:e});if(y.success&&y.data){console.log(`[ExecutedProgramService] Cloud execution completed in ${y.processingTime}ms`);const m=y.data.get(t);if(m)return this.eventBus.emit({type:"execution:completed",timestamp:Date.now(),payload:{channelId:t,result:m}}),this.stateService.updateChannel(t,{executedResult:m}),m}else console.log(`[ExecutedProgramService] Cloud execution failed, using backend gateway: ${y.error}`)}}const n=await this.backendGateway.executePrograms(e),p=this.processServerResponse(n,t);return this.eventBus.emit({type:"execution:completed",timestamp:Date.now(),payload:{channelId:t,result:p}}),this.stateService.updateChannel(t,{executedResult:p}),p}catch(n){throw console.error("Failed to execute program:",n),n}}processServerResponse(e,t){const n={channel:t,executedLines:[],variableDeltas:{registers:new Map,lastUpdated:Date.now()},plotData:{channel:t,segments:[],metadata:{bounds:{min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},totalDistance:0,totalTime:0}},timestamp:Date.now()};return e.canal&&console.log("Canal data received:",e.canal),e.message&&e.message.length>0&&console.log("Server messages:",e.message),n}clearResults(e){this.stateService.updateChannel(e,{executedResult:void 0})}clearAllResults(){const e=this.stateService.getAllChannels();for(const t of e)this.clearResults(t.id)}}class $a{constructor(){fe(this,"plotCache",new Map)}getCacheKey(e,t){return`${e}:${t}`}setPlotData(e,t,n){const p=this.getCacheKey(e,t);this.plotCache.set(p,n)}getPlotData(e,t){const n=this.getCacheKey(e,t);return this.plotCache.get(n)}clearChannel(e){const t=[];for(const n of this.plotCache.keys())n.startsWith(`${e}:`)&&t.push(n);for(const n of t)this.plotCache.delete(n)}clearAll(){this.plotCache.clear()}getSegmentsByTool(e,t,n){const p=this.getPlotData(e,t);return p?p.segments.filter(f=>f.toolNumber===n):[]}getSegmentsUpToLine(e,t,n){const p=this.getPlotData(e,t);return p?p.segments.filter(f=>f.lineNumber<=n):[]}calculateBounds(e){let t=1/0,n=1/0,p=1/0,f=-1/0,y=-1/0,m=-1/0;for(const l of e.segments)for(const u of l.points)t=Math.min(t,u.x),n=Math.min(n,u.y),p=Math.min(p,u.z),f=Math.max(f,u.x),y=Math.max(y,u.y),m=Math.max(m,u.z);return{min:{x:t,y:n,z:p},max:{x:f,y,z:m},center:{x:(t+f)/2,y:(n+y)/2,z:(p+m)/2},size:{x:f-t,y:y-n,z:m-p}}}getPlotStatistics(e,t){const n=this.getPlotData(e,t);if(!n)return null;const p=new Set;let f=0;const y=new Map;for(const m of n.segments){p.add(m.toolNumber),f+=m.points.length;const l=y.get(m.type)||0;y.set(m.type,l+1)}return{totalSegments:n.segments.length,totalPoints:f,uniqueTools:p.size,tools:Array.from(p),segmentTypes:Object.fromEntries(y),bounds:n.metadata.bounds,totalDistance:n.metadata.totalDistance,totalTime:n.metadata.totalTime}}dispose(){this.clearAll()}}const ls="nc-edit7-preferences";class Fa{constructor(){fe(this,"settings");this.settings=this.loadSettings()}loadSettings(){try{const e=localStorage.getItem(ls);if(e){const t=JSON.parse(e);return this.validateSettings(t)}}catch(e){console.error("Failed to load user preferences:",e)}return this.getDefaultSettings()}saveSettings(){try{localStorage.setItem(ls,JSON.stringify(this.settings))}catch(e){console.error("Failed to save user preferences:",e)}}getDefaultSettings(){return{theme:"light",editorFontSize:14,autoSave:!0,layoutPreferences:{channelLayout:"grid",plotPosition:"right",defaultKeywordSide:"left",defaultTimeGutterSide:"right"}}}validateSettings(e){const t=this.getDefaultSettings();return{theme:e.theme==="dark"?"dark":"light",editorFontSize:typeof e.editorFontSize=="number"?e.editorFontSize:t.editorFontSize,autoSave:typeof e.autoSave=="boolean"?e.autoSave:t.autoSave,defaultMachine:e.defaultMachine,layoutPreferences:{...t.layoutPreferences,...e.layoutPreferences}}}getSettings(){return{...this.settings}}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}updateLayoutPreferences(e){this.settings.layoutPreferences={...this.settings.layoutPreferences,...e},this.saveSettings()}setTheme(e){this.settings.theme=e,this.saveSettings(),document.documentElement.setAttribute("data-theme",e)}setEditorFontSize(e){this.settings.editorFontSize=Math.max(8,Math.min(32,e)),this.saveSettings()}setAutoSave(e){this.settings.autoSave=e,this.saveSettings()}setDefaultMachine(e){this.settings.defaultMachine=e,this.saveSettings()}clearDefaultMachine(){delete this.settings.defaultMachine,this.saveSettings()}reset(){this.settings=this.getDefaultSettings(),this.saveSettings()}export(){return JSON.stringify(this.settings,null,2)}import(e){try{const t=JSON.parse(e);return this.settings=this.validateSettings(t),this.saveSettings(),!0}catch(t){return console.error("Failed to import settings:",t),!1}}}class Ua{constructor(e){fe(this,"diagnostics",new Map);fe(this,"nextId",1);this.eventBus=e,this.eventBus.on("error",t=>{this.addDiagnostic({channelId:void 0,severity:"ERROR",source:"SYSTEM",message:t.payload.message,details:t.payload.details})})}addDiagnostic(e){const t=`diag-${this.nextId++}`,n={...e,id:t,timestamp:Date.now()};return this.diagnostics.set(t,n),t}addParserFaults(e,t){for(const n of t)this.addDiagnostic({channelId:e,severity:n.severity,source:"PARSER",message:`Line ${n.lineNumber}: ${n.message}`,details:n})}addBackendError(e,t,n){this.addDiagnostic({channelId:n,severity:"ERROR",source:"BACKEND",message:e,details:t})}removeDiagnostic(e){return this.diagnostics.delete(e)}clearChannel(e){const t=[];for(const[n,p]of this.diagnostics)p.channelId===e&&t.push(n);for(const n of t)this.diagnostics.delete(n)}clearAll(){this.diagnostics.clear()}getAllDiagnostics(){return Array.from(this.diagnostics.values()).sort((e,t)=>t.timestamp-e.timestamp)}getChannelDiagnostics(e){return this.getAllDiagnostics().filter(t=>t.channelId===e)}getDiagnosticsBySeverity(e){return this.getAllDiagnostics().filter(t=>t.severity===e)}getDiagnosticsBySource(e){return this.getAllDiagnostics().filter(t=>t.source===e)}getErrorCount(){return this.getDiagnosticsBySeverity("ERROR").length}getWarningCount(){return this.getDiagnosticsBySeverity("WARNING").length}hasErrors(){return this.getErrorCount()>0}hasWarnings(){return this.getWarningCount()>0}getSummary(){return{total:this.diagnostics.size,errors:this.getErrorCount(),warnings:this.getWarningCount(),info:this.getDiagnosticsBySeverity("INFO").length,bySource:{parser:this.getDiagnosticsBySource("PARSER").length,backend:this.getDiagnosticsBySource("BACKEND").length,system:this.getDiagnosticsBySource("SYSTEM").length}}}}class Ba{constructor(e,t,n){fe(this,"config");fe(this,"stats",{localTasks:0,cloudTasks:0,failedDelegations:0});this.backendGateway=e,this.eventBus=t,this.config={enabled:n?.enabled??!1,endpoint:n?.endpoint,apiKey:n?.apiKey,autoDelegate:n?.autoDelegate??!0,thresholds:{programSizeBytes:n?.thresholds?.programSizeBytes??1e4,lineCount:n?.thresholds?.lineCount??500,complexity:n?.thresholds?.complexity??70,...n?.thresholds},capabilities:{parsing:!0,execution:!0,plotting:!0,optimization:!1,simulation:!1,...n?.capabilities},timeout:n?.timeout??3e4}}shouldDelegateParsing(e){if(!this.config.enabled||!this.config.capabilities.parsing)return{shouldDelegate:!1,reason:"Cloud delegation is disabled",capability:"parsing"};const t=this.analyzeProgram(e);return t.sizeBytes>this.config.thresholds.programSizeBytes?{shouldDelegate:!0,reason:`Program size (${t.sizeBytes} bytes) exceeds threshold`,capability:"parsing",estimatedLocalTime:t.lineCount*2,estimatedCloudTime:Math.min(1e3,t.lineCount*.5)}:t.lineCount>this.config.thresholds.lineCount?{shouldDelegate:!0,reason:`Line count (${t.lineCount}) exceeds threshold`,capability:"parsing",estimatedLocalTime:t.lineCount*2,estimatedCloudTime:Math.min(1e3,t.lineCount*.5)}:t.complexityScore>this.config.thresholds.complexity?{shouldDelegate:!0,reason:`Complexity score (${t.complexityScore}) exceeds threshold`,capability:"parsing",estimatedLocalTime:t.complexityScore*10,estimatedCloudTime:t.complexityScore*2}:{shouldDelegate:!1,reason:"Program is suitable for local parsing",capability:"parsing"}}shouldDelegateExecution(e){if(!this.config.enabled||!this.config.capabilities.execution)return{shouldDelegate:!1,reason:"Cloud delegation is disabled",capability:"execution"};const t=e.reduce((p,f)=>p+f.program.length,0),n=e.reduce((p,f)=>p+f.program.split(`
`).length,0);return t>this.config.thresholds.programSizeBytes?{shouldDelegate:!0,reason:"Total program size exceeds threshold",capability:"execution"}:n>this.config.thresholds.lineCount?{shouldDelegate:!0,reason:"Total line count exceeds threshold",capability:"execution"}:e.length>1?{shouldDelegate:!0,reason:"Multi-channel execution benefits from cloud processing",capability:"execution"}:{shouldDelegate:!1,reason:"Execution is suitable for backend gateway",capability:"execution"}}shouldDelegatePlotting(e){if(!this.config.enabled||!this.config.capabilities.plotting)return{shouldDelegate:!1,reason:"Cloud delegation is disabled",capability:"plotting"};const t=this.analyzeProgram(e);return t.lineCount>1e3||t.sizeBytes>5e4?{shouldDelegate:!0,reason:"Large program benefits from cloud plotting",capability:"plotting"}:{shouldDelegate:!1,reason:"Plotting is suitable for local processing",capability:"plotting"}}analyzeProgram(e){const t=new Blob([e]).size,p=e.split(`
`).filter(r=>r.trim()).length;let f=0;f+=Math.min(20,t/1e3*2),f+=Math.min(20,p/100*2);const y=(e.match(/G[234]\b/gi)||[]).length;f+=Math.min(20,y/10);const m=(e.match(/T\d+/gi)||[]).length;f+=Math.min(15,m*2);const l=(e.match(/M[12]\d\d/gi)||[]).length;f+=Math.min(15,l*5);const u=(e.match(/M98/gi)||[]).length;return f+=Math.min(10,u*3),{sizeBytes:t,lineCount:p,complexityScore:Math.min(100,Math.round(f))}}async delegateParsing(e){const t=Date.now();try{return this.config.endpoint?(this.stats.cloudTasks++,this.eventBus.emit({type:"cloud:task-delegated",timestamp:Date.now(),payload:{taskType:"parsing",channelId:e.channelId}}),console.warn("[CloudAgentService] Cloud parsing endpoint not implemented yet - falling back to local parsing"),{success:!1,error:"Cloud parsing endpoint not implemented yet - use local parsing",processingTime:Date.now()-t,delegatedTo:"local"}):(this.stats.localTasks++,{success:!1,error:"Cloud endpoint not configured, use local parsing",processingTime:Date.now()-t,delegatedTo:"local"})}catch(n){return this.stats.failedDelegations++,{success:!1,error:n instanceof Error?n.message:String(n),processingTime:Date.now()-t,delegatedTo:"cloud"}}}async delegateExecution(e){const t=Date.now();try{const n=this.shouldDelegateExecution(e.programs);return this.stats.cloudTasks++,this.eventBus.emit({type:"cloud:task-delegated",timestamp:Date.now(),payload:{taskType:"execution",decision:n}}),await this.backendGateway.executePrograms(e.programs),console.warn("[CloudAgentService] Cloud execution response parsing not implemented - ExecutedProgramService will handle via BackendGateway"),{success:!1,error:"Cloud execution response parsing not implemented - use ExecutedProgramService directly",processingTime:Date.now()-t,delegatedTo:"local"}}catch(n){return this.stats.failedDelegations++,{success:!1,error:n instanceof Error?n.message:String(n),processingTime:Date.now()-t,delegatedTo:"cloud"}}}getStats(){return{...this.stats,totalTasks:this.stats.localTasks+this.stats.cloudTasks,delegationRate:this.stats.cloudTasks/(this.stats.localTasks+this.stats.cloudTasks)||0}}updateConfig(e){this.config={...this.config,...e,thresholds:{...this.config.thresholds,...e.thresholds},capabilities:{...this.config.capabilities,...e.capabilities}}}getConfig(){return{...this.config}}setEnabled(e){this.config.enabled=e}async isAvailable(){if(!this.config.enabled||!this.config.endpoint)return!1;try{return!1}catch{return!1}}}class ti extends HTMLElement{constructor(){super();fe(this,"shadow");fe(this,"_isConnected",!1);this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this._isConnected||(this._isConnected=!0,this.render(),this.onConnected())}disconnectedCallback(){this.onDisconnected(),this._isConnected=!1}onConnected(){}onDisconnected(){}requestRender(){this._isConnected&&this.render()}createStyles(t){const n=document.createElement("style");return n.textContent=t,n}query(t){return this.shadow.querySelector(t)}queryAll(t){return this.shadow.querySelectorAll(t)}}function za(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var Uo={exports:{}};(function(g,e){(function(){var t="ace",n=function(){return this}();!n&&typeof window<"u"&&(n=window);var p=function(r,a,s){if(typeof r!="string"){p.original?p.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace());return}arguments.length==2&&(s=a),p.modules[r]||(p.payloads[r]=s,p.modules[r]=null)};p.modules={},p.payloads={};var f=function(r,a,s){if(typeof a=="string"){var o=l(r,a);if(o!=null)return s&&s(),o}else if(Object.prototype.toString.call(a)==="[object Array]"){for(var i=[],c=0,h=a.length;c<h;++c){var d=l(r,a[c]);if(d==null&&y.original)return;i.push(d)}return s&&s.apply(null,i)||!0}},y=function(r,a){var s=f("",r,a);return s==null&&y.original?y.original.apply(this,arguments):s},m=function(r,a){if(a.indexOf("!")!==-1){var s=a.split("!");return m(r,s[0])+"!"+m(r,s[1])}if(a.charAt(0)=="."){var o=r.split("/").slice(0,-1).join("/");for(a=o+"/"+a;a.indexOf(".")!==-1&&i!=a;){var i=a;a=a.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return a},l=function(r,a){a=m(r,a);var s=p.modules[a];if(!s){if(s=p.payloads[a],typeof s=="function"){var o={},i={id:a,uri:"",exports:o,packaged:!0},c=function(d,_){return f(a,d,_)},h=s(c,o,i);o=h||i.exports,p.modules[a]=o,delete p.payloads[a]}s=p.modules[a]=o||s}return s};function u(r){var a=n;n[r]||(n[r]={}),a=n[r],(!a.define||!a.define.packaged)&&(p.original=a.define,a.define=p,a.define.packaged=!0),(!a.require||!a.require.packaged)&&(y.original=a.require,a.require=y,a.require.packaged=!0)}u(t)})(),ace.define("ace/lib/es6-shim",["require","exports","module"],function(t,n,p){function f(y,m,l){Object.defineProperty(y,m,{value:l,enumerable:!1,writable:!0,configurable:!0})}String.prototype.startsWith||f(String.prototype,"startsWith",function(y,m){return m=m||0,this.lastIndexOf(y,m)===m}),String.prototype.endsWith||f(String.prototype,"endsWith",function(y,m){var l=this;(m===void 0||m>l.length)&&(m=l.length),m-=y.length;var u=l.indexOf(y,m);return u!==-1&&u===m}),String.prototype.repeat||f(String.prototype,"repeat",function(y){for(var m="",l=this;y>0;)y&1&&(m+=l),(y>>=1)&&(l+=l);return m}),String.prototype.includes||f(String.prototype,"includes",function(y,m){return this.indexOf(y,m)!=-1}),Object.assign||(Object.assign=function(y){if(y==null)throw new TypeError("Cannot convert undefined or null to object");for(var m=Object(y),l=1;l<arguments.length;l++){var u=arguments[l];u!=null&&Object.keys(u).forEach(function(r){m[r]=u[r]})}return m}),Object.values||(Object.values=function(y){return Object.keys(y).map(function(m){return y[m]})}),Array.prototype.find||f(Array.prototype,"find",function(y){for(var m=this.length,l=arguments[1],u=0;u<m;u++){var r=this[u];if(y.call(l,r,u,this))return r}}),Array.prototype.findIndex||f(Array.prototype,"findIndex",function(y){for(var m=this.length,l=arguments[1],u=0;u<m;u++){var r=this[u];if(y.call(l,r,u,this))return u}}),Array.prototype.includes||f(Array.prototype,"includes",function(y,m){return this.indexOf(y,m)!=-1}),Array.prototype.fill||f(Array.prototype,"fill",function(y){for(var m=this,l=m.length>>>0,u=arguments[1],r=u>>0,a=r<0?Math.max(l+r,0):Math.min(r,l),s=arguments[2],o=s===void 0?l:s>>0,i=o<0?Math.max(l+o,0):Math.min(o,l);a<i;)m[a]=y,a++;return m}),Array.of||f(Array,"of",function(){return Array.prototype.slice.call(arguments)})}),ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/es6-shim"],function(t,n,p){t("./es6-shim")}),ace.define("ace/lib/deep_copy",["require","exports","module"],function(t,n,p){n.deepCopy=function f(y){if(typeof y!="object"||!y)return y;var m;if(Array.isArray(y)){m=[];for(var l=0;l<y.length;l++)m[l]=f(y[l]);return m}if(Object.prototype.toString.call(y)!=="[object Object]")return y;m={};for(var l in y)m[l]=f(y[l]);return m}}),ace.define("ace/lib/lang",["require","exports","module","ace/lib/deep_copy"],function(t,n,p){n.last=function(m){return m[m.length-1]},n.stringReverse=function(m){return m.split("").reverse().join("")},n.stringRepeat=function(m,l){for(var u="";l>0;)l&1&&(u+=m),(l>>=1)&&(m+=m);return u};var f=/^\s\s*/,y=/\s\s*$/;n.stringTrimLeft=function(m){return m.replace(f,"")},n.stringTrimRight=function(m){return m.replace(y,"")},n.copyObject=function(m){var l={};for(var u in m)l[u]=m[u];return l},n.copyArray=function(m){for(var l=[],u=0,r=m.length;u<r;u++)m[u]&&typeof m[u]=="object"?l[u]=this.copyObject(m[u]):l[u]=m[u];return l},n.deepCopy=t("./deep_copy").deepCopy,n.arrayToMap=function(m){for(var l={},u=0;u<m.length;u++)l[m[u]]=1;return l},n.createMap=function(m){var l=Object.create(null);for(var u in m)l[u]=m[u];return l},n.arrayRemove=function(m,l){for(var u=0;u<=m.length;u++)l===m[u]&&m.splice(u,1)},n.escapeRegExp=function(m){return m.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},n.escapeHTML=function(m){return(""+m).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},n.getMatchOffsets=function(m,l){var u=[];return m.replace(l,function(r){u.push({offset:arguments[arguments.length-2],length:r.length})}),u},n.deferredCall=function(m){var l=null,u=function(){l=null,m()},r=function(a){return r.cancel(),l=setTimeout(u,a||0),r};return r.schedule=r,r.call=function(){return this.cancel(),m(),r},r.cancel=function(){return clearTimeout(l),l=null,r},r.isPending=function(){return l},r},n.delayedCall=function(m,l){var u=null,r=function(){u=null,m()},a=function(s){u==null&&(u=setTimeout(r,s||l))};return a.delay=function(s){u&&clearTimeout(u),u=setTimeout(r,s||l)},a.schedule=a,a.call=function(){this.cancel(),m()},a.cancel=function(){u&&clearTimeout(u),u=null},a.isPending=function(){return u},a},n.supportsLookbehind=function(){try{new RegExp("(?<=.)")}catch{return!1}return!0},n.skipEmptyMatch=function(m,l,u){return u&&m.codePointAt(l)>65535?2:1}}),ace.define("ace/lib/useragent",["require","exports","module"],function(t,n,p){n.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},n.getOS=function(){return n.isMac?n.OS.MAC:n.isLinux?n.OS.LINUX:n.OS.WINDOWS};var f=typeof navigator=="object"?navigator:{},y=(/mac|win|linux/i.exec(f.platform)||["other"])[0].toLowerCase(),m=f.userAgent||"",l=f.appName||"";n.isWin=y=="win",n.isMac=y=="mac",n.isLinux=y=="linux",n.isIE=l=="Microsoft Internet Explorer"||l.indexOf("MSAppHost")>=0?parseFloat((m.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((m.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),n.isOldIE=n.isIE&&n.isIE<9,n.isGecko=n.isMozilla=m.match(/ Gecko\/\d+/),n.isOpera=typeof opera=="object"&&Object.prototype.toString.call(window.opera)=="[object Opera]",n.isWebKit=parseFloat(m.split("WebKit/")[1])||void 0,n.isChrome=parseFloat(m.split(" Chrome/")[1])||void 0,n.isSafari=parseFloat(m.split(" Safari/")[1])&&!n.isChrome||void 0,n.isEdge=parseFloat(m.split(" Edge/")[1])||void 0,n.isAIR=m.indexOf("AdobeAIR")>=0,n.isAndroid=m.indexOf("Android")>=0,n.isChromeOS=m.indexOf(" CrOS ")>=0,n.isIOS=/iPad|iPhone|iPod/.test(m)&&!window.MSStream,n.isIOS&&(n.isMac=!0),n.isMobile=n.isIOS||n.isAndroid}),ace.define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],function(t,n,p){var f=t("./useragent"),y="http://www.w3.org/1999/xhtml";n.buildDom=function s(o,i,c){if(typeof o=="string"&&o){var h=document.createTextNode(o);return i&&i.appendChild(h),h}if(!Array.isArray(o))return o&&o.appendChild&&i&&i.appendChild(o),o;if(typeof o[0]!="string"||!o[0]){for(var d=[],_=0;_<o.length;_++){var C=s(o[_],i,c);C&&d.push(C)}return d}var M=document.createElement(o[0]),b=o[1],v=1;b&&typeof b=="object"&&!Array.isArray(b)&&(v=2);for(var _=v;_<o.length;_++)s(o[_],M,c);return v==2&&Object.keys(b).forEach(function(E){var D=b[E];E==="class"?M.className=Array.isArray(D)?D.join(" "):D:typeof D=="function"||E=="value"||E[0]=="$"?M[E]=D:E==="ref"?c&&(c[D]=M):E==="style"?typeof D=="string"&&(M.style.cssText=D):D!=null&&M.setAttribute(E,D)}),i&&i.appendChild(M),M},n.getDocumentHead=function(s){return s||(s=document),s.head||s.getElementsByTagName("head")[0]||s.documentElement},n.createElement=function(s,o){return document.createElementNS?document.createElementNS(o||y,s):document.createElement(s)},n.removeChildren=function(s){s.innerHTML=""},n.createTextNode=function(s,o){var i=o?o.ownerDocument:document;return i.createTextNode(s)},n.createFragment=function(s){var o=s?s.ownerDocument:document;return o.createDocumentFragment()},n.hasCssClass=function(s,o){var i=(s.className+"").split(/\s+/g);return i.indexOf(o)!==-1},n.addCssClass=function(s,o){n.hasCssClass(s,o)||(s.className+=" "+o)},n.removeCssClass=function(s,o){for(var i=s.className.split(/\s+/g);;){var c=i.indexOf(o);if(c==-1)break;i.splice(c,1)}s.className=i.join(" ")},n.toggleCssClass=function(s,o){for(var i=s.className.split(/\s+/g),c=!0;;){var h=i.indexOf(o);if(h==-1)break;c=!1,i.splice(h,1)}return c&&i.push(o),s.className=i.join(" "),c},n.setCssClass=function(s,o,i){i?n.addCssClass(s,o):n.removeCssClass(s,o)},n.hasCssString=function(s,o){var i=0,c;if(o=o||document,c=o.querySelectorAll("style")){for(;i<c.length;)if(c[i++].id===s)return!0}},n.removeElementById=function(s,o){o=o||document,o.getElementById(s)&&o.getElementById(s).remove()};var m,l=[];n.useStrictCSP=function(s){m=s,s==!1?u():l||(l=[])};function u(){var s=l;l=null,s&&s.forEach(function(o){r(o[0],o[1])})}function r(s,o,i){if(!(typeof document>"u")){if(l){if(i)u();else if(i===!1)return l.push([s,o])}if(!m){var c=i;!i||!i.getRootNode?c=document:(c=i.getRootNode(),(!c||c==i)&&(c=document));var h=c.ownerDocument||c;if(o&&n.hasCssString(o,c))return null;o&&(s+=`
/*# sourceURL=ace/css/`+o+" */");var d=n.createElement("style");d.appendChild(h.createTextNode(s)),o&&(d.id=o),c==h&&(c=n.getDocumentHead(h)),c.insertBefore(d,c.firstChild)}}}if(n.importCssString=r,n.importCssStylsheet=function(s,o){n.buildDom(["link",{rel:"stylesheet",href:s}],n.getDocumentHead(o))},n.$fixPositionBug=function(s){var o=s.getBoundingClientRect();if(s.style.left){var i=parseFloat(s.style.left),c=+o.left;Math.abs(i-c)>1&&(s.style.left=2*i-c+"px")}if(s.style.right){var i=parseFloat(s.style.right),c=window.innerWidth-o.right;Math.abs(i-c)>1&&(s.style.right=2*i-c+"px")}if(s.style.top){var i=parseFloat(s.style.top),c=+o.top;Math.abs(i-c)>1&&(s.style.top=2*i-c+"px")}if(s.style.bottom){var i=parseFloat(s.style.bottom),c=window.innerHeight-o.bottom;Math.abs(i-c)>1&&(s.style.bottom=2*i-c+"px")}},n.scrollbarWidth=function(s){var o=n.createElement("ace_inner");o.style.width="100%",o.style.minWidth="0px",o.style.height="200px",o.style.display="block";var i=n.createElement("ace_outer"),c=i.style;c.position="absolute",c.left="-10000px",c.overflow="hidden",c.width="200px",c.minWidth="0px",c.height="150px",c.display="block",i.appendChild(o);var h=s&&s.documentElement||document&&document.documentElement;if(!h)return 0;h.appendChild(i);var d=o.offsetWidth;c.overflow="scroll";var _=o.offsetWidth;return d===_&&(_=i.clientWidth),h.removeChild(i),d-_},n.computedStyle=function(s,o){return window.getComputedStyle(s,"")||{}},n.setStyle=function(s,o,i){s[o]!==i&&(s[o]=i)},n.HAS_CSS_ANIMATION=!1,n.HAS_CSS_TRANSFORMS=!1,n.HI_DPI=f.isWin?typeof window<"u"&&window.devicePixelRatio>=1.5:!0,f.isChromeOS&&(n.HI_DPI=!1),typeof document<"u"){var a=document.createElement("div");n.HI_DPI&&a.style.transform!==void 0&&(n.HAS_CSS_TRANSFORMS=!0),!f.isEdge&&typeof a.style.animationName<"u"&&(n.HAS_CSS_ANIMATION=!0),a=null}n.HAS_CSS_TRANSFORMS?n.translate=function(s,o,i){s.style.transform="translate("+Math.round(o)+"px, "+Math.round(i)+"px)"}:n.translate=function(s,o,i){s.style.top=Math.round(i)+"px",s.style.left=Math.round(o)+"px"}}),ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(t,n,p){/*
* based on code from:
*
* @license RequireJS text 0.25.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
* Available via the MIT or new BSD license.
* see: http://github.com/jrburke/requirejs for details
*/var f=t("./dom");n.get=function(y,m){var l=new XMLHttpRequest;l.open("GET",y,!0),l.onreadystatechange=function(){l.readyState===4&&m(l.responseText)},l.send(null)},n.loadScript=function(y,m){var l=f.getDocumentHead(),u=document.createElement("script");u.src=y,l.appendChild(u),u.onload=u.onreadystatechange=function(r,a){(a||!u.readyState||u.readyState=="loaded"||u.readyState=="complete")&&(u=u.onload=u.onreadystatechange=null,a||m())}},n.qualifyURL=function(y){var m=document.createElement("a");return m.href=y,m.href}}),ace.define("ace/lib/oop",["require","exports","module"],function(t,n,p){n.inherits=function(f,y){f.super_=y,f.prototype=Object.create(y.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}})},n.mixin=function(f,y){for(var m in y)f[m]=y[m];return f},n.implement=function(f,y){n.mixin(f,y)}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(t,n,p){var f={},y=function(){this.propagationStopped=!0},m=function(){this.defaultPrevented=!0};f._emit=f._dispatchEvent=function(l,u){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var r=this._eventRegistry[l]||[],a=this._defaultHandlers[l];if(!(!r.length&&!a)){(typeof u!="object"||!u)&&(u={}),u.type||(u.type=l),u.stopPropagation||(u.stopPropagation=y),u.preventDefault||(u.preventDefault=m),r=r.slice();for(var s=0;s<r.length&&(r[s](u,this),!u.propagationStopped);s++);if(a&&!u.defaultPrevented)return a(u,this)}},f._signal=function(l,u){var r=(this._eventRegistry||{})[l];if(r){r=r.slice();for(var a=0;a<r.length;a++)r[a](u,this)}},f.once=function(l,u){var r=this;if(this.on(l,function a(){r.off(l,a),u.apply(null,arguments)}),!u)return new Promise(function(a){u=a})},f.setDefaultHandler=function(l,u){var r=this._defaultHandlers;if(r||(r=this._defaultHandlers={_disabled_:{}}),r[l]){var a=r[l],s=r._disabled_[l];s||(r._disabled_[l]=s=[]),s.push(a);var o=s.indexOf(u);o!=-1&&s.splice(o,1)}r[l]=u},f.removeDefaultHandler=function(l,u){var r=this._defaultHandlers;if(r){var a=r._disabled_[l];if(r[l]==u)a&&this.setDefaultHandler(l,a.pop());else if(a){var s=a.indexOf(u);s!=-1&&a.splice(s,1)}}},f.on=f.addEventListener=function(l,u,r){this._eventRegistry=this._eventRegistry||{};var a=this._eventRegistry[l];return a||(a=this._eventRegistry[l]=[]),a.indexOf(u)==-1&&a[r?"unshift":"push"](u),u},f.off=f.removeListener=f.removeEventListener=function(l,u){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[l];if(r){var a=r.indexOf(u);a!==-1&&r.splice(a,1)}},f.removeAllListeners=function(l){l||(this._eventRegistry=this._defaultHandlers=void 0),this._eventRegistry&&(this._eventRegistry[l]=void 0),this._defaultHandlers&&(this._defaultHandlers[l]=void 0)},n.EventEmitter=f}),ace.define("ace/lib/report_error",["require","exports","module"],function(t,n,p){n.reportError=function(y,m){var l=new Error(y);l.data=m,typeof console=="object"&&console.error&&console.error(l),setTimeout(function(){throw l})}}),ace.define("ace/lib/default_english_messages",["require","exports","module"],function(t,n,p){var f={"autocomplete.popup.aria-roledescription":"Autocomplete suggestions","autocomplete.popup.aria-label":"Autocomplete suggestions","autocomplete.popup.item.aria-roledescription":"item","autocomplete.loading":"Loading...","editor.scroller.aria-roledescription":"editor","editor.scroller.aria-label":"Editor content, press Enter to start editing, press Escape to exit","editor.gutter.aria-roledescription":"editor gutter","editor.gutter.aria-label":"Editor gutter, press Enter to interact with controls using arrow keys, press Escape to exit","error-marker.good-state":"Looks good!","prompt.recently-used":"Recently used","prompt.other-commands":"Other commands","prompt.no-matching-commands":"No matching commands","search-box.find.placeholder":"Search for","search-box.find-all.text":"All","search-box.replace.placeholder":"Replace with","search-box.replace-next.text":"Replace","search-box.replace-all.text":"All","search-box.toggle-replace.title":"Toggle Replace mode","search-box.toggle-regexp.title":"RegExp Search","search-box.toggle-case.title":"CaseSensitive Search","search-box.toggle-whole-word.title":"Whole Word Search","search-box.toggle-in-selection.title":"Search In Selection","search-box.search-counter":"$0 of $1","text-input.aria-roledescription":"editor","text-input.aria-label":"Cursor at row $0","gutter.code-folding.range.aria-label":"Toggle code folding, rows $0 through $1","gutter.code-folding.closed.aria-label":"Toggle code folding, rows $0 through $1","gutter.code-folding.open.aria-label":"Toggle code folding, row $0","gutter.code-folding.closed.title":"Unfold code","gutter.code-folding.open.title":"Fold code","gutter.annotation.aria-label.error":"Error, read annotations row $0","gutter.annotation.aria-label.warning":"Warning, read annotations row $0","gutter.annotation.aria-label.info":"Info, read annotations row $0","inline-fold.closed.title":"Unfold code","gutter-tooltip.aria-label.error.singular":"error","gutter-tooltip.aria-label.error.plural":"errors","gutter-tooltip.aria-label.warning.singular":"warning","gutter-tooltip.aria-label.warning.plural":"warnings","gutter-tooltip.aria-label.info.singular":"information message","gutter-tooltip.aria-label.info.plural":"information messages","gutter.annotation.aria-label.security":"Security finding, read annotations row $0","gutter.annotation.aria-label.hint":"Suggestion, read annotations row $0","gutter-tooltip.aria-label.security.singular":"security finding","gutter-tooltip.aria-label.security.plural":"security findings","gutter-tooltip.aria-label.hint.singular":"suggestion","gutter-tooltip.aria-label.hint.plural":"suggestions","editor.tooltip.disable-editing":"Editing is disabled"};n.defaultEnglishMessages=f}),ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/report_error","ace/lib/default_english_messages"],function(t,n,p){"no use strict";var f=t("./oop"),y=t("./event_emitter").EventEmitter,m=t("./report_error").reportError,l=t("./default_english_messages").defaultEnglishMessages,u={setOptions:function(i){Object.keys(i).forEach(function(c){this.setOption(c,i[c])},this)},getOptions:function(i){var c={};if(i)Array.isArray(i)||(i=Object.keys(i));else{var h=this.$options;i=Object.keys(h).filter(function(d){return!h[d].hidden})}return i.forEach(function(d){c[d]=this.getOption(d)},this),c},setOption:function(i,c){if(this["$"+i]!==c){var h=this.$options[i];if(!h)return r('misspelled option "'+i+'"');if(h.forwardTo)return this[h.forwardTo]&&this[h.forwardTo].setOption(i,c);h.handlesSet||(this["$"+i]=c),h&&h.set&&h.set.call(this,c)}},getOption:function(i){var c=this.$options[i];return c?c.forwardTo?this[c.forwardTo]&&this[c.forwardTo].getOption(i):c&&c.get?c.get.call(this):this["$"+i]:r('misspelled option "'+i+'"')}};function r(i){typeof console<"u"&&console.warn&&console.warn.apply(console,arguments)}var a,s,o=function(){function i(){this.$defaultOptions={},a=l,s="dollarSigns"}return i.prototype.defineOptions=function(c,h,d){return c.$options||(this.$defaultOptions[h]=c.$options={}),Object.keys(d).forEach(function(_){var C=d[_];typeof C=="string"&&(C={forwardTo:C}),C.name||(C.name=_),c.$options[C.name]=C,"initialValue"in C&&(c["$"+C.name]=C.initialValue)}),f.implement(c,u),this},i.prototype.resetOptions=function(c){Object.keys(c.$options).forEach(function(h){var d=c.$options[h];"value"in d&&c.setOption(h,d.value)})},i.prototype.setDefaultValue=function(c,h,d){if(!c){for(c in this.$defaultOptions)if(this.$defaultOptions[c][h])break;if(!this.$defaultOptions[c][h])return!1}var _=this.$defaultOptions[c]||(this.$defaultOptions[c]={});_[h]&&(_.forwardTo?this.setDefaultValue(_.forwardTo,h,d):_[h].value=d)},i.prototype.setDefaultValues=function(c,h){Object.keys(h).forEach(function(d){this.setDefaultValue(c,d,h[d])},this)},i.prototype.setMessages=function(c,h){a=c,h&&h.placeholders&&(s=h.placeholders)},i.prototype.nls=function(c,h,d){a[c]||(r("No message found for the key '"+c+"' in messages with id "+a.$id+", trying to find a translation for the default string '"+h+"'."),a[h]||r("No message found for the default string '"+h+"' in the provided messages. Falling back to the default English message."));var _=a[c]||a[h]||h;return d&&(s==="dollarSigns"&&(_=_.replace(/\$(\$|[\d]+)/g,function(C,M){return M=="$"?"$":d[M]})),s==="curlyBrackets"&&(_=_.replace(/\{([^\}]+)\}/g,function(C,M){return d[M]}))),_},i}();o.prototype.warn=r,o.prototype.reportError=m,f.implement(o.prototype,y),n.AppConfig=o}),ace.define("ace/theme/textmate-css",["require","exports","module"],function(t,n,p){p.exports=`.ace-tm .ace_gutter {
  background: #f0f0f0;
  color: #333;
}

.ace-tm .ace_print-margin {
  width: 1px;
  background: #e8e8e8;
}

.ace-tm .ace_fold {
    background-color: #6B72E6;
}

.ace-tm {
  background-color: #FFFFFF;
  color: black;
}

.ace-tm .ace_cursor {
  color: black;
}
        
.ace-tm .ace_invisible {
  color: rgb(191, 191, 191);
}

.ace-tm .ace_storage,
.ace-tm .ace_keyword {
  color: blue;
}

.ace-tm .ace_constant {
  color: rgb(197, 6, 11);
}

.ace-tm .ace_constant.ace_buildin {
  color: rgb(88, 72, 246);
}

.ace-tm .ace_constant.ace_language {
  color: rgb(88, 92, 246);
}

.ace-tm .ace_constant.ace_library {
  color: rgb(6, 150, 14);
}

.ace-tm .ace_invalid {
  background-color: rgba(255, 0, 0, 0.1);
  color: red;
}

.ace-tm .ace_support.ace_function {
  color: rgb(60, 76, 114);
}

.ace-tm .ace_support.ace_constant {
  color: rgb(6, 150, 14);
}

.ace-tm .ace_support.ace_type,
.ace-tm .ace_support.ace_class {
  color: rgb(109, 121, 222);
}

.ace-tm .ace_keyword.ace_operator {
  color: rgb(104, 118, 135);
}

.ace-tm .ace_string {
  color: rgb(3, 106, 7);
}

.ace-tm .ace_comment {
  color: rgb(76, 136, 107);
}

.ace-tm .ace_comment.ace_doc {
  color: rgb(0, 102, 255);
}

.ace-tm .ace_comment.ace_doc.ace_tag {
  color: rgb(128, 159, 191);
}

.ace-tm .ace_constant.ace_numeric {
  color: rgb(0, 0, 205);
}

.ace-tm .ace_variable {
  color: rgb(49, 132, 149);
}

.ace-tm .ace_xml-pe {
  color: rgb(104, 104, 91);
}

.ace-tm .ace_entity.ace_name.ace_function {
  color: #0000A2;
}


.ace-tm .ace_heading {
  color: rgb(12, 7, 255);
}

.ace-tm .ace_list {
  color:rgb(185, 6, 144);
}

.ace-tm .ace_meta.ace_tag {
  color:rgb(0, 22, 142);
}

.ace-tm .ace_string.ace_regex {
  color: rgb(255, 0, 0)
}

.ace-tm .ace_marker-layer .ace_selection {
  background: rgb(181, 213, 255);
}
.ace-tm.ace_multiselect .ace_selection.ace_start {
  box-shadow: 0 0 3px 0px white;
}
.ace-tm .ace_marker-layer .ace_step {
  background: rgb(252, 255, 0);
}

.ace-tm .ace_marker-layer .ace_stack {
  background: rgb(164, 229, 101);
}

.ace-tm .ace_marker-layer .ace_bracket {
  margin: -1px 0 0 -1px;
  border: 1px solid rgb(192, 192, 192);
}

.ace-tm .ace_marker-layer .ace_active-line {
  background: rgba(0, 0, 0, 0.07);
}

.ace-tm .ace_gutter-active-line {
    background-color : #dcdcdc;
}

.ace-tm .ace_marker-layer .ace_selected-word {
  background: rgb(250, 250, 255);
  border: 1px solid rgb(200, 200, 250);
}

.ace-tm .ace_indent-guide {
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;
}

.ace-tm .ace_indent-guide-active {
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAZSURBVHjaYvj///9/hivKyv8BAAAA//8DACLqBhbvk+/eAAAAAElFTkSuQmCC") right repeat-y;
}
`}),ace.define("ace/theme/textmate",["require","exports","module","ace/theme/textmate-css","ace/lib/dom"],function(t,n,p){n.isDark=!1,n.cssClass="ace-tm",n.cssText=t("./textmate-css"),n.$id="ace/theme/textmate";var f=t("../lib/dom");f.importCssString(n.cssText,n.cssClass,!1)}),ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/net","ace/lib/dom","ace/lib/app_config","ace/theme/textmate"],function(t,n,p){"no use strict";var f=t("./lib/lang"),y=t("./lib/net"),m=t("./lib/dom"),l=t("./lib/app_config").AppConfig;p.exports=n=new l;var u={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1,useStrictCSP:null};n.get=function(o){if(!u.hasOwnProperty(o))throw new Error("Unknown config key: "+o);return u[o]},n.set=function(o,i){if(u.hasOwnProperty(o))u[o]=i;else if(this.setDefaultValue("",o,i)==!1)throw new Error("Unknown config key: "+o);o=="useStrictCSP"&&m.useStrictCSP(i)},n.all=function(){return f.copyObject(u)},n.$modes={},n.moduleUrl=function(o,i){if(u.$moduleUrls[o])return u.$moduleUrls[o];var c=o.split("/");i=i||c[c.length-2]||"";var h=i=="snippets"?"/":"-",d=c[c.length-1];if(i=="worker"&&h=="-"){var _=new RegExp("^"+i+"[\\-_]|[\\-_]"+i+"$","g");d=d.replace(_,"")}(!d||d==i)&&c.length>1&&(d=c[c.length-2]);var C=u[i+"Path"];return C==null?C=u.basePath:h=="/"&&(i=h=""),C&&C.slice(-1)!="/"&&(C+="/"),C+i+h+d+this.get("suffix")},n.setModuleUrl=function(o,i){return u.$moduleUrls[o]=i};var r=function(o,i){if(o==="ace/theme/textmate"||o==="./theme/textmate")return i(null,t("./theme/textmate"));if(a)return a(o,i);console.error("loader is not configured")},a;n.setLoader=function(o){a=o},n.dynamicModules=Object.create(null),n.$loading={},n.$loaded={},n.loadModule=function(o,i){var c;if(Array.isArray(o))var h=o[0],d=o[1];else if(typeof o=="string")var d=o;var _=function(C){if(C&&!n.$loading[d])return i&&i(C);if(n.$loading[d]||(n.$loading[d]=[]),n.$loading[d].push(i),!(n.$loading[d].length>1)){var M=function(){r(d,function(b,v){v&&(n.$loaded[d]=v),n._emit("load.module",{name:d,module:v});var E=n.$loading[d];n.$loading[d]=null,E.forEach(function(D){D&&D(v)})})};if(!n.get("packaged"))return M();y.loadScript(n.moduleUrl(d,h),M),s()}};if(n.dynamicModules[d])n.dynamicModules[d]().then(function(C){C.default?_(C.default):_(C)});else{try{c=this.$require(d)}catch{}_(c||n.$loaded[d])}},n.$require=function(o){if(typeof p.require=="function"){var i="require";return p[i](o)}},n.setModuleLoader=function(o,i){n.dynamicModules[o]=i};var s=function(){!u.basePath&&!u.workerPath&&!u.modePath&&!u.themePath&&!Object.keys(u.$moduleUrls).length&&(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),s=function(){})};n.version="1.43.4"}),ace.define("ace/loader_build",["require","exports","module","ace/lib/fixoldbrowsers","ace/config"],function(t,n,p){t("./lib/fixoldbrowsers");var f=t("./config");f.setLoader(function(u,r){t([u],function(a){r(null,a)})});var y=function(){return this||typeof window<"u"&&window}();p.exports=function(u){f.init=m,f.$require=t,u.require=t},m(!0);function m(u){if(!(!y||!y.document)){f.set("packaged",u||t.packaged||p.packaged||y.define&&(void 0).packaged);var r={},a="",s=document.currentScript||document._currentScript,o=s&&s.ownerDocument||document;s&&s.src&&(a=s.src.split(/[?#]/)[0].split("/").slice(0,-1).join("/")||"");for(var i=o.getElementsByTagName("script"),c=0;c<i.length;c++){var h=i[c],d=h.src||h.getAttribute("src");if(d){for(var _=h.attributes,C=0,M=_.length;C<M;C++){var b=_[C];b.name.indexOf("data-ace-")===0&&(r[l(b.name.replace(/^data-ace-/,""))]=b.value)}var v=d.match(/^(.*)\/ace([\-.]\w+)?\.js(\?|$)/);v&&(a=v[1])}}a&&(r.base=r.base||a,r.packaged=!0),r.basePath=r.base,r.workerPath=r.workerPath||r.base,r.modePath=r.modePath||r.base,r.themePath=r.themePath||r.base,delete r.base;for(var E in r)typeof r[E]<"u"&&f.set(E,r[E])}}function l(u){return u.replace(/-(.)/g,function(r,a){return a.toUpperCase()})}}),ace.define("ace/range",["require","exports","module"],function(t,n,p){var f=function(){function y(m,l,u,r){this.start={row:m,column:l},this.end={row:u,column:r}}return y.prototype.isEqual=function(m){return this.start.row===m.start.row&&this.end.row===m.end.row&&this.start.column===m.start.column&&this.end.column===m.end.column},y.prototype.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},y.prototype.contains=function(m,l){return this.compare(m,l)==0},y.prototype.compareRange=function(m){var l,u=m.end,r=m.start;return l=this.compare(u.row,u.column),l==1?(l=this.compare(r.row,r.column),l==1?2:l==0?1:0):l==-1?-2:(l=this.compare(r.row,r.column),l==-1?-1:l==1?42:0)},y.prototype.comparePoint=function(m){return this.compare(m.row,m.column)},y.prototype.containsRange=function(m){return this.comparePoint(m.start)==0&&this.comparePoint(m.end)==0},y.prototype.intersects=function(m){var l=this.compareRange(m);return l==-1||l==0||l==1},y.prototype.isEnd=function(m,l){return this.end.row==m&&this.end.column==l},y.prototype.isStart=function(m,l){return this.start.row==m&&this.start.column==l},y.prototype.setStart=function(m,l){typeof m=="object"?(this.start.column=m.column,this.start.row=m.row):(this.start.row=m,this.start.column=l)},y.prototype.setEnd=function(m,l){typeof m=="object"?(this.end.column=m.column,this.end.row=m.row):(this.end.row=m,this.end.column=l)},y.prototype.inside=function(m,l){return this.compare(m,l)==0?!(this.isEnd(m,l)||this.isStart(m,l)):!1},y.prototype.insideStart=function(m,l){return this.compare(m,l)==0?!this.isEnd(m,l):!1},y.prototype.insideEnd=function(m,l){return this.compare(m,l)==0?!this.isStart(m,l):!1},y.prototype.compare=function(m,l){return!this.isMultiLine()&&m===this.start.row?l<this.start.column?-1:l>this.end.column?1:0:m<this.start.row?-1:m>this.end.row?1:this.start.row===m?l>=this.start.column?0:-1:this.end.row===m?l<=this.end.column?0:1:0},y.prototype.compareStart=function(m,l){return this.start.row==m&&this.start.column==l?-1:this.compare(m,l)},y.prototype.compareEnd=function(m,l){return this.end.row==m&&this.end.column==l?1:this.compare(m,l)},y.prototype.compareInside=function(m,l){return this.end.row==m&&this.end.column==l?1:this.start.row==m&&this.start.column==l?-1:this.compare(m,l)},y.prototype.clipRows=function(m,l){if(this.end.row>l)var u={row:l+1,column:0};else if(this.end.row<m)var u={row:m,column:0};if(this.start.row>l)var r={row:l+1,column:0};else if(this.start.row<m)var r={row:m,column:0};return y.fromPoints(r||this.start,u||this.end)},y.prototype.extend=function(m,l){var u=this.compare(m,l);if(u==0)return this;if(u==-1)var r={row:m,column:l};else var a={row:m,column:l};return y.fromPoints(r||this.start,a||this.end)},y.prototype.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},y.prototype.isMultiLine=function(){return this.start.row!==this.end.row},y.prototype.clone=function(){return y.fromPoints(this.start,this.end)},y.prototype.collapseRows=function(){return this.end.column==0?new y(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new y(this.start.row,0,this.end.row,0)},y.prototype.toScreenRange=function(m){var l=m.documentToScreenPosition(this.start),u=m.documentToScreenPosition(this.end);return new y(l.row,l.column,u.row,u.column)},y.prototype.moveBy=function(m,l){this.start.row+=m,this.start.column+=l,this.end.row+=m,this.end.column+=l},y}();f.fromPoints=function(y,m){return new f(y.row,y.column,m.row,m.column)},f.comparePoints=function(y,m){return y.row-m.row||y.column-m.column},n.Range=f}),ace.define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(t,n,p){for(var f=t("./oop"),y={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,super:8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete","-13":"NumpadEnter",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",59:";",61:"=",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}},m={Command:224,Backspace:8,Tab:9,Return:13,Enter:13,Pause:19,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Delete:46,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Backquote:192,Minus:189,Equal:187,BracketLeft:219,Backslash:220,BracketRight:221,Semicolon:186,Quote:222,Comma:188,Period:190,Slash:191,Space:32,NumpadAdd:107,NumpadDecimal:110,NumpadSubtract:109,NumpadDivide:111,NumpadMultiply:106},l=0;l<10;l++)m["Digit"+l]=48+l,m["Numpad"+l]=96+l,y.PRINTABLE_KEYS[48+l]=""+l,y.FUNCTION_KEYS[96+l]="Numpad"+l;for(var l=65;l<91;l++){var u=String.fromCharCode(l+32);m["Key"+u.toUpperCase()]=l,y.PRINTABLE_KEYS[l]=u}for(var l=1;l<13;l++)m["F"+l]=111+l,y.FUNCTION_KEYS[111+l]="F"+l;var r={Shift:16,Control:17,Alt:18,Meta:224};for(var a in r)m[a]=m[a+"Left"]=m[a+"Right"]=r[a];n.$codeToKeyCode=m,y.PRINTABLE_KEYS[173]="-";for(var s in y.FUNCTION_KEYS){var o=y.FUNCTION_KEYS[s].toLowerCase();y[o]=parseInt(s,10)}for(var s in y.PRINTABLE_KEYS){var o=y.PRINTABLE_KEYS[s].toLowerCase();y[o]=parseInt(s,10)}f.mixin(y,y.MODIFIER_KEYS),f.mixin(y,y.PRINTABLE_KEYS),f.mixin(y,y.FUNCTION_KEYS),y.enter=y.return,y.escape=y.esc,y.del=y.delete,function(){for(var i=["cmd","ctrl","alt","shift"],c=Math.pow(2,i.length);c--;)y.KEY_MODS[c]=i.filter(function(h){return c&y.KEY_MODS[h]}).join("-")+"-"}(),y.KEY_MODS[0]="",y.KEY_MODS[-1]="input-",f.mixin(n,y),n.default=n,n.keyCodeToString=function(i){var c=y[i];return typeof c!="string"&&(c=String.fromCharCode(i)),c.toLowerCase()}}),ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(t,n,p){var f=t("./keys"),y=t("./useragent"),m=null,l=0,u;function r(){u=!1;try{document.createComment("").addEventListener("test",function(){},{get passive(){return u={passive:!1},!0}})}catch{}}function a(){return u==null&&r(),u}function s(C,M,b){this.elem=C,this.type=M,this.callback=b}s.prototype.destroy=function(){i(this.elem,this.type,this.callback),this.elem=this.type=this.callback=void 0};var o=n.addListener=function(C,M,b,v){C.addEventListener(M,b,a()),v&&v.$toDestroy.push(new s(C,M,b))},i=n.removeListener=function(C,M,b){C.removeEventListener(M,b,a())};n.stopEvent=function(C){return n.stopPropagation(C),n.preventDefault(C),!1},n.stopPropagation=function(C){C.stopPropagation&&C.stopPropagation()},n.preventDefault=function(C){C.preventDefault&&C.preventDefault()},n.getButton=function(C){return C.type=="dblclick"?0:C.type=="contextmenu"||y.isMac&&C.ctrlKey&&!C.altKey&&!C.shiftKey?2:C.button},n.capture=function(C,M,b){var v=C&&C.ownerDocument||document;function E(D){M&&M(D),b&&b(D),i(v,"mousemove",M),i(v,"mouseup",E),i(v,"dragstart",E)}return o(v,"mousemove",M),o(v,"mouseup",E),o(v,"dragstart",E),E},n.addMouseWheelListener=function(C,M,b){o(C,"wheel",function(v){var E=.15,D=v.deltaX||0,L=v.deltaY||0;switch(v.deltaMode){case v.DOM_DELTA_PIXEL:v.wheelX=D*E,v.wheelY=L*E;break;case v.DOM_DELTA_LINE:var w=15;v.wheelX=D*w,v.wheelY=L*w;break;case v.DOM_DELTA_PAGE:var I=150;v.wheelX=D*I,v.wheelY=L*I;break}M(v)},b)},n.addMultiMouseDownListener=function(C,M,b,v,E){var D=0,L,w,I,R={2:"dblclick",3:"tripleclick",4:"quadclick"};function A(x){if(n.getButton(x)!==0?D=0:x.detail>1?(D++,D>4&&(D=1)):D=1,y.isIE){var S=Math.abs(x.clientX-L)>5||Math.abs(x.clientY-w)>5;(!I||S)&&(D=1),I&&clearTimeout(I),I=setTimeout(function(){I=null},M[D-1]||600),D==1&&(L=x.clientX,w=x.clientY)}if(x._clicks=D,b[v]("mousedown",x),D>4)D=0;else if(D>1)return b[v](R[D],x)}Array.isArray(C)||(C=[C]),C.forEach(function(x){o(x,"mousedown",A,E)})};function c(C){return 0|(C.ctrlKey?1:0)|(C.altKey?2:0)|(C.shiftKey?4:0)|(C.metaKey?8:0)}n.getModifierString=function(C){return f.KEY_MODS[c(C)]};function h(C,M,b){var v=c(M);if(!b&&M.code&&(b=f.$codeToKeyCode[M.code]||b),!y.isMac&&m){if(M.getModifierState&&(M.getModifierState("OS")||M.getModifierState("Win"))&&(v|=8),m.altGr)if((3&v)!=3)m.altGr=0;else return;if(b===18||b===17){var E=M.location;if(b===17&&E===1)m[b]==1&&(l=M.timeStamp);else if(b===18&&v===3&&E===2){var D=M.timeStamp-l;D<50&&(m.altGr=!0)}}}if(b in f.MODIFIER_KEYS&&(b=-1),!(!v&&b===13&&M.location===3&&(C(M,v,-b),M.defaultPrevented))){if(y.isChromeOS&&v&8){if(C(M,v,b),M.defaultPrevented)return;v&=-9}return!v&&!(b in f.FUNCTION_KEYS)&&!(b in f.PRINTABLE_KEYS)?!1:C(M,v,b)}}n.addCommandKeyListener=function(C,M,b){var v=null;o(C,"keydown",function(E){m[E.keyCode]=(m[E.keyCode]||0)+1;var D=h(M,E,E.keyCode);return v=E.defaultPrevented,D},b),o(C,"keypress",function(E){v&&(E.ctrlKey||E.altKey||E.shiftKey||E.metaKey)&&(n.stopEvent(E),v=null)},b),o(C,"keyup",function(E){m[E.keyCode]=null},b),m||(d(),o(window,"focus",d))};function d(){m=Object.create(null)}if(typeof window=="object"&&window.postMessage&&!y.isOldIE){var _=1;n.nextTick=function(C,M){M=M||window;var b="zero-timeout-message-"+_++,v=function(E){E.data==b&&(n.stopPropagation(E),i(M,"message",v),C())};o(M,"message",v),M.postMessage(b,"*")}}n.$idleBlocked=!1,n.onIdle=function(C,M){return setTimeout(function b(){n.$idleBlocked?setTimeout(b,100):C()},M)},n.$idleBlockId=null,n.blockIdle=function(C){n.$idleBlockId&&clearTimeout(n.$idleBlockId),n.$idleBlocked=!0,n.$idleBlockId=setTimeout(function(){n.$idleBlocked=!1},C||100)},n.nextFrame=typeof window=="object"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),n.nextFrame?n.nextFrame=n.nextFrame.bind(window):n.nextFrame=function(C){setTimeout(C,17)}}),ace.define("ace/clipboard",["require","exports","module"],function(t,n,p){var f;p.exports={lineMode:!1,pasteCancelled:function(){return f&&f>Date.now()-50?!0:f=!1},cancel:function(){f=Date.now()}}}),ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/config","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/clipboard","ace/lib/keys"],function(t,n,p){var f=t("../lib/event"),y=t("../config").nls,m=t("../lib/useragent"),l=t("../lib/dom"),u=t("../lib/lang"),r=t("../clipboard"),a=m.isChrome<18,s=m.isIE,o=m.isChrome>63,i=400,c=t("../lib/keys"),h=c.KEY_MODS,d=m.isIOS,_=d?/\s/:/\n/,C=m.isMobile,M=function(){function b(v,E){var D=this;this.host=E,this.text=l.createElement("textarea"),this.text.className="ace_text-input",this.text.setAttribute("wrap","off"),this.text.setAttribute("autocomplete","off"),this.text.setAttribute("autocorrect","off"),this.text.setAttribute("autocapitalize","off"),this.text.setAttribute("spellcheck","false"),this.text.style.opacity="0",v.insertBefore(this.text,v.firstChild),this.copied=!1,this.pasted=!1,this.inComposition=!1,this.sendingText=!1,this.tempStyle="",C||(this.text.style.fontSize="1px"),this.commandMode=!1,this.ignoreFocusEvents=!1,this.lastValue="",this.lastSelectionStart=0,this.lastSelectionEnd=0,this.lastRestoreEnd=0,this.rowStart=Number.MAX_SAFE_INTEGER,this.rowEnd=Number.MIN_SAFE_INTEGER,this.numberOfExtraLines=0;try{this.$isFocused=document.activeElement===this.text}catch{}this.cancelComposition=this.cancelComposition.bind(this),this.setAriaOptions({role:"textbox"}),f.addListener(this.text,"blur",function(L){D.ignoreFocusEvents||(E.onBlur(L),D.$isFocused=!1)},E),f.addListener(this.text,"focus",function(L){if(!D.ignoreFocusEvents){if(D.$isFocused=!0,m.isEdge)try{if(!document.hasFocus())return}catch{}E.onFocus(L),m.isEdge?setTimeout(D.resetSelection.bind(D)):D.resetSelection()}},E),this.$focusScroll=!1,E.on("beforeEndOperation",function(){var L=E.curOp,w=L&&L.command&&L.command.name;if(w!="insertstring"){var I=w&&(L.docChanged||L.selectionChanged);D.inComposition&&I&&(D.lastValue=D.text.value="",D.onCompositionEnd()),D.resetSelection()}}),E.on("changeSelection",this.setAriaLabel.bind(this)),this.resetSelection=d?this.$resetSelectionIOS:this.$resetSelection,this.$isFocused&&E.onFocus(),this.inputHandler=null,this.afterContextMenu=!1,f.addCommandKeyListener(this.text,function(L,w,I){if(!D.inComposition)return E.onCommandKey(L,w,I)},E),f.addListener(this.text,"select",this.onSelect.bind(this),E),f.addListener(this.text,"input",this.onInput.bind(this),E),f.addListener(this.text,"cut",this.onCut.bind(this),E),f.addListener(this.text,"copy",this.onCopy.bind(this),E),f.addListener(this.text,"paste",this.onPaste.bind(this),E),(!("oncut"in this.text)||!("oncopy"in this.text)||!("onpaste"in this.text))&&f.addListener(v,"keydown",function(L){if(!(m.isMac&&!L.metaKey||!L.ctrlKey))switch(L.keyCode){case 67:D.onCopy(L);break;case 86:D.onPaste(L);break;case 88:D.onCut(L);break}},E),this.syncComposition=u.delayedCall(this.onCompositionUpdate.bind(this),50).schedule.bind(null,null),f.addListener(this.text,"compositionstart",this.onCompositionStart.bind(this),E),f.addListener(this.text,"compositionupdate",this.onCompositionUpdate.bind(this),E),f.addListener(this.text,"keyup",this.onKeyup.bind(this),E),f.addListener(this.text,"keydown",this.syncComposition.bind(this),E),f.addListener(this.text,"compositionend",this.onCompositionEnd.bind(this),E),this.closeTimeout,f.addListener(this.text,"mouseup",this.$onContextMenu.bind(this),E),f.addListener(this.text,"mousedown",function(L){L.preventDefault(),D.onContextMenuClose()},E),f.addListener(E.renderer.scroller,"contextmenu",this.$onContextMenu.bind(this),E),f.addListener(this.text,"contextmenu",this.$onContextMenu.bind(this),E),d&&this.addIosSelectionHandler(v,E,this.text)}return b.prototype.addIosSelectionHandler=function(v,E,D){var L=this,w=null,I=!1;D.addEventListener("keydown",function(A){w&&clearTimeout(w),I=!0},!0),D.addEventListener("keyup",function(A){w=setTimeout(function(){I=!1},100)},!0);var R=function(A){if(document.activeElement===D&&!(I||L.inComposition||E.$mouseHandler.isMousePressed)&&!L.copied){var x=D.selectionStart,S=D.selectionEnd,T=null,P=0;if(x==0?T=c.up:x==1?T=c.home:S>L.lastSelectionEnd&&L.lastValue[S]==`
`?T=c.end:x<L.lastSelectionStart&&L.lastValue[x-1]==" "?(T=c.left,P=h.option):x<L.lastSelectionStart||x==L.lastSelectionStart&&L.lastSelectionEnd!=L.lastSelectionStart&&x==S?T=c.left:S>L.lastSelectionEnd&&L.lastValue.slice(0,S).split(`
`).length>2?T=c.down:S>L.lastSelectionEnd&&L.lastValue[S-1]==" "?(T=c.right,P=h.option):(S>L.lastSelectionEnd||S==L.lastSelectionEnd&&L.lastSelectionEnd!=L.lastSelectionStart&&x==S)&&(T=c.right),x!==S&&(P|=h.shift),T){var N=E.onCommandKey({},P,T);if(!N&&E.commands){T=c.keyCodeToString(T);var k=E.commands.findKeyCommand(P,T);k&&E.execCommand(k)}L.lastSelectionStart=x,L.lastSelectionEnd=S,L.resetSelection("")}}};document.addEventListener("selectionchange",R),E.on("destroy",function(){document.removeEventListener("selectionchange",R)})},b.prototype.onContextMenuClose=function(){var v=this;clearTimeout(this.closeTimeout),this.closeTimeout=setTimeout(function(){v.tempStyle&&(v.text.style.cssText=v.tempStyle,v.tempStyle=""),v.host.renderer.$isMousePressed=!1,v.host.renderer.$keepTextAreaAtCursor&&v.host.renderer.$moveTextAreaToCursor()},0)},b.prototype.$onContextMenu=function(v){this.host.textInput.onContextMenu(v),this.onContextMenuClose()},b.prototype.onKeyup=function(v){v.keyCode==27&&this.text.value.length<this.text.selectionStart&&(this.inComposition||(this.lastValue=this.text.value),this.lastSelectionStart=this.lastSelectionEnd=-1,this.resetSelection()),this.syncComposition()},b.prototype.cancelComposition=function(){this.ignoreFocusEvents=!0,this.text.blur(),this.text.focus(),this.ignoreFocusEvents=!1},b.prototype.onCompositionStart=function(v){if(!(this.inComposition||!this.host.onCompositionStart||this.host.$readOnly)&&(this.inComposition={},!this.commandMode)){v.data&&(this.inComposition.useTextareaForIME=!1),setTimeout(this.onCompositionUpdate.bind(this),0),this.host._signal("compositionStart"),this.host.on("mousedown",this.cancelComposition);var E=this.host.getSelectionRange();E.end.row=E.start.row,E.end.column=E.start.column,this.inComposition.markerRange=E,this.inComposition.selectionStart=this.lastSelectionStart,this.host.onCompositionStart(this.inComposition),this.inComposition.useTextareaForIME?(this.lastValue=this.text.value="",this.lastSelectionStart=0,this.lastSelectionEnd=0):(this.text.msGetInputContext&&(this.inComposition.context=this.text.msGetInputContext()),this.text.getInputContext&&(this.inComposition.context=this.text.getInputContext()))}},b.prototype.onCompositionUpdate=function(){if(!(!this.inComposition||!this.host.onCompositionUpdate||this.host.$readOnly)){if(this.commandMode)return this.cancelComposition();if(this.inComposition.useTextareaForIME)this.host.onCompositionUpdate(this.text.value);else{var v=this.text.value;this.sendText(v),this.inComposition.markerRange&&(this.inComposition.context&&(this.inComposition.markerRange.start.column=this.inComposition.selectionStart=this.inComposition.context.compositionStartOffset),this.inComposition.markerRange.end.column=this.inComposition.markerRange.start.column+this.lastSelectionEnd-this.inComposition.selectionStart+this.lastRestoreEnd)}}},b.prototype.onCompositionEnd=function(v){!this.host.onCompositionEnd||this.host.$readOnly||(this.inComposition=!1,this.host.onCompositionEnd(),this.host.off("mousedown",this.cancelComposition),v&&this.onInput())},b.prototype.onCut=function(v){this.doCopy(v,!0)},b.prototype.onCopy=function(v){this.doCopy(v,!1)},b.prototype.onPaste=function(v){var E=this.handleClipboardData(v);r.pasteCancelled()||(typeof E=="string"?(E&&this.host.onPaste(E,v),m.isIE&&setTimeout(this.resetSelection),f.preventDefault(v)):(this.text.value="",this.pasted=!0))},b.prototype.doCopy=function(v,E){var D=this,L=this.host.getCopyText();if(!L)return f.preventDefault(v);this.handleClipboardData(v,L)?(d&&(this.resetSelection(L),this.copied=L,setTimeout(function(){D.copied=!1},10)),E?this.host.onCut():this.host.onCopy(),f.preventDefault(v)):(this.copied=!0,this.text.value=L,this.text.select(),setTimeout(function(){D.copied=!1,D.resetSelection(),E?D.host.onCut():D.host.onCopy()}))},b.prototype.handleClipboardData=function(v,E,D){var L=v.clipboardData||window.clipboardData;if(!(!L||a)){var w=s||D?"Text":"text/plain";try{return E?L.setData(w,E)!==!1:L.getData(w)}catch(I){if(!D)return this.handleClipboardData(I,E,!0)}}},b.prototype.onInput=function(v){if(this.inComposition)return this.onCompositionUpdate();if(v&&v.inputType){if(v.inputType=="historyUndo")return this.host.execCommand("undo");if(v.inputType=="historyRedo")return this.host.execCommand("redo")}var E=this.text.value,D=this.sendText(E,!0);(E.length>i+100||_.test(D)||C&&this.lastSelectionStart<1&&this.lastSelectionStart==this.lastSelectionEnd)&&this.resetSelection()},b.prototype.sendText=function(v,E){if(this.afterContextMenu&&(this.afterContextMenu=!1),this.pasted)return this.resetSelection(),v&&this.host.onPaste(v),this.pasted=!1,"";for(var D=this.text.selectionStart,L=this.text.selectionEnd,w=this.lastSelectionStart,I=this.lastValue.length-this.lastSelectionEnd,R=v,A=v.length-D,x=v.length-L,S=0;w>0&&this.lastValue[S]==v[S];)S++,w--;for(R=R.slice(S),S=1;I>0&&this.lastValue.length-S>this.lastSelectionStart-1&&this.lastValue[this.lastValue.length-S]==v[v.length-S];)S++,I--;A-=S-1,x-=S-1;var T=R.length-S+1;if(T<0&&(w=-T,T=0),R=R.slice(0,T),!E&&!R&&!A&&!w&&!I&&!x)return"";this.sendingText=!0;var P=!1;return m.isAndroid&&R==". "&&(R="  ",P=!0),R&&!w&&!I&&!A&&!x||this.commandMode?this.host.onTextInput(R):this.host.onTextInput(R,{extendLeft:w,extendRight:I,restoreStart:A,restoreEnd:x}),this.sendingText=!1,this.lastValue=v,this.lastSelectionStart=D,this.lastSelectionEnd=L,this.lastRestoreEnd=x,P?`
`:R},b.prototype.onSelect=function(v){var E=this;if(!this.inComposition){var D=function(L){return L.selectionStart===0&&L.selectionEnd>=E.lastValue.length&&L.value===E.lastValue&&E.lastValue&&L.selectionEnd!==E.lastSelectionEnd};this.copied?this.copied=!1:D(this.text)?(this.host.selectAll(),this.resetSelection()):C&&this.text.selectionStart!=this.lastSelectionStart&&this.resetSelection()}},b.prototype.$resetSelectionIOS=function(v){if(!(!this.$isFocused||this.copied&&!v||this.sendingText)){v||(v="");var E=`
 ab`+v+`cde fg
`;E!=this.text.value&&(this.text.value=this.lastValue=E);var D=4,L=4+(v.length||(this.host.selection.isEmpty()?0:1));(this.lastSelectionStart!=D||this.lastSelectionEnd!=L)&&this.text.setSelectionRange(D,L),this.lastSelectionStart=D,this.lastSelectionEnd=L}},b.prototype.$resetSelection=function(){var v=this;if(!(this.inComposition||this.sendingText)&&!(!this.$isFocused&&!this.afterContextMenu)){this.inComposition=!0;var E=0,D=0,L="",w=function(k,O){for(var $=O,V=1;V<=k-v.rowStart&&V<2*v.numberOfExtraLines+1;V++)$+=v.host.session.getLine(k-V).length+1;return $};if(this.host.session){var I=this.host.selection,R=I.getRange(),A=I.cursor.row;A===this.rowEnd+1?(this.rowStart=this.rowEnd+1,this.rowEnd=this.rowStart+2*this.numberOfExtraLines):A===this.rowStart-1?(this.rowEnd=this.rowStart-1,this.rowStart=this.rowEnd-2*this.numberOfExtraLines):(A<this.rowStart-1||A>this.rowEnd+1)&&(this.rowStart=A>this.numberOfExtraLines?A-this.numberOfExtraLines:0,this.rowEnd=A>this.numberOfExtraLines?A+this.numberOfExtraLines:2*this.numberOfExtraLines);for(var x=[],S=this.rowStart;S<=this.rowEnd;S++)x.push(this.host.session.getLine(S));if(L=x.join(`
`),E=w(R.start.row,R.start.column),D=w(R.end.row,R.end.column),R.start.row<this.rowStart){var T=this.host.session.getLine(this.rowStart-1);E=R.start.row<this.rowStart-1?0:E,D+=T.length+1,L=T+`
`+L}else if(R.end.row>this.rowEnd){var P=this.host.session.getLine(this.rowEnd+1);D=R.end.row>this.rowEnd+1?P.length:R.end.column,D+=L.length+1,L=L+`
`+P}else C&&A>0&&(L=`
`+L,D+=1,E+=1);L.length>i&&(E<i&&D<i?L=L.slice(0,i):(L=`
`,E==D?E=D=0:(E=0,D=1)));var N=L+`

`;N!=this.lastValue&&(this.text.value=this.lastValue=N,this.lastSelectionStart=this.lastSelectionEnd=N.length)}if(this.afterContextMenu&&(this.lastSelectionStart=this.text.selectionStart,this.lastSelectionEnd=this.text.selectionEnd),this.lastSelectionEnd!=D||this.lastSelectionStart!=E||this.text.selectionEnd!=this.lastSelectionEnd)try{this.text.setSelectionRange(E,D),this.lastSelectionStart=E,this.lastSelectionEnd=D}catch{}this.inComposition=!1}},b.prototype.setHost=function(v){this.host=v},b.prototype.setNumberOfExtraLines=function(v){if(this.rowStart=Number.MAX_SAFE_INTEGER,this.rowEnd=Number.MIN_SAFE_INTEGER,v<0){this.numberOfExtraLines=0;return}this.numberOfExtraLines=v},b.prototype.setAriaLabel=function(){var v="";if(this.host.$textInputAriaLabel&&(v+="".concat(this.host.$textInputAriaLabel,", ")),this.host.session){var E=this.host.session.selection.cursor.row;v+=y("text-input.aria-label","Cursor at row $0",[E+1])}this.text.setAttribute("aria-label",v)},b.prototype.setAriaOptions=function(v){v.activeDescendant?(this.text.setAttribute("aria-haspopup","true"),this.text.setAttribute("aria-autocomplete",v.inline?"both":"list"),this.text.setAttribute("aria-activedescendant",v.activeDescendant)):(this.text.setAttribute("aria-haspopup","false"),this.text.setAttribute("aria-autocomplete","both"),this.text.removeAttribute("aria-activedescendant")),v.role&&this.text.setAttribute("role",v.role),v.setLabel&&(this.text.setAttribute("aria-roledescription",y("text-input.aria-roledescription","editor")),this.setAriaLabel())},b.prototype.focus=function(){var v=this;if(this.setAriaOptions({setLabel:this.host.renderer.enableKeyboardAccessibility}),this.tempStyle||o||this.$focusScroll=="browser")return this.text.focus({preventScroll:!0});var E=this.text.style.top;this.text.style.position="fixed",this.text.style.top="0px";try{var D=this.text.getBoundingClientRect().top!=0}catch{return}var L=[];if(D)for(var w=this.text.parentElement;w&&w.nodeType==1;)L.push(w),w.setAttribute("ace_nocontext","true"),!w.parentElement&&w.getRootNode?w=w.getRootNode().host:w=w.parentElement;this.text.focus({preventScroll:!0}),D&&L.forEach(function(I){I.removeAttribute("ace_nocontext")}),setTimeout(function(){v.text.style.position="",v.text.style.top=="0px"&&(v.text.style.top=E)},0)},b.prototype.blur=function(){this.text.blur()},b.prototype.isFocused=function(){return this.$isFocused},b.prototype.setInputHandler=function(v){this.inputHandler=v},b.prototype.getInputHandler=function(){return this.inputHandler},b.prototype.getElement=function(){return this.text},b.prototype.setCommandMode=function(v){this.commandMode=v,this.text.readOnly=!1},b.prototype.setReadOnly=function(v){this.commandMode||(this.text.readOnly=v)},b.prototype.setCopyWithEmptySelection=function(v){},b.prototype.onContextMenu=function(v){this.afterContextMenu=!0,this.resetSelection(),this.host._emit("nativecontextmenu",{target:this.host,domEvent:v}),this.moveToMouse(v,!0)},b.prototype.moveToMouse=function(v,E){var D=this;this.tempStyle||(this.tempStyle=this.text.style.cssText),this.text.style.cssText=(E?"z-index:100000;":"")+(m.isIE?"opacity:0.1;":"")+"text-indent: -"+(this.lastSelectionStart+this.lastSelectionEnd)*this.host.renderer.characterWidth*.5+"px;";var L=this.host.container.getBoundingClientRect(),w=l.computedStyle(this.host.container),I=L.top+(parseInt(w.borderTopWidth)||0),R=L.left+(parseInt(w.borderLeftWidth)||0),A=L.bottom-I-this.text.clientHeight-2,x=function(S){l.translate(D.text,S.clientX-R-2,Math.min(S.clientY-I-2,A))};x(v),v.type=="mousedown"&&(this.host.renderer.$isMousePressed=!0,clearTimeout(this.closeTimeout),m.isWin&&f.capture(this.host.container,x,this.onContextMenuClose.bind(this)))},b.prototype.destroy=function(){this.text.parentElement&&this.text.parentElement.removeChild(this.text)},b}();n.TextInput=M,n.$setUserAgentForTests=function(b,v){C=b,d=v}}),ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],function(t,n,p){var f=t("../lib/useragent"),y=0,m=550,l=function(){function a(s){s.$clickSelection=null;var o=s.editor;o.setDefaultHandler("mousedown",this.onMouseDown.bind(s)),o.setDefaultHandler("dblclick",this.onDoubleClick.bind(s)),o.setDefaultHandler("tripleclick",this.onTripleClick.bind(s)),o.setDefaultHandler("quadclick",this.onQuadClick.bind(s)),o.setDefaultHandler("mousewheel",this.onMouseWheel.bind(s));var i=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];i.forEach(function(c){s[c]=this[c]},this),s.selectByLines=this.extendSelectionBy.bind(s,"getLineRange"),s.selectByWords=this.extendSelectionBy.bind(s,"getWordRange")}return a.prototype.onMouseDown=function(s){var o=s.inSelection(),i=s.getDocumentPosition();this.mousedownEvent=s;var c=this.editor,h=s.getButton();if(h!==0){var d=c.getSelectionRange(),_=d.isEmpty();(_||h==1)&&c.selection.moveToPosition(i),h==2&&(c.textInput.onContextMenu(s.domEvent),f.isMozilla||s.preventDefault());return}if(this.mousedownEvent.time=Date.now(),o&&!c.isFocused()&&(c.focus(),this.$focusTimeout&&!this.$clickSelection&&!c.inMultiSelectMode)){this.setState("focusWait"),this.captureMouse(s);return}return this.captureMouse(s),this.startSelect(i,s.domEvent._clicks>1),s.preventDefault()},a.prototype.startSelect=function(s,o){s=s||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var i=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?i.selection.selectToPosition(s):o||i.selection.moveToPosition(s),o||this.select(),i.setStyle("ace_selecting"),this.setState("select"))},a.prototype.select=function(){var s,o=this.editor,i=o.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var c=this.$clickSelection.comparePoint(i);if(c==-1)s=this.$clickSelection.end;else if(c==1)s=this.$clickSelection.start;else{var h=r(this.$clickSelection,i,o.session);i=h.cursor,s=h.anchor}o.selection.setSelectionAnchor(s.row,s.column)}o.selection.selectToPosition(i),o.renderer.scrollCursorIntoView()},a.prototype.extendSelectionBy=function(s){var o,i=this.editor,c=i.renderer.screenToTextCoordinates(this.x,this.y),h=i.selection[s](c.row,c.column);if(this.$clickSelection){var d=this.$clickSelection.comparePoint(h.start),_=this.$clickSelection.comparePoint(h.end);if(d==-1&&_<=0)o=this.$clickSelection.end,(h.end.row!=c.row||h.end.column!=c.column)&&(c=h.start);else if(_==1&&d>=0)o=this.$clickSelection.start,(h.start.row!=c.row||h.start.column!=c.column)&&(c=h.end);else if(d==-1&&_==1)c=h.end,o=h.start;else{var C=r(this.$clickSelection,c,i.session);c=C.cursor,o=C.anchor}i.selection.setSelectionAnchor(o.row,o.column)}i.selection.selectToPosition(c),i.renderer.scrollCursorIntoView()},a.prototype.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting")},a.prototype.focusWait=function(){var s=u(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),o=Date.now();(s>y||o-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},a.prototype.onDoubleClick=function(s){var o=s.getDocumentPosition(),i=this.editor,c=i.session,h=c.getBracketRange(o);h?(h.isEmpty()&&(h.start.column--,h.end.column++),this.setState("select")):(h=i.selection.getWordRange(o.row,o.column),this.setState("selectByWords")),this.$clickSelection=h,this.select()},a.prototype.onTripleClick=function(s){var o=s.getDocumentPosition(),i=this.editor;this.setState("selectByLines");var c=i.getSelectionRange();c.isMultiLine()&&c.contains(o.row,o.column)?(this.$clickSelection=i.selection.getLineRange(c.start.row),this.$clickSelection.end=i.selection.getLineRange(c.end.row).end):this.$clickSelection=i.selection.getLineRange(o.row),this.select()},a.prototype.onQuadClick=function(s){var o=this.editor;o.selectAll(),this.$clickSelection=o.getSelectionRange(),this.setState("selectAll")},a.prototype.onMouseWheel=function(s){if(!s.getAccelKey()){s.getShiftKey()&&s.wheelY&&!s.wheelX&&(s.wheelX=s.wheelY,s.wheelY=0);var o=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var i=this.$lastScroll,c=s.domEvent.timeStamp,h=c-i.t,d=h?s.wheelX/h:i.vx,_=h?s.wheelY/h:i.vy;h<m&&(d=(d+i.vx)/2,_=(_+i.vy)/2);var C=Math.abs(d/_),M=!1;if(C>=1&&o.renderer.isScrollableBy(s.wheelX*s.speed,0)&&(M=!0),C<=1&&o.renderer.isScrollableBy(0,s.wheelY*s.speed)&&(M=!0),M)i.allowed=c;else if(c-i.allowed<m){var b=Math.abs(d)<=1.5*Math.abs(i.vx)&&Math.abs(_)<=1.5*Math.abs(i.vy);b?(M=!0,i.allowed=c):i.allowed=0}if(i.t=c,i.vx=d,i.vy=_,M)return o.renderer.scrollBy(s.wheelX*s.speed,s.wheelY*s.speed),s.stop()}},a}();l.prototype.selectEnd=l.prototype.selectByLinesEnd,l.prototype.selectAllEnd=l.prototype.selectByLinesEnd,l.prototype.selectByWordsEnd=l.prototype.selectByLinesEnd,n.DefaultHandlers=l;function u(a,s,o,i){return Math.sqrt(Math.pow(o-a,2)+Math.pow(i-s,2))}function r(a,s,o){if(a.start.row==a.end.row)var i=2*s.column-a.start.column-a.end.column;else if(a.start.row==a.end.row-1&&!a.start.column&&!a.end.column)var i=3*s.column-2*o.getLine(a.start.row).length;else var i=2*s.row-a.start.row-a.end.row;return i<0?{cursor:a.start,anchor:a.end}:{cursor:a.end,anchor:a.start}}}),ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(t,n,p){var f=t("../lib/event"),y=t("../lib/useragent"),m=function(){function l(u,r){this.speed,this.wheelX,this.wheelY,this.domEvent=u,this.editor=r,this.x=this.clientX=u.clientX,this.y=this.clientY=u.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1}return l.prototype.stopPropagation=function(){f.stopPropagation(this.domEvent),this.propagationStopped=!0},l.prototype.preventDefault=function(){f.preventDefault(this.domEvent),this.defaultPrevented=!0},l.prototype.stop=function(){this.stopPropagation(),this.preventDefault()},l.prototype.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},l.prototype.getGutterRow=function(){var u=this.getDocumentPosition().row,r=this.editor.session.documentToScreenRow(u,0),a=this.editor.session.documentToScreenRow(this.editor.renderer.$gutterLayer.$lines.get(0).row,0);return r-a},l.prototype.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var u=this.editor,r=u.getSelectionRange();if(r.isEmpty())this.$inSelection=!1;else{var a=this.getDocumentPosition();this.$inSelection=r.contains(a.row,a.column)}return this.$inSelection},l.prototype.getButton=function(){return f.getButton(this.domEvent)},l.prototype.getShiftKey=function(){return this.domEvent.shiftKey},l.prototype.getAccelKey=function(){return y.isMac?this.domEvent.metaKey:this.domEvent.ctrlKey},l}();n.MouseEvent=m}),ace.define("ace/lib/scroll",["require","exports","module"],function(t,n,p){n.preventParentScroll=function(y){y.stopPropagation();var m=y.currentTarget,l=m.scrollHeight>m.clientHeight;l||y.preventDefault()}}),ace.define("ace/tooltip",["require","exports","module","ace/lib/dom","ace/lib/event","ace/range","ace/lib/scroll"],function(t,n,p){var f=this&&this.__extends||function(){var c=function(h,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,C){_.__proto__=C}||function(_,C){for(var M in C)Object.prototype.hasOwnProperty.call(C,M)&&(_[M]=C[M])},c(h,d)};return function(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");c(h,d);function _(){this.constructor=h}h.prototype=d===null?Object.create(d):(_.prototype=d.prototype,new _)}}(),y=this&&this.__values||function(c){var h=typeof Symbol=="function"&&Symbol.iterator,d=h&&c[h],_=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&_>=c.length&&(c=void 0),{value:c&&c[_++],done:!c}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")},m=t("./lib/dom");t("./lib/event");var l=t("./range").Range,u=t("./lib/scroll").preventParentScroll,r="ace_tooltip",a=function(){function c(h){this.isOpen=!1,this.$element=null,this.$parentNode=h}return c.prototype.$init=function(){return this.$element=m.createElement("div"),this.$element.className=r,this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},c.prototype.getElement=function(){return this.$element||this.$init()},c.prototype.setText=function(h){this.getElement().textContent=h},c.prototype.setHtml=function(h){this.getElement().innerHTML=h},c.prototype.setPosition=function(h,d){this.getElement().style.left=h+"px",this.getElement().style.top=d+"px"},c.prototype.setClassName=function(h){m.addCssClass(this.getElement(),h)},c.prototype.setTheme=function(h){this.theme&&(this.theme.isDark&&m.removeCssClass(this.getElement(),"ace_dark"),this.theme.cssClass&&m.removeCssClass(this.getElement(),this.theme.cssClass)),h.isDark&&m.addCssClass(this.getElement(),"ace_dark"),h.cssClass&&m.addCssClass(this.getElement(),h.cssClass),this.theme={isDark:h.isDark,cssClass:h.cssClass}},c.prototype.show=function(h,d,_){h!=null&&this.setText(h),d!=null&&_!=null&&this.setPosition(d,_),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},c.prototype.hide=function(h){this.isOpen&&(this.getElement().style.display="none",this.getElement().className=r,this.isOpen=!1)},c.prototype.getHeight=function(){return this.getElement().offsetHeight},c.prototype.getWidth=function(){return this.getElement().offsetWidth},c.prototype.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)},c}(),s=function(){function c(){this.popups=[]}return c.prototype.addPopup=function(h){this.popups.push(h),this.updatePopups()},c.prototype.removePopup=function(h){var d=this.popups.indexOf(h);d!==-1&&(this.popups.splice(d,1),this.updatePopups())},c.prototype.updatePopups=function(){var h,d,_,C;this.popups.sort(function(R,A){return A.priority-R.priority});var M=[];try{for(var b=y(this.popups),v=b.next();!v.done;v=b.next()){var E=v.value,D=!0;try{for(var L=(_=void 0,y(M)),w=L.next();!w.done;w=L.next()){var I=w.value;if(this.doPopupsOverlap(I,E)){D=!1;break}}}catch(R){_={error:R}}finally{try{w&&!w.done&&(C=L.return)&&C.call(L)}finally{if(_)throw _.error}}D?M.push(E):E.hide()}}catch(R){h={error:R}}finally{try{v&&!v.done&&(d=b.return)&&d.call(b)}finally{if(h)throw h.error}}},c.prototype.doPopupsOverlap=function(h,d){var _=h.getElement().getBoundingClientRect(),C=d.getElement().getBoundingClientRect();return _.left<C.right&&_.right>C.left&&_.top<C.bottom&&_.bottom>C.top},c}(),o=new s;n.popupManager=o,n.Tooltip=a;var i=function(c){f(h,c);function h(d){d===void 0&&(d=document.body);var _=c.call(this,d)||this;_.timeout=void 0,_.lastT=0,_.idleTime=350,_.lastEvent=void 0,_.onMouseOut=_.onMouseOut.bind(_),_.onMouseMove=_.onMouseMove.bind(_),_.waitForHover=_.waitForHover.bind(_),_.hide=_.hide.bind(_);var C=_.getElement();return C.style.whiteSpace="pre-wrap",C.style.pointerEvents="auto",C.addEventListener("mouseout",_.onMouseOut),C.tabIndex=-1,C.addEventListener("blur",function(){C.contains(document.activeElement)||this.hide()}.bind(_)),C.addEventListener("wheel",u),_}return h.prototype.addToEditor=function(d){d.on("mousemove",this.onMouseMove),d.on("mousedown",this.hide);var _=d.renderer.getMouseEventTarget();_&&typeof _.removeEventListener=="function"&&_.addEventListener("mouseout",this.onMouseOut,!0)},h.prototype.removeFromEditor=function(d){d.off("mousemove",this.onMouseMove),d.off("mousedown",this.hide);var _=d.renderer.getMouseEventTarget();_&&typeof _.removeEventListener=="function"&&_.removeEventListener("mouseout",this.onMouseOut,!0),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},h.prototype.onMouseMove=function(d,_){this.lastEvent=d,this.lastT=Date.now();var C=_.$mouseHandler.isMousePressed;if(this.isOpen){var M=this.lastEvent&&this.lastEvent.getDocumentPosition();(!this.range||!this.range.contains(M.row,M.column)||C||this.isOutsideOfText(this.lastEvent))&&this.hide()}this.timeout||C||(this.lastEvent=d,this.timeout=setTimeout(this.waitForHover,this.idleTime))},h.prototype.waitForHover=function(){this.timeout&&clearTimeout(this.timeout);var d=Date.now()-this.lastT;if(this.idleTime-d>10){this.timeout=setTimeout(this.waitForHover,this.idleTime-d);return}this.timeout=null,this.lastEvent&&!this.isOutsideOfText(this.lastEvent)&&this.$gatherData(this.lastEvent,this.lastEvent.editor)},h.prototype.isOutsideOfText=function(d){var _=d.editor,C=d.getDocumentPosition(),M=_.session.getLine(C.row);if(C.column==M.length){var b=_.renderer.pixelToScreenCoordinates(d.clientX,d.clientY),v=_.session.documentToScreenPosition(C.row,C.column);if(v.column!=b.column||v.row!=b.row)return!0}return!1},h.prototype.setDataProvider=function(d){this.$gatherData=d},h.prototype.showForRange=function(d,_,C,M){if(!(M&&M!=this.lastEvent)&&!(this.isOpen&&document.activeElement==this.getElement())){var b=d.renderer;this.isOpen||(o.addPopup(this),this.$registerCloseEvents(),this.setTheme(b.theme)),this.isOpen=!0,this.range=l.fromPoints(_.start,_.end);var v=b.textToScreenCoordinates(_.start.row,_.start.column),E=b.scroller.getBoundingClientRect();v.pageX<E.left&&(v.pageX=E.left);var D=this.getElement();D.innerHTML="",D.appendChild(C),D.style.maxHeight="",D.style.display="block",this.$setPosition(d,v,!0,_),m.$fixPositionBug(D)}},h.prototype.$setPosition=function(d,_,C,M){var b=10;C&&this.addMarker(M,d.session);var v=d.renderer,E=this.getElement(),D=E.offsetHeight,L=E.offsetWidth,w=_.pageY,I=_.pageX,R=window.innerHeight-w-v.lineHeight,A=this.$shouldPlaceAbove(D,w,R-b);E.style.maxHeight=(A?w:R)-b+"px",E.style.top=A?"":w+v.lineHeight+"px",E.style.bottom=A?window.innerHeight-w+"px":"",E.style.left=Math.min(I,window.innerWidth-L-b)+"px"},h.prototype.$shouldPlaceAbove=function(d,_,C){return!(_-d<0&&_<C)},h.prototype.addMarker=function(d,_){this.marker&&this.$markerSession.removeMarker(this.marker),this.$markerSession=_,this.marker=_&&_.addMarker(d,"ace_highlight-marker","text")},h.prototype.hide=function(d){d&&this.$fromKeyboard&&d.type=="keydown"&&d.code=="Escape"||!d&&document.activeElement==this.getElement()||d&&d.target&&(d.type!="keydown"||d.ctrlKey||d.metaKey)&&this.$element.contains(d.target)||(this.lastEvent=null,this.timeout&&clearTimeout(this.timeout),this.timeout=null,this.addMarker(null),this.isOpen&&(this.$fromKeyboard=!1,this.$removeCloseEvents(),this.getElement().style.display="none",this.isOpen=!1,o.removePopup(this)))},h.prototype.$registerCloseEvents=function(){window.addEventListener("keydown",this.hide,!0),window.addEventListener("wheel",this.hide,!0),window.addEventListener("mousedown",this.hide,!0)},h.prototype.$removeCloseEvents=function(){window.removeEventListener("keydown",this.hide,!0),window.removeEventListener("wheel",this.hide,!0),window.removeEventListener("mousedown",this.hide,!0)},h.prototype.onMouseOut=function(d){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.lastEvent=null,this.isOpen&&(!d.relatedTarget||this.getElement().contains(d.relatedTarget)||d&&d.currentTarget.contains(d.relatedTarget)||d.relatedTarget.classList.contains("ace_content")||this.hide())},h}(a);n.HoverTooltip=i}),ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/mouse/mouse_event","ace/tooltip","ace/config","ace/range"],function(t,n,p){var f=this&&this.__extends||function(){var i=function(c,h){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,_){d.__proto__=_}||function(d,_){for(var C in _)Object.prototype.hasOwnProperty.call(_,C)&&(d[C]=_[C])},i(c,h)};return function(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");i(c,h);function d(){this.constructor=c}c.prototype=h===null?Object.create(h):(d.prototype=h.prototype,new d)}}(),y=this&&this.__values||function(i){var c=typeof Symbol=="function"&&Symbol.iterator,h=c&&i[c],d=0;if(h)return h.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&d>=i.length&&(i=void 0),{value:i&&i[d++],done:!i}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},m=t("../lib/dom"),l=t("./mouse_event").MouseEvent,u=t("../tooltip").HoverTooltip,r=t("../config").nls,a=t("../range").Range;function s(i){var c=i.editor,h=c.renderer.$gutterLayer;i.$tooltip=new o(c),i.$tooltip.addToEditor(c),i.$tooltip.setDataProvider(function(d,_){var C=d.getDocumentPosition().row;i.$tooltip.showTooltip(C)}),i.editor.setDefaultHandler("guttermousedown",function(d){if(!(!c.isFocused()||d.getButton()!=0)){var _=h.getRegion(d);if(_!="foldWidgets"){var C=d.getDocumentPosition().row,M=c.session.selection;if(d.getShiftKey())M.selectTo(C,0);else{if(d.domEvent.detail==2)return c.selectAll(),d.preventDefault();i.$clickSelection=c.selection.getLineRange(C)}return i.setState("selectByLines"),i.captureMouse(d),d.preventDefault()}}})}n.GutterHandler=s;var o=function(i){f(c,i);function c(h){var d=i.call(this,h.container)||this;d.id="gt"+ ++c.$uid,d.editor=h,d.visibleTooltipRow;var _=d.getElement();return _.setAttribute("role","tooltip"),_.setAttribute("id",d.id),_.style.pointerEvents="auto",d.idleTime=50,d.onDomMouseMove=d.onDomMouseMove.bind(d),d.onDomMouseOut=d.onDomMouseOut.bind(d),d.setClassName("ace_gutter-tooltip"),d}return c.prototype.onDomMouseMove=function(h){var d=new l(h,this.editor);this.onMouseMove(d,this.editor)},c.prototype.onDomMouseOut=function(h){var d=new l(h,this.editor);this.onMouseOut(d)},c.prototype.addToEditor=function(h){var d=h.renderer.$gutter;d.addEventListener("mousemove",this.onDomMouseMove),d.addEventListener("mouseout",this.onDomMouseOut),i.prototype.addToEditor.call(this,h)},c.prototype.removeFromEditor=function(h){var d=h.renderer.$gutter;d.removeEventListener("mousemove",this.onDomMouseMove),d.removeEventListener("mouseout",this.onDomMouseOut),i.prototype.removeFromEditor.call(this,h)},c.prototype.destroy=function(){this.editor&&this.removeFromEditor(this.editor),i.prototype.destroy.call(this)},Object.defineProperty(c,"annotationLabels",{get:function(){return{error:{singular:r("gutter-tooltip.aria-label.error.singular","error"),plural:r("gutter-tooltip.aria-label.error.plural","errors")},security:{singular:r("gutter-tooltip.aria-label.security.singular","security finding"),plural:r("gutter-tooltip.aria-label.security.plural","security findings")},warning:{singular:r("gutter-tooltip.aria-label.warning.singular","warning"),plural:r("gutter-tooltip.aria-label.warning.plural","warnings")},info:{singular:r("gutter-tooltip.aria-label.info.singular","information message"),plural:r("gutter-tooltip.aria-label.info.plural","information messages")},hint:{singular:r("gutter-tooltip.aria-label.hint.singular","suggestion"),plural:r("gutter-tooltip.aria-label.hint.plural","suggestions")}}},enumerable:!1,configurable:!0}),c.prototype.showTooltip=function(h){var d,_=this.editor.renderer.$gutterLayer,C=_.$annotations[h],M;C?M={displayText:Array.from(C.displayText),type:Array.from(C.type)}:M={displayText:[],type:[]};var b=_.session.getFoldLine(h);if(b&&_.$showFoldedAnnotations){for(var v={error:[],security:[],warning:[],info:[],hint:[]},E={error:1,security:2,warning:3,info:4,hint:5},D,L=h+1;L<=b.end.row;L++)if(_.$annotations[L])for(var w=0;w<_.$annotations[L].text.length;w++){var I=_.$annotations[L].type[w];v[I].push(_.$annotations[L].text[w]),(!D||E[I]<E[D])&&(D=I)}if(["error","security","warning"].includes(D)){var R="".concat(c.annotationsToSummaryString(v)," in folded code.");M.displayText.push(R),M.type.push(D+"_fold")}}if(M.displayText.length===0)return this.hide();for(var A={error:[],security:[],warning:[],info:[],hint:[]},x=_.$useSvgGutterIcons?"ace_icon_svg":"ace_icon",L=0;L<M.displayText.length;L++){var S=m.createElement("span"),T=m.createElement("span");(d=T.classList).add.apply(d,["ace_".concat(M.type[L]),x]),T.setAttribute("aria-label","".concat(c.annotationLabels[M.type[L].replace("_fold","")].singular)),T.setAttribute("role","img"),T.appendChild(m.createTextNode(" ")),S.appendChild(T),S.appendChild(m.createTextNode(M.displayText[L])),S.appendChild(m.createElement("br")),A[M.type[L].replace("_fold","")].push(S)}var P=m.createElement("span");A.error.forEach(function(O){return P.appendChild(O)}),A.security.forEach(function(O){return P.appendChild(O)}),A.warning.forEach(function(O){return P.appendChild(O)}),A.info.forEach(function(O){return P.appendChild(O)}),A.hint.forEach(function(O){return P.appendChild(O)}),P.setAttribute("aria-live","polite");var N=this.$findLinkedAnnotationNode(h);N&&N.setAttribute("aria-describedby",this.id);var k=a.fromPoints({row:h,column:0},{row:h,column:0});this.showForRange(this.editor,k,P),this.visibleTooltipRow=h,this.editor._signal("showGutterTooltip",this)},c.prototype.$setPosition=function(h,d,_,C){var M=this.$findCellByRow(C.start.row);if(M){var b=M&&M.element,v=b&&b.querySelector(".ace_gutter_annotation");if(v){var E=v.getBoundingClientRect();if(E){var D={pageX:E.right,pageY:E.top};return i.prototype.$setPosition.call(this,h,D,!1,C)}}}},c.prototype.$shouldPlaceAbove=function(h,d,_){return _<h},c.prototype.$findLinkedAnnotationNode=function(h){var d=this.$findCellByRow(h);if(d){var _=d.element;if(_.childNodes.length>2)return _.childNodes[2]}},c.prototype.$findCellByRow=function(h){return this.editor.renderer.$gutterLayer.$lines.cells.find(function(d){return d.row===h})},c.prototype.hide=function(h){if(this.isOpen){if(this.$element.removeAttribute("aria-live"),this.visibleTooltipRow!=null){var d=this.$findLinkedAnnotationNode(this.visibleTooltipRow);d&&d.removeAttribute("aria-describedby")}this.visibleTooltipRow=void 0,this.editor._signal("hideGutterTooltip",this),i.prototype.hide.call(this,h)}},c.annotationsToSummaryString=function(h){var d,_,C=[],M=["error","security","warning","info","hint"];try{for(var b=y(M),v=b.next();!v.done;v=b.next()){var E=v.value;if(h[E].length){var D=h[E].length===1?c.annotationLabels[E].singular:c.annotationLabels[E].plural;C.push("".concat(h[E].length," ").concat(D))}}}catch(L){d={error:L}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(d)throw d.error}}return C.join(", ")},c.prototype.isOutsideOfText=function(h){var d=h.editor,_=d.renderer.$gutter.getBoundingClientRect();return!(h.clientX>=_.left&&h.clientX<=_.right&&h.clientY>=_.top&&h.clientY<=_.bottom)},c}(u);o.$uid=0,n.GutterTooltip=o}),ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(t,n,p){var f=t("../lib/dom"),y=t("../lib/event"),m=t("../lib/useragent"),l=200,u=200,r=5;function a(o){var i=o.editor,c=f.createElement("div");c.style.cssText="top:-100px;position:absolute;z-index:2147483647;opacity:0.5",c.textContent="";var h=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];h.forEach(function(H){o[H]=this[H]},this),i.on("mousedown",this.onMouseDown.bind(o));var d=i.container,_,C,M,b,v,E,D=0,L,w,I,R,A;this.onDragStart=function(H){if(this.cancelDrag||!d.draggable){var U=this;return setTimeout(function(){U.startSelect(),U.captureMouse(H)},0),H.preventDefault()}v=i.getSelectionRange();var z=H.dataTransfer;z.effectAllowed=i.getReadOnly()?"copy":"copyMove",i.container.appendChild(c),z.setDragImage&&z.setDragImage(c,0,0),setTimeout(function(){i.container.removeChild(c)}),z.clearData(),z.setData("Text",i.session.getTextRange()),w=!0,this.setState("drag")},this.onDragEnd=function(H){if(d.draggable=!1,w=!1,this.setState(null),!i.getReadOnly()){var U=H.dataTransfer.dropEffect;!L&&U=="move"&&i.session.remove(i.getSelectionRange()),i.$resetCursorStyle()}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(H){if(!(i.getReadOnly()||!$(H.dataTransfer)))return C=H.clientX,M=H.clientY,_||P(),D++,H.dataTransfer.dropEffect=L=V(H),y.preventDefault(H)},this.onDragOver=function(H){if(!(i.getReadOnly()||!$(H.dataTransfer)))return C=H.clientX,M=H.clientY,_||(P(),D++),k!==null&&(k=null),H.dataTransfer.dropEffect=L=V(H),y.preventDefault(H)},this.onDragLeave=function(H){if(D--,D<=0&&_)return N(),L=null,y.preventDefault(H)},this.onDrop=function(H){if(E){var U=H.dataTransfer;if(w)switch(L){case"move":v.contains(E.row,E.column)?v={start:E,end:E}:v=i.moveText(v,E);break;case"copy":v=i.moveText(v,E,!0);break}else{var z=U.getData("Text");v={start:E,end:i.session.insert(E,z)},i.focus(),L=null}return N(),y.preventDefault(H)}},y.addListener(d,"dragstart",this.onDragStart.bind(o),i),y.addListener(d,"dragend",this.onDragEnd.bind(o),i),y.addListener(d,"dragenter",this.onDragEnter.bind(o),i),y.addListener(d,"dragover",this.onDragOver.bind(o),i),y.addListener(d,"dragleave",this.onDragLeave.bind(o),i),y.addListener(d,"drop",this.onDrop.bind(o),i);function x(H,U){var z=Date.now(),G=!U||H.row!=U.row,K=!U||H.column!=U.column;if(!R||G||K)i.moveCursorToPosition(H),R=z,A={x:C,y:M};else{var Y=s(A.x,A.y,C,M);Y>r?R=null:z-R>=u&&(i.renderer.scrollCursorIntoView(),R=null)}}function S(H,U){var z=Date.now(),G=i.renderer.layerConfig.lineHeight,K=i.renderer.layerConfig.characterWidth,Y=i.renderer.scroller.getBoundingClientRect(),Z={x:{left:C-Y.left,right:Y.right-C},y:{top:M-Y.top,bottom:Y.bottom-M}},ie=Math.min(Z.x.left,Z.x.right),oe=Math.min(Z.y.top,Z.y.bottom),j={row:H.row,column:H.column};ie/K<=2&&(j.column+=Z.x.left<Z.x.right?-3:2),oe/G<=1&&(j.row+=Z.y.top<Z.y.bottom?-1:1);var ke=H.row!=j.row,ge=H.column!=j.column,me=!U||H.row!=U.row;ke||ge&&!me?I?z-I>=l&&i.renderer.scrollCursorIntoView(j):I=z:I=null}function T(){var H=E;E=i.renderer.screenToTextCoordinates(C,M),x(E,H),S(E,H)}function P(){v=i.selection.toOrientedRange(),_=i.session.addMarker(v,"ace_selection",i.getSelectionStyle()),i.clearSelection(),i.isFocused()&&i.renderer.$cursorLayer.setBlinking(!1),clearInterval(b),T(),b=setInterval(T,20),D=0,y.addListener(document,"mousemove",O)}function N(){clearInterval(b),i.session.removeMarker(_),_=null,i.selection.fromOrientedRange(v),i.isFocused()&&!w&&i.$resetCursorStyle(),v=null,E=null,D=0,I=null,R=null,y.removeListener(document,"mousemove",O)}var k=null;function O(){k==null&&(k=setTimeout(function(){k!=null&&_&&N()},20))}function $(H){var U=H.types;return!U||Array.prototype.some.call(U,function(z){return z=="text/plain"||z=="Text"})}function V(H){var U=["copy","copymove","all","uninitialized"],z=["move","copymove","linkmove","all","uninitialized"],G=m.isMac?H.altKey:H.ctrlKey,K="uninitialized";try{K=H.dataTransfer.effectAllowed.toLowerCase()}catch{}var Y="none";return G&&U.indexOf(K)>=0?Y="copy":z.indexOf(K)>=0?Y="move":U.indexOf(K)>=0&&(Y="copy"),Y}}(function(){this.dragWait=function(){var o=Date.now()-this.mousedownEvent.time;o>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){var o=this.editor.container;o.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(o){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var o=this.editor,i=o.container;i.draggable=!0,o.renderer.$cursorLayer.setBlinking(!1),o.setStyle("ace_dragging");var c=m.isWin?"default":"move";o.renderer.setCursorStyle(c),this.setState("dragReady")},this.onMouseDrag=function(o){var i=this.editor.container;if(m.isIE&&this.state=="dragReady"){var c=s(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);c>3&&i.dragDrop()}if(this.state==="dragWait"){var c=s(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);c>0&&(i.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(o){if(this.$dragEnabled){this.mousedownEvent=o;var i=this.editor,c=o.inSelection(),h=o.getButton(),d=o.domEvent.detail||1;if(d===1&&h===0&&c){if(o.editor.inMultiSelectMode&&(o.getAccelKey()||o.getShiftKey()))return;this.mousedownEvent.time=Date.now();var _=o.domEvent.target||o.domEvent.srcElement;if("unselectable"in _&&(_.unselectable="on"),i.getDragDelay()){if(m.isWebKit){this.cancelDrag=!0;var C=i.container;C.draggable=!0}this.setState("dragWait")}else this.startDrag();this.captureMouse(o,this.onMouseDrag.bind(this)),o.defaultPrevented=!0}}}}).call(a.prototype);function s(o,i,c,h){return Math.sqrt(Math.pow(c-o,2)+Math.pow(h-i,2))}n.DragdropHandler=a}),ace.define("ace/mouse/touch_handler",["require","exports","module","ace/mouse/mouse_event","ace/lib/event","ace/lib/dom"],function(t,n,p){var f=t("./mouse_event").MouseEvent,y=t("../lib/event"),m=t("../lib/dom");n.addTouchListeners=function(l,u){var r="scroll",a,s,o,i,c,h,d=0,_,C=0,M=0,b=0,v,E;function D(){var x=window.navigator&&window.navigator.clipboard,S=!1,T=function(){var k=u.getCopyText(),O=u.session.getUndoManager().hasUndo();E.replaceChild(m.buildDom(S?["span",!k&&P("selectall")&&["span",{class:"ace_mobile-button",action:"selectall"},"Select All"],k&&P("copy")&&["span",{class:"ace_mobile-button",action:"copy"},"Copy"],k&&P("cut")&&["span",{class:"ace_mobile-button",action:"cut"},"Cut"],x&&P("paste")&&["span",{class:"ace_mobile-button",action:"paste"},"Paste"],O&&P("undo")&&["span",{class:"ace_mobile-button",action:"undo"},"Undo"],P("find")&&["span",{class:"ace_mobile-button",action:"find"},"Find"],P("openCommandPalette")&&["span",{class:"ace_mobile-button",action:"openCommandPalette"},"Palette"]]:["span"]),E.firstChild)},P=function(k){return u.commands.canExecute(k,u)},N=function(k){var O=k.target.getAttribute("action");if(O=="more"||!S)return S=!S,T();O=="paste"?x.readText().then(function($){u.execCommand(O,$)}):O&&((O=="cut"||O=="copy")&&(x?x.writeText(u.getCopyText()):document.execCommand("copy")),u.execCommand(O)),E.firstChild.style.display="none",S=!1,O!="openCommandPalette"&&u.focus()};E=m.buildDom(["div",{class:"ace_mobile-menu",ontouchstart:function(k){r="menu",k.stopPropagation(),k.preventDefault(),u.textInput.focus()},ontouchend:function(k){k.stopPropagation(),k.preventDefault(),N(k)},onclick:N},["span"],["span",{class:"ace_mobile-button",action:"more"},"..."]],u.container)}function L(){if(!u.getOption("enableMobileMenu")){E&&w();return}E||D();var x=u.selection.cursor,S=u.renderer.textToScreenCoordinates(x.row,x.column),T=u.renderer.textToScreenCoordinates(0,0).pageX,P=u.renderer.scrollLeft,N=u.container.getBoundingClientRect();E.style.top=S.pageY-N.top-3+"px",S.pageX-N.left<N.width-70?(E.style.left="",E.style.right="10px"):(E.style.right="",E.style.left=T+P-N.left+"px"),E.style.display="",E.firstChild.style.display="none",u.on("input",w)}function w(x){E&&(E.style.display="none"),u.off("input",w)}function I(){c=null,clearTimeout(c);var x=u.selection.getRange(),S=x.contains(_.row,_.column);(x.isEmpty()||!S)&&(u.selection.moveToPosition(_),u.selection.selectWord()),r="wait",L()}function R(){c=null,clearTimeout(c),u.selection.moveToPosition(_);var x=C>=2?u.selection.getLineRange(_.row):u.session.getBracketRange(_);x&&!x.isEmpty()?u.selection.setRange(x):u.selection.selectWord(),r="wait"}y.addListener(l,"contextmenu",function(x){if(v){var S=u.textInput.getElement();S.focus()}},u),y.addListener(l,"touchstart",function(x){var S=x.touches;if(c||S.length>1){clearTimeout(c),c=null,o=-1,r="zoom";return}v=u.$mouseHandler.isMousePressed=!0;var T=u.renderer.layerConfig.lineHeight,P=u.renderer.layerConfig.lineHeight,N=x.timeStamp;i=N;var k=S[0],O=k.clientX,$=k.clientY;Math.abs(a-O)+Math.abs(s-$)>T&&(o=-1),a=x.clientX=O,s=x.clientY=$,M=b=0;var V=new f(x,u);if(_=V.getDocumentPosition(),N-o<500&&S.length==1&&!d)C++,x.preventDefault(),x.button=0,R();else{C=0;var H=u.selection.cursor,U=u.selection.isEmpty()?H:u.selection.anchor,z=u.renderer.$cursorLayer.getPixelPosition(H,!0),G=u.renderer.$cursorLayer.getPixelPosition(U,!0),K=u.renderer.scroller.getBoundingClientRect(),Y=u.renderer.layerConfig.offset,Z=u.renderer.scrollLeft,ie=function(ke,ge){return ke=ke/P,ge=ge/T-.75,ke*ke+ge*ge};if(x.clientX<K.left){r="zoom";return}var oe=ie(x.clientX-K.left-z.left+Z,x.clientY-K.top-z.top+Y),j=ie(x.clientX-K.left-G.left+Z,x.clientY-K.top-G.top+Y);oe<3.5&&j<3.5&&(r=oe>j?"cursor":"anchor"),j<3.5?r="anchor":oe<3.5?r="cursor":r="scroll",c=setTimeout(I,450)}o=N},u),y.addListener(l,"touchend",function(x){v=u.$mouseHandler.isMousePressed=!1,h&&clearInterval(h),r=="zoom"?(r="",d=0):c?(u.selection.moveToPosition(_),d=0,L()):r=="scroll"?(A(),w()):L(),clearTimeout(c),c=null},u),y.addListener(l,"touchmove",function(x){c&&(clearTimeout(c),c=null);var S=x.touches;if(!(S.length>1||r=="zoom")){var T=S[0],P=a-T.clientX,N=s-T.clientY;if(r=="wait")if(P*P+N*N>4)r="cursor";else return x.preventDefault();a=T.clientX,s=T.clientY,x.clientX=T.clientX,x.clientY=T.clientY;var k=x.timeStamp,O=k-i;if(i=k,r=="scroll"){var $=new f(x,u);$.speed=1,$.wheelX=P,$.wheelY=N,10*Math.abs(P)<Math.abs(N)&&(P=0),10*Math.abs(N)<Math.abs(P)&&(N=0),O!=0&&(M=P/O,b=N/O),u._emit("mousewheel",$),$.propagationStopped||(M=b=0)}else{var V=new f(x,u),H=V.getDocumentPosition();r=="cursor"?u.selection.moveCursorToPosition(H):r=="anchor"&&u.selection.setSelectionAnchor(H.row,H.column),u.renderer.scrollCursorIntoView(H),x.preventDefault()}}},u);function A(){d+=60,h=setInterval(function(){d--<=0&&(clearInterval(h),h=null),Math.abs(M)<.01&&(M=0),Math.abs(b)<.01&&(b=0),d<20&&(M=.9*M),d<20&&(b=.9*b);var x=u.session.getScrollTop();u.renderer.scrollBy(10*M,10*b),x==u.session.getScrollTop()&&(d=0)},10)}}}),ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/mouse/touch_handler","ace/config"],function(t,n,p){var f=t("../lib/event"),y=t("../lib/useragent"),m=t("./default_handlers").DefaultHandlers,l=t("./default_gutter_handler").GutterHandler,u=t("./mouse_event").MouseEvent,r=t("./dragdrop_handler").DragdropHandler,a=t("./touch_handler").addTouchListeners,s=t("../config"),o=function(){function i(c){this.$dragDelay,this.$dragEnabled,this.$mouseMoved,this.mouseEvent,this.$focusTimeout;var h=this;this.editor=c,new m(this),new l(this),new r(this);var d=function(M){var b=!document.hasFocus||!document.hasFocus()||!c.isFocused()&&document.activeElement==(c.textInput&&c.textInput.getElement());b&&window.focus(),c.focus(),setTimeout(function(){c.isFocused()||c.focus()})},_=c.renderer.getMouseEventTarget();f.addListener(_,"click",this.onMouseEvent.bind(this,"click"),c),f.addListener(_,"mousemove",this.onMouseMove.bind(this,"mousemove"),c),f.addMultiMouseDownListener([_,c.renderer.scrollBarV&&c.renderer.scrollBarV.inner,c.renderer.scrollBarH&&c.renderer.scrollBarH.inner,c.textInput&&c.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",c),f.addMouseWheelListener(c.container,this.onMouseWheel.bind(this,"mousewheel"),c),a(c.container,c);var C=c.renderer.$gutter;f.addListener(C,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"),c),f.addListener(C,"click",this.onMouseEvent.bind(this,"gutterclick"),c),f.addListener(C,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),c),f.addListener(C,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),c),f.addListener(_,"mousedown",d,c),f.addListener(C,"mousedown",d,c),y.isIE&&c.renderer.scrollBarV&&(f.addListener(c.renderer.scrollBarV.element,"mousedown",d,c),f.addListener(c.renderer.scrollBarH.element,"mousedown",d,c)),c.on("mousemove",function(M){if(!(h.state||h.$dragDelay||!h.$dragEnabled)){var b=c.renderer.screenToTextCoordinates(M.x,M.y),v=c.session.selection.getRange(),E=c.renderer;!v.isEmpty()&&v.insideStart(b.row,b.column)?E.setCursorStyle("default"):E.setCursorStyle("")}},c)}return i.prototype.onMouseEvent=function(c,h){this.editor.session&&this.editor._emit(c,new u(h,this.editor))},i.prototype.onMouseMove=function(c,h){var d=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;!d||!d.length||this.editor._emit(c,new u(h,this.editor))},i.prototype.onMouseWheel=function(c,h){var d=new u(h,this.editor);d.speed=this.$scrollSpeed*2,d.wheelX=h.wheelX,d.wheelY=h.wheelY,this.editor._emit(c,d)},i.prototype.setState=function(c){this.state=c},i.prototype.captureMouse=function(c,h){this.x=c.x,this.y=c.y,this.isMousePressed=!0;var d=this.editor,_=this.editor.renderer;_.$isMousePressed=!0;var C=this,M=!0,b=function(w){if(w){if(y.isWebKit&&!w.which&&C.releaseMouse)return C.releaseMouse();C.x=w.clientX,C.y=w.clientY,h&&h(w),C.mouseEvent=new u(w,C.editor),C.$mouseMoved=!0}},v=function(w){d.off("beforeEndOperation",L),M=!1,d.session&&E(),C[C.state+"End"]&&C[C.state+"End"](w),C.state="",C.isMousePressed=_.$isMousePressed=!1,_.$keepTextAreaAtCursor&&_.$moveTextAreaToCursor(),C.$onCaptureMouseMove=C.releaseMouse=null,w&&C.onMouseEvent("mouseup",w),d.endOperation()},E=function(){C[C.state]&&C[C.state](),C.$mouseMoved=!1},D=function(){M&&(E(),f.nextFrame(D))};if(y.isOldIE&&c.domEvent.type=="dblclick")return setTimeout(function(){v(c)});var L=function(w){C.releaseMouse&&d.curOp.command.name&&d.curOp.selectionChanged&&(C[C.state+"End"]&&C[C.state+"End"](),C.state="",C.releaseMouse())};d.on("beforeEndOperation",L),d.startOperation({command:{name:"mouse"}}),C.$onCaptureMouseMove=b,C.releaseMouse=f.capture(this.editor.container,b,v),D()},i.prototype.cancelContextMenu=function(){var c=function(h){h&&h.domEvent&&h.domEvent.type!="contextmenu"||(this.editor.off("nativecontextmenu",c),h&&h.domEvent&&f.stopEvent(h.domEvent))}.bind(this);setTimeout(c,10),this.editor.on("nativecontextmenu",c)},i.prototype.destroy=function(){this.releaseMouse&&this.releaseMouse(),this.$tooltip&&this.$tooltip.destroy()},i}();o.prototype.releaseMouse=null,s.defineOptions(o.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:y.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0}}),n.MouseHandler=o}),ace.define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],function(t,n,p){var f=t("../lib/dom"),y=function(){function m(l){l.on("click",function(u){var r=u.getDocumentPosition(),a=l.session,s=a.getFoldAt(r.row,r.column,1);s&&(u.getAccelKey()?a.removeFold(s):a.expandFold(s),u.stop());var o=u.domEvent&&u.domEvent.target;o&&f.hasCssClass(o,"ace_inline_button")&&f.hasCssClass(o,"ace_toggle_wrap")&&(a.setOption("wrap",!a.getUseWrapMode()),l.renderer.scrollCursorIntoView())}),l.on("gutterclick",function(u){var r=l.renderer.$gutterLayer.getRegion(u);if(r=="foldWidgets"){var a=u.getDocumentPosition().row,s=l.session;s.foldWidgets&&s.foldWidgets[a]&&l.session.onFoldWidgetClick(a,u),l.isFocused()||l.focus(),u.stop()}}),l.on("gutterdblclick",function(u){var r=l.renderer.$gutterLayer.getRegion(u);if(r=="foldWidgets"){var a=u.getDocumentPosition().row,s=l.session,o=s.getParentFoldRangeData(a,!0),i=o.range||o.firstRange;if(i){a=i.start.row;var c=s.getFoldAt(a,s.getLine(a).length,1);c?s.removeFold(c):(s.addFold("...",i),l.renderer.scrollCursorIntoView({row:i.start.row,column:0}))}u.stop()}})}return m}();n.FoldHandler=y}),ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(t,n,p){var f=t("../lib/keys"),y=t("../lib/event"),m=function(){function l(u){this.$editor=u,this.$data={editor:u},this.$handlers=[],this.setDefaultHandler(u.commands)}return l.prototype.setDefaultHandler=function(u){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=u,this.addKeyboardHandler(u,0)},l.prototype.setKeyboardHandler=function(u){var r=this.$handlers;if(r[r.length-1]!=u){for(;r[r.length-1]&&r[r.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(r[r.length-1]);this.addKeyboardHandler(u,1)}},l.prototype.addKeyboardHandler=function(u,r){if(u){typeof u=="function"&&!u.handleKeyboard&&(u.handleKeyboard=u);var a=this.$handlers.indexOf(u);a!=-1&&this.$handlers.splice(a,1),r==null?this.$handlers.push(u):this.$handlers.splice(r,0,u),a==-1&&u.attach&&u.attach(this.$editor)}},l.prototype.removeKeyboardHandler=function(u){var r=this.$handlers.indexOf(u);return r==-1?!1:(this.$handlers.splice(r,1),u.detach&&u.detach(this.$editor),!0)},l.prototype.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},l.prototype.getStatusText=function(){var u=this.$data,r=u.editor;return this.$handlers.map(function(a){return a.getStatusText&&a.getStatusText(r,u)||""}).filter(Boolean).join(" ")},l.prototype.$callKeyboardHandlers=function(u,r,a,s){for(var o,i=!1,c=this.$editor.commands,h=this.$handlers.length;h--&&(o=this.$handlers[h].handleKeyboard(this.$data,u,r,a,s),!(!(!o||!o.command)&&(o.command=="null"?i=!0:i=c.exec(o.command,this.$editor,o.args,s),i&&s&&u!=-1&&o.passEvent!=!0&&o.command.passEvent!=!0&&y.stopEvent(s),i))););return!i&&u==-1&&(o={command:"insertstring"},i=c.exec("insertstring",this.$editor,r)),i&&this.$editor._signal&&this.$editor._signal("keyboardActivity",o),i},l.prototype.onCommandKey=function(u,r,a){var s=f.keyCodeToString(a);return this.$callKeyboardHandlers(r,s,a,u)},l.prototype.onTextInput=function(u){return this.$callKeyboardHandlers(-1,u)},l}();n.KeyBinding=m}),ace.define("ace/lib/bidiutil",["require","exports","module"],function(t,n,p){var f=0,y=0,m=!1,l=!1,u=!1,r=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],a=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],s=0,o=1,i=0,c=1,h=2,d=3,_=4,C=5,M=6,b=7,v=8,E=9,D=10,L=11,w=12,I=13,R=14,A=15,x=16,S=17,T=18,P=[T,T,T,T,T,T,T,T,T,M,C,M,v,C,T,T,T,T,T,T,T,T,T,T,T,T,T,T,C,C,C,M,v,_,_,L,L,L,_,_,_,_,_,D,E,D,E,E,h,h,h,h,h,h,h,h,h,h,E,_,_,_,_,_,_,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,_,_,_,_,_,_,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,_,_,_,_,T,T,T,T,T,T,C,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,T,E,_,L,L,L,L,_,_,_,_,i,_,_,T,_,_,L,L,h,h,_,i,_,_,_,h,i,_,_,_,_,_],N=[v,v,v,v,v,v,v,v,v,v,v,T,T,T,i,c,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,v,C,I,R,A,x,S,E,L,L,L,L,L,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,E,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,v];function k(H,U,z,G){var K=f?a:r,Y=null,Z=null,ie=null,oe=0,j=null,ke=null,ge=-1,me=null,ve=null,Ye=[];if(!G)for(me=0,G=[];me<z;me++)G[me]=V(H[me]);for(y=f,m=!1,l=!1,u=!1,ve=0;ve<z;ve++){if(Y=oe,Ye[ve]=Z=$(H,G,Ye,ve),oe=K[Y][Z],j=oe&240,oe&=15,U[ve]=ie=K[oe][5],j>0)if(j==16){for(me=ge;me<ve;me++)U[me]=1;ge=-1}else ge=-1;if(ke=K[oe][6],ke)ge==-1&&(ge=ve);else if(ge>-1){for(me=ge;me<ve;me++)U[me]=ie;ge=-1}G[ve]==C&&(U[ve]=0),y|=ie}if(u){for(me=0;me<z;me++)if(G[me]==M){U[me]=f;for(var Te=me-1;Te>=0&&G[Te]==v;Te--)U[Te]=f}}}function O(H,U,z){if(!(y<H)){if(H==1&&f==o&&!l){z.reverse();return}for(var G=z.length,K=0,Y,Z,ie,oe;K<G;){if(U[K]>=H){for(Y=K+1;Y<G&&U[Y]>=H;)Y++;for(Z=K,ie=Y-1;Z<ie;Z++,ie--)oe=z[Z],z[Z]=z[ie],z[ie]=oe;K=Y}K++}}}function $(H,U,z,G){var K=U[G],Y,Z,ie,oe;switch(K){case i:case c:m=!1;case _:case d:return K;case h:return m?d:h;case b:return m=!0,c;case v:return _;case E:return G<1||G+1>=U.length||(Y=z[G-1])!=h&&Y!=d||(Z=U[G+1])!=h&&Z!=d?_:(m&&(Z=d),Z==Y?Z:_);case D:return Y=G>0?z[G-1]:C,Y==h&&G+1<U.length&&U[G+1]==h?h:_;case L:if(G>0&&z[G-1]==h)return h;if(m)return _;for(oe=G+1,ie=U.length;oe<ie&&U[oe]==L;)oe++;return oe<ie&&U[oe]==h?h:_;case w:for(ie=U.length,oe=G+1;oe<ie&&U[oe]==w;)oe++;if(oe<ie){var j=H[G],ke=j>=1425&&j<=2303||j==64286;if(Y=U[oe],ke&&(Y==c||Y==b))return c}return G<1||(Y=U[G-1])==C?_:z[G-1];case C:return m=!1,l=!0,f;case M:return u=!0,_;case I:case R:case x:case S:case A:m=!1;case T:return _}}function V(H){var U=H.charCodeAt(0),z=U>>8;return z==0?U>191?i:P[U]:z==5?/[\u0591-\u05f4]/.test(H)?c:i:z==6?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(H)?w:/[\u0660-\u0669\u066b-\u066c]/.test(H)?d:U==1642?L:/[\u06f0-\u06f9]/.test(H)?h:b:z==32&&U<=8287?N[U&255]:z==254&&U>=65136?b:_}n.L=i,n.R=c,n.EN=h,n.ON_R=3,n.AN=4,n.R_H=5,n.B=6,n.RLE=7,n.DOT="",n.doBidiReorder=function(H,U,z){if(H.length<2)return{};var G=H.split(""),K=new Array(G.length),Y=new Array(G.length),Z=[];f=z?o:s,k(G,Z,G.length,U);for(var ie=0;ie<K.length;K[ie]=ie,ie++);O(2,Z,K),O(1,Z,K);for(var ie=0;ie<K.length-1;ie++)U[ie]===d?Z[ie]=n.AN:Z[ie]===c&&(U[ie]>b&&U[ie]<I||U[ie]===_||U[ie]===T)?Z[ie]=n.ON_R:ie>0&&G[ie-1]===""&&/\u0622|\u0623|\u0625|\u0627/.test(G[ie])&&(Z[ie-1]=Z[ie]=n.R_H,ie++);G[G.length-1]===n.DOT&&(Z[G.length-1]=n.B),G[0]===""&&(Z[0]=n.RLE);for(var ie=0;ie<K.length;ie++)Y[ie]=Z[K[ie]];return{logicalFromVisual:K,bidiLevels:Y}},n.hasBidiCharacters=function(H,U){for(var z=!1,G=0;G<H.length;G++)U[G]=V(H.charAt(G)),!z&&(U[G]==c||U[G]==b||U[G]==d)&&(z=!0);return z},n.getVisualFromLogicalIdx=function(H,U){for(var z=0;z<U.logicalFromVisual.length;z++)if(U.logicalFromVisual[z]==H)return z;return 0}}),ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],function(t,n,p){var f=t("./lib/bidiutil"),y=t("./lib/lang"),m=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/,l=function(){function u(r){this.session=r,this.bidiMap={},this.currentRow=null,this.bidiUtil=f,this.charWidths=[],this.EOL="",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="",this.RLE="",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=m.test(r.getValue())}return u.prototype.isBidiRow=function(r,a,s){return this.seenBidi?(r!==this.currentRow&&(this.currentRow=r,this.updateRowLine(a,s),this.updateBidiMap()),this.bidiMap.bidiLevels):!1},u.prototype.onChange=function(r){this.seenBidi?this.currentRow=null:r.action=="insert"&&m.test(r.lines.join(`
`))&&(this.seenBidi=!0,this.currentRow=null)},u.prototype.getDocumentRow=function(){var r=0,a=this.session.$screenRowCache;if(a.length){var s=this.session.$getRowCacheIndex(a,this.currentRow);s>=0&&(r=this.session.$docRowCache[s])}return r},u.prototype.getSplitIndex=function(){var r=0,a=this.session.$screenRowCache;if(a.length)for(var s,o=this.session.$getRowCacheIndex(a,this.currentRow);this.currentRow-r>0&&(s=this.session.$getRowCacheIndex(a,this.currentRow-r-1),s===o);)o=s,r++;else r=this.currentRow;return r},u.prototype.updateRowLine=function(r,a){r===void 0&&(r=this.getDocumentRow());var s=r===this.session.getLength()-1,o=s?this.EOF:this.EOL;if(this.wrapIndent=0,this.line=this.session.getLine(r),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE,this.session.$useWrapMode){var i=this.session.$wrapData[r];i&&(a===void 0&&(a=this.getSplitIndex()),a>0&&i.length?(this.wrapIndent=i.indent,this.wrapOffset=this.wrapIndent*this.charWidths[f.L],this.line=a<i.length?this.line.substring(i[a-1],i[a]):this.line.substring(i[i.length-1])):this.line=this.line.substring(0,i[a]),a==i.length&&(this.line+=this.showInvisibles?o:f.DOT))}else this.line+=this.showInvisibles?o:f.DOT;var c=this.session,h=0,d;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(_,C){return _==="	"||c.isFullWidth(_.charCodeAt(0))?(d=_==="	"?c.getScreenTabSize(C+h):2,h+=d-1,y.stringRepeat(f.DOT,d)):_}),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==f.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},u.prototype.updateBidiMap=function(){var r=[];f.hasBidiCharacters(this.line,r)||this.isRtlDir?this.bidiMap=f.doBidiReorder(this.line,r,this.isRtlDir):this.bidiMap={}},u.prototype.markAsDirty=function(){this.currentRow=null},u.prototype.updateCharacterWidths=function(r){if(this.characterWidth!==r.$characterSize.width){this.fontMetrics=r;var a=this.characterWidth=r.$characterSize.width,s=r.$measureCharWidth("");this.charWidths[f.L]=this.charWidths[f.EN]=this.charWidths[f.ON_R]=a,this.charWidths[f.R]=this.charWidths[f.AN]=s,this.charWidths[f.R_H]=s*.45,this.charWidths[f.B]=this.charWidths[f.RLE]=0,this.currentRow=null}},u.prototype.setShowInvisibles=function(r){this.showInvisibles=r,this.currentRow=null},u.prototype.setEolChar=function(r){this.EOL=r},u.prototype.setContentWidth=function(r){this.contentWidth=r},u.prototype.isRtlLine=function(r){return this.$isRtl?!0:r!=null?this.session.getLine(r).charAt(0)==this.RLE:this.isRtlDir},u.prototype.setRtlDirection=function(r,a){for(var s=r.getCursorPosition(),o=r.selection.getSelectionAnchor().row;o<=s.row;o++)!a&&r.session.getLine(o).charAt(0)===r.session.$bidiHandler.RLE?r.session.doc.removeInLine(o,0,1):a&&r.session.getLine(o).charAt(0)!==r.session.$bidiHandler.RLE&&r.session.doc.insert({column:0,row:o},r.session.$bidiHandler.RLE)},u.prototype.getPosLeft=function(r){r-=this.wrapIndent;var a=this.line.charAt(0)===this.RLE?1:0,s=r>a?this.session.getOverwrite()?r:r-1:a,o=f.getVisualFromLogicalIdx(s,this.bidiMap),i=this.bidiMap.bidiLevels,c=0;!this.session.getOverwrite()&&r<=a&&i[o]%2!==0&&o++;for(var h=0;h<o;h++)c+=this.charWidths[i[h]];return!this.session.getOverwrite()&&r>a&&i[o]%2===0&&(c+=this.charWidths[i[o]]),this.wrapIndent&&(c+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(c+=this.rtlLineOffset),c},u.prototype.getSelections=function(r,a){var s=this.bidiMap,o=s.bidiLevels,i,c=[],h=0,d=Math.min(r,a)-this.wrapIndent,_=Math.max(r,a)-this.wrapIndent,C=!1,M=!1,b=0;this.wrapIndent&&(h+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var v,E=0;E<o.length;E++)v=s.logicalFromVisual[E],i=o[E],C=v>=d&&v<_,C&&!M?b=h:!C&&M&&c.push({left:b,width:h-b}),h+=this.charWidths[i],M=C;if(C&&E===o.length&&c.push({left:b,width:h-b}),this.isRtlDir)for(var D=0;D<c.length;D++)c[D].left+=this.rtlLineOffset;return c},u.prototype.offsetToCol=function(s){this.isRtlDir&&(s-=this.rtlLineOffset);var a=0,s=Math.max(s,0),o=0,i=0,c=this.bidiMap.bidiLevels,h=this.charWidths[c[i]];for(this.wrapIndent&&(s-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);s>o+h/2;){if(o+=h,i===c.length-1){h=0;break}h=this.charWidths[c[++i]]}return i>0&&c[i-1]%2!==0&&c[i]%2===0?(s<o&&i--,a=this.bidiMap.logicalFromVisual[i]):i>0&&c[i-1]%2===0&&c[i]%2!==0?a=1+(s>o?this.bidiMap.logicalFromVisual[i]:this.bidiMap.logicalFromVisual[i-1]):this.isRtlDir&&i===c.length-1&&h===0&&c[i-1]%2===0||!this.isRtlDir&&i===0&&c[i]%2!==0?a=1+this.bidiMap.logicalFromVisual[i]:(i>0&&c[i-1]%2!==0&&h!==0&&i--,a=this.bidiMap.logicalFromVisual[i]),a===0&&this.isRtlDir&&a++,a+this.wrapIndent},u}();n.BidiHandler=l}),ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(t,n,p){var f=t("./lib/oop"),y=t("./lib/lang"),m=t("./lib/event_emitter").EventEmitter,l=t("./range").Range,u=function(){function r(a){this.session=a,this.doc=a.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var s=this;this.cursor.on("change",function(o){s.$cursorChanged=!0,s.$silent||s._emit("changeCursor"),!s.$isEmpty&&!s.$silent&&s._emit("changeSelection"),!s.$keepDesiredColumnOnChange&&o.old.column!=o.value.column&&(s.$desiredColumn=null)}),this.anchor.on("change",function(){s.$anchorChanged=!0,!s.$isEmpty&&!s.$silent&&s._emit("changeSelection")})}return r.prototype.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},r.prototype.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},r.prototype.getCursor=function(){return this.lead.getPosition()},r.prototype.setAnchor=function(a,s){this.$isEmpty=!1,this.anchor.setPosition(a,s)},r.prototype.getAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},r.prototype.getSelectionLead=function(){return this.lead.getPosition()},r.prototype.isBackwards=function(){var a=this.anchor,s=this.lead;return a.row>s.row||a.row==s.row&&a.column>s.column},r.prototype.getRange=function(){var a=this.anchor,s=this.lead;return this.$isEmpty?l.fromPoints(s,s):this.isBackwards()?l.fromPoints(s,a):l.fromPoints(a,s)},r.prototype.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},r.prototype.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},r.prototype.setRange=function(a,s){var o=s?a.end:a.start,i=s?a.start:a.end;this.$setSelection(o.row,o.column,i.row,i.column)},r.prototype.$setSelection=function(a,s,o,i){if(!this.$silent){var c=this.$isEmpty,h=this.inMultiSelectMode;this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(a,s),this.cursor.setPosition(o,i),this.$isEmpty=!l.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),(this.$cursorChanged||this.$anchorChanged||c!=this.$isEmpty||h)&&this._emit("changeSelection")}},r.prototype.$moveSelection=function(a){var s=this.lead;this.$isEmpty&&this.setSelectionAnchor(s.row,s.column),a.call(this)},r.prototype.selectTo=function(a,s){this.$moveSelection(function(){this.moveCursorTo(a,s)})},r.prototype.selectToPosition=function(a){this.$moveSelection(function(){this.moveCursorToPosition(a)})},r.prototype.moveTo=function(a,s){this.clearSelection(),this.moveCursorTo(a,s)},r.prototype.moveToPosition=function(a){this.clearSelection(),this.moveCursorToPosition(a)},r.prototype.selectUp=function(){this.$moveSelection(this.moveCursorUp)},r.prototype.selectDown=function(){this.$moveSelection(this.moveCursorDown)},r.prototype.selectRight=function(){this.$moveSelection(this.moveCursorRight)},r.prototype.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},r.prototype.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},r.prototype.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},r.prototype.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},r.prototype.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},r.prototype.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},r.prototype.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},r.prototype.getWordRange=function(a,s){if(typeof s>"u"){var o=a||this.lead;a=o.row,s=o.column}return this.session.getWordRange(a,s)},r.prototype.selectWord=function(){this.setSelectionRange(this.getWordRange())},r.prototype.selectAWord=function(){var a=this.getCursor(),s=this.session.getAWordRange(a.row,a.column);this.setSelectionRange(s)},r.prototype.getLineRange=function(a,s){var o=typeof a=="number"?a:this.lead.row,i,c=this.session.getFoldLine(o);return c?(o=c.start.row,i=c.end.row):i=o,s===!0?new l(o,0,i,this.session.getLine(i).length):new l(o,0,i+1,0)},r.prototype.selectLine=function(){this.setSelectionRange(this.getLineRange())},r.prototype.moveCursorUp=function(){this.moveCursorBy(-1,0)},r.prototype.moveCursorDown=function(){this.moveCursorBy(1,0)},r.prototype.wouldMoveIntoSoftTab=function(a,s,o){var i=a.column,c=a.column+s;return o<0&&(i=a.column-s,c=a.column),this.session.isTabStop(a)&&this.doc.getLine(a.row).slice(i,c).split(" ").length-1==s},r.prototype.moveCursorLeft=function(){var a=this.lead.getPosition(),s;if(s=this.session.getFoldAt(a.row,a.column,-1))this.moveCursorTo(s.start.row,s.start.column);else if(a.column===0)a.row>0&&this.moveCursorTo(a.row-1,this.doc.getLine(a.row-1).length);else{var o=this.session.getTabSize();this.wouldMoveIntoSoftTab(a,o,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-o):this.moveCursorBy(0,-1)}},r.prototype.moveCursorRight=function(){var a=this.lead.getPosition(),s;if(s=this.session.getFoldAt(a.row,a.column,1))this.moveCursorTo(s.end.row,s.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var o=this.session.getTabSize(),a=this.lead;this.wouldMoveIntoSoftTab(a,o,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,o):this.moveCursorBy(0,1)}},r.prototype.moveCursorLineStart=function(){var a=this.lead.row,s=this.lead.column,o=this.session.documentToScreenRow(a,s),i=this.session.screenToDocumentPosition(o,0),c=this.session.getDisplayLine(a,null,i.row,i.column),h=c.match(/^\s*/);h[0].length!=s&&!this.session.$useEmacsStyleLineStart&&(i.column+=h[0].length),this.moveCursorToPosition(i)},r.prototype.moveCursorLineEnd=function(){var a=this.lead,s=this.session.getDocumentLastRowColumnPosition(a.row,a.column);if(this.lead.column==s.column){var o=this.session.getLine(s.row);if(s.column==o.length){var i=o.search(/\s+$/);i>0&&(s.column=i)}}this.moveCursorTo(s.row,s.column)},r.prototype.moveCursorFileEnd=function(){var a=this.doc.getLength()-1,s=this.doc.getLine(a).length;this.moveCursorTo(a,s)},r.prototype.moveCursorFileStart=function(){this.moveCursorTo(0,0)},r.prototype.moveCursorLongWordRight=function(){var a=this.lead.row,s=this.lead.column,o=this.doc.getLine(a),i=o.substring(s);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var c=this.session.getFoldAt(a,s,1);if(c){this.moveCursorTo(c.end.row,c.end.column);return}if(this.session.nonTokenRe.exec(i)&&(s+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,i=o.substring(s)),s>=o.length){this.moveCursorTo(a,o.length),this.moveCursorRight(),a<this.doc.getLength()-1&&this.moveCursorWordRight();return}this.session.tokenRe.exec(i)&&(s+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(a,s)},r.prototype.moveCursorLongWordLeft=function(){var a=this.lead.row,s=this.lead.column,o;if(o=this.session.getFoldAt(a,s,-1)){this.moveCursorTo(o.start.row,o.start.column);return}var i=this.session.getFoldStringAt(a,s,-1);i==null&&(i=this.doc.getLine(a).substring(0,s));var c=y.stringReverse(i);if(this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(c)&&(s-=this.session.nonTokenRe.lastIndex,c=c.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),s<=0){this.moveCursorTo(a,0),this.moveCursorLeft(),a>0&&this.moveCursorWordLeft();return}this.session.tokenRe.exec(c)&&(s-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(a,s)},r.prototype.$shortWordEndIndex=function(a){var s=0,o,i=/\s/,c=this.session.tokenRe;if(c.lastIndex=0,this.session.tokenRe.exec(a))s=this.session.tokenRe.lastIndex;else{for(;(o=a[s])&&i.test(o);)s++;if(s<1){for(c.lastIndex=0;(o=a[s])&&!c.test(o);)if(c.lastIndex=0,s++,i.test(o))if(s>2){s--;break}else{for(;(o=a[s])&&i.test(o);)s++;if(s>2)break}}}return c.lastIndex=0,s},r.prototype.moveCursorShortWordRight=function(){var a=this.lead.row,s=this.lead.column,o=this.doc.getLine(a),i=o.substring(s),c=this.session.getFoldAt(a,s,1);if(c)return this.moveCursorTo(c.end.row,c.end.column);if(s==o.length){var h=this.doc.getLength();do a++,i=this.doc.getLine(a);while(a<h&&/^\s*$/.test(i));/^\s+/.test(i)||(i=""),s=0}var d=this.$shortWordEndIndex(i);this.moveCursorTo(a,s+d)},r.prototype.moveCursorShortWordLeft=function(){var a=this.lead.row,s=this.lead.column,o;if(o=this.session.getFoldAt(a,s,-1))return this.moveCursorTo(o.start.row,o.start.column);var i=this.session.getLine(a).substring(0,s);if(s===0){do a--,i=this.doc.getLine(a);while(a>0&&/^\s*$/.test(i));s=i.length,/\s+$/.test(i)||(i="")}var c=y.stringReverse(i),h=this.$shortWordEndIndex(c);return this.moveCursorTo(a,s-h)},r.prototype.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},r.prototype.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},r.prototype.moveCursorBy=function(a,s){var o=this.session.documentToScreenPosition(this.lead.row,this.lead.column),i;if(s===0&&(a!==0&&(this.session.$bidiHandler.isBidiRow(o.row,this.lead.row)?(i=this.session.$bidiHandler.getPosLeft(o.column),o.column=Math.round(i/this.session.$bidiHandler.charWidths[0])):i=o.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?o.column=this.$desiredColumn:this.$desiredColumn=o.column),a!=0&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]){var c=this.session.lineWidgets[this.lead.row];a<0?a-=c.rowsAbove||0:a>0&&(a+=c.rowCount-(c.rowsAbove||0))}var h=this.session.screenToDocumentPosition(o.row+a,o.column,i);a!==0&&s===0&&h.row===this.lead.row&&(h.column,this.lead.column),this.moveCursorTo(h.row,h.column+s,s===0)},r.prototype.moveCursorToPosition=function(a){this.moveCursorTo(a.row,a.column)},r.prototype.moveCursorTo=function(a,s,o){var i=this.session.getFoldAt(a,s,1);i&&(a=i.start.row,s=i.start.column),this.$keepDesiredColumnOnChange=!0;var c=this.session.getLine(a);/[\uDC00-\uDFFF]/.test(c.charAt(s))&&c.charAt(s-1)&&(this.lead.row==a&&this.lead.column==s+1?s=s-1:s=s+1),this.lead.setPosition(a,s),this.$keepDesiredColumnOnChange=!1,o||(this.$desiredColumn=null)},r.prototype.moveCursorToScreen=function(a,s,o){var i=this.session.screenToDocumentPosition(a,s);this.moveCursorTo(i.row,i.column,o)},r.prototype.detach=function(){this.lead.detach(),this.anchor.detach()},r.prototype.fromOrientedRange=function(a){this.setSelectionRange(a,a.cursor==a.start),this.$desiredColumn=a.desiredColumn||this.$desiredColumn},r.prototype.toOrientedRange=function(a){var s=this.getRange();return a?(a.start.column=s.start.column,a.start.row=s.start.row,a.end.column=s.end.column,a.end.row=s.end.row):a=s,a.cursor=this.isBackwards()?a.start:a.end,a.desiredColumn=this.$desiredColumn,a},r.prototype.getRangeOfMovements=function(a){var s=this.getCursor();try{a(this);var o=this.getCursor();return l.fromPoints(s,o)}catch{return l.fromPoints(s,s)}finally{this.moveCursorToPosition(s)}},r.prototype.toJSON=function(){if(this.rangeCount)var a=this.ranges.map(function(s){var o=s.clone();return o.isBackwards=s.cursor==s.start,o});else{var a=this.getRange();a.isBackwards=this.isBackwards()}return a},r.prototype.fromJSON=function(a){if(a.start==null)if(this.rangeList&&a.length>1){this.toSingleRange(a[0]);for(var s=a.length;s--;){var o=l.fromPoints(a[s].start,a[s].end);a[s].isBackwards&&(o.cursor=o.start),this.addRange(o,!0)}return}else a=a[0];this.rangeList&&this.toSingleRange(a),this.setSelectionRange(a,a.isBackwards)},r.prototype.isEqual=function(a){if((a.length||this.rangeCount)&&a.length!=this.rangeCount)return!1;if(!a.length||!this.ranges)return this.getRange().isEqual(a);for(var s=this.ranges.length;s--;)if(!this.ranges[s].isEqual(a[s]))return!1;return!0},r}();u.prototype.setSelectionAnchor=u.prototype.setAnchor,u.prototype.getSelectionAnchor=u.prototype.getAnchor,u.prototype.setSelectionRange=u.prototype.setRange,f.implement(u.prototype,m),n.Selection=u}),ace.define("ace/tokenizer",["require","exports","module","ace/lib/report_error"],function(t,n,p){var f=t("./lib/report_error").reportError,y=2e3,m=function(){function l(u){this.splitRegex,this.states=u,this.regExps={},this.matchMappings={};for(var r in this.states){for(var a=this.states[r],s=[],o=0,i=this.matchMappings[r]={defaultToken:"text"},c="g",h=[],d=0;d<a.length;d++){var _=a[d];if(_.defaultToken&&(i.defaultToken=_.defaultToken),_.caseInsensitive&&c.indexOf("i")===-1&&(c+="i"),_.unicode&&c.indexOf("u")===-1&&(c+="u"),_.regex!=null){_.regex instanceof RegExp&&(_.regex=_.regex.toString().slice(1,-1));var C=_.regex,M=new RegExp("(?:("+C+")|(.))").exec("a").length-2;Array.isArray(_.token)?_.token.length==1||M==1?_.token=_.token[0]:M-1!=_.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:_,groupCount:M-1}),_.token=_.token[0]):(_.tokenArray=_.token,_.token=null,_.onMatch=this.$arrayTokens):typeof _.token=="function"&&!_.onMatch&&(M>1?_.onMatch=this.$applyToken:_.onMatch=_.token),M>1&&(/\\\d/.test(_.regex)?C=_.regex.replace(/\\([0-9]+)/g,function(b,v){return"\\"+(parseInt(v,10)+o+1)}):(M=1,C=this.removeCapturingGroups(_.regex)),!_.splitRegex&&typeof _.token!="string"&&h.push(_)),i[o]=d,o+=M,s.push(C),_.onMatch||(_.onMatch=null)}}s.length||(i[0]=0,s.push("$")),h.forEach(function(b){b.splitRegex=this.createSplitterRegexp(b.regex,c)},this),this.regExps[r]=new RegExp("("+s.join(")|(")+")|($)",c)}}return l.prototype.$setMaxTokenCount=function(u){y=u|0},l.prototype.$applyToken=function(u){var r=this.splitRegex.exec(u).slice(1),a=this.token.apply(this,r);if(typeof a=="string")return[{type:a,value:u}];for(var s=[],o=0,i=a.length;o<i;o++)r[o]&&(s[s.length]={type:a[o],value:r[o]});return s},l.prototype.$arrayTokens=function(u){if(!u)return[];var r=this.splitRegex.exec(u);if(!r)return"text";for(var a=[],s=this.tokenArray,o=0,i=s.length;o<i;o++)r[o+1]&&(a[a.length]={type:s[o],value:r[o+1]});return a},l.prototype.removeCapturingGroups=function(u){var r=u.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!<]|(\()/g,function(a,s){return s?"(?:":a});return r},l.prototype.createSplitterRegexp=function(u,r){if(u.indexOf("(?=")!=-1){var a=0,s=!1,o={};u.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(i,c,h,d,_,C){return s?s=_!="]":_?s=!0:d?(a==o.stack&&(o.end=C+1,o.stack=-1),a--):h&&(a++,h.length!=1&&(o.stack=a,o.start=C)),i}),o.end!=null&&/^\)*$/.test(u.substr(o.end))&&(u=u.substring(0,o.start)+u.substr(o.end))}return u.charAt(0)!="^"&&(u="^"+u),u.charAt(u.length-1)!="$"&&(u+="$"),new RegExp(u,(r||"").replace("g",""))},l.prototype.getLineTokens=function(u,r){if(r&&typeof r!="string"){var a=r.slice(0);r=a[0],r==="#tmp"&&(a.shift(),r=a.shift())}else var a=[];var s=r||"start",o=this.states[s];o||(s="start",o=this.states[s]);var i=this.matchMappings[s],c=this.regExps[s];c.lastIndex=0;for(var h,d=[],_=0,C=0,M={type:null,value:""};h=c.exec(u);){var b=i.defaultToken,v=null,E=h[0],D=c.lastIndex;if(D-E.length>_){var L=u.substring(_,D-E.length);M.type==b?M.value+=L:(M.type&&d.push(M),M={type:b,value:L})}for(var w=0;w<h.length-2;w++)if(h[w+1]!==void 0){v=o[i[w]],v.onMatch?b=v.onMatch(E,s,a,u):b=v.token,v.next&&(typeof v.next=="string"?s=v.next:s=v.next(s,a),o=this.states[s],o||(this.reportError("state doesn't exist",s),s="start",o=this.states[s]),i=this.matchMappings[s],_=D,c=this.regExps[s],c.lastIndex=D),v.consumeLineEnd&&(_=D);break}if(E){if(typeof b=="string")(!v||v.merge!==!1)&&M.type===b?M.value+=E:(M.type&&d.push(M),M={type:b,value:E});else if(b){M.type&&d.push(M),M={type:null,value:""};for(var w=0;w<b.length;w++)d.push(b[w])}}if(_==u.length)break;if(_=D,C++>y){for(C>2*u.length&&this.reportError("infinite loop with in ace tokenizer",{startState:r,line:u});_<u.length;)M.type&&d.push(M),M={value:u.substring(_,_+=500),type:"overflow"};s="start",a=[];break}}return M.type&&d.push(M),a.length>1&&a[0]!==s&&a.unshift("#tmp",s),{tokens:d,state:a.length?a:s}},l}();m.prototype.reportError=f,n.Tokenizer=m}),ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/deep_copy"],function(t,n,p){var f=t("../lib/deep_copy").deepCopy,y;y=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}},function(){this.addRules=function(u,r){if(!r){for(var a in u)this.$rules[a]=u[a];return}for(var a in u){for(var s=u[a],o=0;o<s.length;o++){var i=s[o];(i.next||i.onMatch)&&(typeof i.next=="string"&&i.next.indexOf(r)!==0&&(i.next=r+i.next),i.nextState&&i.nextState.indexOf(r)!==0&&(i.nextState=r+i.nextState))}this.$rules[r+a]=s}},this.getRules=function(){return this.$rules},this.embedRules=function(u,r,a,s,o){var i=typeof u=="function"?new u().getRules():u;if(s)for(var c=0;c<s.length;c++)s[c]=r+s[c];else{s=[];for(var h in i)s.push(r+h)}if(this.addRules(i,r),a)for(var d=Array.prototype[o?"push":"unshift"],c=0;c<s.length;c++)d.apply(this.$rules[s[c]],f(a));this.$embeds||(this.$embeds=[]),this.$embeds.push(r)},this.getEmbeds=function(){return this.$embeds};var m=function(u,r){return(u!="start"||r.length)&&r.unshift(this.nextState,u),this.nextState},l=function(u,r){return r.shift(),r.shift()||"start"};this.normalizeRules=function(){var u=0,r=this.$rules;function a(s){var o=r[s];o.processed=!0;for(var i=0;i<o.length;i++){var c=o[i],h=null;Array.isArray(c)&&(h=c,c={}),!c.regex&&c.start&&(c.regex=c.start,c.next||(c.next=[]),c.next.push({defaultToken:c.token},{token:c.token+".end",regex:c.end||c.start,next:"pop"}),c.token=c.token+".start",c.push=!0);var d=c.next||c.push;if(d&&Array.isArray(d)){var _=c.stateName;_||(_=c.token,typeof _!="string"&&(_=_[0]||""),r[_]&&(_+=u++)),r[_]=d,c.next=_,a(_)}else d=="pop"&&(c.next=l);if(c.push&&(c.nextState=c.next||c.push,c.next=m,delete c.push),c.rules)for(var C in c.rules)r[C]?r[C].push&&r[C].push.apply(r[C],c.rules[C]):r[C]=c.rules[C];var M=typeof c=="string"?c:c.include;if(M&&(M==="$self"&&(M="start"),Array.isArray(M)?h=M.map(function(v){return r[v]}):h=r[M]),h){var b=[i,1].concat(h);c.noEscape&&(b=b.filter(function(v){return!v.next})),o.splice.apply(o,b),i--}c.keywordMap&&(c.token=this.createKeywordMapper(c.keywordMap,c.defaultToken||"text",c.caseInsensitive),delete c.defaultToken)}}Object.keys(r).forEach(a,this)},this.createKeywordMapper=function(u,r,a,s){var o=Object.create(null);return this.$keywordList=[],Object.keys(u).forEach(function(i){for(var c=u[i],h=c.split(s||"|"),d=h.length;d--;){var _=h[d];this.$keywordList.push(_),a&&(_=_.toLowerCase()),o[_]=i}},this),u=null,a?function(i){return o[i.toLowerCase()]||r}:function(i){return o[i]||r}},this.getKeywords=function(){return this.$keywords}}.call(y.prototype),n.TextHighlightRules=y}),ace.define("ace/mode/behaviour",["require","exports","module"],function(t,n,p){var f;f=function(){this.$behaviours={}},function(){this.add=function(y,m,l){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[y]:this.$behaviours[y]={}}this.$behaviours[y][m]=l},this.addBehaviours=function(y){for(var m in y)for(var l in y[m])this.add(m,l,y[m][l])},this.remove=function(y){this.$behaviours&&this.$behaviours[y]&&delete this.$behaviours[y]},this.inherit=function(y,m){if(typeof y=="function")var l=new y().getBehaviours(m);else var l=y.getBehaviours(m);this.addBehaviours(l)},this.getBehaviours=function(y){if(y){for(var m={},l=0;l<y.length;l++)this.$behaviours[y[l]]&&(m[y[l]]=this.$behaviours[y[l]]);return m}else return this.$behaviours}}.call(f.prototype),n.Behaviour=f}),ace.define("ace/token_iterator",["require","exports","module","ace/range"],function(t,n,p){var f=t("./range").Range,y=function(){function m(l,u,r){this.$session=l,this.$row=u,this.$rowTokens=l.getTokens(u);var a=l.getTokenAt(u,r);this.$tokenIndex=a?a.index:-1}return m.prototype.stepBackward=function(){for(this.$tokenIndex-=1;this.$tokenIndex<0;){if(this.$row-=1,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},m.prototype.stepForward=function(){this.$tokenIndex+=1;for(var l;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,l||(l=this.$session.getLength()),this.$row>=l)return this.$row=l-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},m.prototype.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},m.prototype.getCurrentTokenRow=function(){return this.$row},m.prototype.getCurrentTokenColumn=function(){var l=this.$rowTokens,u=this.$tokenIndex,r=l[u].start;if(r!==void 0)return r;for(r=0;u>0;)u-=1,r+=l[u].value.length;return r},m.prototype.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},m.prototype.getCurrentTokenRange=function(){var l=this.$rowTokens[this.$tokenIndex],u=this.getCurrentTokenColumn();return new f(this.$row,u,this.$row,u+l.value.length)},m}();n.TokenIterator=y}),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(t,n,p){var f=t("../../lib/oop"),y=t("../behaviour").Behaviour,m=t("../../token_iterator").TokenIterator,l=t("../../lib/lang"),u=["text","paren.rparen","rparen","paren","punctuation.operator"],r=["text","paren.rparen","rparen","paren","punctuation.operator","comment"],a,s={},o={'"':'"',"'":"'"},i=function(d){var _=-1;if(d.multiSelect&&(_=d.selection.index,s.rangeCount!=d.multiSelect.rangeCount&&(s={rangeCount:d.multiSelect.rangeCount})),s[_])return a=s[_];a=s[_]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},c=function(d,_,C,M){var b=d.end.row-d.start.row;return{text:C+_+M,selection:[0,d.start.column+1,b,d.end.column+(b?0:1)]}},h;h=function(d){d=d||{},this.add("braces","insertion",function(_,C,M,b,v){var E=M.getCursorPosition(),D=b.doc.getLine(E.row);if(v=="{"){i(M);var L=M.getSelectionRange(),w=b.doc.getTextRange(L),I=b.getTokenAt(E.row,E.column);if(w!==""&&w!=="{"&&M.getWrapBehavioursEnabled())return c(L,w,"{","}");if(I&&/(?:string)\.quasi|\.xml/.test(I.type)){var R=[/tag\-(?:open|name)/,/attribute\-name/];return R.some(function(k){return k.test(I.type)})||/(string)\.quasi/.test(I.type)&&I.value[E.column-I.start-1]!=="$"?void 0:(h.recordAutoInsert(M,b,"}"),{text:"{}",selection:[1,1]})}else if(h.isSaneInsertion(M,b))return/[\]\}\)]/.test(D[E.column])||M.inMultiSelectMode||d.braces?(h.recordAutoInsert(M,b,"}"),{text:"{}",selection:[1,1]}):(h.recordMaybeInsert(M,b,"{"),{text:"{",selection:[1,1]})}else if(v=="}"){i(M);var A=D.substring(E.column,E.column+1);if(A=="}"){var x=b.$findOpeningBracket("}",{column:E.column+1,row:E.row});if(x!==null&&h.isAutoInsertedClosing(E,D,v))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else if(v==`
`||v==`\r
`){i(M);var S="";h.isMaybeInsertedClosing(E,D)&&(S=l.stringRepeat("}",a.maybeInsertedBrackets),h.clearMaybeInsertedClosing());var A=D.substring(E.column,E.column+1);if(A==="}"){var T=b.findMatchingBracket({row:E.row,column:E.column+1},"}");if(!T)return null;var P=this.$getIndent(b.getLine(T.row))}else if(S)var P=this.$getIndent(D);else{h.clearMaybeInsertedClosing();return}var N=P+b.getTabString();return{text:`
`+N+`
`+P+S,selection:[1,N.length,1,N.length]}}else h.clearMaybeInsertedClosing()}),this.add("braces","deletion",function(_,C,M,b,v){var E=b.doc.getTextRange(v);if(!v.isMultiLine()&&E=="{"){i(M);var D=b.doc.getLine(v.start.row),L=D.substring(v.end.column,v.end.column+1);if(L=="}")return v.end.column++,v;a.maybeInsertedBrackets--}}),this.add("parens","insertion",function(_,C,M,b,v){if(v=="("){i(M);var E=M.getSelectionRange(),D=b.doc.getTextRange(E);if(D!==""&&M.getWrapBehavioursEnabled())return c(E,D,"(",")");if(h.isSaneInsertion(M,b))return h.recordAutoInsert(M,b,")"),{text:"()",selection:[1,1]}}else if(v==")"){i(M);var L=M.getCursorPosition(),w=b.doc.getLine(L.row),I=w.substring(L.column,L.column+1);if(I==")"){var R=b.$findOpeningBracket(")",{column:L.column+1,row:L.row});if(R!==null&&h.isAutoInsertedClosing(L,w,v))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(_,C,M,b,v){var E=b.doc.getTextRange(v);if(!v.isMultiLine()&&E=="("){i(M);var D=b.doc.getLine(v.start.row),L=D.substring(v.start.column+1,v.start.column+2);if(L==")")return v.end.column++,v}}),this.add("brackets","insertion",function(_,C,M,b,v){if(v=="["){i(M);var E=M.getSelectionRange(),D=b.doc.getTextRange(E);if(D!==""&&M.getWrapBehavioursEnabled())return c(E,D,"[","]");if(h.isSaneInsertion(M,b))return h.recordAutoInsert(M,b,"]"),{text:"[]",selection:[1,1]}}else if(v=="]"){i(M);var L=M.getCursorPosition(),w=b.doc.getLine(L.row),I=w.substring(L.column,L.column+1);if(I=="]"){var R=b.$findOpeningBracket("]",{column:L.column+1,row:L.row});if(R!==null&&h.isAutoInsertedClosing(L,w,v))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(_,C,M,b,v){var E=b.doc.getTextRange(v);if(!v.isMultiLine()&&E=="["){i(M);var D=b.doc.getLine(v.start.row),L=D.substring(v.start.column+1,v.start.column+2);if(L=="]")return v.end.column++,v}}),this.add("string_dquotes","insertion",function(_,C,M,b,v){var E=b.$mode.$quotes||o;if(v.length==1&&E[v]){if(this.lineCommentStart&&this.lineCommentStart.indexOf(v)!=-1)return;i(M);var D=v,L=M.getSelectionRange(),w=b.doc.getTextRange(L);if(w!==""&&(w.length!=1||!E[w])&&M.getWrapBehavioursEnabled())return c(L,w,D,D);if(!w){var I=M.getCursorPosition(),R=b.doc.getLine(I.row),A=R.substring(I.column-1,I.column),x=R.substring(I.column,I.column+1),S=b.getTokenAt(I.row,I.column),T=b.getTokenAt(I.row,I.column+1);if(A=="\\"&&S&&/escape/.test(S.type))return null;var P=S&&/string|escape/.test(S.type),N=!T||/string|escape/.test(T.type),k;if(x==D)k=P!==N,k&&/string\.end/.test(T.type)&&(k=!1);else{if(P&&!N||P&&N)return null;var O=b.$mode.tokenRe;O.lastIndex=0;var $=O.test(A);O.lastIndex=0;var V=O.test(x),H=b.$mode.$pairQuotesAfter,U=H&&H[D]&&H[D].test(A);if(!U&&$||V||x&&!/[\s;,.})\]\\]/.test(x))return null;var z=R[I.column-2];if(A==D&&(z==D||O.test(z)))return null;k=!0}return{text:k?D+D:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(_,C,M,b,v){var E=b.$mode.$quotes||o,D=b.doc.getTextRange(v);if(!v.isMultiLine()&&E.hasOwnProperty(D)){i(M);var L=b.doc.getLine(v.start.row),w=L.substring(v.start.column+1,v.start.column+2);if(w==D)return v.end.column++,v}}),d.closeDocComment!==!1&&this.add("doc comment end","insertion",function(_,C,M,b,v){if(_==="doc-start"&&(v===`
`||v===`\r
`)&&M.selection.isEmpty()){var E=M.getCursorPosition();if(E.column===0)return;for(var D=b.doc.getLine(E.row),L=b.doc.getLine(E.row+1),w=b.getTokens(E.row),I=0,R=0;R<w.length;R++){I+=w[R].value.length;var A=w[R];if(I>=E.column){if(I===E.column){if(!/\.doc/.test(A.type))return;if(/\*\//.test(A.value)){var x=w[R+1];if(!x||!/\.doc/.test(x.type))return}}var S=E.column-(I-A.value.length),T=A.value.indexOf("*/"),P=A.value.indexOf("/**",T>-1?T+2:0);if(P!==-1&&S>P&&S<P+3||T!==-1&&P!==-1&&S>=T&&S<=P||!/\.doc/.test(A.type))return;break}}var N=this.$getIndent(D);if(/\s*\*/.test(L))return/^\s*\*/.test(D)?{text:v+N+"* ",selection:[1,2+N.length,1,2+N.length]}:{text:v+N+" * ",selection:[1,3+N.length,1,3+N.length]};if(/\/\*\*/.test(D.substring(0,E.column)))return{text:v+N+" * "+v+" "+N+"*/",selection:[1,4+N.length,1,4+N.length]}}})},h.isSaneInsertion=function(d,_){var C=d.getCursorPosition(),M=new m(_,C.row,C.column);if(!this.$matchTokenType(M.getCurrentToken()||"text",u)){if(/[)}\]]/.test(d.session.getLine(C.row)[C.column]))return!0;var b=new m(_,C.row,C.column+1);if(!this.$matchTokenType(b.getCurrentToken()||"text",u))return!1}return M.stepForward(),M.getCurrentTokenRow()!==C.row||this.$matchTokenType(M.getCurrentToken()||"text",r)},h.$matchTokenType=function(d,_){return _.indexOf(d.type||d)>-1},h.recordAutoInsert=function(d,_,C){var M=d.getCursorPosition(),b=_.doc.getLine(M.row);this.isAutoInsertedClosing(M,b,a.autoInsertedLineEnd[0])||(a.autoInsertedBrackets=0),a.autoInsertedRow=M.row,a.autoInsertedLineEnd=C+b.substr(M.column),a.autoInsertedBrackets++},h.recordMaybeInsert=function(d,_,C){var M=d.getCursorPosition(),b=_.doc.getLine(M.row);this.isMaybeInsertedClosing(M,b)||(a.maybeInsertedBrackets=0),a.maybeInsertedRow=M.row,a.maybeInsertedLineStart=b.substr(0,M.column)+C,a.maybeInsertedLineEnd=b.substr(M.column),a.maybeInsertedBrackets++},h.isAutoInsertedClosing=function(d,_,C){return a.autoInsertedBrackets>0&&d.row===a.autoInsertedRow&&C===a.autoInsertedLineEnd[0]&&_.substr(d.column)===a.autoInsertedLineEnd},h.isMaybeInsertedClosing=function(d,_){return a.maybeInsertedBrackets>0&&d.row===a.maybeInsertedRow&&_.substr(d.column)===a.maybeInsertedLineEnd&&_.substr(0,d.column)==a.maybeInsertedLineStart},h.popAutoInsertedClosing=function(){a.autoInsertedLineEnd=a.autoInsertedLineEnd.substr(1),a.autoInsertedBrackets--},h.clearMaybeInsertedClosing=function(){a&&(a.maybeInsertedBrackets=0,a.maybeInsertedRow=-1)},f.inherits(h,y),n.CstyleBehaviour=h}),ace.define("ace/unicode",["require","exports","module"],function(t,n,p){for(var f=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],y=0,m=[],l=0;l<f.length;l+=2)m.push(y+=f[l]),f[l+1]&&m.push(45,y+=f[l+1]);n.wordChars=String.fromCharCode.apply(null,m)}),ace.define("ace/mode/text",["require","exports","module","ace/config","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(t,n,p){var f=t("../config"),y=t("../tokenizer").Tokenizer,m=t("./text_highlight_rules").TextHighlightRules,l=t("./behaviour/cstyle").CstyleBehaviour,u=t("../unicode"),r=t("../lib/lang"),a=t("../token_iterator").TokenIterator,s=t("../range").Range,o;o=function(){this.HighlightRules=m},function(){this.$defaultBehaviour=new l,this.tokenRe=new RegExp("^["+u.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+u.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new y(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(i,c,h,d){var _=c.doc,C=!0,M=!0,b=1/0,v=c.getTabSize(),E=!1;if(this.lineCommentStart){if(Array.isArray(this.lineCommentStart))var w=this.lineCommentStart.map(r.escapeRegExp).join("|"),D=this.lineCommentStart[0];else var w=r.escapeRegExp(this.lineCommentStart),D=this.lineCommentStart;w=new RegExp("^(\\s*)(?:"+w+") ?"),E=c.getUseSoftTabs();var A=function(V,H){var U=V.match(w);if(U){var z=U[1].length,G=U[0].length;!T(V,z,G)&&U[0][G-1]==" "&&G--,_.removeInLine(H,z,G)}},S=D+" ",R=function(V,H){(!C||/\S/.test(V))&&(T(V,b,b)?_.insertInLine({row:H,column:b},S):_.insertInLine({row:H,column:b},D))},x=function(V,H){return w.test(V)},T=function(V,H,U){for(var z=0;H--&&V.charAt(H)==" ";)z++;if(z%v!=0)return!1;for(var z=0;V.charAt(U++)==" ";)z++;return v>2?z%v!=v-1:z%v==0}}else{if(!this.blockComment)return!1;var D=this.blockComment.start,L=this.blockComment.end,w=new RegExp("^(\\s*)(?:"+r.escapeRegExp(D)+")"),I=new RegExp("(?:"+r.escapeRegExp(L)+")\\s*$"),R=function(k,O){x(k,O)||(!C||/\S/.test(k))&&(_.insertInLine({row:O,column:k.length},L),_.insertInLine({row:O,column:b},D))},A=function(k,O){var $;($=k.match(I))&&_.removeInLine(O,k.length-$[0].length,k.length),($=k.match(w))&&_.removeInLine(O,$[1].length,$[0].length)},x=function(k,O){if(w.test(k))return!0;for(var $=c.getTokens(O),V=0;V<$.length;V++)if($[V].type==="comment")return!0}}function P(k){for(var O=h;O<=d;O++)k(_.getLine(O),O)}var N=1/0;P(function(k,O){var $=k.search(/\S/);$!==-1?($<b&&(b=$),M&&!x(k,O)&&(M=!1)):N>k.length&&(N=k.length)}),b==1/0&&(b=N,C=!1,M=!1),E&&b%v!=0&&(b=Math.floor(b/v)*v),P(M?A:R)},this.toggleBlockComment=function(i,c,h,d){var _=this.blockComment;if(_){!_.start&&_[0]&&(_=_[0]);var C=new a(c,d.row,d.column),M=C.getCurrentToken();c.selection;var b=c.selection.toOrientedRange(),v,E;if(M&&/comment/.test(M.type)){for(var D,L;M&&/comment/.test(M.type);){var w=M.value.indexOf(_.start);if(w!=-1){var I=C.getCurrentTokenRow(),R=C.getCurrentTokenColumn()+w;D=new s(I,R,I,R+_.start.length);break}M=C.stepBackward()}for(var C=new a(c,d.row,d.column),M=C.getCurrentToken();M&&/comment/.test(M.type);){var w=M.value.indexOf(_.end);if(w!=-1){var I=C.getCurrentTokenRow(),R=C.getCurrentTokenColumn()+w;L=new s(I,R,I,R+_.end.length);break}M=C.stepForward()}L&&c.remove(L),D&&(c.remove(D),v=D.start.row,E=-_.start.length)}else E=_.start.length,v=h.start.row,c.insert(h.end,_.end),c.insert(h.start,_.start);b.start.row==v&&(b.start.column+=E),b.end.row==v&&(b.end.column+=E),c.selection.fromOrientedRange(b)}},this.getNextLineIndent=function(i,c,h){return this.$getIndent(c)},this.checkOutdent=function(i,c,h){return!1},this.autoOutdent=function(i,c,h){},this.$getIndent=function(i){return i.match(/^\s*/)[0]},this.createWorker=function(i){return null},this.createModeDelegates=function(i){this.$embeds=[],this.$modes={};for(var c in i)if(i[c]){var h=i[c],d=h.prototype.$id,_=f.$modes[d];_||(f.$modes[d]=_=new h),f.$modes[c]||(f.$modes[c]=_),this.$embeds.push(c),this.$modes[c]=_}for(var C=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],M=function(v){(function(E){var D=C[v],L=E[D];E[C[v]]=function(){return this.$delegator(D,arguments,L)}})(b)},b=this,c=0;c<C.length;c++)M(c)},this.$delegator=function(i,c,h){var d=c[0]||"start";if(typeof d!="string"){if(Array.isArray(d[2])){var _=d[2][d[2].length-1],C=this.$modes[_];if(C)return C[i].apply(C,[d[1]].concat([].slice.call(c,1)))}d=d[0]||"start"}for(var M=0;M<this.$embeds.length;M++)if(this.$modes[this.$embeds[M]]){var b=d.split(this.$embeds[M]);if(!b[0]&&b[1]){c[0]=b[1];var C=this.$modes[this.$embeds[M]];return C[i].apply(C,c)}}var v=h.apply(this,c);return h?v:void 0},this.transformAction=function(i,c,h,d,_){if(this.$behaviour){var C=this.$behaviour.getBehaviours();for(var M in C)if(C[M][c]){var b=C[M][c].apply(this,arguments);if(b)return b}}},this.getKeywords=function(i){if(!this.completionKeywords){var c=this.$tokenizer.rules,h=[];for(var d in c)for(var _=c[d],C=0,M=_.length;C<M;C++)if(typeof _[C].token=="string")/keyword|support|storage/.test(_[C].token)&&h.push(_[C].regex);else if(typeof _[C].token=="object"){for(var b=0,v=_[C].token.length;b<v;b++)if(/keyword|support|storage/.test(_[C].token[b])){var d=_[C].regex.match(/\(.+?\)/g)[b];h.push(d.substr(1,d.length-2))}}this.completionKeywords=h}return i?h.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(i,c,h,d){var _=this.$keywordList||this.$createKeywordList();return _.map(function(C){return{name:C,value:C,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}.call(o.prototype),n.Mode=o}),ace.define("ace/line_widgets",["require","exports","module","ace/lib/dom"],function(t,n,p){var f=t("./lib/dom"),y=function(){function m(l){this.session=l,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}return m.prototype.getRowLength=function(l){var u;return this.lineWidgets?u=this.lineWidgets[l]&&this.lineWidgets[l].rowCount||0:u=0,!this.$useWrapMode||!this.$wrapData[l]?1+u:this.$wrapData[l].length+1+u},m.prototype.$getWidgetScreenLength=function(){var l=0;return this.lineWidgets.forEach(function(u){u&&u.rowCount&&!u.hidden&&(l+=u.rowCount)}),l},m.prototype.$onChangeEditor=function(l){this.attach(l.editor)},m.prototype.attach=function(l){l&&l.widgetManager&&l.widgetManager!=this&&l.widgetManager.detach(),this.editor!=l&&(this.detach(),this.editor=l,l&&(l.widgetManager=this,l.renderer.on("beforeRender",this.measureWidgets),l.renderer.on("afterRender",this.renderWidgets)))},m.prototype.detach=function(l){var u=this.editor;if(u){this.editor=null,u.widgetManager=null,u.renderer.off("beforeRender",this.measureWidgets),u.renderer.off("afterRender",this.renderWidgets);var r=this.session.lineWidgets;r&&r.forEach(function(a){a&&a.el&&a.el.parentNode&&(a._inDocument=!1,a.el.parentNode.removeChild(a.el))})}},m.prototype.updateOnFold=function(l,u){var r=u.lineWidgets;if(!(!r||!l.action)){for(var a=l.data,s=a.start.row,o=a.end.row,i=l.action=="add",c=s+1;c<o;c++)r[c]&&(r[c].hidden=i);r[o]&&(i?r[s]?r[o].hidden=i:r[s]=r[o]:(r[s]==r[o]&&(r[s]=void 0),r[o].hidden=i))}},m.prototype.updateOnChange=function(l){var u=this.session.lineWidgets;if(u){var r=l.start.row,a=l.end.row-r;if(a!==0)if(l.action=="remove"){var s=u.splice(r+1,a);!u[r]&&s[s.length-1]&&(u[r]=s.pop()),s.forEach(function(i){i&&this.removeLineWidget(i)},this),this.$updateRows()}else{var o=new Array(a);u[r]&&u[r].column!=null&&l.start.column>u[r].column&&r++,o.unshift(r,0),u.splice.apply(u,o),this.$updateRows()}}},m.prototype.$updateRows=function(){var l=this.session.lineWidgets;if(l){var u=!0;l.forEach(function(r,a){if(r)for(u=!1,r.row=a;r.$oldWidget;)r.$oldWidget.row=a,r=r.$oldWidget}),u&&(this.session.lineWidgets=null)}},m.prototype.$registerLineWidget=function(l){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var u=this.session.lineWidgets[l.row];return u&&(l.$oldWidget=u,u.el&&u.el.parentNode&&(u.el.parentNode.removeChild(u.el),u._inDocument=!1)),this.session.lineWidgets[l.row]=l,l},m.prototype.addLineWidget=function(l){if(this.$registerLineWidget(l),l.session=this.session,!this.editor)return l;var u=this.editor.renderer;l.html&&!l.el&&(l.el=f.createElement("div"),l.el.innerHTML=l.html),l.text&&!l.el&&(l.el=f.createElement("div"),l.el.textContent=l.text),l.el&&(f.addCssClass(l.el,"ace_lineWidgetContainer"),l.className&&f.addCssClass(l.el,l.className),l.el.style.position="absolute",l.el.style.zIndex="5",u.container.appendChild(l.el),l._inDocument=!0,l.coverGutter||(l.el.style.zIndex="3"),l.pixelHeight==null&&(l.pixelHeight=l.el.offsetHeight)),l.rowCount==null&&(l.rowCount=l.pixelHeight/u.layerConfig.lineHeight);var r=this.session.getFoldAt(l.row,0);if(l.$fold=r,r){var a=this.session.lineWidgets;l.row==r.end.row&&!a[r.start.row]?a[r.start.row]=l:l.hidden=!0}return this.session._emit("changeFold",{data:{start:{row:l.row}}}),this.$updateRows(),this.renderWidgets(null,u),this.onWidgetChanged(l),l},m.prototype.removeLineWidget=function(l){if(l._inDocument=!1,l.session=null,l.el&&l.el.parentNode&&l.el.parentNode.removeChild(l.el),l.editor&&l.editor.destroy)try{l.editor.destroy()}catch{}if(this.session.lineWidgets){var u=this.session.lineWidgets[l.row];if(u==l)this.session.lineWidgets[l.row]=l.$oldWidget,l.$oldWidget&&this.onWidgetChanged(l.$oldWidget);else for(;u;){if(u.$oldWidget==l){u.$oldWidget=l.$oldWidget;break}u=u.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:l.row}}}),this.$updateRows()},m.prototype.getWidgetsAtRow=function(l){for(var u=this.session.lineWidgets,r=u&&u[l],a=[];r;)a.push(r),r=r.$oldWidget;return a},m.prototype.onWidgetChanged=function(l){this.session._changedWidgets.push(l),this.editor&&this.editor.renderer.updateFull()},m.prototype.measureWidgets=function(l,u){var r=this.session._changedWidgets,a=u.layerConfig;if(!(!r||!r.length)){for(var s=1/0,o=0;o<r.length;o++){var i=r[o];if(!(!i||!i.el)&&i.session==this.session){if(!i._inDocument){if(this.session.lineWidgets[i.row]!=i)continue;i._inDocument=!0,u.container.appendChild(i.el)}i.h=i.el.offsetHeight,i.fixedWidth||(i.w=i.el.offsetWidth,i.screenWidth=Math.ceil(i.w/a.characterWidth));var c=i.h/a.lineHeight;i.coverLine&&(c-=this.session.getRowLineCount(i.row),c<0&&(c=0)),i.rowCount!=c&&(i.rowCount=c,i.row<s&&(s=i.row))}}s!=1/0&&(this.session._emit("changeFold",{data:{start:{row:s}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},m.prototype.renderWidgets=function(l,u){var r=u.layerConfig,a=this.session.lineWidgets;if(a){for(var s=Math.min(this.firstRow,r.firstRow),o=Math.max(this.lastRow,r.lastRow,a.length);s>0&&!a[s];)s--;this.firstRow=r.firstRow,this.lastRow=r.lastRow,u.$cursorLayer.config=r;for(var i=s;i<=o;i++){var c=a[i];if(!(!c||!c.el)){if(c.hidden){c.el.style.top=-100-(c.pixelHeight||0)+"px";continue}c._inDocument||(c._inDocument=!0,u.container.appendChild(c.el));var h=u.$cursorLayer.getPixelPosition({row:i,column:0},!0).top;c.coverLine||(h+=r.lineHeight*this.session.getRowLineCount(c.row)),c.el.style.top=h-r.offset+"px";var d=c.coverGutter?0:u.gutterWidth;c.fixedWidth||(d-=u.scrollLeft),c.el.style.left=d+"px",c.fullWidth&&c.screenWidth&&(c.el.style.minWidth=r.width+2*r.padding+"px"),c.fixedWidth?c.el.style.right=u.scrollBar.getWidth()+"px":c.el.style.right=""}}}},m}();n.LineWidgets=y}),ace.define("ace/apply_delta",["require","exports","module"],function(t,n,p){n.applyDelta=function(f,y,m){var l=y.start.row,u=y.start.column,r=f[l]||"";switch(y.action){case"insert":var a=y.lines;if(a.length===1)f[l]=r.substring(0,u)+y.lines[0]+r.substring(u);else{var s=[l,1].concat(y.lines);f.splice.apply(f,s),f[l]=r.substring(0,u)+f[l],f[l+y.lines.length-1]+=r.substring(u)}break;case"remove":var o=y.end.column,i=y.end.row;l===i?f[l]=r.substring(0,u)+r.substring(o):f.splice(l,i-l+1,r.substring(0,u)+f[i].substring(o));break}}}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(t,n,p){var f=t("./lib/oop"),y=t("./lib/event_emitter").EventEmitter,m=function(){function r(a,s,o){this.$onChange=this.onChange.bind(this),this.attach(a),typeof s!="number"?this.setPosition(s.row,s.column):this.setPosition(s,o)}return r.prototype.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},r.prototype.getDocument=function(){return this.document},r.prototype.onChange=function(a){if(!(a.start.row==a.end.row&&a.start.row!=this.row)&&!(a.start.row>this.row)){var s=u(a,{row:this.row,column:this.column},this.$insertRight);this.setPosition(s.row,s.column,!0)}},r.prototype.setPosition=function(a,s,o){var i;if(o?i={row:a,column:s}:i=this.$clipPositionToDocument(a,s),!(this.row==i.row&&this.column==i.column)){var c={row:this.row,column:this.column};this.row=i.row,this.column=i.column,this._signal("change",{old:c,value:i})}},r.prototype.detach=function(){this.document.off("change",this.$onChange)},r.prototype.attach=function(a){this.document=a||this.document,this.document.on("change",this.$onChange)},r.prototype.$clipPositionToDocument=function(a,s){var o={};return a>=this.document.getLength()?(o.row=Math.max(0,this.document.getLength()-1),o.column=this.document.getLine(o.row).length):a<0?(o.row=0,o.column=0):(o.row=a,o.column=Math.min(this.document.getLine(o.row).length,Math.max(0,s))),s<0&&(o.column=0),o},r}();m.prototype.$insertRight=!1,f.implement(m.prototype,y);function l(r,a,s){var o=s?r.column<=a.column:r.column<a.column;return r.row<a.row||r.row==a.row&&o}function u(r,a,s){var o=r.action=="insert",i=(o?1:-1)*(r.end.row-r.start.row),c=(o?1:-1)*(r.end.column-r.start.column),h=r.start,d=o?h:r.end;return l(a,h,s)?{row:a.row,column:a.column}:l(d,a,!s)?{row:a.row+i,column:a.column+(a.row==d.row?c:0)}:{row:h.row,column:h.column}}n.Anchor=m}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(t,n,p){var f=t("./lib/oop"),y=t("./apply_delta").applyDelta,m=t("./lib/event_emitter").EventEmitter,l=t("./range").Range,u=t("./anchor").Anchor,r=function(){function a(s){this.$lines=[""],s.length===0?this.$lines=[""]:Array.isArray(s)?this.insertMergedLines({row:0,column:0},s):this.insert({row:0,column:0},s)}return a.prototype.setValue=function(s){var o=this.getLength()-1;this.remove(new l(0,0,o,this.getLine(o).length)),this.insert({row:0,column:0},s||"")},a.prototype.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},a.prototype.createAnchor=function(s,o){return new u(this,s,o)},a.prototype.$detectNewLine=function(s){var o=s.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=o?o[1]:`
`,this._signal("changeNewLineMode")},a.prototype.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return`\r
`;case"unix":return`
`;default:return this.$autoNewLine||`
`}},a.prototype.setNewLineMode=function(s){this.$newLineMode!==s&&(this.$newLineMode=s,this._signal("changeNewLineMode"))},a.prototype.getNewLineMode=function(){return this.$newLineMode},a.prototype.isNewLine=function(s){return s==`\r
`||s=="\r"||s==`
`},a.prototype.getLine=function(s){return this.$lines[s]||""},a.prototype.getLines=function(s,o){return this.$lines.slice(s,o+1)},a.prototype.getAllLines=function(){return this.getLines(0,this.getLength())},a.prototype.getLength=function(){return this.$lines.length},a.prototype.getTextRange=function(s){return this.getLinesForRange(s).join(this.getNewLineCharacter())},a.prototype.getLinesForRange=function(s){var o;if(s.start.row===s.end.row)o=[this.getLine(s.start.row).substring(s.start.column,s.end.column)];else{o=this.getLines(s.start.row,s.end.row),o[0]=(o[0]||"").substring(s.start.column);var i=o.length-1;s.end.row-s.start.row==i&&(o[i]=o[i].substring(0,s.end.column))}return o},a.prototype.insertLines=function(s,o){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(s,o)},a.prototype.removeLines=function(s,o){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(s,o)},a.prototype.insertNewLine=function(s){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(s,["",""])},a.prototype.insert=function(s,o){return this.getLength()<=1&&this.$detectNewLine(o),this.insertMergedLines(s,this.$split(o))},a.prototype.insertInLine=function(s,o){var i=this.clippedPos(s.row,s.column),c=this.pos(s.row,s.column+o.length);return this.applyDelta({start:i,end:c,action:"insert",lines:[o]},!0),this.clonePos(c)},a.prototype.clippedPos=function(s,o){var i=this.getLength();s===void 0?s=i:s<0?s=0:s>=i&&(s=i-1,o=void 0);var c=this.getLine(s);return o==null&&(o=c.length),o=Math.min(Math.max(o,0),c.length),{row:s,column:o}},a.prototype.clonePos=function(s){return{row:s.row,column:s.column}},a.prototype.pos=function(s,o){return{row:s,column:o}},a.prototype.$clipPosition=function(s){var o=this.getLength();return s.row>=o?(s.row=Math.max(0,o-1),s.column=this.getLine(o-1).length):(s.row=Math.max(0,s.row),s.column=Math.min(Math.max(s.column,0),this.getLine(s.row).length)),s},a.prototype.insertFullLines=function(s,o){s=Math.min(Math.max(s,0),this.getLength());var i=0;s<this.getLength()?(o=o.concat([""]),i=0):(o=[""].concat(o),s--,i=this.$lines[s].length),this.insertMergedLines({row:s,column:i},o)},a.prototype.insertMergedLines=function(s,o){var i=this.clippedPos(s.row,s.column),c={row:i.row+o.length-1,column:(o.length==1?i.column:0)+o[o.length-1].length};return this.applyDelta({start:i,end:c,action:"insert",lines:o}),this.clonePos(c)},a.prototype.remove=function(s){var o=this.clippedPos(s.start.row,s.start.column),i=this.clippedPos(s.end.row,s.end.column);return this.applyDelta({start:o,end:i,action:"remove",lines:this.getLinesForRange({start:o,end:i})}),this.clonePos(o)},a.prototype.removeInLine=function(s,o,i){var c=this.clippedPos(s,o),h=this.clippedPos(s,i);return this.applyDelta({start:c,end:h,action:"remove",lines:this.getLinesForRange({start:c,end:h})},!0),this.clonePos(c)},a.prototype.removeFullLines=function(s,o){s=Math.min(Math.max(0,s),this.getLength()-1),o=Math.min(Math.max(0,o),this.getLength()-1);var i=o==this.getLength()-1&&s>0,c=o<this.getLength()-1,h=i?s-1:s,d=i?this.getLine(h).length:0,_=c?o+1:o,C=c?0:this.getLine(_).length,M=new l(h,d,_,C),b=this.$lines.slice(s,o+1);return this.applyDelta({start:M.start,end:M.end,action:"remove",lines:this.getLinesForRange(M)}),b},a.prototype.removeNewLine=function(s){s<this.getLength()-1&&s>=0&&this.applyDelta({start:this.pos(s,this.getLine(s).length),end:this.pos(s+1,0),action:"remove",lines:["",""]})},a.prototype.replace=function(s,o){if(s instanceof l||(s=l.fromPoints(s.start,s.end)),o.length===0&&s.isEmpty())return s.start;if(o==this.getTextRange(s))return s.end;this.remove(s);var i;return o?i=this.insert(s.start,o):i=s.start,i},a.prototype.applyDeltas=function(s){for(var o=0;o<s.length;o++)this.applyDelta(s[o])},a.prototype.revertDeltas=function(s){for(var o=s.length-1;o>=0;o--)this.revertDelta(s[o])},a.prototype.applyDelta=function(s,o){var i=s.action=="insert";(i?s.lines.length<=1&&!s.lines[0]:!l.comparePoints(s.start,s.end))||(i&&s.lines.length>2e4?this.$splitAndapplyLargeDelta(s,2e4):(y(this.$lines,s,o),this._signal("change",s)))},a.prototype.$safeApplyDelta=function(s){var o=this.$lines.length;(s.action=="remove"&&s.start.row<o&&s.end.row<o||s.action=="insert"&&s.start.row<=o)&&this.applyDelta(s)},a.prototype.$splitAndapplyLargeDelta=function(s,o){for(var i=s.lines,c=i.length-o+1,h=s.start.row,d=s.start.column,_=0,C=0;_<c;_=C){C+=o-1;var M=i.slice(_,C);M.push(""),this.applyDelta({start:this.pos(h+_,d),end:this.pos(h+C,d=0),action:s.action,lines:M},!0)}s.lines=i.slice(_),s.start.row=h+_,s.start.column=d,this.applyDelta(s,!0)},a.prototype.revertDelta=function(s){this.$safeApplyDelta({start:this.clonePos(s.start),end:this.clonePos(s.end),action:s.action=="insert"?"remove":"insert",lines:s.lines.slice()})},a.prototype.indexToPosition=function(s,o){for(var i=this.$lines||this.getAllLines(),c=this.getNewLineCharacter().length,h=o||0,d=i.length;h<d;h++)if(s-=i[h].length+c,s<0)return{row:h,column:s+i[h].length+c};return{row:d-1,column:s+i[d-1].length+c}},a.prototype.positionToIndex=function(s,o){for(var i=this.$lines||this.getAllLines(),c=this.getNewLineCharacter().length,h=0,d=Math.min(s.row,i.length),_=o||0;_<d;++_)h+=i[_].length+c;return h+s.column},a.prototype.$split=function(s){return s.split(/\r\n|\r|\n/)},a}();r.prototype.$autoNewLine="",r.prototype.$newLineMode="auto",f.implement(r.prototype,m),n.Document=r}),ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(t,n,p){var f=t("./lib/oop"),y=t("./lib/event_emitter").EventEmitter,m=function(){function l(u,r){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=u;var a=this;this.$worker=function(){if(a.running){for(var s=new Date,o=a.currentLine,i=-1,c=a.doc,h=o;a.lines[o];)o++;var d=c.getLength(),_=0;for(a.running=!1;o<d;){a.$tokenizeRow(o),i=o;do o++;while(a.lines[o]);if(_++,_%5===0&&new Date-s>20){a.running=setTimeout(a.$worker,20);break}}a.currentLine=o,i==-1&&(i=o),h<=i&&a.fireUpdateEvent(h,i)}}}return l.prototype.setTokenizer=function(u){this.tokenizer=u,this.lines=[],this.states=[],this.start(0)},l.prototype.setDocument=function(u){this.doc=u,this.lines=[],this.states=[],this.stop()},l.prototype.fireUpdateEvent=function(u,r){var a={first:u,last:r};this._signal("update",{data:a})},l.prototype.start=function(u){this.currentLine=Math.min(u||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},l.prototype.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},l.prototype.$updateOnChange=function(u){var r=u.start.row,a=u.end.row-r;if(a===0)this.lines[r]=null;else if(u.action=="remove")this.lines.splice(r,a+1,null),this.states.splice(r,a+1,null);else{var s=Array(a+1);s.unshift(r,1),this.lines.splice.apply(this.lines,s),this.states.splice.apply(this.states,s)}this.currentLine=Math.min(r,this.currentLine,this.doc.getLength()),this.stop()},l.prototype.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},l.prototype.getTokens=function(u){return this.lines[u]||this.$tokenizeRow(u)},l.prototype.getState=function(u){return this.currentLine==u&&this.$tokenizeRow(u),this.states[u]||"start"},l.prototype.$tokenizeRow=function(u){var r=this.doc.getLine(u),a=this.states[u-1],s=this.tokenizer.getLineTokens(r,a,u);return this.states[u]+""!=s.state+""?(this.states[u]=s.state,this.lines[u+1]=null,this.currentLine>u+1&&(this.currentLine=u+1)):this.currentLine==u&&(this.currentLine=u+1),this.lines[u]=s.tokens},l.prototype.cleanup=function(){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.removeAllListeners()},l}();f.implement(m.prototype,y),n.BackgroundTokenizer=m}),ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/range"],function(t,n,p){var f=t("./lib/lang"),y=t("./range").Range,m=function(){function l(u,r,a){a===void 0&&(a="text"),this.setRegexp(u),this.clazz=r,this.type=a,this.docLen=0}return l.prototype.setRegexp=function(u){this.regExp+""!=u+""&&(this.regExp=u,this.cache=[])},l.prototype.update=function(u,r,a,s){if(this.regExp){for(var o=s.firstRow,i=s.lastRow,c={},h=a.$editor&&a.$editor.$search,d=h&&h.$isMultilineSearch(a.$editor.getLastSearchOptions()),_=o;_<=i;_++){var C=this.cache[_];if(C==null||a.getValue().length!=this.docLen){if(d){C=[];var M=h.$multiLineForward(a,this.regExp,_,i);if(M){var b=M.endRow<=i?M.endRow-1:i;b>_&&(_=b),C.push(new y(M.startRow,M.startCol,M.endRow,M.endCol))}C.length>this.MAX_RANGES&&(C=C.slice(0,this.MAX_RANGES))}else C=f.getMatchOffsets(a.getLine(_),this.regExp),C.length>this.MAX_RANGES&&(C=C.slice(0,this.MAX_RANGES)),C=C.map(function(L){return new y(_,L.offset,_,L.offset+L.length)});this.cache[_]=C.length?C:""}if(C.length!==0)for(var v=C.length;v--;){var E=C[v].toScreenRange(a),D=E.toString();c[D]||(c[D]=!0,r.drawSingleLineMarker(u,E,this.clazz,s))}}this.docLen=a.getValue().length}},l}();m.prototype.MAX_RANGES=500,n.SearchHighlight=m}),ace.define("ace/undomanager",["require","exports","module","ace/range"],function(t,n,p){var f=function(){function b(){this.$keepRedoStack,this.$maxRev=0,this.$fromUndo=!1,this.$undoDepth=1/0,this.reset()}return b.prototype.addSession=function(v){this.$session=v},b.prototype.add=function(v,E,D){if(!this.$fromUndo&&v!=this.$lastDelta){if(this.$keepRedoStack||(this.$redoStack.length=0),E===!1||!this.lastDeltas){this.lastDeltas=[];var L=this.$undoStack.length;L>this.$undoDepth-1&&this.$undoStack.splice(0,L-this.$undoDepth+1),this.$undoStack.push(this.lastDeltas),v.id=this.$rev=++this.$maxRev}(v.action=="remove"||v.action=="insert")&&(this.$lastDelta=v),this.lastDeltas.push(v)}},b.prototype.addSelection=function(v,E){this.selections.push({value:v,rev:E||this.$rev})},b.prototype.startNewGroup=function(){return this.lastDeltas=null,this.$rev},b.prototype.markIgnored=function(v,E){E==null&&(E=this.$rev+1);for(var D=this.$undoStack,L=D.length;L--;){var w=D[L][0];if(w.id<=v)break;w.id<E&&(w.ignore=!0)}this.lastDeltas=null},b.prototype.getSelection=function(v,E){for(var D=this.selections,L=D.length;L--;){var w=D[L];if(w.rev<v)return E&&(w=D[L+1]),w}},b.prototype.getRevision=function(){return this.$rev},b.prototype.getDeltas=function(v,E){E==null&&(E=this.$rev+1);for(var D=this.$undoStack,L=null,w=0,I=D.length;I--;){var R=D[I][0];if(R.id<E&&!L&&(L=I+1),R.id<=v){w=I+1;break}}return D.slice(w,L)},b.prototype.getChangedRanges=function(v,E){E==null&&(E=this.$rev+1)},b.prototype.getChangedLines=function(v,E){E==null&&(E=this.$rev+1)},b.prototype.undo=function(v,E){this.lastDeltas=null;var D=this.$undoStack;if(y(D,D.length)){v||(v=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var L=D.pop(),w=null;return L&&(w=v.undoChanges(L,E),this.$redoStack.push(L),this.$syncRev()),this.$fromUndo=!1,w}},b.prototype.redo=function(v,E){if(this.lastDeltas=null,v||(v=this.$session),this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){var D=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);M(this.$redoStack,D),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(I){I[0].id=++this.$maxRev},this)}var L=this.$redoStack.pop(),w=null;return L&&(w=v.redoChanges(L,E),this.$undoStack.push(L),this.$syncRev()),this.$fromUndo=!1,w},b.prototype.$syncRev=function(){var v=this.$undoStack,E=v[v.length-1],D=E&&E[0].id||0;this.$redoStackBaseRev=D,this.$rev=D},b.prototype.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},b.prototype.canUndo=function(){return this.$undoStack.length>0},b.prototype.canRedo=function(){return this.$redoStack.length>0},b.prototype.bookmark=function(v){v==null&&(v=this.$rev),this.mark=v},b.prototype.isAtBookmark=function(){return this.$rev===this.mark},b.prototype.toJSON=function(){return{$redoStack:this.$redoStack,$undoStack:this.$undoStack}},b.prototype.fromJSON=function(v){this.reset(),this.$undoStack=v.$undoStack,this.$redoStack=v.$redoStack},b.prototype.$prettyPrint=function(v){return v?a(v):a(this.$undoStack)+`
---
`+a(this.$redoStack)},b}();f.prototype.hasUndo=f.prototype.canUndo,f.prototype.hasRedo=f.prototype.canRedo,f.prototype.isClean=f.prototype.isAtBookmark,f.prototype.markClean=f.prototype.bookmark;function y(b,v){for(var E=v;E--;){var D=b[E];if(D&&!D[0].ignore){for(;E<v-1;){var L=i(b[E],b[E+1]);b[E]=L[0],b[E+1]=L[1],E++}return!0}}}var m=t("./range").Range,l=m.comparePoints;m.comparePoints;function u(b){return{row:b.row,column:b.column}}function r(b){return{start:u(b.start),end:u(b.end),action:b.action,lines:b.lines.slice()}}function a(b){if(b=b||this,Array.isArray(b))return b.map(a).join(`
`);var v="";return b.action?(v=b.action=="insert"?"+":"-",v+="["+b.lines+"]"):b.value&&(Array.isArray(b.value)?v=b.value.map(s).join(`
`):v=s(b.value)),b.start&&(v+=s(b)),(b.id||b.rev)&&(v+="	("+(b.id||b.rev)+")"),v}function s(b){return b.start.row+":"+b.start.column+"=>"+b.end.row+":"+b.end.column}function o(b,v){var E=b.action=="insert",D=v.action=="insert";if(E&&D)if(l(v.start,b.end)>=0)h(v,b,-1);else if(l(v.start,b.start)<=0)h(b,v,1);else return null;else if(E&&!D)if(l(v.start,b.end)>=0)h(v,b,-1);else if(l(v.end,b.start)<=0)h(b,v,-1);else return null;else if(!E&&D)if(l(v.start,b.start)>=0)h(v,b,1);else if(l(v.start,b.start)<=0)h(b,v,1);else return null;else if(!E&&!D)if(l(v.start,b.start)>=0)h(v,b,1);else if(l(v.end,b.start)<=0)h(b,v,-1);else return null;return[v,b]}function i(b,v){for(var E=b.length;E--;)for(var D=0;D<v.length;D++)if(!o(b[E],v[D])){for(;E<b.length;){for(;D--;)o(v[D],b[E]);D=v.length,E++}return[b,v]}return b.selectionBefore=v.selectionBefore=b.selectionAfter=v.selectionAfter=null,[v,b]}function c(b,v){var E=b.action=="insert",D=v.action=="insert";if(E&&D)l(b.start,v.start)<0?h(v,b,1):h(b,v,1);else if(E&&!D)l(b.start,v.end)>=0?h(b,v,-1):(l(b.start,v.start)<=0||h(b,m.fromPoints(v.start,b.start),-1),h(v,b,1));else if(!E&&D)l(v.start,b.end)>=0?h(v,b,-1):(l(v.start,b.start)<=0||h(v,m.fromPoints(b.start,v.start),-1),h(b,v,1));else if(!E&&!D)if(l(v.start,b.end)>=0)h(v,b,-1);else if(l(v.end,b.start)<=0)h(b,v,-1);else{var L,w;return l(b.start,v.start)<0&&(L=b,b=_(b,v.start)),l(b.end,v.end)>0&&(w=_(b,v.end)),d(v.end,b.start,b.end,-1),w&&!L&&(b.lines=w.lines,b.start=w.start,b.end=w.end,w=b),[v,L,w].filter(Boolean)}return[v,b]}function h(b,v,E){d(b.start,v.start,v.end,E),d(b.end,v.start,v.end,E)}function d(b,v,E,D){b.row==(D==1?v:E).row&&(b.column+=D*(E.column-v.column)),b.row+=D*(E.row-v.row)}function _(b,v){var E=b.lines,D=b.end;b.end=u(v);var L=b.end.row-b.start.row,w=E.splice(L,E.length),I=L?v.column:v.column-b.start.column;E.push(w[0].substring(0,I)),w[0]=w[0].substr(I);var R={start:u(v),end:D,lines:w,action:b.action};return R}function C(b,v){v=r(v);for(var E=b.length;E--;){for(var D=b[E],L=0;L<D.length;L++){var w=D[L],I=c(w,v);v=I[0],I.length!=2&&(I[2]?(D.splice(L+1,1,I[1],I[2]),L++):I[1]||(D.splice(L,1),L--))}D.length||b.splice(E,1)}return b}function M(b,v){for(var E=0;E<v.length;E++)for(var D=v[E],L=0;L<D.length;L++)C(b,D[L])}n.UndoManager=f}),ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(t,n,p){var f=t("../range").Range,y=function(){function m(l,u){this.foldData=l,Array.isArray(u)?this.folds=u:u=this.folds=[u];var r=u[u.length-1];this.range=new f(u[0].start.row,u[0].start.column,r.end.row,r.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(a){a.setFoldLine(this)},this)}return m.prototype.shiftRow=function(l){this.start.row+=l,this.end.row+=l,this.folds.forEach(function(u){u.start.row+=l,u.end.row+=l})},m.prototype.addFold=function(l){if(l.sameRow){if(l.start.row<this.startRow||l.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(l),this.folds.sort(function(u,r){return-u.range.compareEnd(r.start.row,r.start.column)}),this.range.compareEnd(l.start.row,l.start.column)>0?(this.end.row=l.end.row,this.end.column=l.end.column):this.range.compareStart(l.end.row,l.end.column)<0&&(this.start.row=l.start.row,this.start.column=l.start.column)}else if(l.start.row==this.end.row)this.folds.push(l),this.end.row=l.end.row,this.end.column=l.end.column;else if(l.end.row==this.start.row)this.folds.unshift(l),this.start.row=l.start.row,this.start.column=l.start.column;else throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");l.foldLine=this},m.prototype.containsRow=function(l){return l>=this.start.row&&l<=this.end.row},m.prototype.walk=function(l,u,r){var a=0,s=this.folds,o,i,c,h=!0;u==null&&(u=this.end.row,r=this.end.column);for(var d=0;d<s.length;d++){if(o=s[d],i=o.range.compareStart(u,r),i==-1){l(null,u,r,a,h);return}if(c=l(null,o.start.row,o.start.column,a,h),c=!c&&l(o.placeholder,o.start.row,o.start.column,a),c||i===0)return;h=!o.sameRow,a=o.end.column}l(null,u,r,a,h)},m.prototype.getNextFoldTo=function(l,u){for(var r,a,s=0;s<this.folds.length;s++){if(r=this.folds[s],a=r.range.compareEnd(l,u),a==-1)return{fold:r,kind:"after"};if(a===0)return{fold:r,kind:"inside"}}return null},m.prototype.addRemoveChars=function(l,u,r){var a=this.getNextFoldTo(l,u),s,o;if(a){if(s=a.fold,a.kind=="inside"&&s.start.column!=u&&s.start.row!=l)window.console&&window.console.log(l,u,s);else if(s.start.row==l){o=this.folds;var i=o.indexOf(s);for(i===0&&(this.start.column+=r),i;i<o.length;i++){if(s=o[i],s.start.column+=r,!s.sameRow)return;s.end.column+=r}this.end.column+=r}}},m.prototype.split=function(l,u){var r=this.getNextFoldTo(l,u);if(!r||r.kind=="inside")return null;var a=r.fold,s=this.folds,o=this.foldData,i=s.indexOf(a),c=s[i-1];this.end.row=c.end.row,this.end.column=c.end.column,s=s.splice(i,s.length-i);var h=new m(o,s);return o.splice(o.indexOf(this)+1,0,h),h},m.prototype.merge=function(l){for(var u=l.folds,r=0;r<u.length;r++)this.addFold(u[r]);var a=this.foldData;a.splice(a.indexOf(l),1)},m.prototype.toString=function(){var l=[this.range.toString()+": ["];return this.folds.forEach(function(u){l.push("  "+u.toString())}),l.push("]"),l.join(`
`)},m.prototype.idxToPosition=function(l){for(var u=0,r=0;r<this.folds.length;r++){var a=this.folds[r];if(l-=a.start.column-u,l<0)return{row:a.start.row,column:a.start.column+l};if(l-=a.placeholder.length,l<0)return a.start;u=a.end.column}return{row:this.end.row,column:this.end.column+l}},m}();n.FoldLine=y}),ace.define("ace/range_list",["require","exports","module","ace/range"],function(t,n,p){var f=t("./range").Range,y=f.comparePoints,m=function(){function l(){this.ranges=[],this.$bias=1}return l.prototype.pointIndex=function(u,r,a){for(var s=this.ranges,o=a||0;o<s.length;o++){var i=s[o],c=y(u,i.end);if(!(c>0)){var h=y(u,i.start);return c===0?r&&h!==0?-o-2:o:h>0||h===0&&!r?o:-o-1}}return-o-1},l.prototype.add=function(u){var r=!u.isEmpty(),a=this.pointIndex(u.start,r);a<0&&(a=-a-1);var s=this.pointIndex(u.end,r,a);return s<0?s=-s-1:s++,this.ranges.splice(a,s-a,u)},l.prototype.addList=function(u){for(var r=[],a=u.length;a--;)r.push.apply(r,this.add(u[a]));return r},l.prototype.substractPoint=function(u){var r=this.pointIndex(u);if(r>=0)return this.ranges.splice(r,1)},l.prototype.merge=function(){var u=[],r=this.ranges;r=r.sort(function(c,h){return y(c.start,h.start)});for(var a=r[0],s,o=1;o<r.length;o++){s=a,a=r[o];var i=y(s.end,a.start);i<0||i==0&&!s.isEmpty()&&!a.isEmpty()||(y(s.end,a.end)<0&&(s.end.row=a.end.row,s.end.column=a.end.column),r.splice(o,1),u.push(a),a=s,o--)}return this.ranges=r,u},l.prototype.contains=function(u,r){return this.pointIndex({row:u,column:r})>=0},l.prototype.containsPoint=function(u){return this.pointIndex(u)>=0},l.prototype.rangeAtPoint=function(u){var r=this.pointIndex(u);if(r>=0)return this.ranges[r]},l.prototype.clipRows=function(u,r){var a=this.ranges;if(a[0].start.row>r||a[a.length-1].start.row<u)return[];var s=this.pointIndex({row:u,column:0});s<0&&(s=-s-1);var o=this.pointIndex({row:r,column:0},s);o<0&&(o=-o-1);for(var i=[],c=s;c<o;c++)i.push(a[c]);return i},l.prototype.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},l.prototype.attach=function(u){this.session&&this.detach(),this.session=u,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},l.prototype.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},l.prototype.$onChange=function(u){for(var r=u.start,a=u.end,s=r.row,o=a.row,i=this.ranges,c=0,h=i.length;c<h;c++){var d=i[c];if(d.end.row>=s)break}if(u.action=="insert")for(var _=o-s,C=-r.column+a.column;c<h;c++){var d=i[c];if(d.start.row>s)break;if(d.start.row==s&&d.start.column>=r.column&&(d.start.column==r.column&&this.$bias<=0||(d.start.column+=C,d.start.row+=_)),d.end.row==s&&d.end.column>=r.column){if(d.end.column==r.column&&this.$bias<0)continue;d.end.column==r.column&&C>0&&c<h-1&&d.end.column>d.start.column&&d.end.column==i[c+1].start.column&&(d.end.column-=C),d.end.column+=C,d.end.row+=_}}else for(var _=s-o,C=r.column-a.column;c<h;c++){var d=i[c];if(d.start.row>o)break;d.end.row<o&&(s<d.end.row||s==d.end.row&&r.column<d.end.column)?(d.end.row=s,d.end.column=r.column):d.end.row==o?d.end.column<=a.column?(_||d.end.column>r.column)&&(d.end.column=r.column,d.end.row=r.row):(d.end.column+=C,d.end.row+=_):d.end.row>o&&(d.end.row+=_),d.start.row<o&&(s<d.start.row||s==d.start.row&&r.column<d.start.column)?(d.start.row=s,d.start.column=r.column):d.start.row==o?d.start.column<=a.column?(_||d.start.column>r.column)&&(d.start.column=r.column,d.start.row=r.row):(d.start.column+=C,d.start.row+=_):d.start.row>o&&(d.start.row+=_)}if(_!=0&&c<h)for(;c<h;c++){var d=i[c];d.start.row+=_,d.end.row+=_}},l}();m.prototype.comparePoints=y,n.RangeList=m}),ace.define("ace/edit_session/fold",["require","exports","module","ace/range_list"],function(t,n,p){var f=this&&this.__extends||function(){var s=function(o,i){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(c[d]=h[d])},s(o,i)};return function(o,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");s(o,i);function c(){this.constructor=o}o.prototype=i===null?Object.create(i):(c.prototype=i.prototype,new c)}}(),y=t("../range_list").RangeList,m=function(s){f(o,s);function o(i,c){var h=s.call(this)||this;return h.foldLine=null,h.placeholder=c,h.range=i,h.start=i.start,h.end=i.end,h.sameRow=i.start.row==i.end.row,h.subFolds=h.ranges=[],h}return o.prototype.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},o.prototype.setFoldLine=function(i){this.foldLine=i,this.subFolds.forEach(function(c){c.setFoldLine(i)})},o.prototype.clone=function(){var i=this.range.clone(),c=new o(i,this.placeholder);return this.subFolds.forEach(function(h){c.subFolds.push(h.clone())}),c.collapseChildren=this.collapseChildren,c},o.prototype.addSubFold=function(i){if(!this.range.isEqual(i)){u(i,this.start);for(var C=i.start.row,M=i.start.column,c=0,h=-1;c<this.subFolds.length&&(h=this.subFolds[c].range.compare(C,M),h==1);c++);var d=this.subFolds[c],_=0;if(h==0){if(d.range.containsRange(i))return d.addSubFold(i);_=1}for(var C=i.range.end.row,M=i.range.end.column,b=c,h=-1;b<this.subFolds.length&&(h=this.subFolds[b].range.compare(C,M),h==1);b++);h==0&&b++;for(var v=this.subFolds.splice(c,b-c,i),E=h==0?v.length-1:v.length,D=_;D<E;D++)i.addSubFold(v[D]);return i.setFoldLine(this.foldLine),i}},o.prototype.restoreRange=function(i){return a(i,this.start)},o}(y);function l(s,o){s.row-=o.row,s.row==0&&(s.column-=o.column)}function u(s,o){l(s.start,o),l(s.end,o)}function r(s,o){s.row==0&&(s.column+=o.column),s.row+=o.row}function a(s,o){r(s.start,o),r(s.end,o)}n.Fold=m}),ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator","ace/mouse/mouse_event"],function(t,n,p){var f=t("../range").Range,y=t("./fold_line").FoldLine,m=t("./fold").Fold,l=t("../token_iterator").TokenIterator,u=t("../mouse/mouse_event").MouseEvent;function r(){this.getFoldAt=function(a,s,o){var i=this.getFoldLine(a);if(!i)return null;for(var c=i.folds,h=0;h<c.length;h++){var d=c[h].range;if(d.contains(a,s)){if(o==1&&d.isEnd(a,s)&&!d.isEmpty())continue;if(o==-1&&d.isStart(a,s)&&!d.isEmpty())continue;return c[h]}}},this.getFoldsInRange=function(a){var s=a.start,o=a.end,i=this.$foldData,c=[];s.column+=1,o.column-=1;for(var h=0;h<i.length;h++){var d=i[h].range.compareRange(a);if(d!=2){if(d==-2)break;for(var _=i[h].folds,C=0;C<_.length;C++){var M=_[C];if(d=M.range.compareRange(a),d==-2)break;if(d==2)continue;if(d==42)break;c.push(M)}}}return s.column-=1,o.column+=1,c},this.getFoldsInRangeList=function(a){if(Array.isArray(a)){var s=[];a.forEach(function(o){s=s.concat(this.getFoldsInRange(o))},this)}else var s=this.getFoldsInRange(a);return s},this.getAllFolds=function(){for(var a=[],s=this.$foldData,o=0;o<s.length;o++)for(var i=0;i<s[o].folds.length;i++)a.push(s[o].folds[i]);return a},this.getFoldStringAt=function(a,s,o,i){if(i=i||this.getFoldLine(a),!i)return null;for(var c={end:{column:0}},h,d,_=0;_<i.folds.length;_++){d=i.folds[_];var C=d.range.compareEnd(a,s);if(C==-1){h=this.getLine(d.start.row).substring(c.end.column,d.start.column);break}else if(C===0)return null;c=d}return h||(h=this.getLine(d.start.row).substring(c.end.column)),o==-1?h.substring(0,s-c.end.column):o==1?h.substring(s-c.end.column):h},this.getFoldLine=function(a,s){var o=this.$foldData,i=0;for(s&&(i=o.indexOf(s)),i==-1&&(i=0),i;i<o.length;i++){var c=o[i];if(c.start.row<=a&&c.end.row>=a)return c;if(c.end.row>a)return null}return null},this.getNextFoldLine=function(a,s){var o=this.$foldData,i=0;for(s&&(i=o.indexOf(s)),i==-1&&(i=0),i;i<o.length;i++){var c=o[i];if(c.end.row>=a)return c}return null},this.getFoldedRowCount=function(a,s){for(var o=this.$foldData,i=s-a+1,c=0;c<o.length;c++){var h=o[c],d=h.end.row,_=h.start.row;if(d>=s){_<s&&(_>=a?i-=s-_:i=0);break}else d>=a&&(_>=a?i-=d-_:i-=d-a+1)}return i},this.$addFoldLine=function(a){return this.$foldData.push(a),this.$foldData.sort(function(s,o){return s.start.row-o.start.row}),a},this.addFold=function(a,s){var o=this.$foldData,i=!1,c;a instanceof m?c=a:(c=new m(s,a),c.collapseChildren=s.collapseChildren),this.$clipRangeToDocument(c.range);var h=c.start.row,d=c.start.column,_=c.end.row,C=c.end.column,M=this.getFoldAt(h,d,1),b=this.getFoldAt(_,C,-1);if(M&&b==M)return M.addSubFold(c);M&&!M.range.isStart(h,d)&&this.removeFold(M),b&&!b.range.isEnd(_,C)&&this.removeFold(b);var v=this.getFoldsInRange(c.range);v.length>0&&(this.removeFolds(v),c.collapseChildren||v.forEach(function(w){c.addSubFold(w)}));for(var E=0;E<o.length;E++){var D=o[E];if(_==D.start.row){D.addFold(c),i=!0;break}else if(h==D.end.row){if(D.addFold(c),i=!0,!c.sameRow){var L=o[E+1];if(L&&L.start.row==_){D.merge(L);break}}break}else if(_<=D.start.row)break}return i||(D=this.$addFoldLine(new y(this.$foldData,c))),this.$useWrapMode?this.$updateWrapData(D.start.row,D.start.row):this.$updateRowLengthCache(D.start.row,D.start.row),this.$modified=!0,this._signal("changeFold",{data:c,action:"add"}),c},this.addFolds=function(a){a.forEach(function(s){this.addFold(s)},this)},this.removeFold=function(a){var s=a.foldLine,o=s.start.row,i=s.end.row,c=this.$foldData,h=s.folds;if(h.length==1)c.splice(c.indexOf(s),1);else if(s.range.isEnd(a.end.row,a.end.column))h.pop(),s.end.row=h[h.length-1].end.row,s.end.column=h[h.length-1].end.column;else if(s.range.isStart(a.start.row,a.start.column))h.shift(),s.start.row=h[0].start.row,s.start.column=h[0].start.column;else if(a.sameRow)h.splice(h.indexOf(a),1);else{var d=s.split(a.start.row,a.start.column);h=d.folds,h.shift(),d.start.row=h[0].start.row,d.start.column=h[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(o,i):this.$updateRowLengthCache(o,i)),this.$modified=!0,this._signal("changeFold",{data:a,action:"remove"})},this.removeFolds=function(a){for(var s=[],o=0;o<a.length;o++)s.push(a[o]);s.forEach(function(i){this.removeFold(i)},this),this.$modified=!0},this.expandFold=function(a){this.removeFold(a),a.subFolds.forEach(function(s){a.restoreRange(s),this.addFold(s)},this),a.collapseChildren>0&&this.foldAll(a.start.row+1,a.end.row,a.collapseChildren-1),a.subFolds=[]},this.expandFolds=function(a){a.forEach(function(s){this.expandFold(s)},this)},this.unfold=function(a,s){var o,i;if(a==null)o=new f(0,0,this.getLength(),0),s==null&&(s=!0);else if(typeof a=="number")o=new f(a,0,a,this.getLine(a).length);else if("row"in a)o=f.fromPoints(a,a);else{if(Array.isArray(a))return i=[],a.forEach(function(h){i=i.concat(this.unfold(h))},this),i;o=a}i=this.getFoldsInRangeList(o);for(var c=i;i.length==1&&f.comparePoints(i[0].start,o.start)<0&&f.comparePoints(i[0].end,o.end)>0;)this.expandFolds(i),i=this.getFoldsInRangeList(o);if(s!=!1?this.removeFolds(i):this.expandFolds(i),c.length)return c},this.isRowFolded=function(a,s){return!!this.getFoldLine(a,s)},this.getRowFoldEnd=function(a,s){var o=this.getFoldLine(a,s);return o?o.end.row:a},this.getRowFoldStart=function(a,s){var o=this.getFoldLine(a,s);return o?o.start.row:a},this.getFoldDisplayLine=function(a,s,o,i,c){i==null&&(i=a.start.row),c==null&&(c=0),s==null&&(s=a.end.row),o==null&&(o=this.getLine(s).length);var h=this.doc,d="";return a.walk(function(_,C,M,b){if(!(C<i)){if(C==i){if(M<c)return;b=Math.max(c,b)}_!=null?d+=_:d+=h.getLine(C).substring(b,M)}},s,o),d},this.getDisplayLine=function(a,s,o,i){var c=this.getFoldLine(a);if(c)return this.getFoldDisplayLine(c,a,s,o,i);var h;return h=this.doc.getLine(a),h.substring(i||0,s||h.length)},this.$cloneFoldData=function(){var a=[];return a=this.$foldData.map(function(s){var o=s.folds.map(function(i){return i.clone()});return new y(a,o)}),a},this.toggleFold=function(a){var s=this.selection,o=s.getRange(),i,c;if(o.isEmpty()){var h=o.start;if(i=this.getFoldAt(h.row,h.column),i){this.expandFold(i);return}else if(a){var d=this.getFoldLine(h.row);d&&this.expandFolds(d.folds);return}else(c=this.findMatchingBracket(h))?o.comparePoint(c)==1?o.end=c:(o.start=c,o.start.column++,o.end.column--):(c=this.findMatchingBracket({row:h.row,column:h.column+1}))?(o.comparePoint(c)==1?o.end=c:o.start=c,o.start.column++):o=this.getCommentFoldRange(h.row,h.column)||o}else{var _=this.getFoldsInRange(o);if(a&&_.length){this.expandFolds(_);return}else _.length==1&&(i=_[0])}if(i||(i=this.getFoldAt(o.start.row,o.start.column)),i&&i.range.toString()==o.toString()){this.expandFold(i);return}var C="...";if(!o.isMultiLine()){if(C=this.getTextRange(o),C.length<4)return;C=C.trim().substring(0,2)+".."}this.addFold(C,o)},this.getCommentFoldRange=function(a,s,o){var i=new l(this,a,s),c=i.getCurrentToken(),h=c&&c.type;if(c&&/^comment|string/.test(h)){h=h.match(/comment|string/)[0],h=="comment"&&(h+="|doc-start|\\.doc");var d=new RegExp(h),_=new f;if(o!=1){do c=i.stepBackward();while(c&&d.test(c.type));c=i.stepForward()}_.start.row=i.getCurrentTokenRow(),_.start.column=i.getCurrentTokenColumn()+c.value.length,i=new l(this,a,s);var C=this.getState(i.$row);if(o!=-1){var M=-1;do if(c=i.stepForward(),M==-1){var b=this.getState(i.$row);C.toString()!==b.toString()&&(M=i.$row)}else if(i.$row>M)break;while(c&&d.test(c.type));c=i.stepBackward()}else c=i.getCurrentToken();return _.end.row=i.getCurrentTokenRow(),_.end.column=i.getCurrentTokenColumn(),_.start.row==_.end.row&&_.start.column>_.end.column?void 0:_}},this.foldAll=function(a,s,o,i){o==null&&(o=1e5);var c=this.foldWidgets;if(c){s=s||this.getLength(),a=a||0;for(var h=a;h<s;h++)if(c[h]==null&&(c[h]=this.getFoldWidget(h)),c[h]=="start"&&!(i&&!i(h))){var d=this.getFoldWidgetRange(h);d&&d.isMultiLine()&&d.end.row<=s&&d.start.row>=a&&(h=d.end.row,d.collapseChildren=o,this.addFold("...",d))}}},this.foldToLevel=function(a){for(this.foldAll();a-- >0;)this.unfold(null,!1)},this.foldAllComments=function(){var a=this;this.foldAll(null,null,null,function(s){for(var o=a.getTokens(s),i=0;i<o.length;i++){var c=o[i];if(!(c.type=="text"&&/^\s+$/.test(c.value)))return!!/comment/.test(c.type)}})},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(a){if(!this.$foldStyles[a])throw new Error("invalid fold style: "+a+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle!=a){this.$foldStyle=a,a=="manual"&&this.unfold();var s=this.$foldMode;this.$setFolding(null),this.$setFolding(s)}},this.$setFolding=function(a){if(this.$foldMode!=a){if(this.$foldMode=a,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),!a||this.$foldStyle=="manual"){this.foldWidgets=null;return}this.foldWidgets=[],this.getFoldWidget=a.getFoldWidget.bind(a,this,this.$foldStyle),this.getFoldWidgetRange=a.getFoldWidgetRange.bind(a,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)}},this.getParentFoldRangeData=function(a,s){var o=this.foldWidgets;if(!o||s&&o[a])return{};for(var i=a-1,c;i>=0;){var h=o[i];if(h==null&&(h=o[i]=this.getFoldWidget(i)),h=="start"){var d=this.getFoldWidgetRange(i);if(c||(c=d),d&&d.end.row>=a)break}i--}return{range:i!==-1&&d,firstRange:c}},this.onFoldWidgetClick=function(a,s){s instanceof u&&(s=s.domEvent);var o={children:s.shiftKey,all:s.ctrlKey||s.metaKey,siblings:s.altKey},i=this.$toggleFoldWidget(a,o);if(!i){var c=s.target||s.srcElement;c&&/ace_fold-widget/.test(c.className)&&(c.className+=" ace_invalid")}},this.$toggleFoldWidget=function(a,s){if(this.getFoldWidget){var o=this.getFoldWidget(a),i=this.getLine(a),c=o==="end"?-1:1,h=this.getFoldAt(a,c===-1?0:i.length,c);if(h)return s.children||s.all?this.removeFold(h):this.expandFold(h),h;var d=this.getFoldWidgetRange(a,!0);if(d&&!d.isMultiLine()&&(h=this.getFoldAt(d.start.row,d.start.column,1),h&&d.isEqual(h.range)))return this.removeFold(h),h;if(s.siblings){var _=this.getParentFoldRangeData(a);if(_.range)var C=_.range.start.row+1,M=_.range.end.row;this.foldAll(C,M,s.all?1e4:0)}else s.children?(M=d?d.end.row:this.getLength(),this.foldAll(a+1,M,s.all?1e4:0)):d&&(s.all&&(d.collapseChildren=1e4),this.addFold("...",d));return d}},this.toggleFoldWidget=function(a){var s=this.selection.getCursor().row;s=this.getRowFoldStart(s);var o=this.$toggleFoldWidget(s,{});if(!o){var i=this.getParentFoldRangeData(s,!0);if(o=i.range||i.firstRange,o){s=o.start.row;var c=this.getFoldAt(s,this.getLine(s).length,1);c?this.removeFold(c):this.addFold("...",o)}}},this.updateFoldWidgets=function(a){var s=a.start.row,o=a.end.row-s;if(o===0)this.foldWidgets[s]=null;else if(a.action=="remove")this.foldWidgets.splice(s,o+1,null);else{var i=Array(o+1);i.unshift(s,1),this.foldWidgets.splice.apply(this.foldWidgets,i)}},this.tokenizerUpdateFoldWidgets=function(a){var s=a.data;s.first!=s.last&&this.foldWidgets.length>s.first&&this.foldWidgets.splice(s.first,this.foldWidgets.length)}}n.Folding=r}),ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(t,n,p){var f=t("../token_iterator").TokenIterator,y=t("../range").Range;function m(){this.findMatchingBracket=function(l,u){if(l.column==0)return null;var r=u||this.getLine(l.row).charAt(l.column-1);if(r=="")return null;var a=r.match(/([\(\[\{])|([\)\]\}])/);return a?a[1]?this.$findClosingBracket(a[1],l):this.$findOpeningBracket(a[2],l):null},this.getBracketRange=function(l){var u=this.getLine(l.row),r=!0,a,s=u.charAt(l.column-1),o=s&&s.match(/([\(\[\{])|([\)\]\}])/);if(o||(s=u.charAt(l.column),l={row:l.row,column:l.column+1},o=s&&s.match(/([\(\[\{])|([\)\]\}])/),r=!1),!o)return null;if(o[1]){var i=this.$findClosingBracket(o[1],l);if(!i)return null;a=y.fromPoints(l,i),r||(a.end.column++,a.start.column--),a.cursor=a.end}else{var i=this.$findOpeningBracket(o[2],l);if(!i)return null;a=y.fromPoints(i,l),r||(a.start.column++,a.end.column--),a.cursor=a.start}return a},this.getMatchingBracketRanges=function(l,u){var r=this.getLine(l.row),a=/([\(\[\{])|([\)\]\}])/,s=!u&&r.charAt(l.column-1),o=s&&s.match(a);if(o||(s=(u===void 0||u)&&r.charAt(l.column),l={row:l.row,column:l.column+1},o=s&&s.match(a)),!o)return null;var i=new y(l.row,l.column-1,l.row,l.column),c=o[1]?this.$findClosingBracket(o[1],l):this.$findOpeningBracket(o[2],l);if(!c)return[i];var h=new y(c.row,c.column,c.row,c.column+1);return[i,h]},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(l,u,r){var a=this.$brackets[l],s=1,o=new f(this,u.row,u.column),i=o.getCurrentToken();if(i||(i=o.stepForward()),!!i){r||(r=new RegExp("(\\.?"+i.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)").replace(/-close\b/,"-(close|open)")+")+"));for(var c=u.column-o.getCurrentTokenColumn()-2,h=i.value;;){for(;c>=0;){var d=h.charAt(c);if(d==a){if(s-=1,s==0)return{row:o.getCurrentTokenRow(),column:c+o.getCurrentTokenColumn()}}else d==l&&(s+=1);c-=1}do i=o.stepBackward();while(i&&!r.test(i.type));if(i==null)break;h=i.value,c=h.length-1}return null}},this.$findClosingBracket=function(l,u,r){var a=this.$brackets[l],s=1,o=new f(this,u.row,u.column),i=o.getCurrentToken();if(i||(i=o.stepForward()),!!i){r||(r=new RegExp("(\\.?"+i.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)").replace(/-open\b/,"-(close|open)")+")+"));for(var c=u.column-o.getCurrentTokenColumn();;){for(var h=i.value,d=h.length;c<d;){var _=h.charAt(c);if(_==a){if(s-=1,s==0)return{row:o.getCurrentTokenRow(),column:c+o.getCurrentTokenColumn()}}else _==l&&(s+=1);c+=1}do i=o.stepForward();while(i&&!r.test(i.type));if(i==null)break;c=0}return null}},this.getMatchingTags=function(l){var u=new f(this,l.row,l.column),r=this.$findTagName(u);if(r){var a=u.stepBackward();return a.value==="<"?this.$findClosingTag(u,r):this.$findOpeningTag(u,r)}},this.$findTagName=function(l){var u=l.getCurrentToken(),r=!1,a=!1;if(u&&u.type.indexOf("tag-name")===-1)do a?u=l.stepBackward():u=l.stepForward(),u&&(u.value==="/>"?a=!0:u.type.indexOf("tag-name")!==-1&&(r=!0));while(u&&!r);return u},this.$findClosingTag=function(l,u){var r,a=u.value,s=u.value,o=0,i=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);u=l.stepForward();var c=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+u.value.length),h=!1;do{if(r=u,r.type.indexOf("tag-close")!==-1&&!h){var d=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);h=!0}if(u=l.stepForward(),u){if(u.value===">"&&!h){var d=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);h=!0}if(u.type.indexOf("tag-name")!==-1){if(a=u.value,s===a){if(r.value==="<")o++;else if(r.value==="</"&&(o--,o<0)){l.stepBackward();var _=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+2);u=l.stepForward();var C=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+u.value.length);if(u.type.indexOf("tag-close")===-1&&(u=l.stepForward()),u&&u.value===">")var M=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);else return}}}else if(s===a&&u.value==="/>"&&(o--,o<0))var _=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+2),C=_,M=C,d=new y(c.end.row,c.end.column,c.end.row,c.end.column+1)}}while(u&&o>=0);if(i&&d&&_&&M&&c&&C)return{openTag:new y(i.start.row,i.start.column,d.end.row,d.end.column),closeTag:new y(_.start.row,_.start.column,M.end.row,M.end.column),openTagName:c,closeTagName:C}},this.$findOpeningTag=function(l,u){var r=l.getCurrentToken(),a=u.value,s=0,o=l.getCurrentTokenRow(),i=l.getCurrentTokenColumn(),c=i+2,h=new y(o,i,o,c);l.stepForward();var d=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+u.value.length);if(u.type.indexOf("tag-close")===-1&&(u=l.stepForward()),!(!u||u.value!==">")){var _=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);l.stepBackward(),l.stepBackward();do if(u=r,o=l.getCurrentTokenRow(),i=l.getCurrentTokenColumn(),c=i+u.value.length,r=l.stepBackward(),u){if(u.type.indexOf("tag-name")!==-1){if(a===u.value)if(r.value==="<"){if(s++,s>0){var C=new y(o,i,o,c),M=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1);do u=l.stepForward();while(u&&u.value!==">");var b=new y(l.getCurrentTokenRow(),l.getCurrentTokenColumn(),l.getCurrentTokenRow(),l.getCurrentTokenColumn()+1)}}else r.value==="</"&&s--}else if(u.value==="/>"){for(var v=0,E=r;E;){if(E.type.indexOf("tag-name")!==-1&&E.value===a){s--;break}else if(E.value==="<")break;E=l.stepBackward(),v++}for(var D=0;D<v;D++)l.stepForward()}}while(r&&s<=0);if(M&&b&&h&&_&&C&&d)return{openTag:new y(M.start.row,M.start.column,b.end.row,b.end.column),closeTag:new y(h.start.row,h.start.column,_.end.row,_.end.column),openTagName:C,closeTagName:d}}}}n.BracketMatch=m}),ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/line_widgets","ace/document","ace/background_tokenizer","ace/search_highlight","ace/undomanager","ace/edit_session/folding","ace/edit_session/bracket_match"],function(t,n,p){var f=t("./lib/oop"),y=t("./lib/lang"),m=t("./bidihandler").BidiHandler,l=t("./config"),u=t("./lib/event_emitter").EventEmitter,r=t("./selection").Selection,a=t("./mode/text").Mode,s=t("./range").Range,o=t("./line_widgets").LineWidgets,i=t("./document").Document,c=t("./background_tokenizer").BackgroundTokenizer,h=t("./search_highlight").SearchHighlight,d=t("./undomanager").UndoManager,_=function(){function R(A,x){this.doc,this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$editor=null,this.prevOp={},this.$foldData=[],this.id="session"+ ++R.$uid,this.$foldData.toString=function(){return this.join(`
`)},this.$gutterCustomWidgets={},this.bgTokenizer=new c(new a().getTokenizer(),this);var S=this;this.bgTokenizer.on("update",function(T){S._signal("tokenizerUpdate",T)}),this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),(typeof A!="object"||!A.getLine)&&(A=new i(A)),this.setDocument(A),this.selection=new r(this),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.selection.on("changeCursor",this.$onSelectionChange),this.$bidiHandler=new m(this),l.resetOptions(this),this.setMode(x),l._signal("session",this),this.destroyed=!1,this.$initOperationListeners()}return R.prototype.$initOperationListeners=function(){var A=this;this.curOp=null,this.on("change",function(){A.curOp||(A.startOperation(),A.curOp.selectionBefore=A.$lastSel),A.curOp.docChanged=!0},!0),this.on("changeSelection",function(){A.curOp||(A.startOperation(),A.curOp.selectionBefore=A.$lastSel),A.curOp.selectionChanged=!0},!0),this.$operationResetTimer=y.delayedCall(this.endOperation.bind(this,!0))},R.prototype.startOperation=function(A){if(this.curOp){if(!A||this.curOp.command)return;this.prevOp=this.curOp}A||(A={}),this.$operationResetTimer.schedule(),this.curOp={command:A.command||{},args:A.args},this.curOp.selectionBefore=this.selection.toJSON(),this._signal("startOperation",A)},R.prototype.endOperation=function(A){if(this.curOp){if(A&&A.returnValue===!1){this.curOp=null,this._signal("endOperation",A);return}if(A==!0&&this.curOp.command&&this.curOp.command.name=="mouse")return;var x=this.selection.toJSON();this.curOp.selectionAfter=x,this.$lastSel=this.selection.toJSON(),this.getUndoManager().addSelection(x),this._signal("beforeEndOperation"),this.prevOp=this.curOp,this.curOp=null,this._signal("endOperation",A)}},R.prototype.setDocument=function(A){this.doc&&this.doc.off("change",this.$onChange),this.doc=A,A.on("change",this.$onChange,!0),this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},R.prototype.getDocument=function(){return this.doc},Object.defineProperty(R.prototype,"widgetManager",{get:function(){var A=new o(this);return this.widgetManager=A,this.$editor&&A.attach(this.$editor),A},set:function(A){Object.defineProperty(this,"widgetManager",{writable:!0,enumerable:!0,configurable:!0,value:A})},enumerable:!1,configurable:!0}),R.prototype.$resetRowCache=function(A){if(!A){this.$docRowCache=[],this.$screenRowCache=[];return}var x=this.$docRowCache.length,S=this.$getRowCacheIndex(this.$docRowCache,A)+1;x>S&&(this.$docRowCache.splice(S,x),this.$screenRowCache.splice(S,x))},R.prototype.$getRowCacheIndex=function(A,x){for(var S=0,T=A.length-1;S<=T;){var P=S+T>>1,N=A[P];if(x>N)S=P+1;else if(x<N)T=P-1;else return P}return S-1},R.prototype.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.destroyed||this.bgTokenizer.start(0)},R.prototype.onChangeFold=function(A){var x=A.data;this.$resetRowCache(x.start.row)},R.prototype.onChange=function(A){this.$modified=!0,this.$bidiHandler.onChange(A),this.$resetRowCache(A.start.row);var x=this.$updateInternalDataOnChange(A);!this.$fromUndo&&this.$undoManager&&(x&&x.length&&(this.$undoManager.add({action:"removeFolds",folds:x},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(A,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer.$updateOnChange(A),this._signal("change",A)},R.prototype.onSelectionChange=function(){this._signal("changeSelection")},R.prototype.setValue=function(A){this.doc.setValue(A),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},R.fromJSON=function(A){typeof A=="string"&&(A=JSON.parse(A));var x=new d;x.$undoStack=A.history.undo,x.$redoStack=A.history.redo,x.mark=A.history.mark,x.$rev=A.history.rev;var S=new R(A.value);return A.folds.forEach(function(T){S.addFold("...",s.fromPoints(T.start,T.end))}),S.setAnnotations(A.annotations),S.setBreakpoints(A.breakpoints),S.setMode(A.mode),S.setScrollLeft(A.scrollLeft),S.setScrollTop(A.scrollTop),S.setUndoManager(x),S.selection.fromJSON(A.selection),S},R.prototype.toJSON=function(){return{annotations:this.$annotations,breakpoints:this.$breakpoints,folds:this.getAllFolds().map(function(A){return A.range}),history:this.getUndoManager(),mode:this.$mode.$id,scrollLeft:this.$scrollLeft,scrollTop:this.$scrollTop,selection:this.selection.toJSON(),value:this.doc.getValue()}},R.prototype.toString=function(){return this.doc.getValue()},R.prototype.getSelection=function(){return this.selection},R.prototype.getState=function(A){return this.bgTokenizer.getState(A)},R.prototype.getTokens=function(A){return this.bgTokenizer.getTokens(A)},R.prototype.getTokenAt=function(A,x){var S=this.bgTokenizer.getTokens(A),T,P=0;if(x==null){var N=S.length-1;P=this.getLine(A).length}else for(var N=0;N<S.length&&(P+=S[N].value.length,!(P>=x));N++);return T=S[N],T?(T.index=N,T.start=P-T.value.length,T):null},R.prototype.setUndoManager=function(A){if(this.$undoManager=A,this.$informUndoManager&&this.$informUndoManager.cancel(),A){var x=this;A.addSession(this),this.$syncInformUndoManager=function(){x.$informUndoManager.cancel(),x.mergeUndoDeltas=!1},this.$informUndoManager=y.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}},R.prototype.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},R.prototype.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},R.prototype.getTabString=function(){return this.getUseSoftTabs()?y.stringRepeat(" ",this.getTabSize()):"	"},R.prototype.setUseSoftTabs=function(A){this.setOption("useSoftTabs",A)},R.prototype.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},R.prototype.setTabSize=function(A){this.setOption("tabSize",A)},R.prototype.getTabSize=function(){return this.$tabSize},R.prototype.isTabStop=function(A){return this.$useSoftTabs&&A.column%this.$tabSize===0},R.prototype.setNavigateWithinSoftTabs=function(A){this.setOption("navigateWithinSoftTabs",A)},R.prototype.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},R.prototype.setOverwrite=function(A){this.setOption("overwrite",A)},R.prototype.getOverwrite=function(){return this.$overwrite},R.prototype.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},R.prototype.addGutterDecoration=function(A,x){this.$decorations[A]||(this.$decorations[A]=""),this.$decorations[A]+=" "+x,this._signal("changeBreakpoint",{})},R.prototype.removeGutterCustomWidget=function(A){this.$editor&&this.$editor.renderer.$gutterLayer.$removeCustomWidget(A)},R.prototype.addGutterCustomWidget=function(A,x){this.$editor&&this.$editor.renderer.$gutterLayer.$addCustomWidget(A,x)},R.prototype.removeGutterDecoration=function(A,x){this.$decorations[A]=(this.$decorations[A]||"").replace(" "+x,""),this._signal("changeBreakpoint",{})},R.prototype.getBreakpoints=function(){return this.$breakpoints},R.prototype.setBreakpoints=function(A){this.$breakpoints=[];for(var x=0;x<A.length;x++)this.$breakpoints[A[x]]="ace_breakpoint";this._signal("changeBreakpoint",{})},R.prototype.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},R.prototype.setBreakpoint=function(A,x){x===void 0&&(x="ace_breakpoint"),x?this.$breakpoints[A]=x:delete this.$breakpoints[A],this._signal("changeBreakpoint",{})},R.prototype.clearBreakpoint=function(A){delete this.$breakpoints[A],this._signal("changeBreakpoint",{})},R.prototype.addMarker=function(A,x,S,T){var P=this.$markerId++,N={range:A,type:S||"line",renderer:typeof S=="function"?S:null,clazz:x,inFront:!!T,id:P};return T?(this.$frontMarkers[P]=N,this._signal("changeFrontMarker")):(this.$backMarkers[P]=N,this._signal("changeBackMarker")),P},R.prototype.addDynamicMarker=function(A,x){if(A.update){var S=this.$markerId++;return A.id=S,A.inFront=!!x,x?(this.$frontMarkers[S]=A,this._signal("changeFrontMarker")):(this.$backMarkers[S]=A,this._signal("changeBackMarker")),A}},R.prototype.removeMarker=function(A){var x=this.$frontMarkers[A]||this.$backMarkers[A];if(x){var S=x.inFront?this.$frontMarkers:this.$backMarkers;delete S[A],this._signal(x.inFront?"changeFrontMarker":"changeBackMarker")}},R.prototype.getMarkers=function(A){return A?this.$frontMarkers:this.$backMarkers},R.prototype.highlight=function(A){if(!this.$searchHighlight){var x=new h(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(x)}this.$searchHighlight.setRegexp(A)},R.prototype.highlightLines=function(A,x,S,T){typeof x!="number"&&(S=x,x=A),S||(S="ace_step");var P=new s(A,0,x,1/0);return P.id=this.addMarker(P,S,"fullLine",T),P},R.prototype.setAnnotations=function(A){this.$annotations=A,this._signal("changeAnnotation",{})},R.prototype.getAnnotations=function(){return this.$annotations||[]},R.prototype.clearAnnotations=function(){this.setAnnotations([])},R.prototype.$detectNewLine=function(A){var x=A.match(/^.*?(\r?\n)/m);x?this.$autoNewLine=x[1]:this.$autoNewLine=`
`},R.prototype.getWordRange=function(A,x){var S=this.getLine(A),T=!1;if(x>0&&(T=!!S.charAt(x-1).match(this.tokenRe)),T||(T=!!S.charAt(x).match(this.tokenRe)),T)var P=this.tokenRe;else if(/^\s+$/.test(S.slice(x-1,x+1)))var P=/\s/;else var P=this.nonTokenRe;var N=x;if(N>0){do N--;while(N>=0&&S.charAt(N).match(P));N++}for(var k=x;k<S.length&&S.charAt(k).match(P);)k++;return new s(A,N,A,k)},R.prototype.getAWordRange=function(A,x){for(var S=this.getWordRange(A,x),T=this.getLine(S.end.row);T.charAt(S.end.column).match(/[ \t]/);)S.end.column+=1;return S},R.prototype.setNewLineMode=function(A){this.doc.setNewLineMode(A)},R.prototype.getNewLineMode=function(){return this.doc.getNewLineMode()},R.prototype.setUseWorker=function(A){this.setOption("useWorker",A)},R.prototype.getUseWorker=function(){return this.$useWorker},R.prototype.onReloadTokenizer=function(A){var x=A.data;this.bgTokenizer.start(x.first),this._signal("tokenizerUpdate",A)},R.prototype.setMode=function(A,x){if(A&&typeof A=="object"){if(A.getTokenizer)return this.$onChangeMode(A);var S=A,T=S.path}else T=A||"ace/mode/text";if(this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new a),this.$modes[T]&&!S){this.$onChangeMode(this.$modes[T]),x&&x();return}this.$modeId=T,l.loadModule(["mode",T],function(P){if(!this.destroyed){if(this.$modeId!==T)return x&&x();this.$modes[T]&&!S?this.$onChangeMode(this.$modes[T]):P&&P.Mode&&(P=new P.Mode(S),S||(this.$modes[T]=P,P.$id=T),this.$onChangeMode(P)),x&&x()}}.bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)},R.prototype.$onChangeMode=function(A,x){if(x||(this.$modeId=A.$id),this.$mode!==A){var S=this.$mode;this.$mode=A,this.$stopWorker(),this.$useWorker&&this.$startWorker();var T=A.getTokenizer();if(T.on!==void 0){var P=this.onReloadTokenizer.bind(this);T.on("update",P)}this.bgTokenizer.setTokenizer(T),this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=A.tokenRe,this.nonTokenRe=A.nonTokenRe,x||(A.attachToSession&&A.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(A.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:S,mode:A}))}},R.prototype.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},R.prototype.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(A){l.warn("Could not load worker",A),this.$worker=null}},R.prototype.getMode=function(){return this.$mode},R.prototype.setScrollTop=function(A){this.$scrollTop===A||isNaN(A)||(this.$scrollTop=A,this._signal("changeScrollTop",A))},R.prototype.getScrollTop=function(){return this.$scrollTop},R.prototype.setScrollLeft=function(A){this.$scrollLeft===A||isNaN(A)||(this.$scrollLeft=A,this._signal("changeScrollLeft",A))},R.prototype.getScrollLeft=function(){return this.$scrollLeft},R.prototype.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},R.prototype.getLineWidgetMaxWidth=function(){if(this.lineWidgetsWidth!=null)return this.lineWidgetsWidth;var A=0;return this.lineWidgets.forEach(function(x){x&&x.screenWidth>A&&(A=x.screenWidth)}),this.lineWidgetWidth=A},R.prototype.$computeWidth=function(A){if(this.$modified||A){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var x=this.doc.getAllLines(),S=this.$rowLengthCache,T=0,P=0,N=this.$foldData[P],k=N?N.start.row:1/0,O=x.length,$=0;$<O;$++){if($>k){if($=N.end.row+1,$>=O)break;N=this.$foldData[P++],k=N?N.start.row:1/0}S[$]==null&&(S[$]=this.$getStringScreenWidth(x[$])[0]),S[$]>T&&(T=S[$])}this.screenWidth=T}},R.prototype.getLine=function(A){return this.doc.getLine(A)},R.prototype.getLines=function(A,x){return this.doc.getLines(A,x)},R.prototype.getLength=function(){return this.doc.getLength()},R.prototype.getTextRange=function(A){return this.doc.getTextRange(A||this.selection.getRange())},R.prototype.insert=function(A,x){return this.doc.insert(A,x)},R.prototype.remove=function(A){return this.doc.remove(A)},R.prototype.removeFullLines=function(A,x){return this.doc.removeFullLines(A,x)},R.prototype.undoChanges=function(A,x){if(A.length){this.$fromUndo=!0;for(var S=A.length-1;S!=-1;S--){var T=A[S];T.action=="insert"||T.action=="remove"?this.doc.revertDelta(T):T.folds&&this.addFolds(T.folds)}!x&&this.$undoSelect&&(A.selectionBefore?this.selection.fromJSON(A.selectionBefore):this.selection.setRange(this.$getUndoSelection(A,!0))),this.$fromUndo=!1}},R.prototype.redoChanges=function(A,x){if(A.length){this.$fromUndo=!0;for(var S=0;S<A.length;S++){var T=A[S];(T.action=="insert"||T.action=="remove")&&this.doc.$safeApplyDelta(T)}!x&&this.$undoSelect&&(A.selectionAfter?this.selection.fromJSON(A.selectionAfter):this.selection.setRange(this.$getUndoSelection(A,!1))),this.$fromUndo=!1}},R.prototype.setUndoSelect=function(A){this.$undoSelect=A},R.prototype.$getUndoSelection=function(A,x){function S(O){return x?O.action!=="insert":O.action==="insert"}for(var T,P,N=0;N<A.length;N++){var k=A[N];if(k.start){if(!T){S(k)?T=s.fromPoints(k.start,k.end):T=s.fromPoints(k.start,k.start);continue}S(k)?(P=k.start,T.compare(P.row,P.column)==-1&&T.setStart(P),P=k.end,T.compare(P.row,P.column)==1&&T.setEnd(P)):(P=k.start,T.compare(P.row,P.column)==-1&&(T=s.fromPoints(k.start,k.start)))}}return T},R.prototype.replace=function(A,x){return this.doc.replace(A,x)},R.prototype.moveText=function(A,x,S){var T=this.getTextRange(A),P=this.getFoldsInRange(A),N=s.fromPoints(x,x);if(!S){this.remove(A);var k=A.start.row-A.end.row,O=k?-A.end.column:A.start.column-A.end.column;O&&(N.start.row==A.end.row&&N.start.column>A.end.column&&(N.start.column+=O),N.end.row==A.end.row&&N.end.column>A.end.column&&(N.end.column+=O)),k&&N.start.row>=A.end.row&&(N.start.row+=k,N.end.row+=k)}if(N.end=this.insert(N.start,T),P.length){var $=A.start,V=N.start,k=V.row-$.row,O=V.column-$.column;this.addFolds(P.map(function(z){return z=z.clone(),z.start.row==$.row&&(z.start.column+=O),z.end.row==$.row&&(z.end.column+=O),z.start.row+=k,z.end.row+=k,z}))}return N},R.prototype.indentRows=function(A,x,S){S=S.replace(/\t/g,this.getTabString());for(var T=A;T<=x;T++)this.doc.insertInLine({row:T,column:0},S)},R.prototype.outdentRows=function(A){for(var x=A.collapseRows(),S=new s(0,0,0,0),T=this.getTabSize(),P=x.start.row;P<=x.end.row;++P){var N=this.getLine(P);S.start.row=P,S.end.row=P;for(var k=0;k<T&&N.charAt(k)==" ";++k);k<T&&N.charAt(k)=="	"?(S.start.column=k,S.end.column=k+1):(S.start.column=0,S.end.column=k),this.remove(S)}},R.prototype.$moveLines=function(A,x,S){if(A=this.getRowFoldStart(A),x=this.getRowFoldEnd(x),S<0){var T=this.getRowFoldStart(A+S);if(T<0)return 0;var P=T-A}else if(S>0){var T=this.getRowFoldEnd(x+S);if(T>this.doc.getLength()-1)return 0;var P=T-x}else{A=this.$clipRowToDocument(A),x=this.$clipRowToDocument(x);var P=x-A+1}var N=new s(A,0,x,Number.MAX_VALUE),k=this.getFoldsInRange(N).map(function($){return $=$.clone(),$.start.row+=P,$.end.row+=P,$}),O=S==0?this.doc.getLines(A,x):this.doc.removeFullLines(A,x);return this.doc.insertFullLines(A+P,O),k.length&&this.addFolds(k),P},R.prototype.moveLinesUp=function(A,x){return this.$moveLines(A,x,-1)},R.prototype.moveLinesDown=function(A,x){return this.$moveLines(A,x,1)},R.prototype.duplicateLines=function(A,x){return this.$moveLines(A,x,0)},R.prototype.$clipRowToDocument=function(A){return Math.max(0,Math.min(A,this.doc.getLength()-1))},R.prototype.$clipColumnToRow=function(A,x){return x<0?0:Math.min(this.doc.getLine(A).length,x)},R.prototype.$clipPositionToDocument=function(A,x){if(x=Math.max(0,x),A<0)A=0,x=0;else{var S=this.doc.getLength();A>=S?(A=S-1,x=this.doc.getLine(S-1).length):x=Math.min(this.doc.getLine(A).length,x)}return{row:A,column:x}},R.prototype.$clipRangeToDocument=function(A){A.start.row<0?(A.start.row=0,A.start.column=0):A.start.column=this.$clipColumnToRow(A.start.row,A.start.column);var x=this.doc.getLength()-1;return A.end.row>x?(A.end.row=x,A.end.column=this.doc.getLine(x).length):A.end.column=this.$clipColumnToRow(A.end.row,A.end.column),A},R.prototype.setUseWrapMode=function(A){if(A!=this.$useWrapMode){if(this.$useWrapMode=A,this.$modified=!0,this.$resetRowCache(0),A){var x=this.getLength();this.$wrapData=Array(x),this.$updateWrapData(0,x-1)}this._signal("changeWrapMode")}},R.prototype.getUseWrapMode=function(){return this.$useWrapMode},R.prototype.setWrapLimitRange=function(A,x){(this.$wrapLimitRange.min!==A||this.$wrapLimitRange.max!==x)&&(this.$wrapLimitRange={min:A,max:x},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode"))},R.prototype.adjustWrapLimit=function(A,x){var S=this.$wrapLimitRange;S.max<0&&(S={min:x,max:x});var T=this.$constrainWrapLimit(A,S.min,S.max);return T!=this.$wrapLimit&&T>1?(this.$wrapLimit=T,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1},R.prototype.$constrainWrapLimit=function(A,x,S){return x&&(A=Math.max(x,A)),S&&(A=Math.min(S,A)),A},R.prototype.getWrapLimit=function(){return this.$wrapLimit},R.prototype.setWrapLimit=function(A){this.setWrapLimitRange(A,A)},R.prototype.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},R.prototype.$updateInternalDataOnChange=function(A){var x=this.$useWrapMode,S=A.action,T=A.start,P=A.end,N=T.row,k=P.row,O=k-N,$=null;if(this.$updating=!0,O!=0)if(S==="remove"){this[x?"$wrapData":"$rowLengthCache"].splice(N,O);var V=this.$foldData;$=this.getFoldsInRange(A),this.removeFolds($);var H=this.getFoldLine(P.row),U=0;if(H){H.addRemoveChars(P.row,P.column,T.column-P.column),H.shiftRow(-O);var z=this.getFoldLine(N);z&&z!==H&&(z.merge(H),H=z),U=V.indexOf(H)+1}for(U;U<V.length;U++){var H=V[U];H.start.row>=P.row&&H.shiftRow(-O)}k=N}else{var G=Array(O);G.unshift(N,0);var K=x?this.$wrapData:this.$rowLengthCache;K.splice.apply(K,G);var V=this.$foldData,H=this.getFoldLine(N),U=0;if(H){var Y=H.range.compareInside(T.row,T.column);Y==0?(H=H.split(T.row,T.column),H&&(H.shiftRow(O),H.addRemoveChars(k,0,P.column-T.column))):Y==-1&&(H.addRemoveChars(N,0,P.column-T.column),H.shiftRow(O)),U=V.indexOf(H)+1}for(U;U<V.length;U++){var H=V[U];H.start.row>=N&&H.shiftRow(O)}}else{O=Math.abs(A.start.column-A.end.column),S==="remove"&&($=this.getFoldsInRange(A),this.removeFolds($),O=-O);var H=this.getFoldLine(N);H&&H.addRemoveChars(N,T.column,O)}return x&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,x?this.$updateWrapData(N,k):this.$updateRowLengthCache(N,k),$},R.prototype.$updateRowLengthCache=function(A,x){this.$rowLengthCache[A]=null,this.$rowLengthCache[x]=null},R.prototype.$updateWrapData=function(A,x){var S=this.doc.getAllLines(),T=this.getTabSize(),P=this.$wrapData,N=this.$wrapLimit,k,O,$=A;for(x=Math.min(x,S.length-1);$<=x;)O=this.getFoldLine($,O),O?(k=[],O.walk(function(V,H,U,z){var G;if(V!=null){G=this.$getDisplayTokens(V,k.length),G[0]=b;for(var K=1;K<G.length;K++)G[K]=v}else G=this.$getDisplayTokens(S[H].substring(z,U),k.length);k=k.concat(G)}.bind(this),O.end.row,S[O.end.row].length+1),P[O.start.row]=this.$computeWrapSplits(k,N,T),$=O.end.row+1):(k=this.$getDisplayTokens(S[$]),P[$]=this.$computeWrapSplits(k,N,T),$++)},R.prototype.$computeWrapSplits=function(A,x,S){if(A.length==0)return[];var T=[],P=A.length,N=0,k=0,O=this.$wrapAsCode,$=this.$indentedSoftWrap,V=x<=Math.max(2*S,8)||$===!1?0:Math.floor(x/2);function H(){var Y=0;if(V===0)return Y;if($)for(var Z=0;Z<A.length;Z++){var ie=A[Z];if(ie==D)Y+=1;else if(ie==L)Y+=S;else{if(ie==w)continue;break}}return O&&$!==!1&&(Y+=S),Math.min(Y,V)}function U(Y){for(var Z=Y-N,ie=N;ie<Y;ie++){var oe=A[ie];(oe===12||oe===2)&&(Z-=1)}T.length||(z=H(),T.indent=z),k+=Z,T.push(k),N=Y}for(var z=0;P-N>x-z;){var G=N+x-z;if(A[G-1]>=D&&A[G]>=D){U(G);continue}if(A[G]==b||A[G]==v){for(G;G!=N-1&&A[G]!=b;G--);if(G>N){U(G);continue}for(G=N+x,G;G<A.length&&A[G]==v;G++);if(G==A.length)break;U(G);continue}for(var K=Math.max(G-(x-(x>>2)),N-1);G>K&&A[G]<b;)G--;if(O){for(;G>K&&A[G]<b;)G--;for(;G>K&&A[G]==E;)G--}else for(;G>K&&A[G]<D;)G--;if(G>K){U(++G);continue}G=N+x,A[G]==M&&G--,U(G-z)}return T},R.prototype.$getDisplayTokens=function(A,x){var S=[],T;x=x||0;for(var P=0;P<A.length;P++){var N=A.charCodeAt(P);if(N==9){T=this.getScreenTabSize(S.length+x),S.push(L);for(var k=1;k<T;k++)S.push(w)}else N==32?S.push(D):N>39&&N<48||N>57&&N<64?S.push(E):N>=4352&&I(N)?S.push(C,M):S.push(C)}return S},R.prototype.$getStringScreenWidth=function(A,x,S){if(x==0)return[0,0];x==null&&(x=1/0),S=S||0;var T,P;for(P=0;P<A.length&&(T=A.charCodeAt(P),T==9?S+=this.getScreenTabSize(S):T>=4352&&I(T)?S+=2:S+=1,!(S>x));P++);return[S,P]},R.prototype.getRowLength=function(A){var x=1;return this.lineWidgets&&(x+=this.lineWidgets[A]&&this.lineWidgets[A].rowCount||0),!this.$useWrapMode||!this.$wrapData[A]?x:this.$wrapData[A].length+x},R.prototype.getRowLineCount=function(A){return!this.$useWrapMode||!this.$wrapData[A]?1:this.$wrapData[A].length+1},R.prototype.getRowWrapIndent=function(A){if(this.$useWrapMode){var x=this.screenToDocumentPosition(A,Number.MAX_VALUE),S=this.$wrapData[x.row];return S.length&&S[0]<x.column?S.indent:0}else return 0},R.prototype.getScreenLastRowColumn=function(A){var x=this.screenToDocumentPosition(A,Number.MAX_VALUE);return this.documentToScreenColumn(x.row,x.column)},R.prototype.getDocumentLastRowColumn=function(A,x){var S=this.documentToScreenRow(A,x);return this.getScreenLastRowColumn(S)},R.prototype.getDocumentLastRowColumnPosition=function(A,x){var S=this.documentToScreenRow(A,x);return this.screenToDocumentPosition(S,Number.MAX_VALUE/10)},R.prototype.getRowSplitData=function(A){if(this.$useWrapMode)return this.$wrapData[A]},R.prototype.getScreenTabSize=function(A){return this.$tabSize-(A%this.$tabSize|0)},R.prototype.screenToDocumentRow=function(A,x){return this.screenToDocumentPosition(A,x).row},R.prototype.screenToDocumentColumn=function(A,x){return this.screenToDocumentPosition(A,x).column},R.prototype.screenToDocumentPosition=function(A,x,S){if(A<0)return{row:0,column:0};var T,P=0,N=0,k,O=0,$=0,V=this.$screenRowCache,H=this.$getRowCacheIndex(V,A),U=V.length;if(U&&H>=0)var O=V[H],P=this.$docRowCache[H],z=A>V[U-1];else var z=!U;for(var G=this.getLength()-1,K=this.getNextFoldLine(P),Y=K?K.start.row:1/0;O<=A&&($=this.getRowLength(P),!(O+$>A||P>=G));)O+=$,P++,P>Y&&(P=K.end.row+1,K=this.getNextFoldLine(P,K),Y=K?K.start.row:1/0),z&&(this.$docRowCache.push(P),this.$screenRowCache.push(O));if(K&&K.start.row<=P)T=this.getFoldDisplayLine(K),P=K.start.row;else{if(O+$<=A||P>G)return{row:G,column:this.getLine(G).length};T=this.getLine(P),K=null}var Z=0,ie=Math.floor(A-O);if(this.$useWrapMode){var oe=this.$wrapData[P];oe&&(k=oe[ie],ie>0&&oe.length&&(Z=oe.indent,N=oe[ie-1]||oe[oe.length-1],T=T.substring(N)))}return S!==void 0&&this.$bidiHandler.isBidiRow(O+ie,P,ie)&&(x=this.$bidiHandler.offsetToCol(S)),N+=this.$getStringScreenWidth(T,x-Z)[1],this.$useWrapMode&&N>=k&&(N=k-1),K?K.idxToPosition(N):{row:P,column:N}},R.prototype.documentToScreenPosition=function(A,x){if(typeof x>"u")var S=this.$clipPositionToDocument(A.row,A.column);else S=this.$clipPositionToDocument(A,x);A=S.row,x=S.column;var T=0,P=null,N=null;N=this.getFoldAt(A,x,1),N&&(A=N.start.row,x=N.start.column);var k,O=0,$=this.$docRowCache,V=this.$getRowCacheIndex($,A),H=$.length;if(H&&V>=0)var O=$[V],T=this.$screenRowCache[V],U=A>$[H-1];else var U=!H;for(var z=this.getNextFoldLine(O),G=z?z.start.row:1/0;O<A;){if(O>=G){if(k=z.end.row+1,k>A)break;z=this.getNextFoldLine(k,z),G=z?z.start.row:1/0}else k=O+1;T+=this.getRowLength(O),O=k,U&&(this.$docRowCache.push(O),this.$screenRowCache.push(T))}var K="";z&&O>=G?(K=this.getFoldDisplayLine(z,A,x),P=z.start.row):(K=this.getLine(A).substring(0,x),P=A);var Y=0;if(this.$useWrapMode){var Z=this.$wrapData[P];if(Z){for(var ie=0;K.length>=Z[ie];)T++,ie++;K=K.substring(Z[ie-1]||0,K.length),Y=ie>0?Z.indent:0}}return this.lineWidgets&&this.lineWidgets[O]&&this.lineWidgets[O].rowsAbove&&(T+=this.lineWidgets[O].rowsAbove),{row:T,column:Y+this.$getStringScreenWidth(K)[0]}},R.prototype.documentToScreenColumn=function(A,x){return this.documentToScreenPosition(A,x).column},R.prototype.documentToScreenRow=function(A,x){return this.documentToScreenPosition(A,x).row},R.prototype.getScreenLength=function(){var A=0,x=null;if(this.$useWrapMode)for(var P=this.$wrapData.length,N=0,T=0,x=this.$foldData[T++],k=x?x.start.row:1/0;N<P;){var O=this.$wrapData[N];A+=O?O.length+1:1,N++,N>k&&(N=x.end.row+1,x=this.$foldData[T++],k=x?x.start.row:1/0)}else{A=this.getLength();for(var S=this.$foldData,T=0;T<S.length;T++)x=S[T],A-=x.end.row-x.start.row}return this.lineWidgets&&(A+=this.$getWidgetScreenLength()),A},R.prototype.$setFontMetrics=function(A){this.$enableVarChar&&(this.$getStringScreenWidth=function(x,S,T){if(S===0)return[0,0];S||(S=1/0),T=T||0;var P,N;for(N=0;N<x.length&&(P=x.charAt(N),P==="	"?T+=this.getScreenTabSize(T):T+=A.getCharacterWidth(P),!(T>S));N++);return[T,N]})},R.prototype.getPrecedingCharacter=function(){var A=this.selection.getCursor();if(A.column===0)return A.row===0?"":this.doc.getNewLineCharacter();var x=this.getLine(A.row);return x[A.column-1]},R.prototype.destroy=function(){this.destroyed||(this.bgTokenizer.setDocument(null),this.bgTokenizer.cleanup(),this.destroyed=!0),this.endOperation(),this.$stopWorker(),this.removeAllListeners(),this.doc&&this.doc.off("change",this.$onChange),this.selection&&(this.selection.off("changeCursor",this.$onSelectionChange),this.selection.off("changeSelection",this.$onSelectionChange)),this.selection.detach()},R}();_.$uid=0,_.prototype.$modes=l.$modes,_.prototype.getValue=_.prototype.toString,_.prototype.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},_.prototype.$overwrite=!1,_.prototype.$mode=null,_.prototype.$modeId=null,_.prototype.$scrollTop=0,_.prototype.$scrollLeft=0,_.prototype.$wrapLimit=80,_.prototype.$useWrapMode=!1,_.prototype.$wrapLimitRange={min:null,max:null},_.prototype.lineWidgets=null,_.prototype.isFullWidth=I,f.implement(_.prototype,u);var C=1,M=2,b=3,v=4,E=9,D=10,L=11,w=12;function I(R){return R<4352?!1:R>=4352&&R<=4447||R>=4515&&R<=4519||R>=4602&&R<=4607||R>=9001&&R<=9002||R>=11904&&R<=11929||R>=11931&&R<=12019||R>=12032&&R<=12245||R>=12272&&R<=12283||R>=12288&&R<=12350||R>=12353&&R<=12438||R>=12441&&R<=12543||R>=12549&&R<=12589||R>=12593&&R<=12686||R>=12688&&R<=12730||R>=12736&&R<=12771||R>=12784&&R<=12830||R>=12832&&R<=12871||R>=12880&&R<=13054||R>=13056&&R<=19903||R>=19968&&R<=42124||R>=42128&&R<=42182||R>=43360&&R<=43388||R>=44032&&R<=55203||R>=55216&&R<=55238||R>=55243&&R<=55291||R>=63744&&R<=64255||R>=65040&&R<=65049||R>=65072&&R<=65106||R>=65108&&R<=65126||R>=65128&&R<=65131||R>=65281&&R<=65376||R>=65504&&R<=65510}t("./edit_session/folding").Folding.call(_.prototype),t("./edit_session/bracket_match").BracketMatch.call(_.prototype),l.defineOptions(_.prototype,"session",{wrap:{set:function(R){if(!R||R=="off"?R=!1:R=="free"?R=!0:R=="printMargin"?R=-1:typeof R=="string"&&(R=parseInt(R,10)||!1),this.$wrap!=R)if(this.$wrap=R,!R)this.setUseWrapMode(!1);else{var A=typeof R=="number"?R:null;this.setWrapLimitRange(A,A),this.setUseWrapMode(!0)}},get:function(){return this.getUseWrapMode()?this.$wrap==-1?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(R){R=R=="auto"?this.$mode.type!="text":R!="text",R!=this.$wrapAsCode&&(this.$wrapAsCode=R,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(R){this.$useWorker=R,this.$stopWorker(),R&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(R){R=parseInt(R),R>0&&this.$tabSize!==R&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=R,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(R){this.setFoldStyle(R)},handlesSet:!0},overwrite:{set:function(R){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(R){this.doc.setNewLineMode(R)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(R){this.setMode(R)},get:function(){return this.$modeId},handlesSet:!0}}),n.EditSession=_}),ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(t,n,p){var f=t("./lib/lang"),y=t("./lib/oop"),m=t("./range").Range,l=function(){function s(){this.$options={}}return s.prototype.set=function(o){return y.mixin(this.$options,o),this},s.prototype.getOptions=function(){return f.copyObject(this.$options)},s.prototype.setOptions=function(o){this.$options=o},s.prototype.find=function(o){var i=this.$options,c=this.$matchIterator(o,i);if(!c)return!1;var h=null;return c.forEach(function(d,_,C,M){return h=new m(d,_,C,M),_==M&&i.start&&i.start.start&&i.skipCurrent!=!1&&h.isEqual(i.start)?(h=null,!1):!0}),h},s.prototype.findAll=function(o){var i=this.$options;if(!i.needle)return[];this.$assembleRegExp(i);var c=i.range,h=c?o.getLines(c.start.row,c.end.row):o.doc.getAllLines(),d=[],_=i.re;if(i.$isMultiLine){var C=_.length,M=h.length-C,b;e:for(var v=_.offset||0;v<=M;v++){for(var E=0;E<C;E++)if(h[v+E].search(_[E])==-1)continue e;var D=h[v],L=h[v+C-1],w=D.length-D.match(_[0])[0].length,I=L.match(_[C-1])[0].length;b&&b.end.row===v&&b.end.column>w||(d.push(b=new m(v,w,v+C-1,I)),C>2&&(v=v+C-2))}}else for(var R,A=0;A<h.length;A++)if(this.$isMultilineSearch(i)){var x=h.length-1;if(R=this.$multiLineForward(o,_,A,x),R){var S=R.endRow<=x?R.endRow-1:x;S>A&&(A=S),d.push(new m(R.startRow,R.startCol,R.endRow,R.endCol))}}else{R=f.getMatchOffsets(h[A],_);for(var E=0;E<R.length;E++){var T=R[E];d.push(new m(A,T.offset,A,T.offset+T.length))}}if(c){for(var P=c.start.column,N=c.end.column,A=0,E=d.length-1;A<E&&d[A].start.column<P&&d[A].start.row==0;)A++;for(var k=c.end.row-c.start.row;A<E&&d[E].end.column>N&&d[E].end.row==k;)E--;for(d=d.slice(A,E+1),A=0,E=d.length;A<E;A++)d[A].start.row+=c.start.row,d[A].end.row+=c.start.row}return d},s.prototype.parseReplaceString=function(o){for(var i={DollarSign:36,Ampersand:38,Digit0:48,Digit1:49,Digit9:57,Backslash:92,n:110,t:116},c="",h=0,d=o.length;h<d;h++){var _=o.charCodeAt(h);if(_===i.Backslash){if(h++,h>=d){c+="\\";break}var C=o.charCodeAt(h);switch(C){case i.Backslash:c+="\\";break;case i.n:c+=`
`;break;case i.t:c+="	";break}continue}if(_===i.DollarSign){if(h++,h>=d){c+="$";break}var M=o.charCodeAt(h);if(M===i.DollarSign){c+="$$";continue}if(M===i.Digit0||M===i.Ampersand){c+="$&";continue}if(i.Digit1<=M&&M<=i.Digit9){c+="$"+o[h];continue}}c+=o[h]}return c||o},s.prototype.replace=function(o,i){var c=this.$options,h=this.$assembleRegExp(c);if(c.$isMultiLine)return i;if(h){var d=this.$isMultilineSearch(c);d&&(o=o.replace(/\r\n|\r|\n/g,`
`));var _=h.exec(o);if(!_||!d&&_[0].length!=o.length)return null;if(i=c.regExp?this.parseReplaceString(i):i.replace(/\$/g,"$$$$"),i=o.replace(h,i),c.preserveCase){i=i.split("");for(var C=Math.min(o.length,o.length);C--;){var M=o[C];M&&M.toLowerCase()!=M?i[C]=i[C].toUpperCase():i[C]=i[C].toLowerCase()}i=i.join("")}return i}},s.prototype.$assembleRegExp=function(o,i){if(o.needle instanceof RegExp)return o.re=o.needle;var c=o.needle;if(!o.needle)return o.re=!1;o.regExp||(c=f.escapeRegExp(c));var h=o.caseSensitive?"gm":"gmi";try{new RegExp(c,"u"),o.$supportsUnicodeFlag=!0,h+="u"}catch{o.$supportsUnicodeFlag=!1}if(o.wholeWord&&(c=u(c,o)),o.$isMultiLine=!i&&/[\n\r]/.test(c),o.$isMultiLine)return o.re=this.$assembleMultilineRegExp(c,h);try{var d=new RegExp(c,h)}catch{d=!1}return o.re=d},s.prototype.$assembleMultilineRegExp=function(o,i){for(var c=o.replace(/\r\n|\r|\n/g,`$
^`).split(`
`),h=[],d=0;d<c.length;d++)try{h.push(new RegExp(c[d],i))}catch{return!1}return h},s.prototype.$isMultilineSearch=function(o){return o.re&&/\\r\\n|\\r|\\n/.test(o.re.source)&&o.regExp&&!o.$isMultiLine},s.prototype.$multiLineForward=function(o,i,c,h){for(var d,_=a(o,c),C=c;C<=h;){for(var M=0;M<_&&!(C>h);M++){var b=o.getLine(C++);d=d==null?b:d+`
`+b}var v=i.exec(d);if(i.lastIndex=0,v){var E=d.slice(0,v.index).split(`
`),D=v[0].split(`
`),L=c+E.length-1,w=E[E.length-1].length,I=L+D.length-1,R=D.length==1?w+D[0].length:D[D.length-1].length;return{startRow:L,startCol:w,endRow:I,endCol:R}}}return null},s.prototype.$multiLineBackward=function(o,i,c,h,d){for(var _,C=a(o,h),M=o.getLine(h).length-c,b=h;b>=d;){for(var v=0;v<C&&b>=d;v++){var E=o.getLine(b--);_=_==null?E:E+`
`+_}var D=r(_,i,M);if(D){var L=_.slice(0,D.index).split(`
`),w=D[0].split(`
`),I=b+L.length,R=L[L.length-1].length,A=I+w.length-1,x=w.length==1?R+w[0].length:w[w.length-1].length;return{startRow:I,startCol:R,endRow:A,endCol:x}}}return null},s.prototype.$matchIterator=function(o,i){var c=this.$assembleRegExp(i);if(!c)return!1;var h=this.$isMultilineSearch(i),d=this.$multiLineForward,_=this.$multiLineBackward,C=i.backwards==!0,M=i.skipCurrent!=!1,b=c.unicode,v=i.range,E=i.start;E||(E=v?v[C?"end":"start"]:o.selection.getRange()),E.start&&(E=E[M!=C?"end":"start"]);var D=v?v.start.row:0,L=v?v.end.row:o.getLength()-1;if(C)var w=function(A){var x=E.row;if(!R(x,E.column,A)){for(x--;x>=D;x--)if(R(x,Number.MAX_VALUE,A))return;if(i.wrap!=!1){for(x=L,D=E.row;x>=D;x--)if(R(x,Number.MAX_VALUE,A))return}}};else var w=function(x){var S=E.row;if(!R(S,E.column,x)){for(S=S+1;S<=L;S++)if(R(S,0,x))return;if(i.wrap!=!1){for(S=D,L=E.row;S<=L;S++)if(R(S,0,x))return}}};if(i.$isMultiLine)var I=c.length,R=function(A,x,S){var T=C?A-I+1:A;if(!(T<0||T+I>o.getLength())){var P=o.getLine(T),N=P.search(c[0]);if(!(!C&&N<x||N===-1)){for(var k=1;k<I;k++)if(P=o.getLine(T+k),P.search(c[k])==-1)return;var O=P.match(c[I-1])[0].length;if(!(C&&O>x)&&S(T,N,T+I-1,O))return!0}}};else if(C)var R=function(x,S,T){if(h){var P=_(o,c,S,x,D);if(!P)return!1;if(T(P.startRow,P.startCol,P.endRow,P.endCol))return!0}else{var N=o.getLine(x),k=[],O,$=0;for(c.lastIndex=0;O=c.exec(N);){var V=O[0].length;if($=O.index,!V){if($>=N.length)break;c.lastIndex=$+=f.skipEmptyMatch(N,$,b)}if(O.index+V>S)break;k.push(O.index,V)}for(var H=k.length-1;H>=0;H-=2){var U=k[H-1],V=k[H];if(T(x,U,x,U+V))return!0}}};else var R=function(x,S,T){if(c.lastIndex=S,h){var P=d(o,c,x,L);if(P){var N=P.endRow<=L?P.endRow-1:L;N>x&&(x=N)}if(!P)return!1;if(T(P.startRow,P.startCol,P.endRow,P.endCol))return!0}else for(var k=o.getLine(x),O,$;$=c.exec(k);){var V=$[0].length;if(O=$.index,T(x,O,x,O+V))return!0;if(!V&&(c.lastIndex=O+=f.skipEmptyMatch(k,O,b),O>=k.length))return!1}};return{forEach:w}},s}();function u(s,o){var i=f.supportsLookbehind();function c(C,M){M===void 0&&(M=!0);var b=i&&o.$supportsUnicodeFlag?new RegExp("[\\p{L}\\p{N}_]","u"):new RegExp("\\w");return b.test(C)||o.regExp?i&&o.$supportsUnicodeFlag?M?"(?<=^|[^\\p{L}\\p{N}_])":"(?=[^\\p{L}\\p{N}_]|$)":"\\b":""}var h=Array.from(s),d=h[0],_=h[h.length-1];return c(d)+s+c(_,!1)}function r(s,o,i){for(var c=null,h=0;h<=s.length;){o.lastIndex=h;var d=o.exec(s);if(!d)break;var _=d.index+d[0].length;if(_>s.length-i)break;(!c||_>c.index+c[0].length)&&(c=d),h=d.index+1}return c}function a(s,o){var i=5e3,c={row:o,column:0},h=s.doc.positionToIndex(c),d=h+i,_=s.doc.indexToPosition(d),C=_.row;return C+1}n.Search=l}),ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(t,n,p){var f=this&&this.__extends||function(){var s=function(o,i){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(c[d]=h[d])},s(o,i)};return function(o,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");s(o,i);function c(){this.constructor=o}o.prototype=i===null?Object.create(i):(c.prototype=i.prototype,new c)}}(),y=t("../lib/keys"),m=t("../lib/useragent"),l=y.KEY_MODS,u=function(){function s(o,i){this.$init(o,i,!1)}return s.prototype.$init=function(o,i,c){this.platform=i||(m.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(o),this.$singleCommand=c},s.prototype.addCommand=function(o){this.commands[o.name]&&this.removeCommand(o),this.commands[o.name]=o,o.bindKey&&this._buildKeyHash(o)},s.prototype.removeCommand=function(o,i){var c=o&&(typeof o=="string"?o:o.name);o=this.commands[c],i||delete this.commands[c];var h=this.commandKeyBinding;for(var d in h){var _=h[d];if(_==o)delete h[d];else if(Array.isArray(_)){var C=_.indexOf(o);C!=-1&&(_.splice(C,1),_.length==1&&(h[d]=_[0]))}}},s.prototype.bindKey=function(o,i,c){if(typeof o=="object"&&o&&(c==null&&(c=o.position),o=o[this.platform]),!!o){if(typeof i=="function")return this.addCommand({exec:i,bindKey:o,name:i.name||o});o.split("|").forEach(function(h){var d="";if(h.indexOf(" ")!=-1){var _=h.split(/\s+/);h=_.pop(),_.forEach(function(b){var v=this.parseKeys(b),E=l[v.hashId]+v.key;d+=(d?" ":"")+E,this._addCommandToBinding(d,"chainKeys")},this),d+=" "}var C=this.parseKeys(h),M=l[C.hashId]+C.key;this._addCommandToBinding(d+M,i,c)},this)}},s.prototype._addCommandToBinding=function(o,i,c){var h=this.commandKeyBinding,d;if(!i)delete h[o];else if(!h[o]||this.$singleCommand)h[o]=i;else{Array.isArray(h[o])?(d=h[o].indexOf(i))!=-1&&h[o].splice(d,1):h[o]=[h[o]],typeof c!="number"&&(c=r(i));var _=h[o];for(d=0;d<_.length;d++){var C=_[d],M=r(C);if(M>c)break}_.splice(d,0,i)}},s.prototype.addCommands=function(o){o&&Object.keys(o).forEach(function(i){var c=o[i];if(c){if(typeof c=="string")return this.bindKey(c,i);typeof c=="function"&&(c={exec:c}),typeof c=="object"&&(c.name||(c.name=i),this.addCommand(c))}},this)},s.prototype.removeCommands=function(o){Object.keys(o).forEach(function(i){this.removeCommand(o[i])},this)},s.prototype.bindKeys=function(o){Object.keys(o).forEach(function(i){this.bindKey(i,o[i])},this)},s.prototype._buildKeyHash=function(o){this.bindKey(o.bindKey,o)},s.prototype.parseKeys=function(o){var i=o.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(M){return M}),c=i.pop(),h=y[c];if(y.FUNCTION_KEYS[h])c=y.FUNCTION_KEYS[h].toLowerCase();else if(i.length){if(i.length==1&&i[0]=="shift")return{key:c.toUpperCase(),hashId:-1}}else return{key:c,hashId:-1};for(var d=0,_=i.length;_--;){var C=y.KEY_MODS[i[_]];if(C==null)return typeof console<"u"&&console.error("invalid modifier "+i[_]+" in "+o),!1;d|=C}return{key:c,hashId:d}},s.prototype.findKeyCommand=function(o,i){var c=l[o]+i;return this.commandKeyBinding[c]},s.prototype.handleKeyboard=function(o,i,c,h){if(!(h<0)){var d=l[i]+c,_=this.commandKeyBinding[d];return o.$keyChain&&(o.$keyChain+=" "+d,_=this.commandKeyBinding[o.$keyChain]||_),_&&(_=="chainKeys"||_[_.length-1]=="chainKeys")?(o.$keyChain=o.$keyChain||d,{command:"null"}):(o.$keyChain&&((!i||i==4)&&c.length==1?o.$keyChain=o.$keyChain.slice(0,-d.length-1):(i==-1||h>0)&&(o.$keyChain="")),{command:_})}},s.prototype.getStatusText=function(o,i){return i.$keyChain||""},s}();function r(s){return typeof s=="object"&&s.bindKey&&s.bindKey.position||(s.isDefault?-100:0)}var a=function(s){f(o,s);function o(i,c){var h=s.call(this,i,c)||this;return h.$singleCommand=!0,h}return o}(u);a.call=function(s,o,i){u.prototype.$init.call(s,o,i,!0)},u.call=function(s,o,i){u.prototype.$init.call(s,o,i,!1)},n.HashHandler=a,n.MultiHashHandler=u}),ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(t,n,p){var f=this&&this.__extends||function(){var r=function(a,s){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(o[c]=i[c])},r(a,s)};return function(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");r(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),y=t("../lib/oop"),m=t("../keyboard/hash_handler").MultiHashHandler,l=t("../lib/event_emitter").EventEmitter,u=function(r){f(a,r);function a(s,o){var i=r.call(this,o,s)||this;return i.byName=i.commands,i.setDefaultHandler("exec",function(c){return c.args?c.command.exec(c.editor,c.args,c.event,!1):c.command.exec(c.editor,{},c.event,!0)}),i}return a.prototype.exec=function(s,o,i){if(Array.isArray(s)){for(var c=s.length;c--;)if(this.exec(s[c],o,i))return!0;return!1}typeof s=="string"&&(s=this.commands[s]);var h={editor:o,command:s,args:i};return this.canExecute(s,o)?(h.returnValue=this._emit("exec",h),this._signal("afterExec",h),h.returnValue!==!1):(this._signal("commandUnavailable",h),!1)},a.prototype.canExecute=function(s,o){return typeof s=="string"&&(s=this.commands[s]),!(!s||o&&o.$readOnly&&!s.readOnly||this.$checkCommandState!=!1&&s.isAvailable&&!s.isAvailable(o))},a.prototype.toggleRecording=function(s){if(!this.$inReplay)return s&&s._emit("changeStatus"),this.recording?(this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(o){this.macro.push([o.command,o.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},a.prototype.replay=function(s){if(!(this.$inReplay||!this.macro)){if(this.recording)return this.toggleRecording(s);try{this.$inReplay=!0,this.macro.forEach(function(o){typeof o=="string"?this.exec(o,s):this.exec(o[0],s,o[1])},this)}finally{this.$inReplay=!1}}},a.prototype.trimMacro=function(s){return s.map(function(o){return typeof o[0]!="string"&&(o[0]=o[0].name),o[1]||(o=o[0]),o})},a}(m);y.implement(u.prototype,l),n.CommandManager=u}),ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],function(t,n,p){var f=t("../lib/lang"),y=t("../config"),m=t("../range").Range;function l(r,a){return{win:r,mac:a}}n.commands=[{name:"showSettingsMenu",description:"Show settings menu",bindKey:l("Ctrl-,","Command-,"),exec:function(r){y.loadModule("ace/ext/settings_menu",function(a){a.init(r),r.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",description:"Go to next error",bindKey:l("Alt-E","F4"),exec:function(r){y.loadModule("ace/ext/error_marker",function(a){a.showErrorMarker(r,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",description:"Go to previous error",bindKey:l("Alt-Shift-E","Shift-F4"),exec:function(r){y.loadModule("ace/ext/error_marker",function(a){a.showErrorMarker(r,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:l("Ctrl-A","Command-A"),exec:function(r){r.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:l(null,"Ctrl-L"),exec:function(r){r.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:l("Ctrl-L","Command-L"),exec:function(r,a){typeof a=="number"&&!isNaN(a)&&r.gotoLine(a),r.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:l("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(r){r.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:l("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(r){r.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",description:"Toggle fold widget",bindKey:l("F2","F2"),exec:function(r){r.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",description:"Toggle parent fold widget",bindKey:l("Alt-F2","Alt-F2"),exec:function(r){r.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:l(null,"Ctrl-Command-Option-0"),exec:function(r){r.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldAllComments",description:"Fold all comments",bindKey:l(null,"Ctrl-Command-Option-0"),exec:function(r){r.session.foldAllComments()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:l("Alt-0","Command-Option-0"),exec:function(r){r.session.foldAll(),r.session.unfold(r.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:l("Alt-Shift-0","Command-Option-Shift-0"),exec:function(r){r.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:l("Ctrl-K","Command-G"),exec:function(r){r.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:l("Ctrl-Shift-K","Command-Shift-G"),exec:function(r){r.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:l("Alt-K","Ctrl-G"),exec:function(r){r.selection.isEmpty()?r.selection.selectWord():r.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:l("Alt-Shift-K","Ctrl-Shift-G"),exec:function(r){r.selection.isEmpty()?r.selection.selectWord():r.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:l("Ctrl-F","Command-F"),exec:function(r){y.loadModule("ace/ext/searchbox",function(a){a.Search(r)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(r){r.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:l("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(r){r.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:l("Ctrl-Home","Command-Home|Command-Up"),exec:function(r){r.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:l("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(r){r.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:l("Up","Up|Ctrl-P"),exec:function(r,a){r.navigateUp(a.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:l("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(r){r.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:l("Ctrl-End","Command-End|Command-Down"),exec:function(r){r.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:l("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(r){r.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:l("Down","Down|Ctrl-N"),exec:function(r,a){r.navigateDown(a.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:l("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(r){r.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:l("Ctrl-Left","Option-Left"),exec:function(r){r.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:l("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(r){r.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:l("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(r){r.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:l("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(r){r.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:l("Left","Left|Ctrl-B"),exec:function(r,a){r.navigateLeft(a.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:l("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(r){r.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:l("Ctrl-Right","Option-Right"),exec:function(r){r.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:l("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(r){r.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:l("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(r){r.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:l("Shift-Right","Shift-Right"),exec:function(r){r.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:l("Right","Right|Ctrl-F"),exec:function(r,a){r.navigateRight(a.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(r){r.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:l(null,"Option-PageDown"),exec:function(r){r.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:l("PageDown","PageDown|Ctrl-V"),exec:function(r){r.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(r){r.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:l(null,"Option-PageUp"),exec:function(r){r.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(r){r.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:l("Ctrl-Up",null),exec:function(r){r.renderer.scrollBy(0,-2*r.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:l("Ctrl-Down",null),exec:function(r){r.renderer.scrollBy(0,2*r.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(r){r.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(r){r.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:l("Ctrl-Alt-E","Command-Option-E"),exec:function(r){r.commands.toggleRecording(r)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:l("Ctrl-Shift-E","Command-Shift-E"),exec:function(r){r.commands.replay(r)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:l("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(r){r.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:l("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(r){r.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:l("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(r){r.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:l(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(r){},readOnly:!0},{name:"cut",description:"Cut",exec:function(r){var a=r.$copyWithEmptySelection&&r.selection.isEmpty(),s=a?r.selection.getLineRange():r.selection.getRange();r._emit("cut",s),s.isEmpty()||r.session.remove(s),r.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(r,a){r.$handlePaste(a)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:l("Ctrl-D","Command-D"),exec:function(r){r.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:l("Ctrl-Shift-D","Command-Shift-D"),exec:function(r){r.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:l("Ctrl-Alt-S","Command-Alt-S"),exec:function(r){r.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:l("Ctrl-/","Command-/"),exec:function(r){r.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:l("Ctrl-Shift-/","Command-Shift-/"),exec:function(r){r.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:l("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(r){r.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:l("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(r){r.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:l("Ctrl-H","Command-Option-F"),exec:function(r){y.loadModule("ace/ext/searchbox",function(a){a.Search(r,!0)})}},{name:"undo",description:"Undo",bindKey:l("Ctrl-Z","Command-Z"),exec:function(r){r.undo()}},{name:"redo",description:"Redo",bindKey:l("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(r){r.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:l("Alt-Shift-Up","Command-Option-Up"),exec:function(r){r.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:l("Alt-Up","Option-Up"),exec:function(r){r.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:l("Alt-Shift-Down","Command-Option-Down"),exec:function(r){r.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:l("Alt-Down","Option-Down"),exec:function(r){r.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:l("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(r){r.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:l("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(r){r.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:l("Shift-Delete",null),exec:function(r){if(r.selection.isEmpty())r.remove("left");else return!1},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:l("Alt-Backspace","Command-Backspace"),exec:function(r){r.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:l("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(r){r.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:l("Ctrl-Shift-Backspace",null),exec:function(r){var a=r.selection.getRange();a.start.column=0,r.session.remove(a)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:l("Ctrl-Shift-Delete",null),exec:function(r){var a=r.selection.getRange();a.end.column=Number.MAX_VALUE,r.session.remove(a)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:l("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(r){r.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:l("Ctrl-Delete","Alt-Delete"),exec:function(r){r.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:l("Shift-Tab","Shift-Tab"),exec:function(r){r.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:l("Tab","Tab"),exec:function(r){r.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:l("Ctrl-[","Ctrl-["),exec:function(r){r.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:l("Ctrl-]","Ctrl-]"),exec:function(r){r.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(r,a){r.insert(a)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(r,a){r.insert(f.stringRepeat(a.text||"",a.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:l(null,"Ctrl-O"),exec:function(r){r.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:l("Alt-Shift-X","Ctrl-T"),exec:function(r){r.transposeLetters()},multiSelectAction:function(r){r.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:l("Ctrl-U","Ctrl-U"),exec:function(r){r.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:l("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(r){r.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:l(null,null),exec:function(r){r.autoIndent()},scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:l("Ctrl-Shift-L","Command-Shift-L"),exec:function(r){var a=r.selection.getRange();a.start.column=a.end.column=0,a.end.row++,r.selection.setRange(a,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"openlink",bindKey:l("Ctrl+F3","F3"),exec:function(r){r.openLink()}},{name:"joinlines",description:"Join lines",bindKey:l(null,null),exec:function(r){for(var a=r.selection.isBackwards(),s=a?r.selection.getSelectionLead():r.selection.getSelectionAnchor(),o=a?r.selection.getSelectionAnchor():r.selection.getSelectionLead(),i=r.session.doc.getLine(s.row).length,c=r.session.doc.getTextRange(r.selection.getRange()),h=c.replace(/\n\s*/," ").length,d=r.session.doc.getLine(s.row),_=s.row+1;_<=o.row+1;_++){var C=f.stringTrimLeft(f.stringTrimRight(r.session.doc.getLine(_)));C.length!==0&&(C=" "+C),d+=C}o.row+1<r.session.doc.getLength()-1&&(d+=r.session.doc.getNewLineCharacter()),r.clearSelection(),r.session.doc.replace(new m(s.row,0,o.row+2,0),d),h>0?(r.selection.moveCursorTo(s.row,s.column),r.selection.selectTo(s.row,s.column+h)):(i=r.session.doc.getLine(s.row).length>i?i+1:i,r.selection.moveCursorTo(s.row,i))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:l(null,null),exec:function(r){var a=r.session.doc.getLength()-1,s=r.session.doc.getLine(a).length,o=r.selection.rangeList.ranges,i=[];o.length<1&&(o=[r.selection.getRange()]);for(var c=0;c<o.length;c++)c==o.length-1&&(o[c].end.row===a&&o[c].end.column===s||i.push(new m(o[c].end.row,o[c].end.column,a,s))),c===0?o[c].start.row===0&&o[c].start.column===0||i.push(new m(0,0,o[c].start.row,o[c].start.column)):i.push(new m(o[c-1].end.row,o[c-1].end.column,o[c].start.row,o[c].start.column));r.exitMultiSelectMode(),r.clearSelection();for(var c=0;c<i.length;c++)r.selection.addRange(i[c],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",description:"Add new line after the current line",exec:function(r){r.selection.clearSelection(),r.navigateLineEnd(),r.insert(`
`)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",description:"Add new line before the current line",exec:function(r){r.selection.clearSelection();var a=r.getCursorPosition();r.selection.moveTo(a.row-1,Number.MAX_VALUE),r.insert(`
`),a.row===0&&r.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",exec:function(r){console.warn("This is an obsolete command. Please use `openCommandPalette` instead."),r.prompt({$type:"commands"})},readOnly:!0},{name:"openCommandPalette",description:"Open command palette",bindKey:l("F1","F1"),exec:function(r){r.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:l(null,null),exec:function(r){r.prompt({$type:"modes"})},readOnly:!0}];for(var u=1;u<9;u++)n.commands.push({name:"foldToLevel"+u,description:"Fold To Level "+u,level:u,exec:function(r){r.session.foldToLevel(this.level)},scrollIntoView:"center",readOnly:!0})}),ace.define("ace/keyboard/gutter_handler",["require","exports","module","ace/lib/keys"],function(t,n,p){var f=t("../lib/keys"),y=function(){function l(u){this.editor=u,this.gutterLayer=u.renderer.$gutterLayer,this.element=u.renderer.$gutter,this.lines=u.renderer.$gutterLayer.$lines,this.activeRowIndex=null,this.activeLane=null,this.annotationTooltip=this.editor.$mouseHandler.$tooltip}return l.prototype.addListener=function(){this.element.addEventListener("keydown",this.$onGutterKeyDown.bind(this)),this.element.addEventListener("focusout",this.$blurGutter.bind(this)),this.editor.on("mousewheel",this.$blurGutter.bind(this))},l.prototype.removeListener=function(){this.element.removeEventListener("keydown",this.$onGutterKeyDown.bind(this)),this.element.removeEventListener("focusout",this.$blurGutter.bind(this)),this.editor.off("mousewheel",this.$blurGutter.bind(this))},l.prototype.$onGutterKeyDown=function(u){if(this.annotationTooltip.isOpen){u.preventDefault(),u.keyCode===f.escape&&this.annotationTooltip.hide();return}if(u.target===this.element){if(u.keyCode!=f.enter)return;u.preventDefault();var r=this.editor.getCursorPosition().row;this.editor.isRowVisible(r)||this.editor.scrollToLine(r,!0,!0),setTimeout(function(){var a=this.$rowToRowIndex(this.gutterLayer.$cursorCell.row),s=this.$findNearestFoldLaneWidget(a),o=this.$findNearestAnnotation(a);if(!(s===null&&o===null)){var i=this.$findClosestNumber(s,o,a);if(i===s)if(this.activeLane="fold",this.activeRowIndex=s,this.$isCustomWidgetVisible(s)){this.$focusCustomWidget(this.activeRowIndex);return}else{this.$focusFoldWidget(this.activeRowIndex);return}else{this.activeRowIndex=o,this.activeLane="annotation",this.$focusAnnotation(this.activeRowIndex);return}}}.bind(this),10);return}this.$handleGutterKeyboardInteraction(u),setTimeout(function(){this.editor._signal("gutterkeydown",new m(u,this))}.bind(this),10)},l.prototype.$handleGutterKeyboardInteraction=function(u){if(u.keyCode===f.tab){u.preventDefault();return}if(u.keyCode===f.escape){u.preventDefault(),this.$blurGutter(),this.element.focus(),this.lane=null;return}if(u.keyCode===f.up){switch(u.preventDefault(),this.activeLane){case"fold":this.$moveFoldWidgetUp();break;case"annotation":this.$moveAnnotationUp();break}return}if(u.keyCode===f.down){switch(u.preventDefault(),this.activeLane){case"fold":this.$moveFoldWidgetDown();break;case"annotation":this.$moveAnnotationDown();break}return}if(u.keyCode===f.left){u.preventDefault(),this.$switchLane("annotation");return}if(u.keyCode===f.right){u.preventDefault(),this.$switchLane("fold");return}if(u.keyCode===f.enter||u.keyCode===f.space){switch(u.preventDefault(),this.activeLane){case"fold":var r=this.$rowIndexToRow(this.activeRowIndex),a=this.editor.session.$gutterCustomWidgets[r];if(a)a.callbacks&&a.callbacks.onClick&&a.callbacks.onClick(u,r);else if(this.gutterLayer.session.foldWidgets[r]==="start"){this.editor.session.onFoldWidgetClick(this.$rowIndexToRow(this.activeRowIndex),u),setTimeout(function(){this.$rowIndexToRow(this.activeRowIndex)!==r&&(this.$blurFoldWidget(this.activeRowIndex),this.activeRowIndex=this.$rowToRowIndex(r),this.$focusFoldWidget(this.activeRowIndex))}.bind(this),10);break}else if(this.gutterLayer.session.foldWidgets[this.$rowIndexToRow(this.activeRowIndex)]==="end")break;return;case"annotation":this.annotationTooltip.showTooltip(this.$rowIndexToRow(this.activeRowIndex)),this.annotationTooltip.$fromKeyboard=!0;break}return}},l.prototype.$blurGutter=function(){if(this.activeRowIndex!==null)switch(this.activeLane){case"fold":this.$blurFoldWidget(this.activeRowIndex),this.$blurCustomWidget(this.activeRowIndex);break;case"annotation":this.$blurAnnotation(this.activeRowIndex);break}this.annotationTooltip.isOpen&&this.annotationTooltip.hide()},l.prototype.$isFoldWidgetVisible=function(u){var r=this.editor.isRowFullyVisible(this.$rowIndexToRow(u)),a=this.$getFoldWidget(u).style.display!=="none";return r&&a},l.prototype.$isCustomWidgetVisible=function(u){var r=this.editor.isRowFullyVisible(this.$rowIndexToRow(u)),a=!!this.$getCustomWidget(u);return r&&a},l.prototype.$isAnnotationVisible=function(u){var r=this.editor.isRowFullyVisible(this.$rowIndexToRow(u)),a=this.$getAnnotation(u).style.display!=="none";return r&&a},l.prototype.$getFoldWidget=function(u){var r=this.lines.get(u),a=r.element;return a.childNodes[1]},l.prototype.$getCustomWidget=function(u){var r=this.lines.get(u),a=r.element;return a.childNodes[3]},l.prototype.$getAnnotation=function(u){var r=this.lines.get(u),a=r.element;return a.childNodes[2]},l.prototype.$findNearestFoldLaneWidget=function(u){if(this.$isCustomWidgetVisible(u)||this.$isFoldWidgetVisible(u))return u;for(var r=0;u-r>0||u+r<this.lines.getLength()-1;){if(r++,u-r>=0&&this.$isCustomWidgetVisible(u-r))return u-r;if(u+r<=this.lines.getLength()-1&&this.$isCustomWidgetVisible(u+r))return u+r;if(u-r>=0&&this.$isFoldWidgetVisible(u-r))return u-r;if(u+r<=this.lines.getLength()-1&&this.$isFoldWidgetVisible(u+r))return u+r}return null},l.prototype.$findNearestAnnotation=function(u){if(this.$isAnnotationVisible(u))return u;for(var r=0;u-r>0||u+r<this.lines.getLength()-1;){if(r++,u-r>=0&&this.$isAnnotationVisible(u-r))return u-r;if(u+r<=this.lines.getLength()-1&&this.$isAnnotationVisible(u+r))return u+r}return null},l.prototype.$focusFoldWidget=function(u){if(u!=null){var r=this.$getFoldWidget(u);r.classList.add(this.editor.renderer.keyboardFocusClassName),r.focus()}},l.prototype.$focusCustomWidget=function(u){if(u!=null){var r=this.$getCustomWidget(u);r&&(r.classList.add(this.editor.renderer.keyboardFocusClassName),r.focus())}},l.prototype.$focusAnnotation=function(u){if(u!=null){var r=this.$getAnnotation(u);r.classList.add(this.editor.renderer.keyboardFocusClassName),r.focus()}},l.prototype.$blurFoldWidget=function(u){var r=this.$getFoldWidget(u);r.classList.remove(this.editor.renderer.keyboardFocusClassName),r.blur()},l.prototype.$blurCustomWidget=function(u){var r=this.$getCustomWidget(u);r&&(r.classList.remove(this.editor.renderer.keyboardFocusClassName),r.blur())},l.prototype.$blurAnnotation=function(u){var r=this.$getAnnotation(u);r.classList.remove(this.editor.renderer.keyboardFocusClassName),r.blur()},l.prototype.$moveFoldWidgetUp=function(){for(var u=this.activeRowIndex;u>0;)if(u--,this.$isFoldWidgetVisible(u)||this.$isCustomWidgetVisible(u)){this.$blurFoldWidget(this.activeRowIndex),this.$blurCustomWidget(this.activeRowIndex),this.activeRowIndex=u,this.$isFoldWidgetVisible(u)?this.$focusFoldWidget(this.activeRowIndex):this.$focusCustomWidget(this.activeRowIndex);return}},l.prototype.$moveFoldWidgetDown=function(){for(var u=this.activeRowIndex;u<this.lines.getLength()-1;)if(u++,this.$isFoldWidgetVisible(u)||this.$isCustomWidgetVisible(u)){this.$blurFoldWidget(this.activeRowIndex),this.$blurCustomWidget(this.activeRowIndex),this.activeRowIndex=u,this.$isFoldWidgetVisible(u)?this.$focusFoldWidget(this.activeRowIndex):this.$focusCustomWidget(this.activeRowIndex);return}},l.prototype.$moveAnnotationUp=function(){for(var u=this.activeRowIndex;u>0;)if(u--,this.$isAnnotationVisible(u)){this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=u,this.$focusAnnotation(this.activeRowIndex);return}},l.prototype.$moveAnnotationDown=function(){for(var u=this.activeRowIndex;u<this.lines.getLength()-1;)if(u++,this.$isAnnotationVisible(u)){this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=u,this.$focusAnnotation(this.activeRowIndex);return}},l.prototype.$findClosestNumber=function(u,r,a){return u===null?r:r===null||Math.abs(a-u)<=Math.abs(a-r)?u:r},l.prototype.$switchLane=function(u){switch(u){case"annotation":if(this.activeLane==="annotation")break;var r=this.$findNearestAnnotation(this.activeRowIndex);if(r==null)break;this.activeLane="annotation",this.$blurFoldWidget(this.activeRowIndex),this.$blurCustomWidget(this.activeRowIndex),this.activeRowIndex=r,this.$focusAnnotation(this.activeRowIndex);break;case"fold":if(this.activeLane==="fold")break;var a=this.$findNearestFoldLaneWidget(this.activeRowIndex);if(a===null)break;this.activeLane="fold",this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=a,this.$isCustomWidgetVisible(a)?this.$focusCustomWidget(this.activeRowIndex):this.$focusFoldWidget(this.activeRowIndex);break}},l.prototype.$rowIndexToRow=function(u){var r=this.lines.get(u);return r?r.row:null},l.prototype.$rowToRowIndex=function(u){for(var r=0;r<this.lines.getLength();r++){var a=this.lines.get(r);if(a.row==u)return r}return null},l}();n.GutterKeyboardHandler=y;var m=function(){function l(u,r){this.gutterKeyboardHandler=r,this.domEvent=u}return l.prototype.getKey=function(){return f.keyCodeToString(this.domEvent.keyCode)},l.prototype.getRow=function(){return this.gutterKeyboardHandler.$rowIndexToRow(this.gutterKeyboardHandler.activeRowIndex)},l.prototype.isInAnnotationLane=function(){return this.gutterKeyboardHandler.activeLane==="annotation"},l.prototype.isInFoldLane=function(){return this.gutterKeyboardHandler.activeLane==="fold"},l}();n.GutterKeyboardEvent=m}),ace.define("ace/editor",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator","ace/keyboard/gutter_handler","ace/config","ace/clipboard","ace/lib/keys","ace/lib/event","ace/tooltip"],function(t,n,p){var f=this&&this.__values||function(x){var S=typeof Symbol=="function"&&Symbol.iterator,T=S&&x[S],P=0;if(T)return T.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&P>=x.length&&(x=void 0),{value:x&&x[P++],done:!x}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")},y=t("./lib/oop"),m=t("./lib/dom"),l=t("./lib/lang"),u=t("./lib/useragent"),r=t("./keyboard/textinput").TextInput,a=t("./mouse/mouse_handler").MouseHandler,s=t("./mouse/fold_handler").FoldHandler,o=t("./keyboard/keybinding").KeyBinding,i=t("./edit_session").EditSession,c=t("./search").Search,h=t("./range").Range,d=t("./lib/event_emitter").EventEmitter,_=t("./commands/command_manager").CommandManager,C=t("./commands/default_commands").commands,M=t("./config"),b=t("./token_iterator").TokenIterator,v=t("./keyboard/gutter_handler").GutterKeyboardHandler,E=t("./config").nls,D=t("./clipboard"),L=t("./lib/keys"),w=t("./lib/event"),I=t("./tooltip").HoverTooltip,R=function(){function x(S,T,P){this.id="editor"+ ++x.$uid,this.session,this.$toDestroy=[];var N=S.getContainerElement();this.container=N,this.renderer=S,this.commands=new _(u.isMac?"mac":"win",C),typeof document=="object"&&(this.textInput=new r(S.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new a(this),new s(this)),this.keyBinding=new o(this),this.$search=new c().set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=l.delayedCall(function(){this._signal("input",{}),this.session&&!this.session.destroyed&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(k,O){O._$emitInputEvent.schedule(31)}),this.setSession(T||P&&P.session||new i("")),M.resetOptions(this),P&&this.setOptions(P),M._signal("editor",this)}return x.prototype.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0)},x.prototype.startOperation=function(S){this.session.startOperation(S)},x.prototype.endOperation=function(S){this.session.endOperation(S)},x.prototype.onStartOperation=function(S){this.curOp=this.session.curOp,this.curOp.scrollTop=this.renderer.scrollTop,this.prevOp=this.session.prevOp,S||(this.previousCommand=null)},x.prototype.onEndOperation=function(S){if(this.curOp&&this.session){if(S&&S.returnValue===!1){this.curOp=null;return}if(this._signal("beforeEndOperation"),!this.curOp)return;var T=this.curOp.command,P=T&&T.scrollIntoView;if(P){switch(P){case"center-animate":P="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var N=this.selection.getRange(),k=this.renderer.layerConfig;(N.start.row>=k.lastRow||N.end.row<=k.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead);break}P=="animate"&&this.renderer.animateScrolling(this.curOp.scrollTop)}this.$lastSel=this.session.selection.toJSON(),this.prevOp=this.curOp,this.curOp=null}},x.prototype.$historyTracker=function(S){if(this.$mergeUndoDeltas){var T=this.prevOp,P=this.$mergeableCommands,N=T.command&&S.command.name==T.command.name;if(S.command.name=="insertstring"){var k=S.args;this.mergeNextCommand===void 0&&(this.mergeNextCommand=!0),N=N&&this.mergeNextCommand&&(!/\s/.test(k)||/\s/.test(T.args)),this.mergeNextCommand=!0}else N=N&&P.indexOf(S.command.name)!==-1;this.$mergeUndoDeltas!="always"&&Date.now()-this.sequenceStartTime>2e3&&(N=!1),N?this.session.mergeUndoDeltas=!0:P.indexOf(S.command.name)!==-1&&(this.sequenceStartTime=Date.now())}},x.prototype.setKeyboardHandler=function(S,T){if(S&&typeof S=="string"&&S!="ace"){this.$keybindingId=S;var P=this;M.loadModule(["keybinding",S],function(N){P.$keybindingId==S&&P.keyBinding.setKeyboardHandler(N&&N.handler),T&&T()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(S),T&&T()},x.prototype.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},x.prototype.setSession=function(S){if(this.session!=S){this.curOp&&this.endOperation(),this.curOp={};var T=this.session;if(T){this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange),this.session.off("startOperation",this.$onStartOperation),this.session.off("endOperation",this.$onEndOperation);var P=this.session.getSelection();P.off("changeCursor",this.$onCursorChange),P.off("changeSelection",this.$onSelectionChange)}this.session=S,S?(this.$onDocumentChange=this.onDocumentChange.bind(this),S.on("change",this.$onDocumentChange),this.renderer.setSession(S),this.$onChangeMode=this.onChangeMode.bind(this),S.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),S.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),S.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),S.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),S.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),S.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=S.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.$onStartOperation=this.onStartOperation.bind(this),this.session.on("startOperation",this.$onStartOperation),this.$onEndOperation=this.onEndOperation.bind(this),this.session.on("endOperation",this.$onEndOperation),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(S)),this._signal("changeSession",{session:S,oldSession:T}),this.curOp=null,T&&T._signal("changeEditor",{oldEditor:this}),T&&(T.$editor=null),S&&S._signal("changeEditor",{editor:this}),S&&(S.$editor=this),S&&!S.destroyed&&S.bgTokenizer.scheduleStart()}},x.prototype.getSession=function(){return this.session},x.prototype.setValue=function(S,T){return this.session.doc.setValue(S),T?T==1?this.navigateFileEnd():T==-1&&this.navigateFileStart():this.selectAll(),S},x.prototype.getValue=function(){return this.session.getValue()},x.prototype.getSelection=function(){return this.selection},x.prototype.resize=function(S){this.renderer.onResize(S)},x.prototype.setTheme=function(S,T){this.renderer.setTheme(S,T)},x.prototype.getTheme=function(){return this.renderer.getTheme()},x.prototype.setStyle=function(S,T){this.renderer.setStyle(S,T)},x.prototype.unsetStyle=function(S){this.renderer.unsetStyle(S)},x.prototype.getFontSize=function(){return this.getOption("fontSize")||m.computedStyle(this.container).fontSize},x.prototype.setFontSize=function(S){this.setOption("fontSize",S)},x.prototype.$highlightBrackets=function(){if(!this.$highlightPending){var S=this;this.$highlightPending=!0,setTimeout(function(){S.$highlightPending=!1;var T=S.session;if(!(!T||T.destroyed)){T.$bracketHighlight&&(T.$bracketHighlight.markerIds.forEach(function(z){T.removeMarker(z)}),T.$bracketHighlight=null);var P=S.getCursorPosition(),N=S.getKeyboardHandler(),k=N&&N.$getDirectionForHighlight&&N.$getDirectionForHighlight(S),O=T.getMatchingBracketRanges(P,k);if(!O){var $=new b(T,P.row,P.column),V=$.getCurrentToken();if(V&&/\b(?:tag-open|tag-name)/.test(V.type)){var H=T.getMatchingTags(P);H&&(O=[H.openTagName.isEmpty()?H.openTag:H.openTagName,H.closeTagName.isEmpty()?H.closeTag:H.closeTagName])}}if(!O&&T.$mode.getMatching&&(O=T.$mode.getMatching(S.session)),!O){S.getHighlightIndentGuides()&&S.renderer.$textLayer.$highlightIndentGuide();return}var U="ace_bracket";Array.isArray(O)?O.length==1&&(U="ace_error_bracket"):O=[O],O.length==2&&(h.comparePoints(O[0].end,O[1].start)==0?O=[h.fromPoints(O[0].start,O[1].end)]:h.comparePoints(O[0].start,O[1].end)==0&&(O=[h.fromPoints(O[1].start,O[0].end)])),T.$bracketHighlight={ranges:O,markerIds:O.map(function(z){return T.addMarker(z,U,"text")})},S.getHighlightIndentGuides()&&S.renderer.$textLayer.$highlightIndentGuide()}},50)}},x.prototype.focus=function(){this.textInput.focus()},x.prototype.isFocused=function(){return this.textInput.isFocused()},x.prototype.blur=function(){this.textInput.blur()},x.prototype.onFocus=function(S){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",S))},x.prototype.onBlur=function(S){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",S))},x.prototype.$cursorChange=function(){this.renderer.updateCursor(),this.$highlightBrackets(),this.$updateHighlightActiveLine()},x.prototype.onDocumentChange=function(S){var T=this.session.$useWrapMode,P=S.start.row==S.end.row?S.end.row:1/0;this.renderer.updateLines(S.start.row,P,T),this._signal("change",S),this.$cursorChange()},x.prototype.onTokenizerUpdate=function(S){var T=S.data;this.renderer.updateLines(T.first,T.last)},x.prototype.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},x.prototype.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},x.prototype.onCursorChange=function(){this.$cursorChange(),this._signal("changeSelection")},x.prototype.$updateHighlightActiveLine=function(){var S=this.getSession(),T;if(this.$highlightActiveLine&&((this.$selectionStyle!="line"||!this.selection.isMultiLine())&&(T=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(T=!1),this.renderer.$maxLines&&this.session.getLength()===1&&!(this.renderer.$minLines>1)&&(T=!1)),S.$highlightLineMarker&&!T)S.removeMarker(S.$highlightLineMarker.id),S.$highlightLineMarker=null;else if(!S.$highlightLineMarker&&T){var P=new h(T.row,T.column,T.row,1/0);P.id=S.addMarker(P,"ace_active-line","screenLine"),S.$highlightLineMarker=P}else T&&(S.$highlightLineMarker.start.row=T.row,S.$highlightLineMarker.end.row=T.row,S.$highlightLineMarker.start.column=T.column,S._signal("changeBackMarker"))},x.prototype.onSelectionChange=function(S){var T=this.session;if(T.$selectionMarker&&T.removeMarker(T.$selectionMarker),T.$selectionMarker=null,this.selection.isEmpty())this.$updateHighlightActiveLine();else{var P=this.selection.getRange(),N=this.getSelectionStyle();T.$selectionMarker=T.addMarker(P,"ace_selection",N)}var k=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(k),this._signal("changeSelection")},x.prototype.$getSelectionHighLightRegexp=function(){var S=this.session,T=this.getSelectionRange();if(!(T.isEmpty()||T.isMultiLine())){var P=T.start.column,N=T.end.column,k=S.getLine(T.start.row),O=k.substring(P,N);if(!(O.length>5e3||!/[\w\d]/.test(O))){var $=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:O}),V=k.substring(P-1,N+1);if($.test(V))return $}}},x.prototype.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},x.prototype.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},x.prototype.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},x.prototype.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},x.prototype.onChangeMode=function(S){this.renderer.updateText(),this._emit("changeMode",S)},x.prototype.onChangeWrapLimit=function(){this.renderer.updateFull()},x.prototype.onChangeWrapMode=function(){this.renderer.onResize(!0)},x.prototype.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},x.prototype.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},x.prototype.getCopyText=function(){var S=this.getSelectedText(),T=this.session.doc.getNewLineCharacter(),P=!1;if(!S&&this.$copyWithEmptySelection){P=!0;for(var N=this.selection.getAllRanges(),k=0;k<N.length;k++){var O=N[k];k&&N[k-1].start.row==O.start.row||(S+=this.session.getLine(O.start.row)+T)}}var $={text:S};return this._signal("copy",$),D.lineMode=P?$.text:!1,$.text},x.prototype.onCopy=function(){this.commands.exec("copy",this)},x.prototype.onCut=function(){this.commands.exec("cut",this)},x.prototype.onPaste=function(S,T){var P={text:S,event:T};this.commands.exec("paste",this,P)},x.prototype.$handlePaste=function(S){typeof S=="string"&&(S={text:S}),this._signal("paste",S);var T=S.text,P=T===D.lineMode,N=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)P?N.insert({row:this.selection.lead.row,column:0},T):this.insert(T);else if(P)this.selection.rangeList.ranges.forEach(function(U){N.insert({row:U.start.row,column:0},T)});else{var k=T.split(/\r\n|\r|\n/),O=this.selection.rangeList.ranges,$=k.length==2&&(!k[0]||!k[1]);if(k.length!=O.length||$)return this.commands.exec("insertstring",this,T);for(var V=O.length;V--;){var H=O[V];H.isEmpty()||N.remove(H),N.insert(H.start,k[V])}}},x.prototype.execCommand=function(S,T){return this.commands.exec(S,this,T)},x.prototype.insert=function(S,T){var P=this.session,N=P.getMode(),k=this.getCursorPosition();if(this.getBehavioursEnabled()&&!T){var O=N.transformAction(P.getState(k.row),"insertion",this,P,S);O&&(S!==O.text&&(this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1)),S=O.text)}if(S=="	"&&(S=this.session.getTabString()),this.selection.isEmpty()){if(this.session.getOverwrite()&&S.indexOf(`
`)==-1){var $=h.fromPoints(k,k);$.end.column+=S.length,this.session.remove($)}}else{var $=this.getSelectionRange();k=this.session.remove($),this.clearSelection()}if(S==`
`||S==`\r
`){var z=P.getLine(k.row);if(k.column>z.search(/\S|$/)){var V=z.substr(k.column).search(/\S|$/);P.doc.removeInLine(k.row,k.column,k.column+V)}}this.clearSelection();var H=k.column,U=P.getState(k.row),z=P.getLine(k.row),G=N.checkOutdent(U,z,S);if(P.insert(k,S),O&&O.selection&&(O.selection.length==2?this.selection.setSelectionRange(new h(k.row,H+O.selection[0],k.row,H+O.selection[1])):this.selection.setSelectionRange(new h(k.row+O.selection[0],O.selection[1],k.row+O.selection[2],O.selection[3]))),this.$enableAutoIndent){if(P.getDocument().isNewLine(S)){var K=N.getNextLineIndent(U,z.slice(0,k.column),P.getTabString());P.insert({row:k.row+1,column:0},K)}G&&N.autoOutdent(U,P,k.row)}},x.prototype.autoIndent=function(){for(var S=this.session,T=S.getMode(),P=this.selection.isEmpty()?[new h(0,0,S.doc.getLength()-1,0)]:this.selection.getAllRanges(),N="",k="",O="",$=S.getTabString(),V=0;V<P.length;V++)for(var H=P[V].start.row,U=P[V].end.row,z=H;z<=U;z++){z>0&&(N=S.getState(z-1),k=S.getLine(z-1),O=T.getNextLineIndent(N,k,$));var G=S.getLine(z),K=T.$getIndent(G);if(O!==K){if(K.length>0){var Y=new h(z,0,z,K.length);S.remove(Y)}O.length>0&&S.insert({row:z,column:0},O)}T.autoOutdent(N,S,z)}},x.prototype.onTextInput=function(S,T){if(!T)return this.keyBinding.onTextInput(S);this.startOperation({command:{name:"insertstring"}});var P=this.applyComposition.bind(this,S,T);this.selection.rangeCount?this.forEachSelection(P):P(),this.endOperation()},x.prototype.applyComposition=function(S,T){if(T.extendLeft||T.extendRight){var P=this.selection.getRange();P.start.column-=T.extendLeft,P.end.column+=T.extendRight,P.start.column<0&&(P.start.row--,P.start.column+=this.session.getLine(P.start.row).length+1),this.selection.setRange(P),!S&&!P.isEmpty()&&this.remove()}if((S||!this.selection.isEmpty())&&this.insert(S,!0),T.restoreStart||T.restoreEnd){var P=this.selection.getRange();P.start.column-=T.restoreStart,P.end.column-=T.restoreEnd,this.selection.setRange(P)}},x.prototype.onCommandKey=function(S,T,P){return this.keyBinding.onCommandKey(S,T,P)},x.prototype.setOverwrite=function(S){this.session.setOverwrite(S)},x.prototype.getOverwrite=function(){return this.session.getOverwrite()},x.prototype.toggleOverwrite=function(){this.session.toggleOverwrite()},x.prototype.setScrollSpeed=function(S){this.setOption("scrollSpeed",S)},x.prototype.getScrollSpeed=function(){return this.getOption("scrollSpeed")},x.prototype.setDragDelay=function(S){this.setOption("dragDelay",S)},x.prototype.getDragDelay=function(){return this.getOption("dragDelay")},x.prototype.setSelectionStyle=function(S){this.setOption("selectionStyle",S)},x.prototype.getSelectionStyle=function(){return this.getOption("selectionStyle")},x.prototype.setHighlightActiveLine=function(S){this.setOption("highlightActiveLine",S)},x.prototype.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},x.prototype.setHighlightGutterLine=function(S){this.setOption("highlightGutterLine",S)},x.prototype.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},x.prototype.setHighlightSelectedWord=function(S){this.setOption("highlightSelectedWord",S)},x.prototype.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},x.prototype.setAnimatedScroll=function(S){this.renderer.setAnimatedScroll(S)},x.prototype.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},x.prototype.setShowInvisibles=function(S){this.renderer.setShowInvisibles(S)},x.prototype.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},x.prototype.setDisplayIndentGuides=function(S){this.renderer.setDisplayIndentGuides(S)},x.prototype.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},x.prototype.setHighlightIndentGuides=function(S){this.renderer.setHighlightIndentGuides(S)},x.prototype.getHighlightIndentGuides=function(){return this.renderer.getHighlightIndentGuides()},x.prototype.setShowPrintMargin=function(S){this.renderer.setShowPrintMargin(S)},x.prototype.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},x.prototype.setPrintMarginColumn=function(S){this.renderer.setPrintMarginColumn(S)},x.prototype.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},x.prototype.setReadOnly=function(S){this.setOption("readOnly",S)},x.prototype.getReadOnly=function(){return this.getOption("readOnly")},x.prototype.setBehavioursEnabled=function(S){this.setOption("behavioursEnabled",S)},x.prototype.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},x.prototype.setWrapBehavioursEnabled=function(S){this.setOption("wrapBehavioursEnabled",S)},x.prototype.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},x.prototype.setShowFoldWidgets=function(S){this.setOption("showFoldWidgets",S)},x.prototype.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},x.prototype.setFadeFoldWidgets=function(S){this.setOption("fadeFoldWidgets",S)},x.prototype.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},x.prototype.remove=function(S){this.selection.isEmpty()&&(S=="left"?this.selection.selectLeft():this.selection.selectRight());var T=this.getSelectionRange();if(this.getBehavioursEnabled()){var P=this.session,N=P.getState(T.start.row),k=P.getMode().transformAction(N,"deletion",this,P,T);if(T.end.column===0){var O=P.getTextRange(T);if(O[O.length-1]==`
`){var $=P.getLine(T.end.row);/^\s+$/.test($)&&(T.end.column=$.length)}}k&&(T=k)}this.session.remove(T),this.clearSelection()},x.prototype.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},x.prototype.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},x.prototype.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},x.prototype.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var S=this.getSelectionRange();S.start.column==S.end.column&&S.start.row==S.end.row&&(S.end.column=0,S.end.row++),this.session.remove(S),this.clearSelection()},x.prototype.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var S=this.getCursorPosition();this.insert(`
`),this.moveCursorToPosition(S)},x.prototype.setGhostText=function(S,T){this.renderer.setGhostText(S,T)},x.prototype.removeGhostText=function(){this.renderer.removeGhostText()},x.prototype.transposeLetters=function(){if(this.selection.isEmpty()){var S=this.getCursorPosition(),T=S.column;if(T!==0){var P=this.session.getLine(S.row),N,k;T<P.length?(N=P.charAt(T)+P.charAt(T-1),k=new h(S.row,T-1,S.row,T+1)):(N=P.charAt(T-1)+P.charAt(T-2),k=new h(S.row,T-2,S.row,T)),this.session.replace(k,N),this.session.selection.moveToPosition(k.end)}}},x.prototype.toLowerCase=function(){var S=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var T=this.getSelectionRange(),P=this.session.getTextRange(T);this.session.replace(T,P.toLowerCase()),this.selection.setSelectionRange(S)},x.prototype.toUpperCase=function(){var S=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var T=this.getSelectionRange(),P=this.session.getTextRange(T);this.session.replace(T,P.toUpperCase()),this.selection.setSelectionRange(S)},x.prototype.indent=function(){var S=this.session,T=this.getSelectionRange();if(T.start.row<T.end.row){var P=this.$getSelectedRows();S.indentRows(P.first,P.last,"	");return}else if(T.start.column<T.end.column){var N=S.getTextRange(T);if(!/^\s+$/.test(N)){var P=this.$getSelectedRows();S.indentRows(P.first,P.last,"	");return}}var k=S.getLine(T.start.row),O=T.start,$=S.getTabSize(),V=S.documentToScreenColumn(O.row,O.column);if(this.session.getUseSoftTabs())var H=$-V%$,U=l.stringRepeat(" ",H);else{for(var H=V%$;k[T.start.column-1]==" "&&H;)T.start.column--,H--;this.selection.setSelectionRange(T),U="	"}return this.insert(U)},x.prototype.blockIndent=function(){var S=this.$getSelectedRows();this.session.indentRows(S.first,S.last,"	")},x.prototype.blockOutdent=function(){var S=this.session.getSelection();this.session.outdentRows(S.getRange())},x.prototype.sortLines=function(){for(var S=this.$getSelectedRows(),T=this.session,P=[],N=S.first;N<=S.last;N++)P.push(T.getLine(N));P.sort(function($,V){return $.toLowerCase()<V.toLowerCase()?-1:$.toLowerCase()>V.toLowerCase()?1:0});for(var k=new h(0,0,0,0),N=S.first;N<=S.last;N++){var O=T.getLine(N);k.start.row=N,k.end.row=N,k.end.column=O.length,T.replace(k,P[N-S.first])}},x.prototype.toggleCommentLines=function(){var S=this.session.getState(this.getCursorPosition().row),T=this.$getSelectedRows();this.session.getMode().toggleCommentLines(S,this.session,T.first,T.last)},x.prototype.toggleBlockComment=function(){var S=this.getCursorPosition(),T=this.session.getState(S.row),P=this.getSelectionRange();this.session.getMode().toggleBlockComment(T,this.session,P,S)},x.prototype.getNumberAt=function(S,T){var P=/[\-]?[0-9]+(?:\.[0-9]+)?/g;P.lastIndex=0;for(var N=this.session.getLine(S);P.lastIndex<T;){var k=P.exec(N);if(k.index<=T&&k.index+k[0].length>=T){var O={value:k[0],start:k.index,end:k.index+k[0].length};return O}}return null},x.prototype.modifyNumber=function(S){var T=this.selection.getCursor().row,P=this.selection.getCursor().column,N=new h(T,P-1,T,P),k=this.session.getTextRange(N);if(!isNaN(parseFloat(k))&&isFinite(k)){var O=this.getNumberAt(T,P);if(O){var $=O.value.indexOf(".")>=0?O.start+O.value.indexOf(".")+1:O.end,V=O.start+O.value.length-$,H=parseFloat(O.value);H*=Math.pow(10,V),$!==O.end&&P<$?S*=Math.pow(10,O.end-P-1):S*=Math.pow(10,O.end-P),H+=S,H/=Math.pow(10,V);var U=H.toFixed(V),z=new h(T,O.start,T,O.end);this.session.replace(z,U),this.moveCursorTo(T,Math.max(O.start+1,P+U.length-O.value.length))}}else this.toggleWord()},x.prototype.toggleWord=function(){var S=this.selection.getCursor().row,T=this.selection.getCursor().column;this.selection.selectWord();var P=this.getSelectedText(),N=this.selection.getWordRange().start.column,k=P.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),O=T-N-1;O<0&&(O=0);var $=0,V=0,H=this;P.match(/[A-Za-z0-9_]+/)&&k.forEach(function(j,ke){V=$+j.length,O>=$&&O<=V&&(P=j,H.selection.clearSelection(),H.moveCursorTo(S,$+N),H.selection.selectTo(S,V+N)),$=V});for(var U=this.$toggleWordPairs,z,G=0;G<U.length;G++)for(var K=U[G],Y=0;Y<=1;Y++){var Z=+!Y,ie=P.match(new RegExp("^\\s?_?("+l.escapeRegExp(K[Y])+")\\s?$","i"));if(ie){var oe=P.match(new RegExp("([_]|^|\\s)("+l.escapeRegExp(ie[1])+")($|\\s)","g"));oe&&(z=P.replace(new RegExp(l.escapeRegExp(K[Y]),"i"),function(j){var ke=K[Z];return j.toUpperCase()==j?ke=ke.toUpperCase():j.charAt(0).toUpperCase()==j.charAt(0)&&(ke=ke.substr(0,0)+K[Z].charAt(0).toUpperCase()+ke.substr(1)),ke}),this.insert(z),z="")}}},x.prototype.findLinkAt=function(S,T){var P,N,k=this.session.getLine(S),O=k.split(/((?:https?|ftp):\/\/[\S]+)/),$=T;$<0&&($=0);var V=0,H=0,U;try{for(var z=f(O),G=z.next();!G.done;G=z.next()){var K=G.value;if(H=V+K.length,$>=V&&$<=H&&K.match(/((?:https?|ftp):\/\/[\S]+)/)){U=K.replace(/[\s:.,'";}\]]+$/,"");break}V=H}}catch(Y){P={error:Y}}finally{try{G&&!G.done&&(N=z.return)&&N.call(z)}finally{if(P)throw P.error}}return U},x.prototype.openLink=function(){var S=this.selection.getCursor(),T=this.findLinkAt(S.row,S.column);return T&&window.open(T,"_blank"),T!=null},x.prototype.removeLines=function(){var S=this.$getSelectedRows();this.session.removeFullLines(S.first,S.last),this.clearSelection()},x.prototype.duplicateSelection=function(){var S=this.selection,T=this.session,P=S.getRange(),N=S.isBackwards();if(P.isEmpty()){var k=P.start.row;T.duplicateLines(k,k)}else{var O=N?P.start:P.end,$=T.insert(O,T.getTextRange(P));P.start=O,P.end=$,S.setSelectionRange(P,N)}},x.prototype.moveLinesDown=function(){this.$moveLines(1,!1)},x.prototype.moveLinesUp=function(){this.$moveLines(-1,!1)},x.prototype.moveText=function(S,T,P){return this.session.moveText(S,T,P)},x.prototype.copyLinesUp=function(){this.$moveLines(-1,!0)},x.prototype.copyLinesDown=function(){this.$moveLines(1,!0)},x.prototype.$moveLines=function(S,T){var P,N,k=this.selection;if(!k.inMultiSelectMode||this.inVirtualSelectionMode){var O=k.toOrientedRange();P=this.$getSelectedRows(O),N=this.session.$moveLines(P.first,P.last,T?0:S),T&&S==-1&&(N=0),O.moveBy(N,0),k.fromOrientedRange(O)}else{var $=k.rangeList.ranges;k.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;for(var V=0,H=0,U=$.length,z=0;z<U;z++){var G=z;$[z].moveBy(V,0),P=this.$getSelectedRows($[z]);for(var K=P.first,Y=P.last;++z<U;){H&&$[z].moveBy(H,0);var Z=this.$getSelectedRows($[z]);if(T&&Z.first!=Y)break;if(!T&&Z.first>Y+1)break;Y=Z.last}for(z--,V=this.session.$moveLines(K,Y,T?0:S),T&&S==-1&&(G=z+1);G<=z;)$[G].moveBy(V,0),G++;T||(V=0),H+=V}k.fromOrientedRange(k.ranges[0]),k.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},x.prototype.$getSelectedRows=function(S){return S=(S||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(S.start.row),last:this.session.getRowFoldEnd(S.end.row)}},x.prototype.onCompositionStart=function(S){this.renderer.showComposition(S)},x.prototype.onCompositionUpdate=function(S){this.renderer.setCompositionText(S)},x.prototype.onCompositionEnd=function(){this.renderer.hideComposition()},x.prototype.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},x.prototype.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},x.prototype.isRowVisible=function(S){return S>=this.getFirstVisibleRow()&&S<=this.getLastVisibleRow()},x.prototype.isRowFullyVisible=function(S){return S>=this.renderer.getFirstFullyVisibleRow()&&S<=this.renderer.getLastFullyVisibleRow()},x.prototype.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},x.prototype.$moveByPage=function(S,T){var P=this.renderer,N=this.renderer.layerConfig,k=S*Math.floor(N.height/N.lineHeight);T===!0?this.selection.$moveSelection(function(){this.moveCursorBy(k,0)}):T===!1&&(this.selection.moveCursorBy(k,0),this.selection.clearSelection());var O=P.scrollTop;P.scrollBy(0,k*N.lineHeight),T!=null&&P.scrollCursorIntoView(null,.5),P.animateScrolling(O)},x.prototype.selectPageDown=function(){this.$moveByPage(1,!0)},x.prototype.selectPageUp=function(){this.$moveByPage(-1,!0)},x.prototype.gotoPageDown=function(){this.$moveByPage(1,!1)},x.prototype.gotoPageUp=function(){this.$moveByPage(-1,!1)},x.prototype.scrollPageDown=function(){this.$moveByPage(1)},x.prototype.scrollPageUp=function(){this.$moveByPage(-1)},x.prototype.scrollToRow=function(S){this.renderer.scrollToRow(S)},x.prototype.scrollToLine=function(S,T,P,N){this.renderer.scrollToLine(S,T,P,N)},x.prototype.centerSelection=function(){var S=this.getSelectionRange(),T={row:Math.floor(S.start.row+(S.end.row-S.start.row)/2),column:Math.floor(S.start.column+(S.end.column-S.start.column)/2)};this.renderer.alignCursor(T,.5)},x.prototype.getCursorPosition=function(){return this.selection.getCursor()},x.prototype.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},x.prototype.getSelectionRange=function(){return this.selection.getRange()},x.prototype.selectAll=function(){this.selection.selectAll()},x.prototype.clearSelection=function(){this.selection.clearSelection()},x.prototype.moveCursorTo=function(S,T){this.selection.moveCursorTo(S,T)},x.prototype.moveCursorToPosition=function(S){this.selection.moveCursorToPosition(S)},x.prototype.jumpToMatching=function(S,T){var P=this.getCursorPosition(),N=new b(this.session,P.row,P.column),k=N.getCurrentToken(),O=0;k&&k.type.indexOf("tag-name")!==-1&&(k=N.stepBackward());var $=k||N.stepForward();if($){var V,H=!1,U={},z=P.column-$.start,G,K={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if($.value.match(/[{}()\[\]]/g)){for(;z<$.value.length&&!H;z++)if(K[$.value[z]])switch(G=K[$.value[z]]+"."+$.type.replace("rparen","lparen"),isNaN(U[G])&&(U[G]=0),$.value[z]){case"(":case"[":case"{":U[G]++;break;case")":case"]":case"}":U[G]--,U[G]===-1&&(V="bracket",H=!0);break}}else $.type.indexOf("tag-name")!==-1&&(isNaN(U[$.value])&&(U[$.value]=0),k.value==="<"&&O>1?U[$.value]++:k.value==="</"&&U[$.value]--,U[$.value]===-1&&(V="tag",H=!0));H||(k=$,O++,$=N.stepForward(),z=0)}while($&&!H);if(V){var Y,Z;if(V==="bracket")Y=this.session.getBracketRange(P),Y||(Y=new h(N.getCurrentTokenRow(),N.getCurrentTokenColumn()+z-1,N.getCurrentTokenRow(),N.getCurrentTokenColumn()+z-1),Z=Y.start,(T||Z.row===P.row&&Math.abs(Z.column-P.column)<2)&&(Y=this.session.getBracketRange(Z)));else if(V==="tag"){if(!$||$.type.indexOf("tag-name")===-1)return;if(Y=new h(N.getCurrentTokenRow(),N.getCurrentTokenColumn()-2,N.getCurrentTokenRow(),N.getCurrentTokenColumn()-2),Y.compare(P.row,P.column)===0){var ie=this.session.getMatchingTags(P);ie&&(ie.openTag.contains(P.row,P.column)?(Y=ie.closeTag,Z=Y.start):(Y=ie.openTag,ie.closeTag.start.row===P.row&&ie.closeTag.start.column===P.column?Z=Y.end:Z=Y.start))}Z=Z||Y.start}Z=Y&&Y.cursor||Z,Z&&(S?Y&&T?this.selection.setRange(Y):Y&&Y.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(Z.row,Z.column):this.selection.moveTo(Z.row,Z.column))}}},x.prototype.gotoLine=function(S,T,P){this.selection.clearSelection(),this.session.unfold({row:S-1,column:T||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(S-1,T||0),this.isRowFullyVisible(S-1)||this.scrollToLine(S-1,!0,P)},x.prototype.navigateTo=function(S,T){this.selection.moveTo(S,T)},x.prototype.navigateUp=function(S){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var T=this.selection.anchor.getPosition();return this.moveCursorToPosition(T)}this.selection.clearSelection(),this.selection.moveCursorBy(-S||-1,0)},x.prototype.navigateDown=function(S){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var T=this.selection.anchor.getPosition();return this.moveCursorToPosition(T)}this.selection.clearSelection(),this.selection.moveCursorBy(S||1,0)},x.prototype.navigateLeft=function(S){if(this.selection.isEmpty())for(S=S||1;S--;)this.selection.moveCursorLeft();else{var T=this.getSelectionRange().start;this.moveCursorToPosition(T)}this.clearSelection()},x.prototype.navigateRight=function(S){if(this.selection.isEmpty())for(S=S||1;S--;)this.selection.moveCursorRight();else{var T=this.getSelectionRange().end;this.moveCursorToPosition(T)}this.clearSelection()},x.prototype.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},x.prototype.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},x.prototype.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},x.prototype.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},x.prototype.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},x.prototype.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},x.prototype.replace=function(S,T){T&&this.$search.set(T);var P=this.$search.find(this.session),N=0;return P&&(this.$tryReplace(P,S)&&(N=1),this.selection.setSelectionRange(P),this.renderer.scrollSelectionIntoView(P.start,P.end)),N},x.prototype.replaceAll=function(S,T){T&&this.$search.set(T);var P=this.$search.findAll(this.session),N=0;if(!P.length)return N;var k=this.getSelectionRange();this.selection.moveTo(0,0);for(var O=P.length-1;O>=0;--O)this.$tryReplace(P[O],S)&&N++;return this.selection.setSelectionRange(k),N},x.prototype.$tryReplace=function(S,T){var P=this.session.getTextRange(S);return T=this.$search.replace(P,T),T!==null?(S.end=this.session.replace(S,T),S):null},x.prototype.getLastSearchOptions=function(){return this.$search.getOptions()},x.prototype.find=function(S,T,P){T||(T={}),typeof S=="string"||S instanceof RegExp?T.needle=S:typeof S=="object"&&y.mixin(T,S);var N=this.selection.getRange();T.needle==null&&(S=this.session.getTextRange(N)||this.$search.$options.needle,S||(N=this.session.getWordRange(N.start.row,N.start.column),S=this.session.getTextRange(N)),this.$search.set({needle:S})),this.$search.set(T),T.start||this.$search.set({start:N});var k=this.$search.find(this.session);if(T.preventScroll)return k;if(k)return this.revealRange(k,P),k;T.backwards?N.start=N.end:N.end=N.start,this.selection.setRange(N)},x.prototype.findNext=function(S,T){this.find({skipCurrent:!0,backwards:!1},S,T)},x.prototype.findPrevious=function(S,T){this.find(S,{skipCurrent:!0,backwards:!0},T)},x.prototype.revealRange=function(S,T){this.session.unfold(S),this.selection.setSelectionRange(S);var P=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(S.start,S.end,.5),T!==!1&&this.renderer.animateScrolling(P)},x.prototype.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},x.prototype.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},x.prototype.destroy=function(){this.destroyed=!0,this.$toDestroy&&(this.$toDestroy.forEach(function(S){S.destroy()}),this.$toDestroy=[]),this.$mouseHandler&&this.$mouseHandler.destroy(),this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy(),this._$emitInputEvent&&this._$emitInputEvent.cancel(),this.removeAllListeners()},x.prototype.setAutoScrollEditorIntoView=function(S){if(S){var T,P=this,N=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var k=this.$scrollAnchor;k.style.cssText="position:absolute",this.container.insertBefore(k,this.container.firstChild);var O=this.on("changeSelection",function(){N=!0}),$=this.renderer.on("beforeRender",function(){N&&(T=P.renderer.container.getBoundingClientRect())}),V=this.renderer.on("afterRender",function(){if(N&&T&&(P.isFocused()||P.searchBox&&P.searchBox.isFocused())){var H=P.renderer,U=H.$cursorLayer.$pixelPos,z=H.layerConfig,G=U.top-z.offset;U.top>=0&&G+T.top<0?N=!0:U.top<z.height&&U.top+T.top+z.lineHeight>window.innerHeight?N=!1:N=null,N!=null&&(k.style.top=G+"px",k.style.left=U.left+"px",k.style.height=z.lineHeight+"px",k.scrollIntoView(N)),N=T=null}});this.setAutoScrollEditorIntoView=function(H){H||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",O),this.renderer.off("afterRender",V),this.renderer.off("beforeRender",$))}}},x.prototype.$resetCursorStyle=function(){var S=this.$cursorStyle||"ace",T=this.renderer.$cursorLayer;T&&(T.setSmoothBlinking(/smooth/.test(S)),T.isBlinking=!this.$readOnly&&S!="wide",m.setCssClass(T.element,"ace_slim-cursors",/slim/.test(S)))},x.prototype.prompt=function(S,T,P){var N=this;M.loadModule("ace/ext/prompt",function(k){k.prompt(N,S,T,P)})},x}();R.$uid=0,R.prototype.curOp=null,R.prototype.prevOp={},R.prototype.$mergeableCommands=["backspace","del","insertstring"],R.prototype.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],y.implement(R.prototype,d),M.defineOptions(R.prototype,"editor",{selectionStyle:{set:function(x){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:x})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(x){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(x){var S=this;if(this.textInput.setReadOnly(x),!this.destroyed){this.$resetCursorStyle(),this.$readOnlyCallback||(this.$readOnlyCallback=function(P){var N=!1;if(P&&P.type=="keydown"){if(P&&P.key&&!P.ctrlKey&&!P.metaKey&&(P.key==" "&&P.preventDefault(),N=P.key.length==1),!N)return}else P&&P.type!=="exec"&&(N=!0);if(N){S.hoverTooltip||(S.hoverTooltip=new I);var k=m.createElement("div");k.textContent=E("editor.tooltip.disable-editing","Editing is disabled"),S.hoverTooltip.isOpen||S.hoverTooltip.showForRange(S,S.getSelectionRange(),k)}else S.hoverTooltip&&S.hoverTooltip.isOpen&&S.hoverTooltip.hide()});var T=this.textInput.getElement();x?(w.addListener(T,"keydown",this.$readOnlyCallback,this),this.commands.on("exec",this.$readOnlyCallback),this.commands.on("commandUnavailable",this.$readOnlyCallback)):(w.removeListener(T,"keydown",this.$readOnlyCallback),this.commands.off("exec",this.$readOnlyCallback),this.commands.off("commandUnavailable",this.$readOnlyCallback),this.hoverTooltip&&(this.hoverTooltip.destroy(),this.hoverTooltip=null))}},initialValue:!1},copyWithEmptySelection:{set:function(x){this.textInput.setCopyWithEmptySelection(x)},initialValue:!1},cursorStyle:{set:function(x){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(x){this.setAutoScrollEditorIntoView(x)}},keyboardHandler:{set:function(x){this.setKeyboardHandler(x)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(x){this.session.setValue(x)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(x){this.setSession(x)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(x){this.renderer.$gutterLayer.setShowLineNumbers(x),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),x&&this.$relativeLineNumbers?A.attach(this):A.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(x){this.$showLineNumbers&&x?A.attach(this):A.detach(this)}},placeholder:{set:function(x){this.$updatePlaceholder||(this.$updatePlaceholder=function(){var S=this.session&&(this.renderer.$composition||this.session.getLength()>1||this.session.getLine(0).length>0);if(S&&this.renderer.placeholderNode)this.renderer.off("afterRender",this.$updatePlaceholder),m.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null;else if(!S&&!this.renderer.placeholderNode){this.renderer.on("afterRender",this.$updatePlaceholder),m.addCssClass(this.container,"ace_hasPlaceholder");var T=m.createElement("div");T.className="ace_placeholder",T.textContent=this.$placeholder||"",this.renderer.placeholderNode=T,this.renderer.content.appendChild(this.renderer.placeholderNode)}else!S&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||"")}.bind(this),this.on("input",this.$updatePlaceholder)),this.$updatePlaceholder()}},enableKeyboardAccessibility:{set:function(x){var S={name:"blurTextInput",description:"Set focus to the editor content div to allow tabbing through the page",bindKey:"Esc",exec:function(N){N.blur(),N.renderer.scroller.focus()},readOnly:!0},T=function(N){if(N.target==this.renderer.scroller&&N.keyCode===L.enter){N.preventDefault();var k=this.getCursorPosition().row;this.isRowVisible(k)||this.scrollToLine(k,!0,!0),this.focus()}},P;x?(this.renderer.enableKeyboardAccessibility=!0,this.renderer.keyboardFocusClassName="ace_keyboard-focus",this.textInput.getElement().setAttribute("tabindex",-1),this.textInput.setNumberOfExtraLines(u.isWin?3:0),this.renderer.scroller.setAttribute("tabindex",0),this.renderer.scroller.setAttribute("role","group"),this.renderer.scroller.setAttribute("aria-roledescription",E("editor.scroller.aria-roledescription","editor")),this.renderer.scroller.classList.add(this.renderer.keyboardFocusClassName),this.renderer.scroller.setAttribute("aria-label",E("editor.scroller.aria-label","Editor content, press Enter to start editing, press Escape to exit")),this.renderer.scroller.addEventListener("keyup",T.bind(this)),this.commands.addCommand(S),this.renderer.$gutter.setAttribute("tabindex",0),this.renderer.$gutter.setAttribute("aria-hidden",!1),this.renderer.$gutter.setAttribute("role","group"),this.renderer.$gutter.setAttribute("aria-roledescription",E("editor.gutter.aria-roledescription","editor gutter")),this.renderer.$gutter.setAttribute("aria-label",E("editor.gutter.aria-label","Editor gutter, press Enter to interact with controls using arrow keys, press Escape to exit")),this.renderer.$gutter.classList.add(this.renderer.keyboardFocusClassName),this.renderer.content.setAttribute("aria-hidden",!0),P||(P=new v(this)),P.addListener(),this.textInput.setAriaOptions({setLabel:!0})):(this.renderer.enableKeyboardAccessibility=!1,this.textInput.getElement().setAttribute("tabindex",0),this.textInput.setNumberOfExtraLines(0),this.renderer.scroller.setAttribute("tabindex",-1),this.renderer.scroller.removeAttribute("role"),this.renderer.scroller.removeAttribute("aria-roledescription"),this.renderer.scroller.classList.remove(this.renderer.keyboardFocusClassName),this.renderer.scroller.removeAttribute("aria-label"),this.renderer.scroller.removeEventListener("keyup",T.bind(this)),this.commands.removeCommand(S),this.renderer.content.removeAttribute("aria-hidden"),this.renderer.$gutter.setAttribute("tabindex",-1),this.renderer.$gutter.setAttribute("aria-hidden",!0),this.renderer.$gutter.removeAttribute("role"),this.renderer.$gutter.removeAttribute("aria-roledescription"),this.renderer.$gutter.removeAttribute("aria-label"),this.renderer.$gutter.classList.remove(this.renderer.keyboardFocusClassName),P&&P.removeListener())},initialValue:!1},textInputAriaLabel:{set:function(x){this.$textInputAriaLabel=x},initialValue:""},enableMobileMenu:{set:function(x){this.$enableMobileMenu=x},initialValue:!0},customScrollbar:"renderer",hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",highlightIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",useResizeObserver:"renderer",useSvgGutterIcons:"renderer",showFoldedAnnotations:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var A={getText:function(x,S){return(Math.abs(x.selection.lead.row-S)||S+1+(S<9?"":""))+""},getWidth:function(x,S,T){return Math.max(S.toString().length,(T.lastRow+1).toString().length,2)*T.characterWidth},update:function(x,S){S.renderer.$loop.schedule(S.renderer.CHANGE_GUTTER)},attach:function(x){x.renderer.$gutterLayer.$renderer=this,x.on("changeSelection",this.update),this.update(null,x)},detach:function(x){x.renderer.$gutterLayer.$renderer==this&&(x.renderer.$gutterLayer.$renderer=null),x.off("changeSelection",this.update),this.update(null,x)}};n.Editor=R}),ace.define("ace/layer/lines",["require","exports","module","ace/lib/dom"],function(t,n,p){var f=t("../lib/dom"),y=function(){function m(l,u){this.element=l,this.canvasHeight=u||5e5,this.element.style.height=this.canvasHeight*2+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0}return m.prototype.moveContainer=function(l){f.translate(this.element,0,-(l.firstRowScreen*l.lineHeight%this.canvasHeight)-l.offset*this.$offsetCoefficient)},m.prototype.pageChanged=function(l,u){return Math.floor(l.firstRowScreen*l.lineHeight/this.canvasHeight)!==Math.floor(u.firstRowScreen*u.lineHeight/this.canvasHeight)},m.prototype.computeLineTop=function(l,u,r){var a=u.firstRowScreen*u.lineHeight,s=Math.floor(a/this.canvasHeight),o=r.documentToScreenRow(l,0)*u.lineHeight;return o-s*this.canvasHeight},m.prototype.computeLineHeight=function(l,u,r){return u.lineHeight*r.getRowLineCount(l)},m.prototype.getLength=function(){return this.cells.length},m.prototype.get=function(l){return this.cells[l]},m.prototype.shift=function(){this.$cacheCell(this.cells.shift())},m.prototype.pop=function(){this.$cacheCell(this.cells.pop())},m.prototype.push=function(l){if(Array.isArray(l)){this.cells.push.apply(this.cells,l);for(var u=f.createFragment(this.element),r=0;r<l.length;r++)u.appendChild(l[r].element);this.element.appendChild(u)}else this.cells.push(l),this.element.appendChild(l.element)},m.prototype.unshift=function(l){if(Array.isArray(l)){this.cells.unshift.apply(this.cells,l);for(var u=f.createFragment(this.element),r=0;r<l.length;r++)u.appendChild(l[r].element);this.element.firstChild?this.element.insertBefore(u,this.element.firstChild):this.element.appendChild(u)}else this.cells.unshift(l),this.element.insertAdjacentElement("afterbegin",l.element)},m.prototype.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},m.prototype.$cacheCell=function(l){l&&(l.element.remove(),this.cellCache.push(l))},m.prototype.createCell=function(l,u,r,a){var s=this.cellCache.pop();if(!s){var o=f.createElement("div");a&&a(o),this.element.appendChild(o),s={element:o,text:"",row:l}}return s.row=l,s},m}();n.Lines=y}),ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/layer/lines","ace/config"],function(t,n,p){var f=t("../lib/dom"),y=t("../lib/oop"),m=t("../lib/lang"),l=t("../lib/event_emitter").EventEmitter,u=t("./lines").Lines,r=t("../config").nls,a=function(){function o(i){this.$showCursorMarker=null,this.element=f.createElement("div"),this.element.className="ace_layer ace_gutter-layer",i.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new u(this.element),this.$lines.$offsetCoefficient=1}return o.prototype.setSession=function(i){this.session&&this.session.off("change",this.$updateAnnotations),this.session=i,i&&i.on("change",this.$updateAnnotations)},o.prototype.addGutterDecoration=function(i,c){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(i,c)},o.prototype.removeGutterDecoration=function(i,c){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(i,c)},o.prototype.setAnnotations=function(i){this.$annotations=[];for(var c=0;c<i.length;c++){var h=i[c],d=h.row,_=this.$annotations[d];_||(_=this.$annotations[d]={text:[],type:[],displayText:[]});var C=h.text,M=h.text,b=h.type;C=C?m.escapeHTML(C):h.html||"",M=M||h.html||"",_.text.indexOf(C)===-1&&(_.text.push(C),_.type.push(b),_.displayText.push(M));var v=h.className;v?_.className=v:b==="error"?_.className=" ace_error":b==="security"&&!/\bace_error\b/.test(_.className)?_.className=" ace_security":b==="warning"&&!/\bace_(error|security)\b/.test(_.className)?_.className=" ace_warning":b==="info"&&!_.className?_.className=" ace_info":b==="hint"&&!_.className&&(_.className=" ace_hint")}},o.prototype.$updateAnnotations=function(i){if(this.$annotations.length){var c=i.start.row,h=i.end.row-c;if(h!==0)if(i.action=="remove")this.$annotations.splice(c,h+1,null);else{var d=new Array(h+1);d.unshift(c,1),this.$annotations.splice.apply(this.$annotations,d)}}},o.prototype.update=function(i){this.config=i;var c=this.session,h=i.firstRow,d=Math.min(i.lastRow+i.gutterOffset,c.getLength()-1);this.oldLastRow=d,this.config=i,this.$lines.moveContainer(i),this.$updateCursorRow();for(var _=c.getNextFoldLine(h),C=_?_.start.row:1/0,M=null,b=-1,v=h;;){if(v>C&&(v=_.end.row+1,_=c.getNextFoldLine(v,_),C=_?_.start.row:1/0),v>d){for(;this.$lines.getLength()>b+1;)this.$lines.pop();break}M=this.$lines.get(++b),M?M.row=v:(M=this.$lines.createCell(v,i,this.session,s),this.$lines.push(M)),this.$renderCell(M,i,_,v),v++}this._signal("afterRender"),this.$updateGutterWidth(i),this.$showCursorMarker&&this.$highlightGutterLine&&this.$updateCursorMarker()},o.prototype.$updateGutterWidth=function(i){var c=this.session,h=c.gutterRenderer||this.$renderer,d=c.$firstLineNumber,_=this.$lines.last()?this.$lines.last().text:"";(this.$fixedWidth||c.$useWrapMode)&&(_=c.getLength()+d-1);var C=h?h.getWidth(c,_,i):_.toString().length*i.characterWidth,M=this.$padding||this.$computePadding();C+=M.left+M.right,C!==this.gutterWidth&&!isNaN(C)&&(this.gutterWidth=C,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",C))},o.prototype.$updateCursorRow=function(){if(this.$highlightGutterLine){var i=this.session.selection.getCursor();this.$cursorRow!==i.row&&(this.$cursorRow=i.row)}},o.prototype.updateLineHighlight=function(){if(this.$showCursorMarker&&this.$updateCursorMarker(),!!this.$highlightGutterLine){var i=this.session.selection.cursor.row;if(this.$cursorRow=i,!(this.$cursorCell&&this.$cursorCell.row==i)){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var c=this.$lines.cells;this.$cursorCell=null;for(var h=0;h<c.length;h++){var d=c[h];if(d.row>=this.$cursorRow){if(d.row>this.$cursorRow){var _=this.session.getFoldLine(this.$cursorRow);if(h>0&&_&&_.start.row==c[h-1].row)d=c[h-1];else break}d.element.className="ace_gutter-active-line "+d.element.className,this.$cursorCell=d;break}}}}},o.prototype.$updateCursorMarker=function(){if(this.session){var i=this.session;this.$highlightElement||(this.$highlightElement=f.createElement("div"),this.$highlightElement.className="ace_gutter-cursor",this.$highlightElement.style.pointerEvents="none",this.element.appendChild(this.$highlightElement));var c=i.selection.cursor,h=this.config,d=this.$lines,_=h.firstRowScreen*h.lineHeight,C=Math.floor(_/d.canvasHeight),M=i.documentToScreenRow(c)*h.lineHeight,b=M-C*d.canvasHeight;f.setStyle(this.$highlightElement.style,"height",h.lineHeight+"px"),f.setStyle(this.$highlightElement.style,"top",b+"px")}},o.prototype.scrollLines=function(i){var c=this.config;if(this.config=i,this.$updateCursorRow(),this.$lines.pageChanged(c,i))return this.update(i);this.$lines.moveContainer(i);var h=Math.min(i.lastRow+i.gutterOffset,this.session.getLength()-1),d=this.oldLastRow;if(this.oldLastRow=h,!c||d<i.firstRow)return this.update(i);if(h<c.firstRow)return this.update(i);if(c.firstRow<i.firstRow)for(var _=this.session.getFoldedRowCount(c.firstRow,i.firstRow-1);_>0;_--)this.$lines.shift();if(d>h)for(var _=this.session.getFoldedRowCount(h+1,d);_>0;_--)this.$lines.pop();i.firstRow<c.firstRow&&this.$lines.unshift(this.$renderLines(i,i.firstRow,c.firstRow-1)),h>d&&this.$lines.push(this.$renderLines(i,d+1,h)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(i)},o.prototype.$renderLines=function(i,c,h){for(var d=[],_=c,C=this.session.getNextFoldLine(_),M=C?C.start.row:1/0;_>M&&(_=C.end.row+1,C=this.session.getNextFoldLine(_,C),M=C?C.start.row:1/0),!(_>h);){var b=this.$lines.createCell(_,i,this.session,s);this.$renderCell(b,i,C,_),d.push(b),_++}return d},o.prototype.$renderCell=function(i,c,h,d){var _=i.element,C=this.session,M=_.childNodes[0],b=_.childNodes[1],v=_.childNodes[2],E=_.childNodes[3],D=v.firstChild,L=C.$firstLineNumber,w=C.$breakpoints,I=C.$decorations,R=C.gutterRenderer||this.$renderer,A=this.$showFoldWidgets&&C.foldWidgets,x=h?h.start.row:Number.MAX_VALUE,S=c.lineHeight+"px",T=this.$useSvgGutterIcons?"ace_gutter-cell_svg-icons ":"ace_gutter-cell ",P=this.$useSvgGutterIcons?"ace_icon_svg":"ace_icon",N=(R?R.getText(C,d):d+L).toString();if(this.$highlightGutterLine&&(d==this.$cursorRow||h&&d<this.$cursorRow&&d>=x&&this.$cursorRow<=h.end.row)&&(T+="ace_gutter-active-line ",this.$cursorCell!=i&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=i)),w[d]&&(T+=w[d]),I[d]&&(T+=I[d]),this.$annotations[d]&&d!==x&&(T+=this.$annotations[d].className),A){var k=A[d];k==null&&(k=A[d]=C.getFoldWidget(d))}if(k){var O="ace_fold-widget ace_"+k,$=k=="start"&&d==x&&d<h.end.row;if($){O+=" ace_closed";for(var V="",H=!1,U=d+1;U<=h.end.row;U++)if(this.$annotations[U]){if(this.$annotations[U].className===" ace_error"){H=!0,V=" ace_error_fold";break}this.$annotations[U].className===" ace_security"?(H=!0,V=" ace_security_fold"):this.$annotations[U].className===" ace_warning"&&V!==" ace_security_fold"&&(H=!0,V=" ace_warning_fold")}T+=V}else O+=" ace_open";b.className!=O&&(b.className=O),f.setStyle(b.style,"height",S),f.setStyle(b.style,"display","inline-block"),b.setAttribute("role","button"),b.setAttribute("tabindex","-1");var z=C.getFoldWidgetRange(d);z?b.setAttribute("aria-label",r("gutter.code-folding.range.aria-label","Toggle code folding, rows $0 through $1",[z.start.row+1,z.end.row+1])):h?b.setAttribute("aria-label",r("gutter.code-folding.closed.aria-label","Toggle code folding, rows $0 through $1",[h.start.row+1,h.end.row+1])):b.setAttribute("aria-label",r("gutter.code-folding.open.aria-label","Toggle code folding, row $0",[d+1])),$?(b.setAttribute("aria-expanded","false"),b.setAttribute("title",r("gutter.code-folding.closed.title","Unfold code"))):(b.setAttribute("aria-expanded","true"),b.setAttribute("title",r("gutter.code-folding.open.title","Fold code")))}else b&&(f.setStyle(b.style,"display","none"),b.setAttribute("tabindex","0"),b.removeAttribute("role"),b.removeAttribute("aria-label"));var G=this.session.$gutterCustomWidgets[d];if(G?this.$addCustomWidget(d,G,i):E&&this.$removeCustomWidget(d,i),H&&this.$showFoldedAnnotations){v.className="ace_gutter_annotation",D.className=P,D.className+=V,f.setStyle(D.style,"height",S),f.setStyle(v.style,"display","block"),f.setStyle(v.style,"height",S);var K;switch(V){case" ace_error_fold":K=r("gutter.annotation.aria-label.error","Error, read annotations row $0",[N]);break;case" ace_security_fold":K=r("gutter.annotation.aria-label.security","Security finding, read annotations row $0",[N]);break;case" ace_warning_fold":K=r("gutter.annotation.aria-label.warning","Warning, read annotations row $0",[N]);break}v.setAttribute("aria-label",K),v.setAttribute("tabindex","-1"),v.setAttribute("role","button")}else if(this.$annotations[d]){v.className="ace_gutter_annotation",D.className=P,this.$useSvgGutterIcons?D.className+=this.$annotations[d].className:_.classList.add(this.$annotations[d].className.replace(" ","")),f.setStyle(D.style,"height",S),f.setStyle(v.style,"display","block"),f.setStyle(v.style,"height",S);var K;switch(this.$annotations[d].className){case" ace_error":K=r("gutter.annotation.aria-label.error","Error, read annotations row $0",[N]);break;case" ace_security":K=r("gutter.annotation.aria-label.security","Security finding, read annotations row $0",[N]);break;case" ace_warning":K=r("gutter.annotation.aria-label.warning","Warning, read annotations row $0",[N]);break;case" ace_info":K=r("gutter.annotation.aria-label.info","Info, read annotations row $0",[N]);break;case" ace_hint":K=r("gutter.annotation.aria-label.hint","Suggestion, read annotations row $0",[N]);break}v.setAttribute("aria-label",K),v.setAttribute("tabindex","-1"),v.setAttribute("role","button")}else f.setStyle(v.style,"display","none"),v.removeAttribute("aria-label"),v.removeAttribute("role"),v.setAttribute("tabindex","0");return N!==M.data&&(M.data=N),_.className!=T&&(_.className=T),f.setStyle(i.element.style,"height",this.$lines.computeLineHeight(d,c,C)+"px"),f.setStyle(i.element.style,"top",this.$lines.computeLineTop(d,c,C)+"px"),i.text=N,v.style.display==="none"&&b.style.display==="none"&&!G?i.element.setAttribute("aria-hidden",!0):i.element.setAttribute("aria-hidden",!1),i},o.prototype.setHighlightGutterLine=function(i){this.$highlightGutterLine=i,!i&&this.$highlightElement&&(this.$highlightElement.remove(),this.$highlightElement=null)},o.prototype.setShowLineNumbers=function(i){this.$renderer=!i&&{getWidth:function(){return 0},getText:function(){return""}}},o.prototype.getShowLineNumbers=function(){return this.$showLineNumbers},o.prototype.setShowFoldWidgets=function(i){i?f.addCssClass(this.element,"ace_folding-enabled"):f.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=i,this.$padding=null},o.prototype.getShowFoldWidgets=function(){return this.$showFoldWidgets},o.prototype.$hideFoldWidget=function(i,c){var h=c||this.$getGutterCell(i);if(h&&h.element){var d=h.element.childNodes[1];d&&f.setStyle(d.style,"display","none")}},o.prototype.$showFoldWidget=function(i,c){var h=c||this.$getGutterCell(i);if(h&&h.element){var d=h.element.childNodes[1];d&&this.session.foldWidgets&&this.session.foldWidgets[h.row]&&f.setStyle(d.style,"display","inline-block")}},o.prototype.$getGutterCell=function(i){var c=this.$lines.cells,h=0,d=c.length-1;if(!(i<c[0].row||i>c[d].row)){for(;h<=d;){var _=Math.floor((h+d)/2),C=c[_];if(C.row>i)d=_-1;else if(C.row<i)h=_+1;else return C}return C}},o.prototype.$addCustomWidget=function(i,c,h){var d=c.className,_=c.label,C=c.title,M=c.callbacks;this.session.$gutterCustomWidgets[i]={className:d,label:_,title:C,callbacks:M},this.$hideFoldWidget(i,h);var b=h||this.$getGutterCell(i);if(b&&b.element){var v=b.element.querySelector(".ace_custom-widget");v&&v.remove(),v=f.createElement("span"),v.className="ace_custom-widget ".concat(d),v.setAttribute("tabindex","-1"),v.setAttribute("role","button"),v.setAttribute("aria-label",_),v.setAttribute("title",C),f.setStyle(v.style,"display","inline-block"),f.setStyle(v.style,"height","inherit"),M&&M.onClick&&v.addEventListener("click",function(E){M.onClick(E,i),E.stopPropagation()}),b.element.appendChild(v)}},o.prototype.$removeCustomWidget=function(i,c){delete this.session.$gutterCustomWidgets[i],this.$showFoldWidget(i,c);var h=c||this.$getGutterCell(i);if(h&&h.element){var d=h.element.querySelector(".ace_custom-widget");d&&h.element.removeChild(d)}},o.prototype.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var i=f.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(i.borderLeftWidth)||0)+(parseInt(i.paddingLeft)||0)+1,this.$padding.right=(parseInt(i.borderRightWidth)||0)+(parseInt(i.paddingRight)||0),this.$padding},o.prototype.getRegion=function(i){var c=this.$padding||this.$computePadding(),h=this.element.getBoundingClientRect();if(i.x<c.left+h.left)return"markers";if(this.$showFoldWidgets&&i.x>h.right-c.right)return"foldWidgets"},o}();a.prototype.$fixedWidth=!1,a.prototype.$highlightGutterLine=!0,a.prototype.$renderer=void 0,a.prototype.$showLineNumbers=!0,a.prototype.$showFoldWidgets=!0,y.implement(a.prototype,l);function s(o){var i=document.createTextNode("");o.appendChild(i);var c=f.createElement("span");o.appendChild(c);var h=f.createElement("span");o.appendChild(h);var d=f.createElement("span");return h.appendChild(d),o}n.Gutter=a}),ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(t,n,p){var f=t("../range").Range,y=t("../lib/dom"),m=function(){function u(r){this.element=y.createElement("div"),this.element.className="ace_layer ace_marker-layer",r.appendChild(this.element)}return u.prototype.setPadding=function(r){this.$padding=r},u.prototype.setSession=function(r){this.session=r},u.prototype.setMarkers=function(r){this.markers=r},u.prototype.elt=function(r,a){var s=this.i!=-1&&this.element.childNodes[this.i];s?this.i++:(s=document.createElement("div"),this.element.appendChild(s),this.i=-1),s.style.cssText=a,s.className=r},u.prototype.update=function(r){if(r){this.config=r,this.i=0;var a;for(var s in this.markers){var o=this.markers[s];if(!o.range){o.update(a,this,this.session,r);continue}var i=o.range.clipRows(r.firstRow,r.lastRow);if(!i.isEmpty())if(i=i.toScreenRange(this.session),o.renderer){var c=this.$getTop(i.start.row,r),h=this.$padding+i.start.column*r.characterWidth;o.renderer(a,i,h,c,r)}else o.type=="fullLine"?this.drawFullLineMarker(a,i,o.clazz,r):o.type=="screenLine"?this.drawScreenLineMarker(a,i,o.clazz,r):i.isMultiLine()?o.type=="text"?this.drawTextMarker(a,i,o.clazz,r):this.drawMultiLineMarker(a,i,o.clazz,r):this.drawSingleLineMarker(a,i,o.clazz+" ace_start ace_br15",r)}if(this.i!=-1)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}},u.prototype.$getTop=function(r,a){return(r-a.firstRowScreen)*a.lineHeight},u.prototype.drawTextMarker=function(r,a,s,o,i){for(var c=this.session,h=a.start.row,d=a.end.row,_=h,C=0,M=0,b=c.getScreenLastRowColumn(_),v=new f(_,a.start.column,_,M);_<=d;_++)v.start.row=v.end.row=_,v.start.column=_==h?a.start.column:c.getRowWrapIndent(_),v.end.column=b,C=M,M=b,b=_+1<d?c.getScreenLastRowColumn(_+1):_==d?0:a.end.column,this.drawSingleLineMarker(r,v,s+(_==h?" ace_start":"")+" ace_br"+l(_==h||_==h+1&&a.start.column,C<M,M>b,_==d),o,_==d?0:1,i)},u.prototype.drawMultiLineMarker=function(r,a,s,o,i){var c=this.$padding,h=o.lineHeight,d=this.$getTop(a.start.row,o),_=c+a.start.column*o.characterWidth;if(i=i||"",this.session.$bidiHandler.isBidiRow(a.start.row)){var C=a.clone();C.end.row=C.start.row,C.end.column=this.session.getLine(C.start.row).length,this.drawBidiSingleLineMarker(r,C,s+" ace_br1 ace_start",o,null,i)}else this.elt(s+" ace_br1 ace_start","height:"+h+"px;right:"+c+"px;top:"+d+"px;left:"+_+"px;"+(i||""));if(this.session.$bidiHandler.isBidiRow(a.end.row)){var C=a.clone();C.start.row=C.end.row,C.start.column=0,this.drawBidiSingleLineMarker(r,C,s+" ace_br12",o,null,i)}else{d=this.$getTop(a.end.row,o);var M=a.end.column*o.characterWidth;this.elt(s+" ace_br12","height:"+h+"px;width:"+M+"px;top:"+d+"px;left:"+c+"px;"+(i||""))}if(h=(a.end.row-a.start.row-1)*o.lineHeight,!(h<=0)){d=this.$getTop(a.start.row+1,o);var b=(a.start.column?1:0)|(a.end.column?0:8);this.elt(s+(b?" ace_br"+b:""),"height:"+h+"px;right:"+c+"px;top:"+d+"px;left:"+c+"px;"+(i||""))}},u.prototype.drawSingleLineMarker=function(r,a,s,o,i,c){if(this.session.$bidiHandler.isBidiRow(a.start.row))return this.drawBidiSingleLineMarker(r,a,s,o,i,c);var h=o.lineHeight,d=(a.end.column+(i||0)-a.start.column)*o.characterWidth,_=this.$getTop(a.start.row,o),C=this.$padding+a.start.column*o.characterWidth;this.elt(s,"height:"+h+"px;width:"+d+"px;top:"+_+"px;left:"+C+"px;"+(c||""))},u.prototype.drawBidiSingleLineMarker=function(r,a,s,o,i,c){var h=o.lineHeight,d=this.$getTop(a.start.row,o),_=this.$padding,C=this.session.$bidiHandler.getSelections(a.start.column,a.end.column);C.forEach(function(M){this.elt(s,"height:"+h+"px;width:"+(M.width+(i||0))+"px;top:"+d+"px;left:"+(_+M.left)+"px;"+(c||""))},this)},u.prototype.drawFullLineMarker=function(r,a,s,o,i){var c=this.$getTop(a.start.row,o),h=o.lineHeight;a.start.row!=a.end.row&&(h+=this.$getTop(a.end.row,o)-c),this.elt(s,"height:"+h+"px;top:"+c+"px;left:0;right:0;"+(i||""))},u.prototype.drawScreenLineMarker=function(r,a,s,o,i){var c=this.$getTop(a.start.row,o),h=o.lineHeight;this.elt(s,"height:"+h+"px;top:"+c+"px;left:0;right:0;"+(i||""))},u}();m.prototype.$padding=0;function l(u,r,a,s){return(u?1:0)|(r?2:0)|(a?4:0)|(s?8:0)}n.Marker=m}),ace.define("ace/layer/text_util",["require","exports","module"],function(t,n,p){var f=new Set(["text","rparen","lparen"]);n.isTextToken=function(y){return f.has(y)}}),ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/layer/lines","ace/lib/event_emitter","ace/config","ace/layer/text_util"],function(t,n,p){var f=t("../lib/oop"),y=t("../lib/dom"),m=t("../lib/lang"),l=t("./lines").Lines,u=t("../lib/event_emitter").EventEmitter,r=t("../config").nls,a=t("./text_util").isTextToken,s=function(){function o(i){this.dom=y,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",i.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new l(this.element)}return o.prototype.$updateEolChar=function(){var i=this.session.doc,c=i.getNewLineCharacter()==`
`&&i.getNewLineMode()!="windows",h=c?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=h)return this.EOL_CHAR=h,!0},o.prototype.setPadding=function(i){this.$padding=i,this.element.style.margin="0 "+i+"px"},o.prototype.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},o.prototype.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},o.prototype.$setFontMetrics=function(i){this.$fontMetrics=i,this.$fontMetrics.on("changeCharacterSize",function(c){this._signal("changeCharacterSize",c)}.bind(this)),this.$pollSizeChanges()},o.prototype.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},o.prototype.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},o.prototype.setSession=function(i){this.session=i,i&&this.$computeTabString()},o.prototype.setShowInvisibles=function(i){return this.showInvisibles==i?!1:(this.showInvisibles=i,typeof i=="string"?(this.showSpaces=/tab/i.test(i),this.showTabs=/space/i.test(i),this.showEOL=/eol/i.test(i)):this.showSpaces=this.showTabs=this.showEOL=i,this.$computeTabString(),!0)},o.prototype.setDisplayIndentGuides=function(i){return this.displayIndentGuides==i?!1:(this.displayIndentGuides=i,this.$computeTabString(),!0)},o.prototype.setHighlightIndentGuides=function(i){return this.$highlightIndentGuides===i?!1:(this.$highlightIndentGuides=i,i)},o.prototype.$computeTabString=function(){var i=this.session.getTabSize();this.tabSize=i;for(var c=this.$tabStrings=[0],h=1;h<i+1;h++)if(this.showTabs){var d=this.dom.createElement("span");d.className="ace_invisible ace_invisible_tab",d.textContent=m.stringRepeat(this.TAB_CHAR,h),c.push(d)}else c.push(this.dom.createTextNode(m.stringRepeat(" ",h),this.element));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var _="ace_indent-guide",C=this.showSpaces?" ace_invisible ace_invisible_space":"",M=this.showSpaces?m.stringRepeat(this.SPACE_CHAR,this.tabSize):m.stringRepeat(" ",this.tabSize),b=this.showTabs?" ace_invisible ace_invisible_tab":"",v=this.showTabs?m.stringRepeat(this.TAB_CHAR,this.tabSize):M,d=this.dom.createElement("span");d.className=_+C,d.textContent=M,this.$tabStrings[" "]=d;var d=this.dom.createElement("span");d.className=_+b,d.textContent=v,this.$tabStrings["	"]=d}},o.prototype.updateLines=function(i,c,h){if(this.config.lastRow!=i.lastRow||this.config.firstRow!=i.firstRow)return this.update(i);this.config=i;for(var d=Math.max(c,i.firstRow),_=Math.min(h,i.lastRow),C=this.element.childNodes,M=0,v=i.firstRow;v<d;v++){var E=this.session.getFoldLine(v);if(E)if(E.containsRow(d)){d=E.start.row;break}else v=E.end.row;M++}for(var b=!1,v=d,E=this.session.getNextFoldLine(v),D=E?E.start.row:1/0;v>D&&(v=E.end.row+1,E=this.session.getNextFoldLine(v,E),D=E?E.start.row:1/0),!(v>_);){var L=C[M++];if(L){this.dom.removeChildren(L),this.$renderLine(L,v,v==D?E:!1),b&&(L.style.top=this.$lines.computeLineTop(v,i,this.session)+"px");var w=i.lineHeight*this.session.getRowLength(v)+"px";L.style.height!=w&&(b=!0,L.style.height=w)}v++}if(b)for(;M<this.$lines.cells.length;){var I=this.$lines.cells[M++];I.element.style.top=this.$lines.computeLineTop(I.row,i,this.session)+"px"}},o.prototype.scrollLines=function(i){var c=this.config;if(this.config=i,this.$lines.pageChanged(c,i))return this.update(i);this.$lines.moveContainer(i);var h=i.lastRow,d=c?c.lastRow:-1;if(!c||d<i.firstRow)return this.update(i);if(h<c.firstRow)return this.update(i);if(!c||c.lastRow<i.firstRow)return this.update(i);if(i.lastRow<c.firstRow)return this.update(i);if(c.firstRow<i.firstRow)for(var _=this.session.getFoldedRowCount(c.firstRow,i.firstRow-1);_>0;_--)this.$lines.shift();if(c.lastRow>i.lastRow)for(var _=this.session.getFoldedRowCount(i.lastRow+1,c.lastRow);_>0;_--)this.$lines.pop();i.firstRow<c.firstRow&&this.$lines.unshift(this.$renderLinesFragment(i,i.firstRow,c.firstRow-1)),i.lastRow>c.lastRow&&this.$lines.push(this.$renderLinesFragment(i,c.lastRow+1,i.lastRow)),this.$highlightIndentGuide()},o.prototype.$renderLinesFragment=function(i,c,h){for(var d=[],_=c,C=this.session.getNextFoldLine(_),M=C?C.start.row:1/0;_>M&&(_=C.end.row+1,C=this.session.getNextFoldLine(_,C),M=C?C.start.row:1/0),!(_>h);){var b=this.$lines.createCell(_,i,this.session),v=b.element;this.dom.removeChildren(v),y.setStyle(v.style,"height",this.$lines.computeLineHeight(_,i,this.session)+"px"),y.setStyle(v.style,"top",this.$lines.computeLineTop(_,i,this.session)+"px"),this.$renderLine(v,_,_==M?C:!1),this.$useLineGroups()?v.className="ace_line_group":v.className="ace_line",d.push(b),_++}return d},o.prototype.update=function(i){this.$lines.moveContainer(i),this.config=i;for(var c=i.firstRow,h=i.lastRow,d=this.$lines;d.getLength();)d.pop();d.push(this.$renderLinesFragment(i,c,h))},o.prototype.$renderToken=function(i,c,h,d){for(var _=this,C=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC\u2066\u2067\u2068\u202A\u202B\u202D\u202E\u202C\u2069\u2060\u2061\u2062\u2063\u2064\u206A\u206B\u206B\u206C\u206D\u206E\u206F]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,M=this.dom.createFragment(this.element),b,v=0;b=C.exec(d);){var E=b[1],D=b[2],L=b[3],w=b[4],I=b[5];if(!(!_.showSpaces&&D)){var R=v!=b.index?d.slice(v,b.index):"";if(v=b.index+b[0].length,R&&M.appendChild(this.dom.createTextNode(R,this.element)),E){var A=_.session.getScreenTabSize(c+b.index),x=_.$tabStrings[A].cloneNode(!0);x.charCount=1,M.appendChild(x),c+=A-1}else if(D)if(_.showSpaces){var S=this.dom.createElement("span");S.className="ace_invisible ace_invisible_space",S.textContent=m.stringRepeat(_.SPACE_CHAR,D.length),M.appendChild(S)}else M.appendChild(this.dom.createTextNode(D,this.element));else if(L){var S=this.dom.createElement("span");S.className="ace_invisible ace_invisible_space ace_invalid",S.textContent=m.stringRepeat(_.SPACE_CHAR,L.length),M.appendChild(S)}else if(w){c+=1;var S=this.dom.createElement("span");S.style.width=_.config.characterWidth*2+"px",S.className=_.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",S.textContent=_.showSpaces?_.SPACE_CHAR:w,M.appendChild(S)}else if(I){c+=1;var S=this.dom.createElement("span");S.style.width=_.config.characterWidth*2+"px",S.className="ace_cjk",S.textContent=I,M.appendChild(S)}}}if(M.appendChild(this.dom.createTextNode(v?d.slice(v):d,this.element)),a(h.type))i.appendChild(M);else{var T="ace_"+h.type.replace(/\./g," ace_"),S=this.dom.createElement("span");h.type=="fold"&&(S.style.width=h.value.length*this.config.characterWidth+"px",S.setAttribute("title",r("inline-fold.closed.title","Unfold code"))),S.className=T,S.appendChild(M),i.appendChild(S)}return c+d.length},o.prototype.renderIndentGuide=function(i,c,h){var d=c.search(this.$indentGuideRe);if(d<=0||d>=h)return c;if(c[0]==" "){d-=d%this.tabSize;for(var _=d/this.tabSize,C=0;C<_;C++)i.appendChild(this.$tabStrings[" "].cloneNode(!0));return this.$highlightIndentGuide(),c.substr(d)}else if(c[0]=="	"){for(var C=0;C<d;C++)i.appendChild(this.$tabStrings["	"].cloneNode(!0));return this.$highlightIndentGuide(),c.substr(d)}return this.$highlightIndentGuide(),c},o.prototype.$highlightIndentGuide=function(){if(!(!this.$highlightIndentGuides||!this.displayIndentGuides)){this.$highlightIndentGuideMarker={indentLevel:void 0,start:void 0,end:void 0,dir:void 0};var i=this.session.doc.$lines;if(i){var c=this.session.selection.getCursor(),h=/^\s*/.exec(this.session.doc.getLine(c.row))[0].length,d=Math.floor(h/this.tabSize);this.$highlightIndentGuideMarker={indentLevel:d,start:c.row};var _=this.session.$bracketHighlight;if(_){for(var C=this.session.$bracketHighlight.ranges,M=0;M<C.length;M++)if(c.row!==C[M].start.row){this.$highlightIndentGuideMarker.end=C[M].start.row+1,c.row>C[M].start.row?this.$highlightIndentGuideMarker.dir=-1:this.$highlightIndentGuideMarker.dir=1;break}}if(!this.$highlightIndentGuideMarker.end&&i[c.row]!==""&&c.column===i[c.row].length){this.$highlightIndentGuideMarker.dir=1;for(var M=c.row+1;M<i.length;M++){var b=i[M],v=/^\s*/.exec(b)[0].length;if(b!==""&&(this.$highlightIndentGuideMarker.end=M,v<=h))break}}this.$renderHighlightIndentGuide()}}},o.prototype.$clearActiveIndentGuide=function(){for(var i=this.element.querySelectorAll(".ace_indent-guide-active"),c=0;c<i.length;c++)i[c].classList.remove("ace_indent-guide-active")},o.prototype.$setIndentGuideActive=function(i,c){var h=this.session.doc.getLine(i.row);if(h!==""){var d=i.element;if(i.element.classList&&i.element.classList.contains("ace_line_group"))if(i.element.childNodes.length>0)d=i.element.childNodes[0];else return;var _=d.childNodes;if(_){var C=_[c-1];C&&C.classList&&C.classList.contains("ace_indent-guide")&&C.classList.add("ace_indent-guide-active")}}},o.prototype.$renderHighlightIndentGuide=function(){if(this.$lines){var i=this.$lines.cells;this.$clearActiveIndentGuide();var c=this.$highlightIndentGuideMarker.indentLevel;if(c!==0)if(this.$highlightIndentGuideMarker.dir===1)for(var h=0;h<i.length;h++){var d=i[h];if(this.$highlightIndentGuideMarker.end&&d.row>=this.$highlightIndentGuideMarker.start+1){if(d.row>=this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(d,c)}}else for(var h=i.length-1;h>=0;h--){var d=i[h];if(this.$highlightIndentGuideMarker.end&&d.row<this.$highlightIndentGuideMarker.start){if(d.row<this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(d,c)}}}},o.prototype.$createLineElement=function(i){var c=this.dom.createElement("div");return c.className="ace_line",c.style.height=this.config.lineHeight+"px",c},o.prototype.$renderWrappedLine=function(i,c,h){var d=0,_=0,C=h[0],M=0,b=this.$createLineElement();i.appendChild(b);for(var v=0;v<c.length;v++){var E=c[v],D=E.value;if(v==0&&this.displayIndentGuides){if(d=D.length,D=this.renderIndentGuide(b,D,C),!D)continue;d-=D.length}if(d+D.length<C)M=this.$renderToken(b,M,E,D),d+=D.length;else{for(;d+D.length>=C;){M=this.$renderToken(b,M,E,D.substring(0,C-d)),D=D.substring(C-d),d=C,b=this.$createLineElement(),i.appendChild(b);var L=this.dom.createTextNode(m.stringRepeat("",h.indent),this.element);L.charCount=0,b.appendChild(L),_++,M=0,C=h[_]||Number.MAX_VALUE}D.length!=0&&(d+=D.length,M=this.$renderToken(b,M,E,D))}}h[h.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(b,M,null,"",!0)},o.prototype.$renderSimpleLine=function(i,c){for(var h=0,d=0;d<c.length;d++){var _=c[d],C=_.value;if(!(d==0&&this.displayIndentGuides&&(C=this.renderIndentGuide(i,C),!C))){if(h+C.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(i,h,_,C);h=this.$renderToken(i,h,_,C)}}},o.prototype.$renderOverflowMessage=function(i,c,h,d,_){h&&this.$renderToken(i,c,h,d.slice(0,this.MAX_LINE_LENGTH-c));var C=this.dom.createElement("span");C.className="ace_inline_button ace_keyword ace_toggle_wrap",C.textContent=_?"<hide>":"<click to see more...>",i.appendChild(C)},o.prototype.$renderLine=function(i,c,h){if(!h&&h!=!1&&(h=this.session.getFoldLine(c)),h)var d=this.$getFoldLineTokens(c,h);else var d=this.session.getTokens(c);var _=i;if(d.length){var C=this.session.getRowSplitData(c);if(C&&C.length){this.$renderWrappedLine(i,d,C);var _=i.lastChild}else{var _=i;this.$useLineGroups()&&(_=this.$createLineElement(),i.appendChild(_)),this.$renderSimpleLine(_,d)}}else this.$useLineGroups()&&(_=this.$createLineElement(),i.appendChild(_));if(this.showEOL&&_){h&&(c=h.end.row);var M=this.dom.createElement("span");M.className="ace_invisible ace_invisible_eol",M.textContent=c==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,_.appendChild(M)}},o.prototype.$getFoldLineTokens=function(i,c){var h=this.session,d=[];function _(M,b,v){for(var E=0,D=0;D+M[E].value.length<b;)if(D+=M[E].value.length,E++,E==M.length)return;if(D!=b){var L=M[E].value.substring(b-D);L.length>v-b&&(L=L.substring(0,v-b)),d.push({type:M[E].type,value:L}),D=b+L.length,E+=1}for(;D<v&&E<M.length;){var L=M[E].value;L.length+D>v?d.push({type:M[E].type,value:L.substring(0,v-D)}):d.push(M[E]),D+=L.length,E+=1}}var C=h.getTokens(i);return c.walk(function(M,b,v,E,D){M!=null?d.push({type:"fold",value:M}):(D&&(C=h.getTokens(b)),C.length&&_(C,E,v))},c.end.row,this.session.getLine(c.end.row).length),d},o.prototype.$useLineGroups=function(){return this.session.getUseWrapMode()},o}();s.prototype.EOF_CHAR="",s.prototype.EOL_CHAR_LF="",s.prototype.EOL_CHAR_CRLF="",s.prototype.EOL_CHAR=s.prototype.EOL_CHAR_LF,s.prototype.TAB_CHAR="",s.prototype.SPACE_CHAR="",s.prototype.$padding=0,s.prototype.MAX_LINE_LENGTH=1e4,s.prototype.showInvisibles=!1,s.prototype.showSpaces=!1,s.prototype.showTabs=!1,s.prototype.showEOL=!1,s.prototype.displayIndentGuides=!0,s.prototype.$highlightIndentGuides=!0,s.prototype.$tabStrings=[],s.prototype.destroy={},s.prototype.onChangeTabSize=s.prototype.$computeTabString,f.implement(s.prototype,u),n.Text=s}),ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(t,n,p){var f=t("../lib/dom"),y=function(){function m(l){this.element=f.createElement("div"),this.element.className="ace_layer ace_cursor-layer",l.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),f.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)}return m.prototype.$updateOpacity=function(l){for(var u=this.cursors,r=u.length;r--;)f.setStyle(u[r].style,"opacity",l?"":"0")},m.prototype.$startCssAnimation=function(){for(var l=this.cursors,u=l.length;u--;)l[u].style.animationDuration=this.blinkInterval+"ms";this.$isAnimating=!0,setTimeout(function(){this.$isAnimating&&f.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},m.prototype.$stopCssAnimation=function(){this.$isAnimating=!1,f.removeCssClass(this.element,"ace_animate-blinking")},m.prototype.setPadding=function(l){this.$padding=l},m.prototype.setSession=function(l){this.session=l},m.prototype.setBlinking=function(l){l!=this.isBlinking&&(this.isBlinking=l,this.restartTimer())},m.prototype.setBlinkInterval=function(l){l!=this.blinkInterval&&(this.blinkInterval=l,this.restartTimer())},m.prototype.setSmoothBlinking=function(l){l!=this.smoothBlinking&&(this.smoothBlinking=l,f.setCssClass(this.element,"ace_smooth-blinking",l),this.$updateCursors(!0),this.restartTimer())},m.prototype.addCursor=function(){var l=f.createElement("div");return l.className="ace_cursor",this.element.appendChild(l),this.cursors.push(l),l},m.prototype.removeCursor=function(){if(this.cursors.length>1){var l=this.cursors.pop();return l.parentNode.removeChild(l),l}},m.prototype.hideCursor=function(){this.isVisible=!1,f.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},m.prototype.showCursor=function(){this.isVisible=!0,f.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},m.prototype.restartTimer=function(){var l=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&(this.$isSmoothBlinking=!1,f.removeCssClass(this.element,"ace_smooth-blinking")),l(!0),!this.isBlinking||!this.blinkInterval||!this.isVisible){this.$stopCssAnimation();return}if(this.smoothBlinking&&(this.$isSmoothBlinking=!0,setTimeout(function(){this.$isSmoothBlinking&&f.addCssClass(this.element,"ace_smooth-blinking")}.bind(this))),f.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var u=function(){this.timeoutId=setTimeout(function(){l(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){l(!0),u()},this.blinkInterval),u()}},m.prototype.getPixelPosition=function(l,u){if(!this.config||!this.session)return{left:0,top:0};l||(l=this.session.selection.getCursor());var r=this.session.documentToScreenPosition(l),a=this.$padding+(this.session.$bidiHandler.isBidiRow(r.row,l.row)?this.session.$bidiHandler.getPosLeft(r.column):r.column*this.config.characterWidth),s=(r.row-(u?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:a,top:s}},m.prototype.isCursorInView=function(l,u){return l.top>=0&&l.top<u.maxHeight},m.prototype.update=function(l){this.config=l;var u=this.session.$selectionMarkers,r=0,a=0;(u===void 0||u.length===0)&&(u=[{cursor:null}]);for(var r=0,s=u.length;r<s;r++){var o=this.getPixelPosition(u[r].cursor,!0);if(!((o.top>l.height+l.offset||o.top<0)&&r>1)){var i=this.cursors[a++]||this.addCursor(),c=i.style;this.drawCursor?this.drawCursor(i,o,l,u[r],this.session):this.isCursorInView(o,l)?(f.setStyle(c,"display","block"),f.translate(i,o.left,o.top),f.setStyle(c,"width",Math.round(l.characterWidth)+"px"),f.setStyle(c,"height",l.lineHeight+"px")):f.setStyle(c,"display","none")}}for(;this.cursors.length>a;)this.removeCursor();var h=this.session.getOverwrite();this.$setOverwrite(h),this.$pixelPos=o,this.restartTimer()},m.prototype.$setOverwrite=function(l){l!=this.overwrite&&(this.overwrite=l,l?f.addCssClass(this.element,"ace_overwrite-cursors"):f.removeCssClass(this.element,"ace_overwrite-cursors"))},m.prototype.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)},m}();y.prototype.$padding=0,y.prototype.drawCursor=null,n.Cursor=y}),ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(t,n,p){var f=this&&this.__extends||function(){var i=function(c,h){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,_){d.__proto__=_}||function(d,_){for(var C in _)Object.prototype.hasOwnProperty.call(_,C)&&(d[C]=_[C])},i(c,h)};return function(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");i(c,h);function d(){this.constructor=c}c.prototype=h===null?Object.create(h):(d.prototype=h.prototype,new d)}}(),y=t("./lib/oop"),m=t("./lib/dom"),l=t("./lib/event"),u=t("./lib/event_emitter").EventEmitter,r=32768,a=function(){function i(c,h){this.element=m.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+h,this.inner=m.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent="",this.element.appendChild(this.inner),c.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,l.addListener(this.element,"scroll",this.onScroll.bind(this)),l.addListener(this.element,"mousedown",l.preventDefault)}return i.prototype.setVisible=function(c){this.element.style.display=c?"":"none",this.isVisible=c,this.coeff=1},i}();y.implement(a.prototype,u);var s=function(i){f(c,i);function c(h,d){var _=i.call(this,h,"-v")||this;return _.scrollTop=0,_.scrollHeight=0,d.$scrollbarWidth=_.width=m.scrollbarWidth(h.ownerDocument),_.inner.style.width=_.element.style.width=(_.width||15)+5+"px",_.$minWidth=0,_}return c.prototype.onScroll=function(){if(!this.skipEvent){if(this.scrollTop=this.element.scrollTop,this.coeff!=1){var h=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-h)/(this.coeff-h)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1},c.prototype.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},c.prototype.setHeight=function(h){this.element.style.height=h+"px"},c.prototype.setScrollHeight=function(h){this.scrollHeight=h,h>r?(this.coeff=r/h,h=r):this.coeff!=1&&(this.coeff=1),this.inner.style.height=h+"px"},c.prototype.setScrollTop=function(h){this.scrollTop!=h&&(this.skipEvent=!0,this.scrollTop=h,this.element.scrollTop=h*this.coeff)},c}(a);s.prototype.setInnerHeight=s.prototype.setScrollHeight;var o=function(i){f(c,i);function c(h,d){var _=i.call(this,h,"-h")||this;return _.scrollLeft=0,_.height=d.$scrollbarWidth,_.inner.style.height=_.element.style.height=(_.height||15)+5+"px",_}return c.prototype.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},c.prototype.getHeight=function(){return this.isVisible?this.height:0},c.prototype.setWidth=function(h){this.element.style.width=h+"px"},c.prototype.setInnerWidth=function(h){this.inner.style.width=h+"px"},c.prototype.setScrollWidth=function(h){this.inner.style.width=h+"px"},c.prototype.setScrollLeft=function(h){this.scrollLeft!=h&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=h)},c}(a);n.ScrollBar=s,n.ScrollBarV=s,n.ScrollBarH=o,n.VScrollBar=s,n.HScrollBar=o}),ace.define("ace/scrollbar_custom",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(t,n,p){var f=this&&this.__extends||function(){var o=function(i,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,d){h.__proto__=d}||function(h,d){for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&(h[_]=d[_])},o(i,c)};return function(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(i,c);function h(){this.constructor=i}i.prototype=c===null?Object.create(c):(h.prototype=c.prototype,new h)}}(),y=t("./lib/oop"),m=t("./lib/dom"),l=t("./lib/event"),u=t("./lib/event_emitter").EventEmitter;m.importCssString(`.ace_editor>.ace_sb-v div, .ace_editor>.ace_sb-h div{
  position: absolute;
  background: rgba(128, 128, 128, 0.6);
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  border: 1px solid #bbb;
  border-radius: 2px;
  z-index: 8;
}
.ace_editor>.ace_sb-v, .ace_editor>.ace_sb-h {
  position: absolute;
  z-index: 6;
  background: none;
  overflow: hidden!important;
}
.ace_editor>.ace_sb-v {
  z-index: 6;
  right: 0;
  top: 0;
  width: 12px;
}
.ace_editor>.ace_sb-v div {
  z-index: 8;
  right: 0;
  width: 100%;
}
.ace_editor>.ace_sb-h {
  bottom: 0;
  left: 0;
  height: 12px;
}
.ace_editor>.ace_sb-h div {
  bottom: 0;
  height: 100%;
}
.ace_editor>.ace_sb_grabbed {
  z-index: 8;
  background: #000;
}`,"ace_scrollbar.css",!1);var r=function(){function o(i,c){this.element=m.createElement("div"),this.element.className="ace_sb"+c,this.inner=m.createElement("div"),this.inner.className="",this.element.appendChild(this.inner),this.VScrollWidth=12,this.HScrollHeight=12,i.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,l.addMultiMouseDownListener(this.element,[500,300,300],this,"onMouseDown")}return o.prototype.setVisible=function(i){this.element.style.display=i?"":"none",this.isVisible=i,this.coeff=1},o}();y.implement(r.prototype,u);var a=function(o){f(i,o);function i(c,h){var d=o.call(this,c,"-v")||this;return d.scrollTop=0,d.scrollHeight=0,d.parent=c,d.width=d.VScrollWidth,d.renderer=h,d.inner.style.width=d.element.style.width=(d.width||15)+"px",d.$minWidth=0,d}return i.prototype.onMouseDown=function(c,h){if(c==="mousedown"&&!(l.getButton(h)!==0||h.detail===2)){if(h.target===this.inner){var d=this,_=h.clientY,C=function(w){_=w.clientY},M=function(){clearInterval(D)},b=h.clientY,v=this.thumbTop,E=function(){if(_!==void 0){var w=d.scrollTopFromThumbTop(v+_-b);w!==d.scrollTop&&d._emit("scroll",{data:w})}};l.capture(this.inner,C,M);var D=setInterval(E,20);return l.preventDefault(h)}var L=h.clientY-this.element.getBoundingClientRect().top-this.thumbHeight/2;return this._emit("scroll",{data:this.scrollTopFromThumbTop(L)}),l.preventDefault(h)}},i.prototype.getHeight=function(){return this.height},i.prototype.scrollTopFromThumbTop=function(c){var h=c*(this.pageHeight-this.viewHeight)/(this.slideHeight-this.thumbHeight);return h=h>>0,h<0?h=0:h>this.pageHeight-this.viewHeight&&(h=this.pageHeight-this.viewHeight),h},i.prototype.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},i.prototype.setHeight=function(c){this.height=Math.max(0,c),this.slideHeight=this.height,this.viewHeight=this.height,this.setScrollHeight(this.pageHeight,!0)},i.prototype.setScrollHeight=function(c,h){this.pageHeight===c&&!h||(this.pageHeight=c,this.thumbHeight=this.slideHeight*this.viewHeight/this.pageHeight,this.thumbHeight>this.slideHeight&&(this.thumbHeight=this.slideHeight),this.thumbHeight<15&&(this.thumbHeight=15),this.inner.style.height=this.thumbHeight+"px",this.scrollTop>this.pageHeight-this.viewHeight&&(this.scrollTop=this.pageHeight-this.viewHeight,this.scrollTop<0&&(this.scrollTop=0),this._emit("scroll",{data:this.scrollTop})))},i.prototype.setScrollTop=function(c){this.scrollTop=c,c<0&&(c=0),this.thumbTop=c*(this.slideHeight-this.thumbHeight)/(this.pageHeight-this.viewHeight),this.inner.style.top=this.thumbTop+"px"},i}(r);a.prototype.setInnerHeight=a.prototype.setScrollHeight;var s=function(o){f(i,o);function i(c,h){var d=o.call(this,c,"-h")||this;return d.scrollLeft=0,d.scrollWidth=0,d.height=d.HScrollHeight,d.inner.style.height=d.element.style.height=(d.height||12)+"px",d.renderer=h,d}return i.prototype.onMouseDown=function(c,h){if(c==="mousedown"&&!(l.getButton(h)!==0||h.detail===2)){if(h.target===this.inner){var d=this,_=h.clientX,C=function(w){_=w.clientX},M=function(){clearInterval(D)},b=h.clientX,v=this.thumbLeft,E=function(){if(_!==void 0){var w=d.scrollLeftFromThumbLeft(v+_-b);w!==d.scrollLeft&&d._emit("scroll",{data:w})}};l.capture(this.inner,C,M);var D=setInterval(E,20);return l.preventDefault(h)}var L=h.clientX-this.element.getBoundingClientRect().left-this.thumbWidth/2;return this._emit("scroll",{data:this.scrollLeftFromThumbLeft(L)}),l.preventDefault(h)}},i.prototype.getHeight=function(){return this.isVisible?this.height:0},i.prototype.scrollLeftFromThumbLeft=function(c){var h=c*(this.pageWidth-this.viewWidth)/(this.slideWidth-this.thumbWidth);return h=h>>0,h<0?h=0:h>this.pageWidth-this.viewWidth&&(h=this.pageWidth-this.viewWidth),h},i.prototype.setWidth=function(c){this.width=Math.max(0,c),this.element.style.width=this.width+"px",this.slideWidth=this.width,this.viewWidth=this.width,this.setScrollWidth(this.pageWidth,!0)},i.prototype.setScrollWidth=function(c,h){this.pageWidth===c&&!h||(this.pageWidth=c,this.thumbWidth=this.slideWidth*this.viewWidth/this.pageWidth,this.thumbWidth>this.slideWidth&&(this.thumbWidth=this.slideWidth),this.thumbWidth<15&&(this.thumbWidth=15),this.inner.style.width=this.thumbWidth+"px",this.scrollLeft>this.pageWidth-this.viewWidth&&(this.scrollLeft=this.pageWidth-this.viewWidth,this.scrollLeft<0&&(this.scrollLeft=0),this._emit("scroll",{data:this.scrollLeft})))},i.prototype.setScrollLeft=function(c){this.scrollLeft=c,c<0&&(c=0),this.thumbLeft=c*(this.slideWidth-this.thumbWidth)/(this.pageWidth-this.viewWidth),this.inner.style.left=this.thumbLeft+"px"},i}(r);s.prototype.setInnerWidth=s.prototype.setScrollWidth,n.ScrollBar=a,n.ScrollBarV=a,n.ScrollBarH=s,n.VScrollBar=a,n.HScrollBar=s}),ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],function(t,n,p){var f=t("./lib/event"),y=function(){function m(l,u){this.onRender=l,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=u||window;var r=this;this._flush=function(a){r.pending=!1;var s=r.changes;if(s&&(f.blockIdle(100),r.changes=0,r.onRender(s)),r.changes){if(r.$recursionLimit--<0)return;r.schedule()}else r.$recursionLimit=2}}return m.prototype.schedule=function(l){this.changes=this.changes|l,this.changes&&!this.pending&&(f.nextFrame(this._flush),this.pending=!0)},m.prototype.clear=function(l){var u=this.changes;return this.changes=0,u},m}();n.RenderLoop=y}),ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/lib/useragent","ace/lib/event_emitter"],function(t,n,p){var f=t("../lib/oop"),y=t("../lib/dom"),m=t("../lib/lang"),l=t("../lib/event"),u=t("../lib/useragent"),r=t("../lib/event_emitter").EventEmitter,a=512,s=typeof ResizeObserver=="function",o=200,i=function(){function c(h){this.el=y.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=y.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=y.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),h.appendChild(this.el),this.$measureNode.textContent=m.stringRepeat("X",a),this.$characterSize={width:0,height:0},s?this.$addObserver():this.checkForSizeChanges()}return c.prototype.$setMeasureNodeStyles=function(h,d){h.width=h.height="auto",h.left=h.top="0px",h.visibility="hidden",h.position="absolute",h.whiteSpace="pre",u.isIE<8?h["font-family"]="inherit":h.font="inherit",h.overflow=d?"hidden":"visible"},c.prototype.checkForSizeChanges=function(h){if(h===void 0&&(h=this.$measureSizes()),h&&(this.$characterSize.width!==h.width||this.$characterSize.height!==h.height)){this.$measureNode.style.fontWeight="bold";var d=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=h,this.charSizes=Object.create(null),this.allowBoldFonts=d&&d.width===h.width&&d.height===h.height,this._emit("changeCharacterSize",{data:h})}},c.prototype.$addObserver=function(){var h=this;this.$observer=new window.ResizeObserver(function(d){h.checkForSizeChanges()}),this.$observer.observe(this.$measureNode)},c.prototype.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var h=this;return this.$pollSizeChangesTimer=l.onIdle(function d(){h.checkForSizeChanges(),l.onIdle(d,500)},500)},c.prototype.setPolling=function(h){h?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},c.prototype.$measureSizes=function(h){var d={height:(h||this.$measureNode).clientHeight,width:(h||this.$measureNode).clientWidth/a};return d.width===0||d.height===0?null:d},c.prototype.$measureCharWidth=function(h){this.$main.textContent=m.stringRepeat(h,a);var d=this.$main.getBoundingClientRect();return d.width/a},c.prototype.getCharacterWidth=function(h){var d=this.charSizes[h];return d===void 0&&(d=this.charSizes[h]=this.$measureCharWidth(h)/this.$characterSize.width),d},c.prototype.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},c.prototype.$getZoom=function(h){return!h||!h.parentElement?1:(Number(window.getComputedStyle(h).zoom)||1)*this.$getZoom(h.parentElement)},c.prototype.$initTransformMeasureNodes=function(){var h=function(d,_){return["div",{style:"position: absolute;top:"+d+"px;left:"+_+"px;"}]};this.els=y.buildDom([h(0,0),h(o,0),h(0,o),h(o,o)],this.el)},c.prototype.transformCoordinates=function(h,d){if(h){var _=this.$getZoom(this.el);h=v(1/_,h)}function C(O,$,V){var H=O[1]*$[0]-O[0]*$[1];return[(-$[1]*V[0]+$[0]*V[1])/H,(+O[1]*V[0]-O[0]*V[1])/H]}function M(O,$){return[O[0]-$[0],O[1]-$[1]]}function b(O,$){return[O[0]+$[0],O[1]+$[1]]}function v(O,$){return[O*$[0],O*$[1]]}this.els||this.$initTransformMeasureNodes();function E(O){var $=O.getBoundingClientRect();return[$.left,$.top]}var D=E(this.els[0]),L=E(this.els[1]),w=E(this.els[2]),I=E(this.els[3]),R=C(M(I,L),M(I,w),M(b(L,w),b(I,D))),A=v(1+R[0],M(L,D)),x=v(1+R[1],M(w,D));if(d){var S=d,T=R[0]*S[0]/o+R[1]*S[1]/o+1,P=b(v(S[0],A),v(S[1],x));return b(v(1/T/o,P),D)}var N=M(h,D),k=C(M(A,v(R[0],N)),M(x,v(R[1],N)),N);return v(o,k)},c}();i.prototype.$characterSize={width:0,height:0},f.implement(i.prototype,r),n.FontMetrics=i}),ace.define("ace/css/editor-css",["require","exports","module"],function(t,n,p){p.exports=`
.ace_br1 {border-top-left-radius    : 3px;}
.ace_br2 {border-top-right-radius   : 3px;}
.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}
.ace_br4 {border-bottom-right-radius: 3px;}
.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}
.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}
.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}
.ace_br8 {border-bottom-left-radius : 3px;}
.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}
.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}
.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}
.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}


.ace_editor {
    position: relative;
    overflow: hidden;
    padding: 0;
    font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'Source Code Pro', 'source-code-pro', monospace;
    direction: ltr;
    text-align: left;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    forced-color-adjust: none;
}

.ace_scroller {
    position: absolute;
    overflow: hidden;
    top: 0;
    bottom: 0;
    background-color: inherit;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    cursor: text;
}

.ace_content {
    position: absolute;
    box-sizing: border-box;
    min-width: 100%;
    contain: style size layout;
    font-variant-ligatures: no-common-ligatures;
}
.ace_invisible {
    font-variant-ligatures: none;
}

.ace_keyboard-focus:focus {
    box-shadow: inset 0 0 0 2px #5E9ED6;
    outline: none;
}

.ace_dragging .ace_scroller:before{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    content: '';
    background: rgba(250, 250, 250, 0.01);
    z-index: 1000;
}
.ace_dragging.ace_dark .ace_scroller:before{
    background: rgba(0, 0, 0, 0.01);
}

.ace_gutter {
    position: absolute;
    overflow : hidden;
    width: auto;
    top: 0;
    bottom: 0;
    left: 0;
    cursor: default;
    z-index: 4;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    contain: style size layout;
}

.ace_gutter-active-line {
    position: absolute;
    left: 0;
    right: 0;
}

.ace_scroller.ace_scroll-left:after {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;
    pointer-events: none;
}

.ace_gutter-cell, .ace_gutter-cell_svg-icons {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding-left: 19px;
    padding-right: 6px;
    background-repeat: no-repeat;
}

.ace_gutter-cell_svg-icons .ace_gutter_annotation {
    margin-left: -14px;
    float: left;
}

.ace_gutter-cell .ace_gutter_annotation {
    margin-left: -19px;
    float: left;
}

.ace_gutter-cell.ace_error, .ace_icon.ace_error, .ace_icon.ace_error_fold, .ace_gutter-cell.ace_security, .ace_icon.ace_security, .ace_icon.ace_security_fold {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: 2px center;
}

.ace_gutter-cell.ace_warning, .ace_icon.ace_warning, .ace_icon.ace_warning_fold {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: 2px center;
}

.ace_gutter-cell.ace_info, .ace_icon.ace_info, .ace_gutter-cell.ace_hint, .ace_icon.ace_hint {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");
    background-repeat: no-repeat;
    background-position: 2px center;
}

.ace_dark .ace_gutter-cell.ace_info, .ace_dark .ace_icon.ace_info, .ace_dark .ace_gutter-cell.ace_hint, .ace_dark .ace_icon.ace_hint {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");
}

.ace_icon_svg.ace_error {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJyZWQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KPGNpcmNsZSBmaWxsPSJub25lIiBjeD0iOCIgY3k9IjgiIHI9IjciIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPGxpbmUgeDE9IjExIiB5MT0iNSIgeDI9IjUiIHkyPSIxMSIvPgo8bGluZSB4MT0iMTEiIHkxPSIxMSIgeDI9IjUiIHkyPSI1Ii8+CjwvZz4KPC9zdmc+");
    background-color: crimson;
}
.ace_icon_svg.ace_security {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjAgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8ZyBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0iZGFya29yYW5nZSIgZmlsbD0ibm9uZSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgogICAgICAgIDxwYXRoIGNsYXNzPSJzdHJva2UtbGluZWpvaW4tcm91bmQiIGQ9Ik04IDE0LjgzMDdDOCAxNC44MzA3IDIgMTIuOTA0NyAyIDguMDg5OTJWMy4yNjU0OEM1LjMxIDMuMjY1NDggNy45ODk5OSAxLjM0OTE4IDcuOTg5OTkgMS4zNDkxOEM3Ljk4OTk5IDEuMzQ5MTggMTAuNjkgMy4yNjU0OCAxNCAzLjI2NTQ4VjguMDg5OTJDMTQgMTIuOTA0NyA4IDE0LjgzMDcgOCAxNC44MzA3WiIvPgogICAgICAgIDxwYXRoIGQ9Ik0yIDguMDg5OTJWMy4yNjU0OEM1LjMxIDMuMjY1NDggNy45ODk5OSAxLjM0OTE4IDcuOTg5OTkgMS4zNDkxOCIvPgogICAgICAgIDxwYXRoIGQ9Ik0xMy45OSA4LjA4OTkyVjMuMjY1NDhDMTAuNjggMy4yNjU0OCA4IDEuMzQ5MTggOCAxLjM0OTE4Ii8+CiAgICAgICAgPHBhdGggY2xhc3M9InN0cm9rZS1saW5lam9pbi1yb3VuZCIgZD0iTTggNFY5Ii8+CiAgICAgICAgPHBhdGggY2xhc3M9InN0cm9rZS1saW5lam9pbi1yb3VuZCIgZD0iTTggMTBWMTIiLz4KICAgIDwvZz4KPC9zdmc+");
    background-color: crimson;
}
.ace_icon_svg.ace_warning {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJkYXJrb3JhbmdlIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+Cjxwb2x5Z29uIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9Im5vbmUiIHBvaW50cz0iOCAxIDE1IDE1IDEgMTUgOCAxIi8+CjxyZWN0IHg9IjgiIHk9IjEyIiB3aWR0aD0iMC4wMSIgaGVpZ2h0PSIwLjAxIi8+CjxsaW5lIHgxPSI4IiB5MT0iNiIgeDI9IjgiIHkyPSIxMCIvPgo8L2c+Cjwvc3ZnPg==");
    background-color: darkorange;
}
.ace_icon_svg.ace_info {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJibHVlIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+CjxjaXJjbGUgZmlsbD0ibm9uZSIgY3g9IjgiIGN5PSI4IiByPSI3IiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjxwb2x5bGluZSBwb2ludHM9IjggMTEgOCA4Ii8+Cjxwb2x5bGluZSBwb2ludHM9IjkgOCA2IDgiLz4KPGxpbmUgeDE9IjEwIiB5MT0iMTEiIHgyPSI2IiB5Mj0iMTEiLz4KPHJlY3QgeD0iOCIgeT0iNSIgd2lkdGg9IjAuMDEiIGhlaWdodD0iMC4wMSIvPgo8L2c+Cjwvc3ZnPg==");
    background-color: royalblue;
}
.ace_icon_svg.ace_hint {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjAgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8ZyBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0ic2lsdmVyIiBmaWxsPSJub25lIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+CiAgICAgICAgPHBhdGggY2xhc3M9InN0cm9rZS1saW5lam9pbi1yb3VuZCIgZD0iTTYgMTRIMTAiLz4KICAgICAgICA8cGF0aCBkPSJNOCAxMUg5QzkgOS40NzAwMiAxMiA4LjU0MDAyIDEyIDUuNzYwMDJDMTIuMDIgNC40MDAwMiAxMS4zOSAzLjM2MDAyIDEwLjQzIDIuNjcwMDJDOSAxLjY0MDAyIDcuMDAwMDEgMS42NDAwMiA1LjU3MDAxIDIuNjcwMDJDNC42MTAwMSAzLjM2MDAyIDMuOTggNC40MDAwMiA0IDUuNzYwMDJDNCA4LjU0MDAyIDcuMDAwMDEgOS40NzAwMiA3LjAwMDAxIDExSDhaIi8+CiAgICA8L2c+Cjwvc3ZnPg==");
    background-color: silver;
}

.ace_icon_svg.ace_error_fold {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiIgZmlsbD0ibm9uZSI+CiAgPHBhdGggZD0ibSAxOC45Mjk4NTEsNy44Mjk4MDc2IGMgMC4xNDYzNTMsNi4zMzc0NjA0IC02LjMyMzE0Nyw3Ljc3Nzg0NDQgLTcuNDc3OTEyLDcuNzc3ODQ0NCAtMi4xMDcyNzI2LC0wLjEyODc1IDUuMTE3Njc4LDAuMzU2MjQ5IDUuMDUxNjk4LC03Ljg3MDA2MTggLTAuNjA0NjcyLC04LjAwMzk3MzQ5IC03LjA3NzI3MDYsLTcuNTYzMTE4OSAtNC44NTczLC03LjQzMDM5NTU2IDEuNjA2LC0wLjExNTE0MjI1IDYuODk3NDg1LDEuMjYyNTQ1OTYgNy4yODM1MTQsNy41MjI2MTI5NiB6IiBmaWxsPSJjcmltc29uIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0ibSA4LjExNDc1NjIsMi4wNTI5ODI4IGMgMy4zNDkxNjk4LDAgNi4wNjQxMzI4LDIuNjc2ODYyNyA2LjA2NDEzMjgsNS45Nzg5NTMgMCwzLjMwMjExMjIgLTIuNzE0OTYzLDUuOTc4OTIwMiAtNi4wNjQxMzI4LDUuOTc4OTIwMiAtMy4zNDkxNDczLDAgLTYuMDY0MTc3MiwtMi42NzY4MDggLTYuMDY0MTc3MiwtNS45Nzg5MjAyIDAuMDA1MzksLTMuMjk5ODg2MSAyLjcxNzI2NTYsLTUuOTczNjQwOCA2LjA2NDE3NzIsLTUuOTc4OTUzIHogbSAwLC0xLjczNTgyNzE5IGMgLTQuMzIxNDgzNiwwIC03LjgyNDc0MDM4LDMuNDU0MDE4NDkgLTcuODI0NzQwMzgsNy43MTQ3ODAxOSAwLDQuMjYwNzI4MiAzLjUwMzI1Njc4LDcuNzE0NzQ1MiA3LjgyNDc0MDM4LDcuNzE0NzQ1MiA0LjMyMTQ0OTgsMCA3LjgyNDY5OTgsLTMuNDU0MDE3IDcuODI0Njk5OCwtNy43MTQ3NDUyIDAsLTIuMDQ2MDkxNCAtMC44MjQzOTIsLTQuMDA4MzY3MiAtMi4yOTE3NTYsLTUuNDU1MTc0NiBDIDEyLjE4MDIyNSwxLjEyOTk2NDggMTAuMTkwMDEzLDAuMzE3MTU1NjEgOC4xMTQ3NTYyLDAuMzE3MTU1NjEgWiBNIDYuOTM3NDU2Myw4LjI0MDU5ODUgNC42NzE4Njg1LDEwLjQ4NTg1MiA2LjAwODY4MTQsMTEuODc2NzI4IDguMzE3MDAzNSw5LjYwMDc5MTEgMTAuNjI1MzM3LDExLjg3NjcyOCAxMS45NjIxMzgsMTAuNDg1ODUyIDkuNjk2NTUwOCw4LjI0MDU5ODUgMTEuOTYyMTM4LDYuMDA2ODA2NiAxMC41NzMyNDYsNC42Mzc0MzM1IDguMzE3MDAzNSw2Ljg3MzQyOTcgNi4wNjA3NjA3LDQuNjM3NDMzNSA0LjY3MTg2ODUsNi4wMDY4MDY2IFoiIGZpbGw9ImNyaW1zb24iIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=");
    background-color: crimson;
}
.ace_icon_svg.ace_security_fold {
    -webkit-mask-image: url("data:image/svg+xml;base64,CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTcgMTQiIGZpbGw9Im5vbmUiPgogICAgPHBhdGggZD0iTTEwLjAwMDEgMTMuNjk5MkMxMC4wMDAxIDEzLjY5OTIgMTEuOTI0MSAxMy40NzYzIDEzIDEyLjY5OTJDMTQuNDEzOSAxMS42NzgxIDE2IDEwLjUgMTYuMTI1MSA2LjgxMTI2VjIuNTg5ODdDMTYuMTI1MSAyLjU0NzY4IDE2LjEyMjEgMi41MDYxOSAxNi4xMTY0IDIuNDY1NTlWMS43MTQ4NUgxNS4yNDE0TDE1LjIzMDcgMS43MTQ4NEwxNC42MjUxIDEuNjk5MjJWNi44MTEyM0MxNC42MjUxIDguNTEwNjEgMTQuNjI1MSA5LjQ2NDYxIDEyLjc4MjQgMTEuNzIxQzEyLjE1ODYgMTIuNDg0OCAxMC4wMDAxIDEzLjY5OTIgMTAuMDAwMSAxMy42OTkyWiIgZmlsbD0iY3JpbXNvbiIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTcuMzM2MDkgMC4zNjc0NzVDNy4wMzIxNCAwLjE1MjY1MiA2LjYyNTQ4IDAuMTUzNjE0IDYuMzIyNTMgMC4zNjk5OTdMNi4zMDg2OSAwLjM3OTU1NEM2LjI5NTUzIDAuMzg4NTg4IDYuMjczODggMC40MDMyNjYgNi4yNDQxNyAwLjQyMjc4OUM2LjE4NDcxIDAuNDYxODYgNi4wOTMyMSAwLjUyMDE3MSA1Ljk3MzEzIDAuNTkxMzczQzUuNzMyNTEgMC43MzQwNTkgNS4zNzk5IDAuOTI2ODY0IDQuOTQyNzkgMS4xMjAwOUM0LjA2MTQ0IDEuNTA5NyAyLjg3NTQxIDEuODgzNzcgMS41ODk4NCAxLjg4Mzc3SDAuNzE0ODQ0VjIuNzU4NzdWNi45ODAxNUMwLjcxNDg0NCA5LjQ5Mzc0IDIuMjg4NjYgMTEuMTk3MyAzLjcwMjU0IDEyLjIxODVDNC40MTg0NSAxMi43MzU1IDUuMTI4NzQgMTMuMTA1MyA1LjY1NzMzIDEzLjM0NTdDNS45MjI4NCAxMy40NjY0IDYuMTQ1NjYgMTMuNTU1OSA2LjMwNDY1IDEzLjYxNjFDNi4zODQyMyAxMy42NDYyIDYuNDQ4MDUgMTMuNjY5IDYuNDkzNDkgMTMuNjg0OEM2LjUxNjIyIDEzLjY5MjcgNi41MzQzOCAxMy42OTg5IDYuNTQ3NjQgMTMuNzAzM0w2LjU2MzgyIDEzLjcwODdMNi41NjkwOCAxMy43MTA0TDYuNTcwOTkgMTMuNzExTDYuODM5ODQgMTMuNzUzM0w2LjU3MjQyIDEzLjcxMTVDNi43NDYzMyAxMy43NjczIDYuOTMzMzUgMTMuNzY3MyA3LjEwNzI3IDEzLjcxMTVMNy4xMDg3IDEzLjcxMUw3LjExMDYxIDEzLjcxMDRMNy4xMTU4NyAxMy43MDg3TDcuMTMyMDUgMTMuNzAzM0M3LjE0NTMxIDEzLjY5ODkgNy4xNjM0NiAxMy42OTI3IDcuMTg2MTkgMTMuNjg0OEM3LjIzMTY0IDEzLjY2OSA3LjI5NTQ2IDEzLjY0NjIgNy4zNzUwMyAxMy42MTYxQzcuNTM0MDMgMTMuNTU1OSA3Ljc1Njg1IDEzLjQ2NjQgOC4wMjIzNiAxMy4zNDU3QzguNTUwOTUgMTMuMTA1MyA5LjI2MTIzIDEyLjczNTUgOS45NzcxNSAxMi4yMTg1QzExLjM5MSAxMS4xOTczIDEyLjk2NDggOS40OTM3NyAxMi45NjQ4IDYuOTgwMThWMi43NTg4QzEyLjk2NDggMi43MTY2IDEyLjk2MTkgMi42NzUxMSAxMi45NTYxIDIuNjM0NTFWMS44ODM3N0gxMi4wODExQzEyLjA3NzUgMS44ODM3NyAxMi4wNzQgMS44ODM3NyAxMi4wNzA0IDEuODgzNzdDMTAuNzk3OSAxLjg4MDA0IDkuNjE5NjIgMS41MTEwMiA4LjczODk0IDEuMTI0ODZDOC43MzUzNCAxLjEyMzI3IDguNzMxNzQgMS4xMjE2OCA4LjcyODE0IDEuMTIwMDlDOC4yOTEwMyAwLjkyNjg2NCA3LjkzODQyIDAuNzM0MDU5IDcuNjk3NzkgMC41OTEzNzNDNy41Nzc3MiAwLjUyMDE3MSA3LjQ4NjIyIDAuNDYxODYgNy40MjY3NiAwLjQyMjc4OUM3LjM5NzA1IDAuNDAzMjY2IDcuMzc1MzkgMC4zODg1ODggNy4zNjIyNCAwLjM3OTU1NEw3LjM0ODk2IDAuMzcwMzVDNy4zNDg5NiAwLjM3MDM1IDcuMzQ4NDcgMC4zNzAwMiA3LjM0NTYzIDAuMzc0MDU0TDcuMzM3NzkgMC4zNjg2NTlMNy4zMzYwOSAwLjM2NzQ3NVpNOC4wMzQ3MSAyLjcyNjkxQzguODYwNCAzLjA5MDYzIDkuOTYwNjYgMy40NjMwOSAxMS4yMDYxIDMuNTg5MDdWNi45ODAxNUgxMS4yMTQ4QzExLjIxNDggOC42Nzk1MyAxMC4xNjM3IDkuOTI1MDcgOC45NTI1NCAxMC43OTk4QzguMzU1OTUgMTEuMjMwNiA3Ljc1Mzc0IDExLjU0NTQgNy4yOTc5NiAxMS43NTI3QzcuMTE2NzEgMTEuODM1MSA2Ljk2MDYyIDExLjg5OTYgNi44Mzk4NCAxMS45NDY5QzYuNzE5MDYgMTEuODk5NiA2LjU2Mjk3IDExLjgzNTEgNi4zODE3MyAxMS43NTI3QzUuOTI1OTUgMTEuNTQ1NCA1LjMyMzczIDExLjIzMDYgNC43MjcxNSAxMC43OTk4QzMuNTE2MDMgOS45MjUwNyAyLjQ2NDg0IDguNjc5NTUgMi40NjQ4NCA2Ljk4MDE4VjMuNTg5MDlDMy43MTczOCAzLjQ2MjM5IDQuODIzMDggMy4wODYzOSA1LjY1MDMzIDIuNzIwNzFDNi4xNDIyOCAyLjUwMzI0IDYuNTQ0ODUgMi4yODUzNyA2LjgzMjU0IDIuMTE2MjRDNy4xMjE4MSAyLjI4NTM1IDcuNTI3IDIuNTAzNTIgOC4wMjE5NiAyLjcyMTMxQzguMDI2MiAyLjcyMzE3IDguMDMwNDUgMi43MjUwNCA4LjAzNDcxIDIuNzI2OTFaTTUuOTY0ODQgMy40MDE0N1Y3Ljc3NjQ3SDcuNzE0ODRWMy40MDE0N0g1Ljk2NDg0Wk01Ljk2NDg0IDEwLjQwMTVWOC42NTE0N0g3LjcxNDg0VjEwLjQwMTVINS45NjQ4NFoiIGZpbGw9ImNyaW1zb24iIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=");
    background-color: crimson;
}
.ace_icon_svg.ace_warning_fold {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyMCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNC43NzY5IDE0LjczMzdMOC42NTE5MiAyLjQ4MzY5QzguMzI5NDYgMS44Mzg3NyA3LjQwOTEzIDEuODM4NzcgNy4wODY2NyAyLjQ4MzY5TDAuOTYxNjY5IDE0LjczMzdDMC42NzA3NzUgMTUuMzE1NSAxLjA5MzgzIDE2IDEuNzQ0MjkgMTZIMTMuOTk0M0MxNC42NDQ4IDE2IDE1LjA2NzggMTUuMzE1NSAxNC43NzY5IDE0LjczMzdaTTMuMTYwMDcgMTQuMjVMNy44NjkyOSA0LjgzMTU2TDEyLjU3ODUgMTQuMjVIMy4xNjAwN1pNOC43NDQyOSAxMS42MjVWMTMuMzc1SDYuOTk0MjlWMTEuNjI1SDguNzQ0MjlaTTYuOTk0MjkgMTAuNzVWNy4yNUg4Ljc0NDI5VjEwLjc1SDYuOTk0MjlaIiBmaWxsPSIjRUM3MjExIi8+CjxwYXRoIGQ9Ik0xMS4xOTkxIDIuOTUyMzhDMTAuODgwOSAyLjMxNDY3IDEwLjM1MzcgMS44MDUyNiA5LjcwNTUgMS41MDlMMTEuMDQxIDEuMDY5NzhDMTEuNjg4MyAwLjk0OTgxNCAxMi4zMzcgMS4yNzI2MyAxMi42MzE3IDEuODYxNDFMMTcuNjEzNiAxMS44MTYxQzE4LjM1MjcgMTMuMjkyOSAxNy41OTM4IDE1LjA4MDQgMTYuMDE4IDE1LjU3NDVDMTYuNDA0NCAxNC40NTA3IDE2LjMyMzEgMTMuMjE4OCAxNS43OTI0IDEyLjE1NTVMMTEuMTk5MSAyLjk1MjM4WiIgZmlsbD0iI0VDNzIxMSIvPgo8L3N2Zz4=");
    background-color: darkorange;
}

.ace_scrollbar {
    contain: strict;
    position: absolute;
    right: 0;
    bottom: 0;
    z-index: 6;
}

.ace_scrollbar-inner {
    position: absolute;
    cursor: text;
    left: 0;
    top: 0;
}

.ace_scrollbar-v{
    overflow-x: hidden;
    overflow-y: scroll;
    top: 0;
}

.ace_scrollbar-h {
    overflow-x: scroll;
    overflow-y: hidden;
    left: 0;
}

.ace_print-margin {
    position: absolute;
    height: 100%;
}

.ace_text-input {
    position: absolute;
    z-index: 0;
    width: 0.5em;
    height: 1em;
    opacity: 0;
    background: transparent;
    -moz-appearance: none;
    appearance: none;
    border: none;
    resize: none;
    outline: none;
    overflow: hidden;
    font: inherit;
    padding: 0 1px;
    margin: 0 -1px;
    contain: strict;
    -ms-user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text;
    user-select: text;
    /*with \`pre-line\` chrome inserts &nbsp; instead of space*/
    white-space: pre!important;
}
.ace_text-input.ace_composition {
    background: transparent;
    color: inherit;
    z-index: 1000;
    opacity: 1;
}
.ace_composition_placeholder { color: transparent }
.ace_composition_marker { 
    border-bottom: 1px solid;
    position: absolute;
    border-radius: 0;
    margin-top: 1px;
}

[ace_nocontext=true] {
    transform: none!important;
    filter: none!important;
    clip-path: none!important;
    mask : none!important;
    contain: none!important;
    perspective: none!important;
    mix-blend-mode: initial!important;
    z-index: auto;
}

.ace_layer {
    z-index: 1;
    position: absolute;
    overflow: hidden;
    /* workaround for chrome bug https://github.com/ajaxorg/ace/issues/2312*/
    word-wrap: normal;
    white-space: pre;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    /* setting pointer-events: auto; on node under the mouse, which changes
        during scroll, will break mouse wheel scrolling in Safari */
    pointer-events: none;
}

.ace_gutter-layer {
    position: relative;
    width: auto;
    text-align: right;
    pointer-events: auto;
    height: 1000000px;
    contain: style size layout;
}

.ace_text-layer {
    font: inherit !important;
    position: absolute;
    height: 1000000px;
    width: 1000000px;
    contain: style size layout;
}

.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {
    contain: style size layout;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
}

.ace_hidpi .ace_text-layer,
.ace_hidpi .ace_gutter-layer,
.ace_hidpi .ace_content,
.ace_hidpi .ace_gutter {
    contain: strict;
}
.ace_hidpi .ace_text-layer > .ace_line, 
.ace_hidpi .ace_text-layer > .ace_line_group {
    contain: strict;
}

.ace_cjk {
    display: inline-block;
    text-align: center;
}

.ace_cursor-layer {
    z-index: 4;
}

.ace_cursor {
    z-index: 4;
    position: absolute;
    box-sizing: border-box;
    border-left: 2px solid;
    /* workaround for smooth cursor repaintng whole screen in chrome */
    transform: translatez(0);
}

.ace_multiselect .ace_cursor {
    border-left-width: 1px;
}

.ace_slim-cursors .ace_cursor {
    border-left-width: 1px;
}

.ace_overwrite-cursors .ace_cursor {
    border-left-width: 0;
    border-bottom: 1px solid;
}

.ace_hidden-cursors .ace_cursor {
    opacity: 0.2;
}

.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {
    opacity: 0;
}

.ace_smooth-blinking .ace_cursor {
    transition: opacity 0.18s;
}

.ace_animate-blinking .ace_cursor {
    animation-duration: 1000ms;
    animation-timing-function: step-end;
    animation-name: blink-ace-animate;
    animation-iteration-count: infinite;
}

.ace_animate-blinking.ace_smooth-blinking .ace_cursor {
    animation-duration: 1000ms;
    animation-timing-function: ease-in-out;
    animation-name: blink-ace-animate-smooth;
}
    
@keyframes blink-ace-animate {
    from, to { opacity: 1; }
    60% { opacity: 0; }
}

@keyframes blink-ace-animate-smooth {
    from, to { opacity: 1; }
    45% { opacity: 1; }
    60% { opacity: 0; }
    85% { opacity: 0; }
}

.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {
    position: absolute;
    z-index: 3;
}

.ace_marker-layer .ace_selection {
    position: absolute;
    z-index: 5;
}

.ace_marker-layer .ace_bracket {
    position: absolute;
    z-index: 6;
}

.ace_marker-layer .ace_error_bracket {
    position: absolute;
    border-bottom: 1px solid #DE5555;
    border-radius: 0;
}

.ace_marker-layer .ace_active-line {
    position: absolute;
    z-index: 2;
}

.ace_marker-layer .ace_selected-word {
    position: absolute;
    z-index: 4;
    box-sizing: border-box;
}

.ace_line .ace_fold {
    box-sizing: border-box;

    display: inline-block;
    height: 11px;
    margin-top: -2px;
    vertical-align: middle;

    background-image:
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");
    background-repeat: no-repeat, repeat-x;
    background-position: center center, top left;
    color: transparent;

    border: 1px solid black;
    border-radius: 2px;

    cursor: pointer;
    pointer-events: auto;
}

.ace_dark .ace_fold {
}

.ace_fold:hover{
    background-image:
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");
}

.ace_tooltip {
    background-color: #f5f5f5;
    border: 1px solid gray;
    border-radius: 1px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    color: black;
    padding: 3px 4px;
    position: fixed;
    z-index: 999999;
    box-sizing: border-box;
    cursor: default;
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: normal;
    font-style: normal;
    font-weight: normal;
    letter-spacing: normal;
    pointer-events: none;
    overflow: auto;
    max-width: min(33em, 66vw);
    overscroll-behavior: contain;
}
.ace_tooltip pre {
    white-space: pre-wrap;
}

.ace_tooltip.ace_dark {
    background-color: #636363;
    color: #fff;
}

.ace_tooltip:focus {
    outline: 1px solid #5E9ED6;
}

.ace_icon {
    display: inline-block;
    width: 18px;
    vertical-align: top;
}

.ace_icon_svg {
    display: inline-block;
    width: 12px;
    vertical-align: top;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 12px;
    -webkit-mask-position: center;
}

.ace_folding-enabled > .ace_gutter-cell, .ace_folding-enabled > .ace_gutter-cell_svg-icons {
    padding-right: 13px;
}

.ace_fold-widget, .ace_custom-widget {
    box-sizing: border-box;

    margin: 0 -12px 0 1px;
    display: none;
    width: 11px;
    vertical-align: top;

    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: center;

    border-radius: 3px;
    
    border: 1px solid transparent;
    cursor: pointer;
    pointer-events: auto;
}

.ace_custom-widget {
    background: none;
}

.ace_folding-enabled .ace_fold-widget {
    display: inline-block;   
}

.ace_fold-widget.ace_end {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");
}

.ace_fold-widget.ace_closed {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");
}

.ace_fold-widget:hover {
    border: 1px solid rgba(0, 0, 0, 0.3);
    background-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);
}

.ace_fold-widget:active {
    border: 1px solid rgba(0, 0, 0, 0.4);
    background-color: rgba(0, 0, 0, 0.05);
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
}
/**
 * Dark version for fold widgets
 */
.ace_dark .ace_fold-widget {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");
}
.ace_dark .ace_fold-widget.ace_end {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");
}
.ace_dark .ace_fold-widget.ace_closed {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");
}
.ace_dark .ace_fold-widget:hover {
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);
    background-color: rgba(255, 255, 255, 0.1);
}
.ace_dark .ace_fold-widget:active {
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);
}

.ace_inline_button {
    border: 1px solid lightgray;
    display: inline-block;
    margin: -1px 8px;
    padding: 0 5px;
    pointer-events: auto;
    cursor: pointer;
}
.ace_inline_button:hover {
    border-color: gray;
    background: rgba(200,200,200,0.2);
    display: inline-block;
    pointer-events: auto;
}

.ace_fold-widget.ace_invalid {
    background-color: #FFB4B4;
    border-color: #DE5555;
}

.ace_fade-fold-widgets .ace_fold-widget {
    transition: opacity 0.4s ease 0.05s;
    opacity: 0;
}

.ace_fade-fold-widgets:hover .ace_fold-widget {
    transition: opacity 0.05s ease 0.05s;
    opacity:1;
}

.ace_underline {
    text-decoration: underline;
}

.ace_bold {
    font-weight: bold;
}

.ace_nobold .ace_bold {
    font-weight: normal;
}

.ace_italic {
    font-style: italic;
}


.ace_error-marker {
    background-color: rgba(255, 0, 0,0.2);
    position: absolute;
    z-index: 9;
}

.ace_highlight-marker {
    background-color: rgba(255, 255, 0,0.2);
    position: absolute;
    z-index: 8;
}

.ace_mobile-menu {
    position: absolute;
    line-height: 1.5;
    border-radius: 4px;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    background: white;
    box-shadow: 1px 3px 2px grey;
    border: 1px solid #dcdcdc;
    color: black;
}
.ace_dark > .ace_mobile-menu {
    background: #333;
    color: #ccc;
    box-shadow: 1px 3px 2px grey;
    border: 1px solid #444;

}
.ace_mobile-button {
    padding: 2px;
    cursor: pointer;
    overflow: hidden;
}
.ace_mobile-button:hover {
    background-color: #eee;
    opacity:1;
}
.ace_mobile-button:active {
    background-color: #ddd;
}

.ace_placeholder {
    position: relative;
    font-family: arial;
    transform: scale(0.9);
    transform-origin: left;
    white-space: pre;
    opacity: 0.7;
    margin: 0 10px;
    z-index: 1;
}

.ace_ghost_text {
    opacity: 0.5;
    font-style: italic;
}

.ace_ghost_text_container > div {
    white-space: pre;
}

.ghost_text_line_wrapped::after {
    content: "";
    position: absolute;
}

.ace_lineWidgetContainer.ace_ghost_text {
    margin: 0px 4px
}

.ace_screenreader-only {
    position:absolute;
    left:-10000px;
    top:auto;
    width:1px;
    height:1px;
    overflow:hidden;
}

.ace_hidden_token {
    display: none;
}`}),ace.define("ace/layer/decorators",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter"],function(t,n,p){var f=t("../lib/dom"),y=t("../lib/oop"),m=t("../lib/event_emitter").EventEmitter,l=function(){function u(r,a){this.renderer=a,this.pixelRatio=1,this.maxHeight=a.layerConfig.maxHeight,this.lineHeight=a.layerConfig.lineHeight,this.minDecorationHeight=2*this.pixelRatio|0,this.halfMinDecorationHeight=this.minDecorationHeight/2|0,this.colors={},this.colors.dark={error:"rgba(255, 18, 18, 1)",warning:"rgba(18, 136, 18, 1)",info:"rgba(18, 18, 136, 1)"},this.colors.light={error:"rgb(255,51,51)",warning:"rgb(32,133,72)",info:"rgb(35,68,138)"},this.setScrollBarV(r)}return u.prototype.$createCanvas=function(){this.canvas=f.createElement("canvas"),this.canvas.style.top="0px",this.canvas.style.right="0px",this.canvas.style.zIndex="7",this.canvas.style.position="absolute"},u.prototype.setScrollBarV=function(r){this.$createCanvas(),this.scrollbarV=r,r.element.appendChild(this.canvas),this.setDimensions()},u.prototype.$updateDecorators=function(r){if(typeof this.canvas.getContext!="function")return;var a=this.renderer.theme.isDark===!0?this.colors.dark:this.colors.light;this.setDimensions(r);var s=this.canvas.getContext("2d");function o(A,x){return A.priority<x.priority?-1:A.priority>x.priority?1:0}var i=this.renderer.session.$annotations;if(s.clearRect(0,0,this.canvas.width,this.canvas.height),i){var c={info:1,warning:2,error:3};i.forEach(function(A){A.priority=c[A.type]||null}),i=i.sort(o);for(var h=0;h<i.length;h++){var d=i[h].row,_=this.getVerticalOffsetForRow(d),C=_+this.lineHeight,M=Math.round(this.heightRatio*_),b=Math.round(this.heightRatio*C),v=Math.round((M+b)/2),E=b-v;E<this.halfMinDecorationHeight&&(E=this.halfMinDecorationHeight),v-E<0&&(v=E),v+E>this.canvasHeight&&(v=this.canvasHeight-E);var D=v-E,L=v+E,w=L-D;s.fillStyle=a[i[h].type]||null,s.fillRect(0,D,Math.round(this.oneZoneWidth-1),w)}}var I=this.renderer.session.selection.getCursor();if(I){var R=Math.round(this.getVerticalOffsetForRow(I.row)*this.heightRatio);s.fillStyle="rgba(0, 0, 0, 0.5)",s.fillRect(0,R,this.canvasWidth,2)}},u.prototype.getVerticalOffsetForRow=function(r){r=r|0;var a=this.renderer.session.documentToScreenRow(r,0)*this.lineHeight;return a},u.prototype.setDimensions=function(r){r=r||this.renderer.layerConfig,this.maxHeight=r.maxHeight,this.lineHeight=r.lineHeight,this.canvasHeight=r.height,this.canvasWidth=this.scrollbarV.width||this.canvasWidth,this.setZoneWidth(),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.maxHeight<this.canvasHeight?this.heightRatio=1:this.heightRatio=this.canvasHeight/this.maxHeight},u.prototype.setZoneWidth=function(){this.oneZoneWidth=this.canvasWidth},u.prototype.destroy=function(){this.canvas.parentNode.removeChild(this.canvas)},u}();y.implement(l.prototype,m),n.Decorator=l}),ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/scrollbar_custom","ace/scrollbar_custom","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter","ace/css/editor-css","ace/layer/decorators","ace/lib/useragent","ace/layer/text_util"],function(t,n,p){var f=t("./lib/oop"),y=t("./lib/dom"),m=t("./lib/lang"),l=t("./config"),u=t("./layer/gutter").Gutter,r=t("./layer/marker").Marker,a=t("./layer/text").Text,s=t("./layer/cursor").Cursor,o=t("./scrollbar").HScrollBar,i=t("./scrollbar").VScrollBar,c=t("./scrollbar_custom").HScrollBar,h=t("./scrollbar_custom").VScrollBar,d=t("./renderloop").RenderLoop,_=t("./layer/font_metrics").FontMetrics,C=t("./lib/event_emitter").EventEmitter,M=t("./css/editor-css"),b=t("./layer/decorators").Decorator,v=t("./lib/useragent"),E=t("./layer/text_util").isTextToken;y.importCssString(M,"ace_editor.css",!1);var D=function(){function L(w,I){var R=this;this.container=w||y.createElement("div"),y.addCssClass(this.container,"ace_editor"),y.HI_DPI&&y.addCssClass(this.container,"ace_hidpi"),this.setTheme(I),l.get("useStrictCSP")==null&&l.set("useStrictCSP",!1),this.$gutter=y.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden","true"),this.scroller=y.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=y.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new u(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new r(this.content);var A=this.$textLayer=new a(this.content);this.canvas=A.element,this.$markerFront=new r(this.content),this.$cursorLayer=new s(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new i(this.container,this),this.scrollBarH=new o(this.container,this),this.scrollBarV.on("scroll",function(x){R.$scrollAnimation||R.session.setScrollTop(x.data-R.scrollMargin.top)}),this.scrollBarH.on("scroll",function(x){R.$scrollAnimation||R.session.setScrollLeft(x.data-R.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new _(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.on("changeCharacterSize",function(x){R.updateCharacterSize(),R.onResize(!0,R.gutterWidth,R.$size.width,R.$size.height),R._signal("changeCharacterSize",x)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!v.isIOS,this.$loop=new d(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),this.$addResizeObserver(),l.resetOptions(this),l._signal("renderer",this)}return L.prototype.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),y.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")},L.prototype.setSession=function(w){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=w,w&&this.scrollMargin.top&&w.getScrollTop()<=0&&w.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(w),this.$markerBack.setSession(w),this.$markerFront.setSession(w),this.$gutterLayer.setSession(w),this.$textLayer.setSession(w),w&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},L.prototype.updateLines=function(w,I,R){if(I===void 0&&(I=1/0),this.$changedLines?(this.$changedLines.firstRow>w&&(this.$changedLines.firstRow=w),this.$changedLines.lastRow<I&&(this.$changedLines.lastRow=I)):this.$changedLines={firstRow:w,lastRow:I},this.$changedLines.lastRow<this.layerConfig.firstRow)if(R)this.$changedLines.lastRow=this.layerConfig.lastRow;else return;this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},L.prototype.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},L.prototype.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},L.prototype.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},L.prototype.updateFull=function(w){w?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},L.prototype.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},L.prototype.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},L.prototype.onResize=function(w,I,R,A){if(!(this.resizing>2)){this.resizing>0?this.resizing++:this.resizing=w?1:0;var x=this.container;A||(A=x.clientHeight||x.scrollHeight),!A&&this.$maxLines&&this.lineHeight>1&&(!x.style.height||x.style.height=="0px")&&(x.style.height="1px",A=x.clientHeight||x.scrollHeight),R||(R=x.clientWidth||x.scrollWidth);var S=this.$updateCachedSize(w,I,R,A);if(this.$resizeTimer&&this.$resizeTimer.cancel(),!this.$size.scrollerHeight||!R&&!A)return this.resizing=0;w&&(this.$gutterLayer.$padding=null),w?this.$renderChanges(S|this.$changes,!0):this.$loop.schedule(S|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.$customScrollbar&&this.$updateCustomScrollbar(!0)}},L.prototype.$updateCachedSize=function(w,I,R,A){A-=this.$extraHeight||0;var x=0,S=this.$size,T={width:S.width,height:S.height,scrollerHeight:S.scrollerHeight,scrollerWidth:S.scrollerWidth};if(A&&(w||S.height!=A)&&(S.height=A,x|=this.CHANGE_SIZE,S.scrollerHeight=S.height,this.$horizScroll&&(S.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.setHeight(S.scrollerHeight),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",x=x|this.CHANGE_SCROLL),R&&(w||S.width!=R)){x|=this.CHANGE_SIZE,S.width=R,I==null&&(I=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=I,y.setStyle(this.scrollBarH.element.style,"left",I+"px"),y.setStyle(this.scroller.style,"left",I+this.margin.left+"px"),S.scrollerWidth=Math.max(0,R-I-this.scrollBarV.getWidth()-this.margin.h),y.setStyle(this.$gutter.style,"left",this.margin.left+"px");var P=this.scrollBarV.getWidth()+"px";y.setStyle(this.scrollBarH.element.style,"right",P),y.setStyle(this.scroller.style,"right",P),y.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),this.scrollBarH.setWidth(S.scrollerWidth),(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||w)&&(x|=this.CHANGE_FULL)}return S.$dirty=!R||!A,x&&this._signal("resize",T),x},L.prototype.onGutterResize=function(w){var I=this.$showGutter?w:0;I!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,I,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},L.prototype.adjustWrapLimit=function(){var w=this.$size.scrollerWidth-this.$padding*2,I=Math.floor(w/this.characterWidth);return this.session.adjustWrapLimit(I,this.$showPrintMargin&&this.$printMarginColumn)},L.prototype.setAnimatedScroll=function(w){this.setOption("animatedScroll",w)},L.prototype.getAnimatedScroll=function(){return this.$animatedScroll},L.prototype.setShowInvisibles=function(w){this.setOption("showInvisibles",w),this.session.$bidiHandler.setShowInvisibles(w)},L.prototype.getShowInvisibles=function(){return this.getOption("showInvisibles")},L.prototype.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},L.prototype.setDisplayIndentGuides=function(w){this.setOption("displayIndentGuides",w)},L.prototype.getHighlightIndentGuides=function(){return this.getOption("highlightIndentGuides")},L.prototype.setHighlightIndentGuides=function(w){this.setOption("highlightIndentGuides",w)},L.prototype.setShowPrintMargin=function(w){this.setOption("showPrintMargin",w)},L.prototype.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},L.prototype.setPrintMarginColumn=function(w){this.setOption("printMarginColumn",w)},L.prototype.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},L.prototype.getShowGutter=function(){return this.getOption("showGutter")},L.prototype.setShowGutter=function(w){return this.setOption("showGutter",w)},L.prototype.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},L.prototype.setFadeFoldWidgets=function(w){this.setOption("fadeFoldWidgets",w)},L.prototype.setHighlightGutterLine=function(w){this.setOption("highlightGutterLine",w)},L.prototype.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},L.prototype.$updatePrintMargin=function(){if(!(!this.$showPrintMargin&&!this.$printMarginEl)){if(!this.$printMarginEl){var w=y.createElement("div");w.className="ace_layer ace_print-margin-layer",this.$printMarginEl=y.createElement("div"),this.$printMarginEl.className="ace_print-margin",w.appendChild(this.$printMarginEl),this.content.insertBefore(w,this.content.firstChild)}var I=this.$printMarginEl.style;I.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",I.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&this.session.$wrap==-1&&this.adjustWrapLimit()}},L.prototype.getContainerElement=function(){return this.container},L.prototype.getMouseEventTarget=function(){return this.scroller},L.prototype.getTextAreaContainer=function(){return this.container},L.prototype.$moveTextAreaToCursor=function(){if(!this.$isMousePressed){var w=this.textarea.style,I=this.$composition;if(!this.$keepTextAreaAtCursor&&!I){y.translate(this.textarea,-100,0);return}var R=this.$cursorLayer.$pixelPos;if(R){I&&I.markerRange&&(R=this.$cursorLayer.getPixelPosition(I.markerRange.start,!0));var A=this.layerConfig,x=R.top,S=R.left;x-=A.offset;var T=I&&I.useTextareaForIME||v.isMobile?this.lineHeight:1;if(x<0||x>A.height-T){y.translate(this.textarea,0,0);return}var P=1,N=this.$size.height-T;if(!I)x+=this.lineHeight;else if(I.useTextareaForIME){var k=this.textarea.value;P=this.characterWidth*this.session.$getStringScreenWidth(k)[0]}else x+=this.lineHeight+2;S-=this.scrollLeft,S>this.$size.scrollerWidth-P&&(S=this.$size.scrollerWidth-P),S+=this.gutterWidth+this.margin.left,y.setStyle(w,"height",T+"px"),y.setStyle(w,"width",P+"px"),y.translate(this.textarea,Math.min(S,this.$size.scrollerWidth-P),Math.min(x,N))}}},L.prototype.getFirstVisibleRow=function(){return this.layerConfig.firstRow},L.prototype.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)},L.prototype.getLastFullyVisibleRow=function(){var w=this.layerConfig,I=w.lastRow,R=this.session.documentToScreenRow(I,0)*w.lineHeight;return R-this.session.getScrollTop()>w.height-w.lineHeight?I-1:I},L.prototype.getLastVisibleRow=function(){return this.layerConfig.lastRow},L.prototype.setPadding=function(w){this.$padding=w,this.$textLayer.setPadding(w),this.$cursorLayer.setPadding(w),this.$markerFront.setPadding(w),this.$markerBack.setPadding(w),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},L.prototype.setScrollMargin=function(w,I,R,A){var x=this.scrollMargin;x.top=w|0,x.bottom=I|0,x.right=A|0,x.left=R|0,x.v=x.top+x.bottom,x.h=x.left+x.right,x.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-x.top),this.updateFull()},L.prototype.setMargin=function(w,I,R,A){var x=this.margin;x.top=w|0,x.bottom=I|0,x.right=A|0,x.left=R|0,x.v=x.top+x.bottom,x.h=x.left+x.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},L.prototype.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},L.prototype.setHScrollBarAlwaysVisible=function(w){this.setOption("hScrollBarAlwaysVisible",w)},L.prototype.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},L.prototype.setVScrollBarAlwaysVisible=function(w){this.setOption("vScrollBarAlwaysVisible",w)},L.prototype.$updateScrollBarV=function(){var w=this.layerConfig.maxHeight,I=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(w-=(I-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>w-I&&(w=this.scrollTop+I,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(w+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},L.prototype.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},L.prototype.freeze=function(){this.$frozen=!0},L.prototype.unfreeze=function(){this.$frozen=!1},L.prototype.$renderChanges=function(w,I){if(this.$changes&&(w|=this.$changes,this.$changes=0),!this.session||!this.container.offsetWidth||this.$frozen||!w&&!I){this.$changes|=w;return}if(this.$size.$dirty)return this.$changes|=w,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender",w),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var R=this.layerConfig;if(w&this.CHANGE_FULL||w&this.CHANGE_SIZE||w&this.CHANGE_TEXT||w&this.CHANGE_LINES||w&this.CHANGE_SCROLL||w&this.CHANGE_H_SCROLL){if(w|=this.$computeLayerConfig()|this.$loop.clear(),R.firstRow!=this.layerConfig.firstRow&&R.firstRowScreen==this.layerConfig.firstRowScreen){var A=this.scrollTop+(R.firstRow-Math.max(this.layerConfig.firstRow,0))*this.lineHeight;A>0&&(this.scrollTop=A,w=w|this.CHANGE_SCROLL,w|=this.$computeLayerConfig()|this.$loop.clear())}R=this.layerConfig,this.$updateScrollBarV(),w&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),y.translate(this.content,-this.scrollLeft,-R.offset);var x=R.width+2*this.$padding+"px",S=R.minHeight+"px";y.setStyle(this.content.style,"width",x),y.setStyle(this.content.style,"height",S)}if(w&this.CHANGE_H_SCROLL&&(y.translate(this.content,-this.scrollLeft,-R.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller ":"ace_scroller ace_scroll-left ",this.enableKeyboardAccessibility&&(this.scroller.className+=this.keyboardFocusClassName)),w&this.CHANGE_FULL){this.$changedLines=null,this.$textLayer.update(R),this.$showGutter&&this.$gutterLayer.update(R),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R),this.$markerBack.update(R),this.$markerFront.update(R),this.$cursorLayer.update(R),this.$moveTextAreaToCursor(),this._signal("afterRender",w);return}if(w&this.CHANGE_SCROLL){this.$changedLines=null,w&this.CHANGE_TEXT||w&this.CHANGE_LINES?this.$textLayer.update(R):this.$textLayer.scrollLines(R),this.$showGutter&&(w&this.CHANGE_GUTTER||w&this.CHANGE_LINES?this.$gutterLayer.update(R):this.$gutterLayer.scrollLines(R)),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R),this.$markerBack.update(R),this.$markerFront.update(R),this.$cursorLayer.update(R),this.$moveTextAreaToCursor(),this._signal("afterRender",w);return}w&this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(R),this.$showGutter&&this.$gutterLayer.update(R),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R)):w&this.CHANGE_LINES?((this.$updateLines()||w&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(R),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R)):w&this.CHANGE_TEXT||w&this.CHANGE_GUTTER?(this.$showGutter&&this.$gutterLayer.update(R),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R)):w&this.CHANGE_CURSOR&&(this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(R),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(R)),w&this.CHANGE_CURSOR&&(this.$cursorLayer.update(R),this.$moveTextAreaToCursor()),w&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(R),w&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(R),this._signal("afterRender",w)},L.prototype.$autosize=function(){var w=this.session.getScreenLength()*this.lineHeight,I=this.$maxLines*this.lineHeight,R=Math.min(I,Math.max((this.$minLines||1)*this.lineHeight,w))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(R+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&R>this.$maxPixelHeight&&(R=this.$maxPixelHeight);var A=R<=2*this.lineHeight,x=!A&&w>I;if(R!=this.desiredHeight||this.$size.height!=this.desiredHeight||x!=this.$vScroll){x!=this.$vScroll&&(this.$vScroll=x,this.scrollBarV.setVisible(x));var S=this.container.clientWidth;this.container.style.height=R+"px",this.$updateCachedSize(!0,this.$gutterWidth,S,R),this.desiredHeight=R,this._signal("autosize")}},L.prototype.$computeLayerConfig=function(){var w=this.session,I=this.$size,R=I.height<=2*this.lineHeight,A=this.session.getScreenLength(),x=A*this.lineHeight,S=this.$getLongestLine(),T=!R&&(this.$hScrollBarAlwaysVisible||I.scrollerWidth-S-2*this.$padding<0),P=this.$horizScroll!==T;P&&(this.$horizScroll=T,this.scrollBarH.setVisible(T));var N=this.$vScroll;this.$maxLines&&this.lineHeight>1&&(this.$autosize(),R=I.height<=2*this.lineHeight);var k=I.scrollerHeight+this.lineHeight,O=!this.$maxLines&&this.$scrollPastEnd?(I.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;x+=O;var $=this.scrollMargin;this.session.setScrollTop(Math.max(-$.top,Math.min(this.scrollTop,x-I.scrollerHeight+$.bottom))),this.session.setScrollLeft(Math.max(-$.left,Math.min(this.scrollLeft,S+2*this.$padding-I.scrollerWidth+$.right)));var V=!R&&(this.$vScrollBarAlwaysVisible||I.scrollerHeight-x+O<0||this.scrollTop>$.top),H=N!==V;H&&(this.$vScroll=V,this.scrollBarV.setVisible(V));var U=this.scrollTop%this.lineHeight,z=Math.ceil(k/this.lineHeight)-1,G=Math.max(0,Math.round((this.scrollTop-U)/this.lineHeight)),K=G+z,Y,Z,ie=this.lineHeight;G=w.screenToDocumentRow(G,0);var oe=w.getFoldLine(G);oe&&(G=oe.start.row),Y=w.documentToScreenRow(G,0),Z=w.getRowLength(G)*ie,K=Math.min(w.screenToDocumentRow(K,0),w.getLength()-1),k=I.scrollerHeight+w.getRowLength(K)*ie+Z,U=this.scrollTop-Y*ie,U<0&&Y>0&&(Y=Math.max(0,Y+Math.floor(U/ie)),U=this.scrollTop-Y*ie);var j=0;return(this.layerConfig.width!=S||P)&&(j=this.CHANGE_H_SCROLL),(P||H)&&(j|=this.$updateCachedSize(!0,this.gutterWidth,I.width,I.height),this._signal("scrollbarVisibilityChanged"),H&&(S=this.$getLongestLine())),this.layerConfig={width:S,padding:this.$padding,firstRow:G,firstRowScreen:Y,lastRow:K,lineHeight:ie,characterWidth:this.characterWidth,minHeight:k,maxHeight:x,offset:U,gutterOffset:ie?Math.max(0,Math.ceil((U+I.height-I.scrollerHeight)/ie)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(S-this.$padding),j},L.prototype.$updateLines=function(){if(this.$changedLines){var w=this.$changedLines.firstRow,I=this.$changedLines.lastRow;this.$changedLines=null;var R=this.layerConfig;if(!(w>R.lastRow+1)&&!(I<R.firstRow)){if(I===1/0){this.$showGutter&&this.$gutterLayer.update(R),this.$textLayer.update(R);return}return this.$textLayer.updateLines(R,w,I),!0}}},L.prototype.$getLongestLine=function(){var w=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(w+=1),this.$textLayer&&w>this.$textLayer.MAX_LINE_LENGTH&&(w=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(w*this.characterWidth))},L.prototype.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},L.prototype.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},L.prototype.addGutterDecoration=function(w,I){this.$gutterLayer.addGutterDecoration(w,I)},L.prototype.removeGutterDecoration=function(w,I){this.$gutterLayer.removeGutterDecoration(w,I)},L.prototype.updateBreakpoints=function(w){this._rows=w,this.$loop.schedule(this.CHANGE_GUTTER)},L.prototype.setAnnotations=function(w){this.$gutterLayer.setAnnotations(w),this.$loop.schedule(this.CHANGE_GUTTER)},L.prototype.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},L.prototype.hideCursor=function(){this.$cursorLayer.hideCursor()},L.prototype.showCursor=function(){this.$cursorLayer.showCursor()},L.prototype.scrollSelectionIntoView=function(w,I,R){this.scrollCursorIntoView(w,R),this.scrollCursorIntoView(I,R)},L.prototype.scrollCursorIntoView=function(w,I,R){if(this.$size.scrollerHeight!==0){var A=this.$cursorLayer.getPixelPosition(w),x=A.left,S=A.top,T=R&&R.top||0,P=R&&R.bottom||0;this.$scrollAnimation&&(this.$stopAnimation=!0);var N=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;N+T>S?(I&&N+T>S+this.lineHeight&&(S-=I*this.$size.scrollerHeight),S===0&&(S=-this.scrollMargin.top),this.session.setScrollTop(S)):N+this.$size.scrollerHeight-P<S+this.lineHeight&&(I&&N+this.$size.scrollerHeight-P<S-this.lineHeight&&(S+=I*this.$size.scrollerHeight),this.session.setScrollTop(S+this.lineHeight+P-this.$size.scrollerHeight));var k=this.scrollLeft,O=2*this.layerConfig.characterWidth;x-O<k?(x-=O,x<this.$padding+O&&(x=-this.scrollMargin.left),this.session.setScrollLeft(x)):(x+=O,k+this.$size.scrollerWidth<x+this.characterWidth?this.session.setScrollLeft(Math.round(x+this.characterWidth-this.$size.scrollerWidth)):k<=this.$padding&&x-k<this.characterWidth&&this.session.setScrollLeft(0))}},L.prototype.getScrollTop=function(){return this.session.getScrollTop()},L.prototype.getScrollLeft=function(){return this.session.getScrollLeft()},L.prototype.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},L.prototype.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},L.prototype.scrollToRow=function(w){this.session.setScrollTop(w*this.lineHeight)},L.prototype.alignCursor=function(w,I){typeof w=="number"&&(w={row:w,column:0});var R=this.$cursorLayer.getPixelPosition(w),A=this.$size.scrollerHeight-this.lineHeight,x=R.top-A*(I||0);return this.session.setScrollTop(x),x},L.prototype.$calcSteps=function(w,I){var R=0,A=this.STEPS,x=[],S=function(T,P,N){return N*(Math.pow(T-1,3)+1)+P};for(R=0;R<A;++R)x.push(S(R/this.STEPS,w,I-w));return x},L.prototype.scrollToLine=function(w,I,R,A){var x=this.$cursorLayer.getPixelPosition({row:w,column:0}),S=x.top;I&&(S-=this.$size.scrollerHeight/2);var T=this.scrollTop;this.session.setScrollTop(S),R!==!1&&this.animateScrolling(T,A)},L.prototype.animateScrolling=function(w,I){var R=this.scrollTop;if(!this.$animatedScroll)return;var A=this;if(w==R)return;if(this.$scrollAnimation){var x=this.$scrollAnimation.steps;if(x.length&&(w=x[0],w==R))return}var S=A.$calcSteps(w,R);this.$scrollAnimation={from:w,to:R,steps:S},clearInterval(this.$timer),A.session.setScrollTop(S.shift()),A.session.$scrollTop=R;function T(){A.$timer=clearInterval(A.$timer),A.$scrollAnimation=null,A.$stopAnimation=!1,I&&I()}this.$timer=setInterval(function(){if(A.$stopAnimation){T();return}if(!A.session)return clearInterval(A.$timer);S.length?(A.session.setScrollTop(S.shift()),A.session.$scrollTop=R):R!=null?(A.session.$scrollTop=-1,A.session.setScrollTop(R),R=null):T()},10)},L.prototype.scrollToY=function(w){this.scrollTop!==w&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=w)},L.prototype.scrollToX=function(w){this.scrollLeft!==w&&(this.scrollLeft=w),this.$loop.schedule(this.CHANGE_H_SCROLL)},L.prototype.scrollTo=function(w,I){this.session.setScrollTop(I),this.session.setScrollLeft(w)},L.prototype.scrollBy=function(w,I){I&&this.session.setScrollTop(this.session.getScrollTop()+I),w&&this.session.setScrollLeft(this.session.getScrollLeft()+w)},L.prototype.isScrollableBy=function(w,I){if(I<0&&this.session.getScrollTop()>=1-this.scrollMargin.top||I>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||w<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left||w>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right)return!0},L.prototype.pixelToScreenCoordinates=function(w,I){var R;if(this.$hasCssTransforms){R={top:0,left:0};var A=this.$fontMetrics.transformCoordinates([w,I]);w=A[1]-this.gutterWidth-this.margin.left,I=A[0]}else R=this.scroller.getBoundingClientRect();var x=w+this.scrollLeft-R.left-this.$padding,S=x/this.characterWidth,T=Math.floor((I+this.scrollTop-R.top)/this.lineHeight),P=this.$blockCursor?Math.floor(S):Math.round(S);return{row:T,column:P,side:S-P>0?1:-1,offsetX:x}},L.prototype.screenToTextCoordinates=function(w,I){var R;if(this.$hasCssTransforms){R={top:0,left:0};var A=this.$fontMetrics.transformCoordinates([w,I]);w=A[1]-this.gutterWidth-this.margin.left,I=A[0]}else R=this.scroller.getBoundingClientRect();var x=w+this.scrollLeft-R.left-this.$padding,S=x/this.characterWidth,T=this.$blockCursor?Math.floor(S):Math.round(S),P=Math.floor((I+this.scrollTop-R.top)/this.lineHeight);return this.session.screenToDocumentPosition(P,Math.max(T,0),x)},L.prototype.textToScreenCoordinates=function(w,I){var R=this.scroller.getBoundingClientRect(),A=this.session.documentToScreenPosition(w,I),x=this.$padding+(this.session.$bidiHandler.isBidiRow(A.row,w)?this.session.$bidiHandler.getPosLeft(A.column):Math.round(A.column*this.characterWidth)),S=A.row*this.lineHeight;return{pageX:R.left+x-this.scrollLeft,pageY:R.top+S-this.scrollTop}},L.prototype.visualizeFocus=function(){y.addCssClass(this.container,"ace_focus")},L.prototype.visualizeBlur=function(){y.removeCssClass(this.container,"ace_focus")},L.prototype.showComposition=function(w){this.$composition=w,w.cssText||(w.cssText=this.textarea.style.cssText),w.useTextareaForIME==null&&(w.useTextareaForIME=this.$useTextareaForIME),this.$useTextareaForIME?(y.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):w.markerId=this.session.addMarker(w.markerRange,"ace_composition_marker","text")},L.prototype.setCompositionText=function(w){var I=this.session.selection.cursor;this.addToken(w,"composition_placeholder",I.row,I.column),this.$moveTextAreaToCursor()},L.prototype.hideComposition=function(){if(this.$composition){this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),y.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText;var w=this.session.selection.cursor;this.removeExtraToken(w.row,w.column),this.$composition=null,this.$cursorLayer.element.style.display=""}},L.prototype.setGhostText=function(w,I){var R=this.session.selection.cursor,A=I||{row:R.row,column:R.column};this.removeGhostText();var x=this.$calculateWrappedTextChunks(w,A);this.addToken(x[0].text,"ghost_text",A.row,A.column),this.$ghostText={text:w,position:{row:A.row,column:A.column}};var S=y.createElement("div");if(x.length>1){var T=this.hideTokensAfterPosition(A.row,A.column),P;x.slice(1).forEach(function(H){var U=y.createElement("div"),z=y.createElement("span");z.className="ace_ghost_text",H.wrapped&&(U.className="ghost_text_line_wrapped"),H.text.length===0&&(H.text=" "),z.appendChild(y.createTextNode(H.text)),U.appendChild(z),S.appendChild(U),P=U}),T.forEach(function(H){var U=y.createElement("span");E(H.type)||(U.className="ace_"+H.type.replace(/\./g," ace_")),U.appendChild(y.createTextNode(H.value)),P.appendChild(U)}),this.$ghostTextWidget={el:S,row:A.row,column:A.column,className:"ace_ghost_text_container"},this.session.widgetManager.addLineWidget(this.$ghostTextWidget);var N=this.$cursorLayer.getPixelPosition(A,!0),k=this.container,O=k.getBoundingClientRect().height,$=x.length*this.lineHeight,V=$<O-N.top;if(V)return;$<O?this.scrollBy(0,(x.length-1)*this.lineHeight):this.scrollToRow(A.row)}},L.prototype.$calculateWrappedTextChunks=function(w,I){var R=this.$size.scrollerWidth-this.$padding*2,A=Math.floor(R/this.characterWidth)-2;A=A<=0?60:A;for(var x=w.split(/\r?\n/),S=[],T=0;T<x.length;T++){var P=this.session.$getDisplayTokens(x[T],I.column),N=this.session.$computeWrapSplits(P,A,this.session.$tabSize);if(N.length>0){var k=0;N.push(x[T].length);for(var O=0;O<N.length;O++){var $=x[T].slice(k,N[O]);S.push({text:$,wrapped:!0}),k=N[O]}}else S.push({text:x[T],wrapped:!1})}return S},L.prototype.removeGhostText=function(){if(this.$ghostText){var w=this.$ghostText.position;this.removeExtraToken(w.row,w.column),this.$ghostTextWidget&&(this.session.widgetManager.removeLineWidget(this.$ghostTextWidget),this.$ghostTextWidget=null),this.$ghostText=null}},L.prototype.addToken=function(w,I,R,A){var x=this.session;x.bgTokenizer.lines[R]=null;var S={type:I,value:w},T=x.getTokens(R);if(A==null||!T.length)T.push(S);else for(var P=0,N=0;N<T.length;N++){var k=T[N];if(P+=k.value.length,A<=P){var O=k.value.length-(P-A),$=k.value.slice(0,O),V=k.value.slice(O);T.splice(N,1,{type:k.type,value:$},S,{type:k.type,value:V});break}}this.updateLines(R,R)},L.prototype.hideTokensAfterPosition=function(w,I){for(var R=this.session.getTokens(w),A=0,x=!1,S=[],T=0;T<R.length;T++){var P=R[T];if(A+=P.value.length,P.type!=="ghost_text"){if(x){S.push({type:P.type,value:P.value}),P.type="hidden_token";continue}A===I&&(x=!0)}}return this.updateLines(w,w),S},L.prototype.removeExtraToken=function(w,I){this.session.bgTokenizer.lines[w]=null,this.updateLines(w,w)},L.prototype.setTheme=function(w,I){var R=this;if(this.$themeId=w,R._dispatchEvent("themeChange",{theme:w}),!w||typeof w=="string"){var A=w||this.$options.theme.initialValue;l.loadModule(["theme",A],x)}else x(w);function x(S){if(R.$themeId!=w)return I&&I();if(!S||!S.cssClass)throw new Error("couldn't load module "+w+" or it didn't call define");S.$id&&(R.$themeId=S.$id),y.importCssString(S.cssText,S.cssClass,R.container),R.theme&&y.removeCssClass(R.container,R.theme.cssClass);var T="padding"in S?S.padding:"padding"in(R.theme||{})?4:R.$padding;if(R.$padding&&T!=R.$padding&&R.setPadding(T),R.$gutterLayer){var P=S.$showGutterCursorMarker;P&&!R.$gutterLayer.$showCursorMarker?R.$gutterLayer.$showCursorMarker="theme":!P&&R.$gutterLayer.$showCursorMarker=="theme"&&(R.$gutterLayer.$showCursorMarker=null)}R.$theme=S.cssClass,R.theme=S,y.addCssClass(R.container,S.cssClass),y.setCssClass(R.container,"ace_dark",S.isDark),R.$size&&(R.$size.width=0,R.$updateSizeAsync()),R._dispatchEvent("themeLoaded",{theme:S}),I&&I(),v.isSafari&&R.scroller&&(R.scroller.style.background="red",R.scroller.style.background="")}},L.prototype.getTheme=function(){return this.$themeId},L.prototype.setStyle=function(w,I){y.setCssClass(this.container,w,I!==!1)},L.prototype.unsetStyle=function(w){y.removeCssClass(this.container,w)},L.prototype.setCursorStyle=function(w){y.setStyle(this.scroller.style,"cursor",w)},L.prototype.setMouseCursor=function(w){y.setStyle(this.scroller.style,"cursor",w)},L.prototype.attachToShadowRoot=function(){y.importCssString(M,"ace_editor.css",this.container)},L.prototype.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy(),this.removeAllListeners(),this.container.textContent="",this.setOption("useResizeObserver",!1)},L.prototype.$updateCustomScrollbar=function(w){var I=this;this.$horizScroll=this.$vScroll=null,this.scrollBarV.element.remove(),this.scrollBarH.element.remove(),w===!0?(this.scrollBarV=new h(this.container,this),this.scrollBarH=new c(this.container,this),this.scrollBarV.setHeight(this.$size.scrollerHeight),this.scrollBarH.setWidth(this.$size.scrollerWidth),this.scrollBarV.addEventListener("scroll",function(R){I.$scrollAnimation||I.session.setScrollTop(R.data-I.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(R){I.$scrollAnimation||I.session.setScrollLeft(R.data-I.scrollMargin.left)}),this.$scrollDecorator?(this.$scrollDecorator.setScrollBarV(this.scrollBarV),this.$scrollDecorator.$updateDecorators()):(this.$scrollDecorator=new b(this.scrollBarV,this),this.$scrollDecorator.$updateDecorators())):(this.scrollBarV=new i(this.container,this),this.scrollBarH=new o(this.container,this),this.scrollBarV.addEventListener("scroll",function(R){I.$scrollAnimation||I.session.setScrollTop(R.data-I.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(R){I.$scrollAnimation||I.session.setScrollLeft(R.data-I.scrollMargin.left)}))},L.prototype.$addResizeObserver=function(){if(!(!window.ResizeObserver||this.$resizeObserver)){var w=this;this.$resizeTimer=m.delayedCall(function(){w.destroyed||w.onResize()},50),this.$resizeObserver=new window.ResizeObserver(function(I){var R=I[0].contentRect.width,A=I[0].contentRect.height;Math.abs(w.$size.width-R)>1||Math.abs(w.$size.height-A)>1?w.$resizeTimer.delay():w.$resizeTimer.cancel()}),this.$resizeObserver.observe(this.container)}},L}();D.prototype.CHANGE_CURSOR=1,D.prototype.CHANGE_MARKER=2,D.prototype.CHANGE_GUTTER=4,D.prototype.CHANGE_SCROLL=8,D.prototype.CHANGE_LINES=16,D.prototype.CHANGE_TEXT=32,D.prototype.CHANGE_SIZE=64,D.prototype.CHANGE_MARKER_BACK=128,D.prototype.CHANGE_MARKER_FRONT=256,D.prototype.CHANGE_FULL=512,D.prototype.CHANGE_H_SCROLL=1024,D.prototype.$changes=0,D.prototype.$padding=null,D.prototype.$frozen=!1,D.prototype.STEPS=8,f.implement(D.prototype,C),l.defineOptions(D.prototype,"renderer",{useResizeObserver:{set:function(L){!L&&this.$resizeObserver?(this.$resizeObserver.disconnect(),this.$resizeTimer.cancel(),this.$resizeTimer=this.$resizeObserver=null):L&&!this.$resizeObserver&&this.$addResizeObserver()}},animatedScroll:{initialValue:!1},showInvisibles:{set:function(L){this.$textLayer.setShowInvisibles(L)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(L){typeof L=="number"&&(this.$printMarginColumn=L),this.$showPrintMargin=!!L,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(L){this.$gutter.style.display=L?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},useSvgGutterIcons:{set:function(L){this.$gutterLayer.$useSvgGutterIcons=L},initialValue:!1},showFoldedAnnotations:{set:function(L){this.$gutterLayer.$showFoldedAnnotations=L},initialValue:!1},fadeFoldWidgets:{set:function(L){y.setCssClass(this.$gutter,"ace_fade-fold-widgets",L)},initialValue:!1},showFoldWidgets:{set:function(L){this.$gutterLayer.setShowFoldWidgets(L),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(L){this.$textLayer.setDisplayIndentGuides(L)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightIndentGuides:{set:function(L){this.$textLayer.setHighlightIndentGuides(L)==!0?this.$textLayer.$highlightIndentGuide():this.$textLayer.$clearActiveIndentGuide(this.$textLayer.$lines.cells)},initialValue:!0},highlightGutterLine:{set:function(L){this.$gutterLayer.setHighlightGutterLine(L),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(L){(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(L){(!this.$vScrollBarAlwaysVisible||!this.$vScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(L){typeof L=="number"&&(L=L+"px"),this.container.style.fontSize=L,this.updateFontSize()},initialValue:12},fontFamily:{set:function(L){this.container.style.fontFamily=L,this.updateFontSize()}},maxLines:{set:function(L){this.updateFull()}},minLines:{set:function(L){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(L){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(L){L=+L||0,this.$scrollPastEnd!=L&&(this.$scrollPastEnd=L,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(L){this.$gutterLayer.$fixedWidth=!!L,this.$loop.schedule(this.CHANGE_GUTTER)}},customScrollbar:{set:function(L){this.$updateCustomScrollbar(L)},initialValue:!1},theme:{set:function(L){this.setTheme(L)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!v.isMobile&&!v.isIE}}),n.VirtualRenderer=D}),ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],function(t,n,p){var f=t("../lib/oop"),y=t("../lib/net"),m=t("../lib/event_emitter").EventEmitter,l=t("../config");function u(o){var i="importScripts('"+y.qualifyURL(o)+"');";try{return new Blob([i],{type:"application/javascript"})}catch{var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,h=new c;return h.append(i),h.getBlob("application/javascript")}}function r(o){if(typeof Worker>"u")return{postMessage:function(){},terminate:function(){}};if(l.get("loadWorkerFromBlob")){var i=u(o),c=window.URL||window.webkitURL,h=c.createObjectURL(i);return new Worker(h)}return new Worker(o)}var a=function(o){o.postMessage||(o=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=o,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){f.implement(this,m),this.$createWorkerFromOldConfig=function(o,i,c,h,d){if(t.nameToUrl&&!t.toUrl&&(t.toUrl=t.nameToUrl),l.get("packaged")||!t.toUrl)h=h||l.moduleUrl(i,"worker");else{var _=this.$normalizePath;h=h||_(t.toUrl("ace/worker/worker.js",null,"_"));var C={};o.forEach(function(M){C[M]=_(t.toUrl(M,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}return this.$worker=r(h),d&&this.send("importScripts",d),this.$worker.postMessage({init:!0,tlns:C,module:i,classname:c}),this.$worker},this.onMessage=function(o){var i=o.data;switch(i.type){case"event":this._signal(i.name,{data:i.data});break;case"call":var c=this.callbacks[i.id];c&&(c(i.data),delete this.callbacks[i.id]);break;case"error":this.reportError(i.data);break;case"log":window.console&&console.log&&console.log.apply(console,i.data);break}},this.reportError=function(o){window.console&&console.error&&console.error(o)},this.$normalizePath=function(o){return y.qualifyURL(o)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker.onerror=function(o){o.preventDefault()},this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(o,i){this.$worker.postMessage({command:o,args:i})},this.call=function(o,i,c){if(c){var h=this.callbackId++;this.callbacks[h]=c,i.push(h)}this.send(o,i)},this.emit=function(o,i){try{i.data&&i.data.err&&(i.data.err={message:i.data.err.message,stack:i.data.err.stack,code:i.data.err.code}),this.$worker&&this.$worker.postMessage({event:o,data:{data:i.data}})}catch(c){console.error(c.stack)}},this.attachToDocument=function(o){this.$doc&&this.terminate(),this.$doc=o,this.call("setValue",[o.getValue()]),o.on("change",this.changeListener,!0)},this.changeListener=function(o){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),o.action=="insert"?this.deltaQueue.push(o.start,o.lines):this.deltaQueue.push(o.start,o.end)},this.$sendDeltaQueue=function(){var o=this.deltaQueue;o&&(this.deltaQueue=null,o.length>50&&o.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:o}))}}).call(a.prototype);var s=function(o,i,c){var h=null,d=!1,_=Object.create(m),C=[],M=new a({messageBuffer:C,terminate:function(){},postMessage:function(v){C.push(v),h&&(d?setTimeout(b):b())}});M.setEmitSync=function(v){d=v};var b=function(){var v=C.shift();v.command?h[v.command].apply(h,v.args):v.event&&_._signal(v.event,v.data)};return _.postMessage=function(v){M.onMessage({data:v})},_.callback=function(v,E){this.postMessage({type:"call",id:E,data:v})},_.emit=function(v,E){this.postMessage({type:"event",name:v,data:E})},l.loadModule(["worker",i],function(v){for(h=new v[c](_);C.length;)b()}),M};n.UIWorkerClient=s,n.WorkerClient=a,n.createWorker=r}),ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(t,n,p){var f=t("./range").Range,y=t("./lib/event_emitter").EventEmitter,m=t("./lib/oop"),l=function(){function u(r,a,s,o,i,c){var h=this;this.length=a,this.session=r,this.doc=r.getDocument(),this.mainClass=i,this.othersClass=c,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate,!0),this.$others=o,this.$onCursorChange=function(){setTimeout(function(){h.onCursorChange()})},this.$pos=s;var d=r.getUndoManager().$undoStack||r.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=d.length,this.setup(),r.selection.on("changeCursor",this.$onCursorChange)}return u.prototype.setup=function(){var r=this,a=this.doc,s=this.session;this.selectionBefore=s.selection.toJSON(),s.selection.inMultiSelectMode&&s.selection.toSingleRange(),this.pos=a.createAnchor(this.$pos.row,this.$pos.column);var o=this.pos;o.$insertRight=!0,o.detach(),o.markerId=s.addMarker(new f(o.row,o.column,o.row,o.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(i){var c=a.createAnchor(i.row,i.column);c.$insertRight=!0,c.detach(),r.others.push(c)}),s.setUndoSelect(!1)},u.prototype.showOtherMarkers=function(){if(!this.othersActive){var r=this.session,a=this;this.othersActive=!0,this.others.forEach(function(s){s.markerId=r.addMarker(new f(s.row,s.column,s.row,s.column+a.length),a.othersClass,null,!1)})}},u.prototype.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var r=0;r<this.others.length;r++)this.session.removeMarker(this.others[r].markerId)}},u.prototype.onUpdate=function(r){if(this.$updating)return this.updateAnchors(r);var a=r;if(a.start.row===a.end.row&&a.start.row===this.pos.row){this.$updating=!0;var s=r.action==="insert"?a.end.column-a.start.column:a.start.column-a.end.column,o=a.start.column>=this.pos.column&&a.start.column<=this.pos.column+this.length+1,i=a.start.column-this.pos.column;if(this.updateAnchors(r),o&&(this.length+=s),o&&!this.session.$fromUndo){if(r.action==="insert")for(var c=this.others.length-1;c>=0;c--){var h=this.others[c],d={row:h.row,column:h.column+i};this.doc.insertMergedLines(d,r.lines)}else if(r.action==="remove")for(var c=this.others.length-1;c>=0;c--){var h=this.others[c],d={row:h.row,column:h.column+i};this.doc.remove(new f(d.row,d.column,d.row,d.column-s))}}this.$updating=!1,this.updateMarkers()}},u.prototype.updateAnchors=function(r){this.pos.onChange(r);for(var a=this.others.length;a--;)this.others[a].onChange(r);this.updateMarkers()},u.prototype.updateMarkers=function(){if(!this.$updating){var r=this,a=this.session,s=function(i,c){a.removeMarker(i.markerId),i.markerId=a.addMarker(new f(i.row,i.column,i.row,i.column+r.length),c,null,!1)};s(this.pos,this.mainClass);for(var o=this.others.length;o--;)s(this.others[o],this.othersClass)}},u.prototype.onCursorChange=function(r){if(!(this.$updating||!this.session)){var a=this.session.selection.getCursor();a.row===this.pos.row&&a.column>=this.pos.column&&a.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",r)):(this.hideOtherMarkers(),this._emit("cursorLeave",r))}},u.prototype.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.off("change",this.$onUpdate),this.session.selection.off("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},u.prototype.cancel=function(){if(this.$undoStackDepth!==-1){for(var r=this.session.getUndoManager(),a=(r.$undoStack||r.$undostack).length-this.$undoStackDepth,s=0;s<a;s++)r.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}},u}();m.implement(l.prototype,y),n.PlaceHolder=l}),ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(t,n,p){var f=t("../lib/event"),y=t("../lib/useragent");function m(u,r){return u.row==r.row&&u.column==r.column}function l(u){var r=u.domEvent,a=r.altKey,s=r.shiftKey,o=r.ctrlKey,i=u.getAccelKey(),c=u.getButton();if(o&&y.isMac&&(c=r.button),u.editor.inMultiSelectMode&&c==2){u.editor.textInput.onContextMenu(u.domEvent);return}if(!o&&!a&&!i){c===0&&u.editor.inMultiSelectMode&&u.editor.exitMultiSelectMode();return}if(c===0){var h=u.editor,d=h.selection,_=h.inMultiSelectMode,C=u.getDocumentPosition(),M=d.getCursor(),b=u.inSelection()||d.isEmpty()&&m(C,M),v=u.x,E=u.y,D=function($){v=$.clientX,E=$.clientY},L=h.session,w=h.renderer.pixelToScreenCoordinates(v,E),I=w,R;if(h.$mouseHandler.$enableJumpToDef)o&&a||i&&a?R=s?"block":"add":a&&h.$blockSelectEnabled&&(R="block");else if(i&&!a){if(R="add",!_&&s)return}else a&&h.$blockSelectEnabled&&(R="block");if(R&&y.isMac&&r.ctrlKey&&h.$mouseHandler.cancelContextMenu(),R=="add"){if(!_&&b)return;if(!_){var A=d.toOrientedRange();h.addSelectionMarker(A)}var x=d.rangeList.rangeAtPoint(C);h.inVirtualSelectionMode=!0,s&&(x=null,A=d.ranges[0]||A,h.removeSelectionMarker(A)),h.once("mouseup",function(){var $=d.toOrientedRange();x&&$.isEmpty()&&m(x.cursor,$.cursor)?d.substractPoint($.cursor):(s?d.substractPoint(A.cursor):A&&(h.removeSelectionMarker(A),d.addRange(A)),d.addRange($)),h.inVirtualSelectionMode=!1})}else if(R=="block"){u.stop(),h.inVirtualSelectionMode=!0;var S,T=[],P=function(){var $=h.renderer.pixelToScreenCoordinates(v,E),V=L.screenToDocumentPosition($.row,$.column,$.offsetX);m(I,$)&&m(V,d.lead)||(I=$,h.selection.moveToPosition(V),h.renderer.scrollCursorIntoView(),h.removeSelectionMarkers(T),T=d.rectangularRangeBlock(I,w),h.$mouseHandler.$clickSelection&&T.length==1&&T[0].isEmpty()&&(T[0]=h.$mouseHandler.$clickSelection.clone()),T.forEach(h.addSelectionMarker,h),h.updateSelectionMarkers())};_&&!i?d.toSingleRange():!_&&i&&(S=d.toOrientedRange(),h.addSelectionMarker(S)),s?w=L.documentToScreenPosition(d.lead):d.moveToPosition(C),I={row:-1,column:-1};var N=function($){P(),clearInterval(O),h.removeSelectionMarkers(T),T.length||(T=[d.toOrientedRange()]),S&&(h.removeSelectionMarker(S),d.toSingleRange(S));for(var V=0;V<T.length;V++)d.addRange(T[V]);h.inVirtualSelectionMode=!1,h.$mouseHandler.$clickSelection=null},k=P;f.capture(h.container,D,N);var O=setInterval(function(){k()},20);return u.preventDefault()}}}n.onMouseDown=l}),ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(t,n,p){n.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(y){y.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(y){y.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(y){y.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(y){y.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(y){y.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(y){y.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(y){y.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(y){y.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split selection into lines",exec:function(y){y.multiSelect.rangeCount>1?y.multiSelect.joinSelections():y.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(y){y.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(y){y.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(y){y.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],n.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(y){y.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(y){return y&&y.inMultiSelectMode}}];var f=t("../keyboard/hash_handler").HashHandler;n.keyboardHandler=new f(n.multiSelectCommands)}),ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(t,n,p){var f=t("./range_list").RangeList,y=t("./range").Range,m=t("./selection").Selection,l=t("./mouse/multi_select_handler").onMouseDown,u=t("./lib/event"),r=t("./lib/lang"),a=t("./commands/multi_select_commands");n.commands=a.defaultCommands.concat(a.multiSelectCommands);var s=t("./search").Search,o=new s;function i(M,b,v){return o.$options.wrap=!0,o.$options.needle=b,o.$options.backwards=v==-1,o.find(M)}var c=t("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(c.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(M,b){if(M){if(!this.inMultiSelectMode&&this.rangeCount===0){var v=this.toOrientedRange();if(this.rangeList.add(v),this.rangeList.add(M),this.rangeList.ranges.length!=2)return this.rangeList.removeAll(),b||this.fromOrientedRange(M);this.rangeList.removeAll(),this.rangeList.add(v),this.$onAddRange(v)}M.cursor||(M.cursor=M.end);var E=this.rangeList.add(M);return this.$onAddRange(M),E.length&&this.$onRemoveRange(E),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),b||this.fromOrientedRange(M)}},this.toSingleRange=function(M){M=M||this.ranges[0];var b=this.rangeList.removeAll();b.length&&this.$onRemoveRange(b),M&&this.fromOrientedRange(M)},this.substractPoint=function(M){var b=this.rangeList.substractPoint(M);if(b)return this.$onRemoveRange(b),b[0]},this.mergeOverlappingRanges=function(){var M=this.rangeList.merge();M.length&&this.$onRemoveRange(M)},this.$onAddRange=function(M){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(M),this._signal("addRange",{range:M})},this.$onRemoveRange=function(M){if(this.rangeCount=this.rangeList.ranges.length,this.rangeCount==1&&this.inMultiSelectMode){var b=this.rangeList.ranges.pop();M.push(b),this.rangeCount=0}for(var v=M.length;v--;){var E=this.ranges.indexOf(M[v]);this.ranges.splice(E,1)}this._signal("removeRange",{ranges:M}),this.rangeCount===0&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),b=b||this.ranges[0],b&&!b.isEqual(this.getRange())&&this.fromOrientedRange(b)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new f,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){for(var M=this.ranges.length?this.ranges:[this.getRange()],b=[],v=0;v<M.length;v++){var E=M[v],D=E.start.row,L=E.end.row;if(D===L)b.push(E.clone());else{for(b.push(new y(D,E.start.column,D,this.session.getLine(D).length));++D<L;)b.push(this.getLineRange(D,!0));b.push(new y(L,0,L,E.end.column))}v==0&&!this.isBackwards()&&(b=b.reverse())}this.toSingleRange();for(var v=b.length;v--;)this.addRange(b[v])},this.joinSelections=function(){var M=this.rangeList.ranges,b=M[M.length-1],v=y.fromPoints(M[0].start,b.end);this.toSingleRange(),this.setSelectionRange(v,b.cursor==b.start)},this.toggleBlockSelection=function(){if(this.rangeCount>1){var M=this.rangeList.ranges,b=M[M.length-1],v=y.fromPoints(M[0].start,b.end);this.toSingleRange(),this.setSelectionRange(v,b.cursor==b.start)}else{var E=this.session.documentToScreenPosition(this.cursor),D=this.session.documentToScreenPosition(this.anchor),L=this.rectangularRangeBlock(E,D);L.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(M,b,v){var E=[],D=M.column<b.column;if(D)var L=M.column,w=b.column,I=M.offsetX,R=b.offsetX;else var L=b.column,w=M.column,I=b.offsetX,R=M.offsetX;var A=M.row<b.row;if(A)var x=M.row,S=b.row;else var x=b.row,S=M.row;L<0&&(L=0),x<0&&(x=0),x==S&&(v=!0);for(var T,P=x;P<=S;P++){var N=y.fromPoints(this.session.screenToDocumentPosition(P,L,I),this.session.screenToDocumentPosition(P,w,R));if(N.isEmpty()){if(T&&d(N.end,T))break;T=N.end}N.cursor=D?N.start:N.end,E.push(N)}if(A&&E.reverse(),!v){for(var k=E.length-1;E[k].isEmpty()&&k>0;)k--;if(k>0)for(var O=0;E[O].isEmpty();)O++;for(var $=k;$>=O;$--)E[$].isEmpty()&&E.splice($,1)}return E}}.call(m.prototype);var h=t("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(M){M.cursor||(M.cursor=M.end);var b=this.getSelectionStyle();return M.marker=this.session.addMarker(M,"ace_selection",b),this.session.$selectionMarkers.push(M),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,M},this.removeSelectionMarker=function(M){if(M.marker){this.session.removeMarker(M.marker);var b=this.session.$selectionMarkers.indexOf(M);b!=-1&&this.session.$selectionMarkers.splice(b,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length}},this.removeSelectionMarkers=function(M){for(var b=this.session.$selectionMarkers,v=M.length;v--;){var E=M[v];if(E.marker){this.session.removeMarker(E.marker);var D=b.indexOf(E);D!=-1&&b.splice(D,1)}}this.session.selectionMarkerCount=b.length},this.$onAddRange=function(M){this.addSelectionMarker(M.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(M){this.removeSelectionMarkers(M.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(M){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(a.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(M){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(a.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(M){var b=M.command,v=M.editor;if(v.multiSelect){if(b.multiSelectAction)b.multiSelectAction=="forEach"?E=v.forEachSelection(b,M.args):b.multiSelectAction=="forEachLine"?E=v.forEachSelection(b,M.args,!0):b.multiSelectAction=="single"?(v.exitMultiSelectMode(),E=b.exec(v,M.args||{})):E=b.multiSelectAction(v,M.args||{});else{var E=b.exec(v,M.args||{});v.multiSelect.addRange(v.multiSelect.toOrientedRange()),v.multiSelect.mergeOverlappingRanges()}return E}},this.forEachSelection=function(M,b,v){if(!this.inVirtualSelectionMode){var E=v&&v.keepOrder,D=v==!0||v&&v.$byLines,L=this.session,w=this.selection,I=w.rangeList,R=(E?w:I).ranges,A;if(!R.length)return M.exec?M.exec(this,b||{}):M(this,b||{});var x=w._eventRegistry;w._eventRegistry={};var S=new m(L);this.inVirtualSelectionMode=!0;for(var T=R.length;T--;){if(D)for(;T>0&&R[T].start.row==R[T-1].end.row;)T--;S.fromOrientedRange(R[T]),S.index=T,this.selection=L.selection=S;var P=M.exec?M.exec(this,b||{}):M(this,b||{});!A&&P!==void 0&&(A=P),S.toOrientedRange(R[T])}S.detach(),this.selection=L.selection=w,this.inVirtualSelectionMode=!1,w._eventRegistry=x,w.mergeOverlappingRanges(),w.ranges[0]&&w.fromOrientedRange(w.ranges[0]);var N=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),N&&N.from==N.to&&this.renderer.animateScrolling(N.from),A}},this.exitMultiSelectMode=function(){!this.inMultiSelectMode||this.inVirtualSelectionMode||this.multiSelect.toSingleRange()},this.getSelectedText=function(){var M="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var b=this.multiSelect.rangeList.ranges,v=[],E=0;E<b.length;E++)v.push(this.session.getTextRange(b[E]));var D=this.session.getDocument().getNewLineCharacter();M=v.join(D),M.length==(v.length-1)*D.length&&(M="")}else this.selection.isEmpty()||(M=this.session.getTextRange(this.getSelectionRange()));return M},this.$checkMultiselectChange=function(M,b){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var v=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&b==this.multiSelect.anchor)return;var E=b==this.multiSelect.anchor?v.cursor==v.start?v.end:v.start:v.cursor;E.row!=b.row||this.session.$clipPositionToDocument(E.row,E.column).column!=b.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()}},this.findAll=function(M,b,v){if(b=b||{},b.needle=M||b.needle,b.needle==null){var E=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();b.needle=this.session.getTextRange(E)}this.$search.set(b);var D=this.$search.findAll(this.session);if(!D.length)return 0;var L=this.multiSelect;v||L.toSingleRange(D[0]);for(var w=D.length;w--;)L.addRange(D[w],!0);return E&&L.rangeList.rangeAtPoint(E.start)&&L.addRange(E,!0),D.length},this.selectMoreLines=function(M,b){var v=this.selection.toOrientedRange(),E=v.cursor==v.end,D=this.session.documentToScreenPosition(v.cursor);this.selection.$desiredColumn&&(D.column=this.selection.$desiredColumn);var L=this.session.screenToDocumentPosition(D.row+M,D.column);if(v.isEmpty())var I=L;else var w=this.session.documentToScreenPosition(E?v.end:v.start),I=this.session.screenToDocumentPosition(w.row+M,w.column);if(E){var R=y.fromPoints(L,I);R.cursor=R.start}else{var R=y.fromPoints(I,L);R.cursor=R.end}if(R.desiredColumn=D.column,!this.selection.inMultiSelectMode)this.selection.addRange(v);else if(b)var A=v.cursor;this.selection.addRange(R),A&&this.selection.substractPoint(A)},this.transposeSelections=function(M){for(var b=this.session,v=b.multiSelect,E=v.ranges,D=E.length;D--;){var L=E[D];if(L.isEmpty()){var w=b.getWordRange(L.start.row,L.start.column);L.start.row=w.start.row,L.start.column=w.start.column,L.end.row=w.end.row,L.end.column=w.end.column}}v.mergeOverlappingRanges();for(var I=[],D=E.length;D--;){var L=E[D];I.unshift(b.getTextRange(L))}M<0?I.unshift(I.pop()):I.push(I.shift());for(var D=E.length;D--;){var L=E[D],R=L.clone();b.replace(L,I[D]),L.start.row=R.start.row,L.start.column=R.start.column}v.fromOrientedRange(v.ranges[0])},this.selectMore=function(M,b,v){var E=this.session,D=E.multiSelect,L=D.toOrientedRange();if(!(L.isEmpty()&&(L=E.getWordRange(L.start.row,L.start.column),L.cursor=M==-1?L.start:L.end,this.multiSelect.addRange(L),v))){var w=E.getTextRange(L),I=i(E,w,M);I&&(I.cursor=M==-1?I.start:I.end,this.session.unfold(I),this.multiSelect.addRange(I),this.renderer.scrollCursorIntoView(null,.5)),b&&this.multiSelect.substractPoint(L.cursor)}},this.alignCursors=function(){var M=this.session,b=M.multiSelect,v=b.ranges,E=-1,D=v.filter(function(k){if(k.cursor.row==E)return!0;E=k.cursor.row});if(!v.length||D.length==v.length-1){var L=this.selection.getRange(),w=L.start.row,I=L.end.row,R=w==I;if(R){var A=this.session.getLength(),x;do x=this.session.getLine(I);while(/[=:]/.test(x)&&++I<A);do x=this.session.getLine(w);while(/[=:]/.test(x)&&--w>0);w<0&&(w=0),I>=A&&(I=A-1)}var S=this.session.removeFullLines(w,I);S=this.$reAlignText(S,R),this.session.insert({row:w,column:0},S.join(`
`)+`
`),R||(L.start.column=0,L.end.column=S[S.length-1].length),this.selection.setRange(L)}else{D.forEach(function(k){b.substractPoint(k.cursor)});var T=0,P=1/0,N=v.map(function(k){var O=k.cursor,$=M.getLine(O.row),V=$.substr(O.column).search(/\S/g);return V==-1&&(V=0),O.column>T&&(T=O.column),V<P&&(P=V),V});v.forEach(function(k,O){var $=k.cursor,V=T-$.column,H=N[O]-P;V>H?M.insert($,r.stringRepeat(" ",V-H)):M.remove(new y($.row,$.column,$.row,$.column-V+H)),k.start.column=k.end.column=T,k.start.row=k.end.row=$.row,k.cursor=k.end}),b.fromOrientedRange(v[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}},this.$reAlignText=function(M,b){var v=!0,E=!0,D,L,w;return M.map(function(S){var T=S.match(/(\s*)(.*?)(\s*)([=:].*)/);return T?D==null?(D=T[1].length,L=T[2].length,w=T[3].length,T):(D+L+w!=T[1].length+T[2].length+T[3].length&&(E=!1),D!=T[1].length&&(v=!1),D>T[1].length&&(D=T[1].length),L<T[2].length&&(L=T[2].length),w>T[3].length&&(w=T[3].length),T):[S]}).map(b?R:v?E?A:R:x);function I(S){return r.stringRepeat(" ",S)}function R(S){return S[2]?I(D)+S[2]+I(L-S[2].length+w)+S[4].replace(/^([=:])\s+/,"$1 "):S[0]}function A(S){return S[2]?I(D+L-S[2].length)+S[2]+I(w)+S[4].replace(/^([=:])\s+/,"$1 "):S[0]}function x(S){return S[2]?I(D)+S[2]+I(w)+S[4].replace(/^([=:])\s+/,"$1 "):S[0]}}}).call(h.prototype);function d(M,b){return M.row==b.row&&M.column==b.column}n.onSessionChange=function(M){var b=M.session;b&&!b.multiSelect&&(b.$selectionMarkers=[],b.selection.$initRangeList(),b.multiSelect=b.selection),this.multiSelect=b&&b.multiSelect;var v=M.oldSession;v&&(v.multiSelect.off("addRange",this.$onAddRange),v.multiSelect.off("removeRange",this.$onRemoveRange),v.multiSelect.off("multiSelect",this.$onMultiSelect),v.multiSelect.off("singleSelect",this.$onSingleSelect),v.multiSelect.lead.off("change",this.$checkMultiselectChange),v.multiSelect.anchor.off("change",this.$checkMultiselectChange)),b&&(b.multiSelect.on("addRange",this.$onAddRange),b.multiSelect.on("removeRange",this.$onRemoveRange),b.multiSelect.on("multiSelect",this.$onMultiSelect),b.multiSelect.on("singleSelect",this.$onSingleSelect),b.multiSelect.lead.on("change",this.$checkMultiselectChange),b.multiSelect.anchor.on("change",this.$checkMultiselectChange)),b&&this.inMultiSelectMode!=b.selection.inMultiSelectMode&&(b.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())};function _(M){M.$multiselectOnSessionChange||(M.$onAddRange=M.$onAddRange.bind(M),M.$onRemoveRange=M.$onRemoveRange.bind(M),M.$onMultiSelect=M.$onMultiSelect.bind(M),M.$onSingleSelect=M.$onSingleSelect.bind(M),M.$multiselectOnSessionChange=n.onSessionChange.bind(M),M.$checkMultiselectChange=M.$checkMultiselectChange.bind(M),M.$multiselectOnSessionChange(M),M.on("changeSession",M.$multiselectOnSessionChange),M.on("mousedown",l),M.commands.addCommands(a.defaultCommands),C(M))}function C(M){if(!M.textInput)return;var b=M.textInput.getElement(),v=!1;u.addListener(b,"keydown",function(D){var L=D.keyCode==18&&!(D.ctrlKey||D.shiftKey||D.metaKey);M.$blockSelectEnabled&&L?v||(M.renderer.setMouseCursor("crosshair"),v=!0):v&&E()},M),u.addListener(b,"keyup",E,M),u.addListener(b,"blur",E,M);function E(D){v&&(M.renderer.setMouseCursor(""),v=!1)}}n.MultiSelect=_,t("./config").defineOptions(h.prototype,"editor",{enableMultiselect:{set:function(M){_(this),M?this.on("mousedown",l):this.off("mousedown",l)},value:!0},enableBlockSelect:{set:function(M){this.$blockSelectEnabled=M},value:!0}})}),ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(t,n,p){var f=t("../../range").Range,y=n.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(m,l,u){var r=m.getLine(u);return this.foldingStartMarker.test(r)?"start":l=="markbeginend"&&this.foldingStopMarker&&this.foldingStopMarker.test(r)?"end":""},this.getFoldWidgetRange=function(m,l,u){return null},this.indentationBlock=function(m,l,u){var r=/\S/,a=m.getLine(l),s=a.search(r);if(s!=-1){for(var o=u||a.length,i=m.getLength(),c=l,h=l;++l<i;){var d=m.getLine(l).search(r);if(d!=-1){if(d<=s){var _=m.getTokenAt(l,0);if(!_||_.type!=="string")break}h=l}}if(h>c){var C=m.getLine(h).length;return new f(c,o,h,C)}}},this.openingBracketBlock=function(m,l,u,r,a){var s={row:u,column:r+1},o=m.$findClosingBracket(l,s,a);if(o){var i=m.foldWidgets[o.row];return i==null&&(i=m.getFoldWidget(o.row)),i=="start"&&o.row>s.row&&(o.row--,o.column=m.getLine(o.row).length),f.fromPoints(s,o)}},this.closingBracketBlock=function(m,l,u,r,a){var s={row:u,column:r},o=m.$findOpeningBracket(l,s);if(o)return o.column++,s.column--,f.fromPoints(o,s)}}).call(y.prototype)}),ace.define("ace/ext/error_marker",["require","exports","module","ace/lib/dom","ace/range","ace/config"],function(t,n,p){var f=t("../lib/dom"),y=t("../range").Range,m=t("../config").nls;function l(r,a,s){for(var o=0,i=r.length-1;o<=i;){var c=o+i>>1,h=s(a,r[c]);if(h>0)o=c+1;else if(h<0)i=c-1;else return c}return-(o+1)}function u(r,a,s){var o=r.getAnnotations().sort(y.comparePoints);if(o.length){var i=l(o,{row:a,column:-1},y.comparePoints);i<0&&(i=-i-1),i>=o.length?i=s>0?0:o.length-1:i===0&&s<0&&(i=o.length-1);var c=o[i];if(!(!c||!s)){if(c.row===a){do c=o[i+=s];while(c&&c.row===a);if(!c)return o.slice()}var h=[];a=c.row;do h[s<0?"unshift":"push"](c),c=o[i+=s];while(c&&c.row==a);return h.length&&h}}}n.showErrorMarker=function(r,a){var s=r.session,o=r.getCursorPosition(),i=o.row,c=s.widgetManager.getWidgetsAtRow(i).filter(function(D){return D.type=="errorMarker"})[0];c?c.destroy():i-=a;var h=u(s,i,a),d;if(h){var _=h[0];o.column=(_.pos&&typeof _.column!="number"?_.pos.sc:_.column)||0,o.row=_.row,d=r.renderer.$gutterLayer.$annotations[o.row]}else{if(c)return;d={displayText:[m("error-marker.good-state","Looks good!")],className:"ace_ok"}}r.session.unfold(o.row),r.selection.moveToPosition(o);var C={row:o.row,fixedWidth:!0,coverGutter:!0,el:f.createElement("div"),type:"errorMarker"},M=C.el.appendChild(f.createElement("div")),b=C.el.appendChild(f.createElement("div"));b.className="error_widget_arrow "+d.className;var v=r.renderer.$cursorLayer.getPixelPosition(o).left;b.style.left=v+r.renderer.gutterWidth-5+"px",C.el.className="error_widget_wrapper",M.className="error_widget "+d.className,d.displayText.forEach(function(D,L){M.appendChild(f.createTextNode(D)),L<d.displayText.length-1&&M.appendChild(f.createElement("br"))}),M.appendChild(f.createElement("div"));var E=function(D,L,w){if(L===0&&(w==="esc"||w==="return"))return C.destroy(),{command:"null"}};C.destroy=function(){r.$mouseHandler.isMousePressed||(r.keyBinding.removeKeyboardHandler(E),s.widgetManager.removeLineWidget(C),r.off("changeSelection",C.destroy),r.off("changeSession",C.destroy),r.off("mouseup",C.destroy),r.off("change",C.destroy))},r.keyBinding.addKeyboardHandler(E),r.on("changeSelection",C.destroy),r.on("changeSession",C.destroy),r.on("mouseup",C.destroy),r.on("change",C.destroy),r.session.widgetManager.addLineWidget(C),C.el.onmousedown=r.focus.bind(r),r.renderer.scrollCursorIntoView(null,.5,{bottom:C.el.offsetHeight})},f.importCssString(`
    .error_widget_wrapper {
        background: inherit;
        color: inherit;
        border:none
    }
    .error_widget {
        border-top: solid 2px;
        border-bottom: solid 2px;
        margin: 5px 0;
        padding: 10px 40px;
        white-space: pre-wrap;
    }
    .error_widget.ace_error, .error_widget_arrow.ace_error{
        border-color: #ff5a5a
    }
    .error_widget.ace_warning, .error_widget_arrow.ace_warning{
        border-color: #F1D817
    }
    .error_widget.ace_info, .error_widget_arrow.ace_info{
        border-color: #5a5a5a
    }
    .error_widget.ace_ok, .error_widget_arrow.ace_ok{
        border-color: #5aaa5a
    }
    .error_widget_arrow {
        position: absolute;
        border: solid 5px;
        border-top-color: transparent!important;
        border-right-color: transparent!important;
        border-left-color: transparent!important;
        top: -5px;
    }
`,"error_marker.css",!1)}),ace.define("ace/ace",["require","exports","module","ace/lib/dom","ace/range","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config","ace/loader_build"],function(t,n,p){t("./loader_build")(n);var f=t("./lib/dom"),y=t("./range").Range,m=t("./editor").Editor,l=t("./edit_session").EditSession,u=t("./undomanager").UndoManager,r=t("./virtual_renderer").VirtualRenderer;t("./worker/worker_client"),t("./keyboard/hash_handler"),t("./placeholder"),t("./multi_select"),t("./mode/folding/fold_mode"),t("./theme/textmate"),t("./ext/error_marker"),n.config=t("./config"),n.edit=function(s,o){if(typeof s=="string"){var i=s;if(s=document.getElementById(i),!s)throw new Error("ace.edit can't find div #"+i)}if(s&&s.env&&s.env.editor instanceof m)return s.env.editor;var c="";if(s&&/input|textarea/i.test(s.tagName)){var h=s;c=h.value,s=f.createElement("pre"),h.parentNode.replaceChild(s,h)}else s&&(c=s.textContent,s.innerHTML="");var d=n.createEditSession(c),_=new m(new r(s),d,o),C={document:d,editor:_,onResize:_.resize.bind(_,null)};return h&&(C.textarea=h),_.on("destroy",function(){C.editor.container.env=null}),_.container.env=_.env=C,_},n.createEditSession=function(s,o){var i=new l(s,o);return i.setUndoManager(new u),i},n.Range=y,n.Editor=m,n.EditSession=l,n.UndoManager=u,n.VirtualRenderer=r;var a=n.config.version;n.version=a}),function(){ace.require(["ace/ace"],function(t){t&&(t.config.init(!0),t.define=ace.define);var n=function(){return this}();!n&&typeof window<"u"&&(n=window),!n&&typeof self<"u"&&(n=self),n.ace||(n.ace=t);for(var p in t)t.hasOwnProperty(p)&&(n.ace[p]=t[p]);n.ace.default=n.ace,g&&(g.exports=n.ace)})}()})(Uo);var Ha=Uo.exports;const di=za(Ha);function Wa(){di.define("ace/mode/nc_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(g,e,t)=>{const n=g("../lib/oop"),p=g("./text_highlight_rules").TextHighlightRules,f=function(){this.$rules={start:[{token:"comment",regex:"\\(.*\\)",comment:"Comment"},{token:"string",regex:"O[0-9]+",comment:"Program Number"},{token:"keyword",regex:"T[0-9]+",comment:"ToolNumber"},{token:"keyword.control",regex:"G[0-9]+(\\.[0-9]+)?",comment:"G Codes"},{token:"keyword.control",regex:"M[0-9]+",comment:"M Codes"},{token:"variable.parameter",regex:"[XYZABCUVWxyzabcuvw]",comment:"Axis"},{token:"constant.numeric",regex:"[-+]?[0-9]*\\.?[0-9]+",comment:"Number"},{token:"support.function",regex:"[FSPQRfspqr]",comment:"Parameters"}]},this.normalizeRules()};n.inherits(f,p),e.NCHighlightRules=f}),di.define("ace/mode/nc",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/nc_highlight_rules"],(g,e,t)=>{const n=g("../lib/oop"),p=g("./text").Mode,f=g("./nc_highlight_rules").NCHighlightRules,y=function(){this.HighlightRules=f,this.$behaviour=this.$defaultBehaviour};n.inherits(y,p),function(){this.lineCommentStart=";",this.blockComment={start:"(",end:")"},this.$id="ace/mode/nc"}.call(y.prototype),e.Mode=y})}class Ga{constructor(){fe(this,"times",new Map)}getWidth(e,t,n){return 6*n.characterWidth}getText(e,t){const n=this.times.get(t);return n!==void 0?n.toFixed(1):""}updateTimes(e){e instanceof Map?this.times=e:(this.times=new Map,Object.entries(e).forEach(([t,n])=>{this.times.set(parseInt(t,10),n)}))}}var Va={exports:{}};(function(g,e){(function(){ace.require(["ace/mode/text"],function(t){g&&(g.exports=t)})})()})(Va);var Xa={exports:{}};(function(g,e){ace.define("ace/theme/monokai-css",["require","exports","module"],function(t,n,p){p.exports=`.ace-monokai .ace_gutter {
  background: #2F3129;
  color: #8F908A
}

.ace-monokai .ace_print-margin {
  width: 1px;
  background: #555651
}

.ace-monokai {
  background-color: #272822;
  color: #F8F8F2
}

.ace-monokai .ace_cursor {
  color: #F8F8F0
}

.ace-monokai .ace_marker-layer .ace_selection {
  background: #49483E
}

.ace-monokai.ace_multiselect .ace_selection.ace_start {
  box-shadow: 0 0 3px 0px #272822;
}

.ace-monokai .ace_marker-layer .ace_step {
  background: rgb(102, 82, 0)
}

.ace-monokai .ace_marker-layer .ace_bracket {
  margin: -1px 0 0 -1px;
  border: 1px solid #49483E
}

.ace-monokai .ace_marker-layer .ace_active-line {
  background: #202020
}

.ace-monokai .ace_gutter-active-line {
  background-color: #272727
}

.ace-monokai .ace_marker-layer .ace_selected-word {
  border: 1px solid #49483E
}

.ace-monokai .ace_invisible {
  color: #52524d
}

.ace-monokai .ace_entity.ace_name.ace_tag,
.ace-monokai .ace_keyword,
.ace-monokai .ace_meta.ace_tag,
.ace-monokai .ace_storage {
  color: #F92672
}

.ace-monokai .ace_punctuation,
.ace-monokai .ace_punctuation.ace_tag {
  color: #fff
}

.ace-monokai .ace_constant.ace_character,
.ace-monokai .ace_constant.ace_language,
.ace-monokai .ace_constant.ace_numeric,
.ace-monokai .ace_constant.ace_other {
  color: #AE81FF
}

.ace-monokai .ace_invalid {
  color: #F8F8F0;
  background-color: #F92672
}

.ace-monokai .ace_invalid.ace_deprecated {
  color: #F8F8F0;
  background-color: #AE81FF
}

.ace-monokai .ace_support.ace_constant,
.ace-monokai .ace_support.ace_function {
  color: #66D9EF
}

.ace-monokai .ace_fold {
  background-color: #A6E22E;
  border-color: #F8F8F2
}

.ace-monokai .ace_storage.ace_type,
.ace-monokai .ace_support.ace_class,
.ace-monokai .ace_support.ace_type {
  font-style: italic;
  color: #66D9EF
}

.ace-monokai .ace_entity.ace_name.ace_function,
.ace-monokai .ace_entity.ace_other,
.ace-monokai .ace_entity.ace_other.ace_attribute-name,
.ace-monokai .ace_variable {
  color: #A6E22E
}

.ace-monokai .ace_variable.ace_parameter {
  font-style: italic;
  color: #FD971F
}

.ace-monokai .ace_string {
  color: #E6DB74
}

.ace-monokai .ace_comment {
  color: #75715E
}

.ace-monokai .ace_indent-guide {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y
}

.ace-monokai .ace_indent-guide-active {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQIW2PQ1dX9zzBz5sz/ABCcBFFentLlAAAAAElFTkSuQmCC) right repeat-y;
}
`}),ace.define("ace/theme/monokai",["require","exports","module","ace/theme/monokai-css","ace/lib/dom"],function(t,n,p){n.isDark=!0,n.cssClass="ace-monokai",n.cssText=t("./monokai-css");var f=t("../lib/dom");f.importCssString(n.cssText,n.cssClass,!1)}),function(){ace.require(["ace/theme/monokai"],function(t){g&&(g.exports=t)})}()})(Xa);var ja={exports:{}};(function(g,e){ace.define("ace/snippets",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/editor"],function(t,n,p){var f=t("./lib/dom"),y=t("./lib/oop"),m=t("./lib/event_emitter").EventEmitter,l=t("./lib/lang"),u=t("./range").Range,r=t("./range_list").RangeList,a=t("./keyboard/hash_handler").HashHandler,s=t("./tokenizer").Tokenizer,o=t("./clipboard"),i={CURRENT_WORD:function(v){return v.session.getTextRange(v.session.getWordRange())},SELECTION:function(v,E,D){var L=v.session.getTextRange();return D?L.replace(/\n\r?([ \t]*\S)/g,`
`+D+"$1"):L},CURRENT_LINE:function(v){return v.session.getLine(v.getCursorPosition().row)},PREV_LINE:function(v){return v.session.getLine(v.getCursorPosition().row-1)},LINE_INDEX:function(v){return v.getCursorPosition().row},LINE_NUMBER:function(v){return v.getCursorPosition().row+1},SOFT_TABS:function(v){return v.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(v){return v.session.getTabSize()},CLIPBOARD:function(v){return o.getText&&o.getText()},FILENAME:function(v){return/[^/\\]*$/.exec(this.FILEPATH(v))[0]},FILENAME_BASE:function(v){return/[^/\\]*$/.exec(this.FILEPATH(v))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(v){return this.FILEPATH(v).replace(/[^/\\]*$/,"")},FILEPATH:function(v){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(v){var E=v.session.$mode||{};return E.blockComment&&E.blockComment.start||""},BLOCK_COMMENT_END:function(v){var E=v.session.$mode||{};return E.blockComment&&E.blockComment.end||""},LINE_COMMENT:function(v){var E=v.session.$mode||{};return E.lineCommentStart||""},CURRENT_YEAR:c.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:c.bind(null,{year:"2-digit"}),CURRENT_MONTH:c.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:c.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:c.bind(null,{month:"short"}),CURRENT_DATE:c.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:c.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:c.bind(null,{weekday:"short"}),CURRENT_HOUR:c.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:c.bind(null,{minute:"2-digit"}),CURRENT_SECOND:c.bind(null,{second:"2-digit"})};i.SELECTED_TEXT=i.SELECTION;function c(v){var E=new Date().toLocaleString("en-us",v);return E.length==1?"0"+E:E}var h=function(){function v(){this.snippetMap={},this.snippetNameMap={},this.variables=i}return v.prototype.getTokenizer=function(){return v.$tokenizer||this.createTokenizer()},v.prototype.createTokenizer=function(){function E(w){return w=w.substr(1),/^\d+$/.test(w)?[{tabstopId:parseInt(w,10)}]:[{text:w}]}function D(w){return"(?:[^\\\\"+w+"]|\\\\.)"}var L={regex:"/("+D("/")+"+)/",onMatch:function(w,I,R){var A=R[0];return A.fmtString=!0,A.guard=w.slice(1,-1),A.flag="",""},next:"formatString"};return v.$tokenizer=new s({start:[{regex:/\\./,onMatch:function(w,I,R){var A=w[1];return(A=="}"&&R.length||"`$\\".indexOf(A)!=-1)&&(w=A),[w]}},{regex:/}/,onMatch:function(w,I,R){return[R.length?R.shift():w]}},{regex:/\$(?:\d+|\w+)/,onMatch:E},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(w,I,R){var A=E(w.substr(1));return R.unshift(A[0]),A},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+D("\\|")+"*\\|",onMatch:function(w,I,R){var A=w.slice(1,-1).replace(/\\[,|\\]|,/g,function(x){return x.length==2?x[1]:"\0"}).split("\0").map(function(x){return{value:x}});return R[0].choices=A,[A[0]]},next:"start"},L,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(w,I,R){return R.length&&R[0].expectElse?(R[0].expectElse=!1,R[0].ifEnd={elseEnd:R[0]},[R[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(w,I,R){var A=w[1];return A=="}"&&R.length||"`$\\".indexOf(A)!=-1?w=A:A=="n"?w=`
`:A=="t"?w="	":"ulULE".indexOf(A)!=-1&&(w={changeCase:A,local:A>"a"}),[w]}},{regex:"/\\w*}",onMatch:function(w,I,R){var A=R.shift();return A&&(A.flag=w.slice(1,-1)),this.next=A&&A.tabstopId?"start":"",[A||w]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(w,I,R){return[{text:w.slice(1)}]}},{regex:/\${\w+/,onMatch:function(w,I,R){var A={text:w.slice(2)};return R.unshift(A),[A]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(w,I,R){var A=R.shift();return this.next=A&&A.tabstopId?"start":"",[A||w]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(w,I,R){var A=R[0];return A.formatFunction=w.slice(2,-1),[R.shift()]},next:"formatString"},L,{regex:/:[\?\-+]?/,onMatch:function(w,I,R){w[1]=="+"&&(R[0].ifEnd=R[0]),w[1]=="?"&&(R[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),v.$tokenizer},v.prototype.tokenizeTmSnippet=function(E,D){return this.getTokenizer().getLineTokens(E,D).tokens.map(function(L){return L.value||L})},v.prototype.getVariableValue=function(E,D,L){if(/^\d+$/.test(D))return(this.variables.__||{})[D]||"";if(/^[A-Z]\d+$/.test(D))return(this.variables[D[0]+"__"]||{})[D.substr(1)]||"";if(D=D.replace(/^TM_/,""),!this.variables.hasOwnProperty(D))return"";var w=this.variables[D];return typeof w=="function"&&(w=this.variables[D](E,D,L)),w??""},v.prototype.tmStrFormat=function(E,D,L){if(!D.fmt)return E;var w=D.flag||"",I=D.guard;I=new RegExp(I,w.replace(/[^gim]/g,""));var R=typeof D.fmt=="string"?this.tokenizeTmSnippet(D.fmt,"formatString"):D.fmt,A=this,x=E.replace(I,function(){var S=A.variables.__;A.variables.__=[].slice.call(arguments);for(var T=A.resolveVariables(R,L),P="E",N=0;N<T.length;N++){var k=T[N];if(typeof k=="object")if(T[N]="",k.changeCase&&k.local){var O=T[N+1];O&&typeof O=="string"&&(k.changeCase=="u"?T[N]=O[0].toUpperCase():T[N]=O[0].toLowerCase(),T[N+1]=O.substr(1))}else k.changeCase&&(P=k.changeCase);else P=="U"?T[N]=k.toUpperCase():P=="L"&&(T[N]=k.toLowerCase())}return A.variables.__=S,T.join("")});return x},v.prototype.tmFormatFunction=function(E,D,L){return D.formatFunction=="upcase"?E.toUpperCase():D.formatFunction=="downcase"?E.toLowerCase():E},v.prototype.resolveVariables=function(E,D){for(var L=[],w="",I=!0,R=0;R<E.length;R++){var A=E[R];if(typeof A=="string"){L.push(A),A==`
`?(I=!0,w=""):I&&(w=/^\t*/.exec(A)[0],I=/\S/.test(A));continue}if(A){if(I=!1,A.fmtString){var x=E.indexOf(A,R+1);x==-1&&(x=E.length),A.fmt=E.slice(R+1,x),R=x}if(A.text){var S=this.getVariableValue(D,A.text,w)+"";A.fmtString&&(S=this.tmStrFormat(S,A,D)),A.formatFunction&&(S=this.tmFormatFunction(S,A,D)),S&&!A.ifEnd?(L.push(S),T(A)):!S&&A.ifEnd&&T(A.ifEnd)}else A.elseEnd?T(A.elseEnd):(A.tabstopId!=null||A.changeCase!=null)&&L.push(A)}}function T(P){var N=E.indexOf(P,R+1);N!=-1&&(R=N)}return L},v.prototype.getDisplayTextForSnippet=function(E,D){var L=d.call(this,E,D);return L.text},v.prototype.insertSnippetForSelection=function(E,D,L){L===void 0&&(L={});var w=d.call(this,E,D,L),I=E.getSelectionRange(),R=E.session.replace(I,w.text),A=new _(E),x=E.inVirtualSelectionMode&&E.selection.index;A.addTabstops(w.tabstops,I.start,R,x)},v.prototype.insertSnippet=function(E,D,L){L===void 0&&(L={});var w=this;if(E.inVirtualSelectionMode)return w.insertSnippetForSelection(E,D,L);E.forEachSelection(function(){w.insertSnippetForSelection(E,D,L)},null,{keepOrder:!0}),E.tabstopManager&&E.tabstopManager.tabNext()},v.prototype.$getScope=function(E){var D=E.session.$mode.$id||"";if(D=D.split("/").pop(),D==="html"||D==="php"){D==="php"&&!E.session.$mode.inlinePhp&&(D="html");var L=E.getCursorPosition(),w=E.session.getState(L.row);typeof w=="object"&&(w=w[0]),w.substring&&(w.substring(0,3)=="js-"?D="javascript":w.substring(0,4)=="css-"?D="css":w.substring(0,4)=="php-"&&(D="php"))}return D},v.prototype.getActiveScopes=function(E){var D=this.$getScope(E),L=[D],w=this.snippetMap;return w[D]&&w[D].includeScopes&&L.push.apply(L,w[D].includeScopes),L.push("_"),L},v.prototype.expandWithTab=function(E,D){var L=this,w=E.forEachSelection(function(){return L.expandSnippetForSelection(E,D)},null,{keepOrder:!0});return w&&E.tabstopManager&&E.tabstopManager.tabNext(),w},v.prototype.expandSnippetForSelection=function(E,D){var L=E.getCursorPosition(),w=E.session.getLine(L.row),I=w.substring(0,L.column),R=w.substr(L.column),A=this.snippetMap,x;return this.getActiveScopes(E).some(function(S){var T=A[S];return T&&(x=this.findMatchingSnippet(T,I,R)),!!x},this),x?(D&&D.dryRun||(E.session.doc.removeInLine(L.row,L.column-x.replaceBefore.length,L.column+x.replaceAfter.length),this.variables.M__=x.matchBefore,this.variables.T__=x.matchAfter,this.insertSnippetForSelection(E,x.content),this.variables.M__=this.variables.T__=null),!0):!1},v.prototype.findMatchingSnippet=function(E,D,L){for(var w=E.length;w--;){var I=E[w];if(!(I.startRe&&!I.startRe.test(D))&&!(I.endRe&&!I.endRe.test(L))&&!(!I.startRe&&!I.endRe))return I.matchBefore=I.startRe?I.startRe.exec(D):[""],I.matchAfter=I.endRe?I.endRe.exec(L):[""],I.replaceBefore=I.triggerRe?I.triggerRe.exec(D)[0]:"",I.replaceAfter=I.endTriggerRe?I.endTriggerRe.exec(L)[0]:"",I}},v.prototype.register=function(E,D){var L=this.snippetMap,w=this.snippetNameMap,I=this;E||(E=[]);function R(S){return S&&!/^\^?\(.*\)\$?$|^\\b$/.test(S)&&(S="(?:"+S+")"),S||""}function A(S,T,P){return S=R(S),T=R(T),S=T+S,S&&S[S.length-1]!="$"&&(S=S+"$"),new RegExp(S)}function x(S){S.scope||(S.scope=D||"_"),D=S.scope,L[D]||(L[D]=[],w[D]={});var T=w[D];if(S.name){var P=T[S.name];P&&I.unregister(P),T[S.name]=S}L[D].push(S),S.prefix&&(S.tabTrigger=S.prefix),!S.content&&S.body&&(S.content=Array.isArray(S.body)?S.body.join(`
`):S.body),S.tabTrigger&&!S.trigger&&(!S.guard&&/^\w/.test(S.tabTrigger)&&(S.guard="\\b"),S.trigger=l.escapeRegExp(S.tabTrigger)),!(!S.trigger&&!S.guard&&!S.endTrigger&&!S.endGuard)&&(S.startRe=A(S.trigger,S.guard),S.triggerRe=new RegExp(S.trigger),S.endRe=A(S.endTrigger,S.endGuard),S.endTriggerRe=new RegExp(S.endTrigger))}Array.isArray(E)?E.forEach(x):Object.keys(E).forEach(function(S){x(E[S])}),this._signal("registerSnippets",{scope:D})},v.prototype.unregister=function(E,D){var L=this.snippetMap,w=this.snippetNameMap;function I(R){var A=w[R.scope||D];if(A&&A[R.name]){delete A[R.name];var x=L[R.scope||D],S=x&&x.indexOf(R);S>=0&&x.splice(S,1)}}E.content?I(E):Array.isArray(E)&&E.forEach(I)},v.prototype.parseSnippetFile=function(E){E=E.replace(/\r/g,"");for(var D=[],L={},w=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm,I;I=w.exec(E);){if(I[1])try{L=JSON.parse(I[1]),D.push(L)}catch{}if(I[4])L.content=I[4].replace(/^\t/gm,""),D.push(L),L={};else{var R=I[2],A=I[3];if(R=="regex"){var x=/\/((?:[^\/\\]|\\.)*)|$/g;L.guard=x.exec(A)[1],L.trigger=x.exec(A)[1],L.endTrigger=x.exec(A)[1],L.endGuard=x.exec(A)[1]}else R=="snippet"?(L.tabTrigger=A.match(/^\S*/)[0],L.name||(L.name=A)):R&&(L[R]=A)}}return D},v.prototype.getSnippetByName=function(E,D){var L=this.snippetNameMap,w;return this.getActiveScopes(D).some(function(I){var R=L[I];return R&&(w=R[E]),!!w},this),w},v}();y.implement(h.prototype,m);var d=function(v,E,D){D===void 0&&(D={});var L=v.getCursorPosition(),w=v.session.getLine(L.row),I=v.session.getTabString(),R=w.match(/^\s*/)[0];L.column<R.length&&(R=R.slice(0,L.column)),E=E.replace(/\r/g,"");var A=this.tokenizeTmSnippet(E);A=this.resolveVariables(A,v),A=A.map(function(G){return G==`
`&&!D.excludeExtraIndent?G+R:typeof G=="string"?G.replace(/\t/g,I):G});var x=[];A.forEach(function(G,K){if(typeof G=="object"){var Y=G.tabstopId,Z=x[Y];if(Z||(Z=x[Y]=[],Z.index=Y,Z.value="",Z.parents={}),Z.indexOf(G)===-1){G.choices&&!Z.choices&&(Z.choices=G.choices),Z.push(G);var ie=A.indexOf(G,K+1);if(ie!==-1){var oe=A.slice(K+1,ie),j=oe.some(function(ke){return typeof ke=="object"});j&&!Z.value?Z.value=oe:oe.length&&(!Z.value||typeof Z.value!="string")&&(Z.value=oe.join(""))}}}}),x.forEach(function(G){G.length=0});var S={};function T(G){for(var K=[],Y=0;Y<G.length;Y++){var Z=G[Y];if(typeof Z=="object"){if(S[Z.tabstopId])continue;var ie=G.lastIndexOf(Z,Y-1);Z=K[ie]||{tabstopId:Z.tabstopId}}K[Y]=Z}return K}for(var P=0;P<A.length;P++){var N=A[P];if(typeof N=="object"){var k=N.tabstopId,O=x[k],$=A.indexOf(N,P+1);if(S[k]){S[k]===N&&(delete S[k],Object.keys(S).forEach(function(G){O.parents[G]=!0}));continue}S[k]=N;var V=O.value;typeof V!="string"?V=T(V):N.fmt&&(V=this.tmStrFormat(V,N,v)),A.splice.apply(A,[P+1,Math.max(0,$-P)].concat(V,N)),O.indexOf(N)===-1&&O.push(N)}}var H=0,U=0,z="";return A.forEach(function(G){if(typeof G=="string"){var K=G.split(`
`);K.length>1?(U=K[K.length-1].length,H+=K.length-1):U+=G.length,z+=G}else G&&(G.start?G.end={row:H,column:U}:G.start={row:H,column:U})}),{text:z,tabstops:x,tokens:A}},_=function(){function v(E){if(this.index=0,this.ranges=[],this.tabstops=[],E.tabstopManager)return E.tabstopManager;E.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=l.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(E)}return v.prototype.attach=function(E){this.$openTabstops=null,this.selectedTabstop=null,this.editor=E,this.session=E.session,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},v.prototype.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges.length=0,this.tabstops.length=0,this.selectedTabstop=null,this.editor.off("change",this.$onChange),this.editor.off("changeSelection",this.$onChangeSelection),this.editor.off("changeSession",this.$onChangeSession),this.editor.commands.off("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.session=null,this.editor=null},v.prototype.onChange=function(E){for(var D=E.action[0]=="r",L=this.selectedTabstop||{},w=L.parents||{},I=this.tabstops.slice(),R=0;R<I.length;R++){var A=I[R],x=A==L||w[A.index];if(A.rangeList.$bias=x?0:1,E.action=="remove"&&A!==L){var S=A.parents&&A.parents[L.index],T=A.rangeList.pointIndex(E.start,S);T=T<0?-T-1:T+1;var P=A.rangeList.pointIndex(E.end,S);P=P<0?-P-1:P-1;for(var N=A.rangeList.ranges.slice(T,P),k=0;k<N.length;k++)this.removeRange(N[k])}A.rangeList.$onChange(E)}var O=this.session;!this.$inChange&&D&&O.getLength()==1&&!O.getValue()&&this.detach()},v.prototype.updateLinkedFields=function(){var E=this.selectedTabstop;if(!(!E||!E.hasLinkedRanges||!E.firstNonLinked)){this.$inChange=!0;for(var D=this.session,L=D.getTextRange(E.firstNonLinked),w=0;w<E.length;w++){var I=E[w];if(I.linked){var R=I.original,A=n.snippetManager.tmStrFormat(L,R,this.editor);D.replace(I,A)}}this.$inChange=!1}},v.prototype.onAfterExec=function(E){E.command&&!E.command.readOnly&&this.updateLinkedFields()},v.prototype.onChangeSelection=function(){if(this.editor){for(var E=this.editor.selection.lead,D=this.editor.selection.anchor,L=this.editor.selection.isEmpty(),w=0;w<this.ranges.length;w++)if(!this.ranges[w].linked){var I=this.ranges[w].contains(E.row,E.column),R=L||this.ranges[w].contains(D.row,D.column);if(I&&R)return}this.detach()}},v.prototype.onChangeSession=function(){this.detach()},v.prototype.tabNext=function(E){var D=this.tabstops.length,L=this.index+(E||1);L=Math.min(Math.max(L,1),D),L==D&&(L=0),this.selectTabstop(L),this.updateTabstopMarkers(),L===0&&this.detach()},v.prototype.selectTabstop=function(E){this.$openTabstops=null;var D=this.tabstops[this.index];if(D&&this.addTabstopMarkers(D),this.index=E,D=this.tabstops[this.index],!(!D||!D.length)){this.selectedTabstop=D;var L=D.firstNonLinked||D;if(D.choices&&(L.cursor=L.start),this.editor.inVirtualSelectionMode)this.editor.selection.fromOrientedRange(L);else{var w=this.editor.multiSelect;w.toSingleRange(L);for(var I=0;I<D.length;I++)D.hasLinkedRanges&&D[I].linked||w.addRange(D[I].clone(),!0)}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},v.prototype.addTabstops=function(E,D,L){var w=this.useLink||!this.editor.getOption("enableMultiselect");if(this.$openTabstops||(this.$openTabstops=[]),!E[0]){var I=u.fromPoints(L,L);M(I.start,D),M(I.end,D),E[0]=[I],E[0].index=0}var R=this.index,A=[R+1,0],x=this.ranges,S=this.snippetId=(this.snippetId||0)+1;E.forEach(function(T,P){var N=this.$openTabstops[P]||T;N.snippetId=S;for(var k=0;k<T.length;k++){var O=T[k],$=u.fromPoints(O.start,O.end||O.start);C($.start,D),C($.end,D),$.original=O,$.tabstop=N,x.push($),N!=T?N.unshift($):N[k]=$,O.fmtString||N.firstNonLinked&&w?($.linked=!0,N.hasLinkedRanges=!0):N.firstNonLinked||(N.firstNonLinked=$)}N.firstNonLinked||(N.hasLinkedRanges=!1),N===T&&(A.push(N),this.$openTabstops[P]=N),this.addTabstopMarkers(N),N.rangeList=N.rangeList||new r,N.rangeList.$bias=0,N.rangeList.addList(N)},this),A.length>2&&(this.tabstops.length&&A.push(A.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,A))},v.prototype.addTabstopMarkers=function(E){var D=this.session;E.forEach(function(L){L.markerId||(L.markerId=D.addMarker(L,"ace_snippet-marker","text"))})},v.prototype.removeTabstopMarkers=function(E){var D=this.session;E.forEach(function(L){D.removeMarker(L.markerId),L.markerId=null})},v.prototype.updateTabstopMarkers=function(){if(this.selectedTabstop){var E=this.selectedTabstop.snippetId;this.selectedTabstop.index===0&&E--,this.tabstops.forEach(function(D){D.snippetId===E?this.addTabstopMarkers(D):this.removeTabstopMarkers(D)},this)}},v.prototype.removeRange=function(E){var D=E.tabstop.indexOf(E);D!=-1&&E.tabstop.splice(D,1),D=this.ranges.indexOf(E),D!=-1&&this.ranges.splice(D,1),D=E.tabstop.rangeList.ranges.indexOf(E),D!=-1&&E.tabstop.splice(D,1),this.session.removeMarker(E.markerId),E.tabstop.length||(D=this.tabstops.indexOf(E.tabstop),D!=-1&&this.tabstops.splice(D,1),this.tabstops.length||this.detach())},v}();_.prototype.keyboardHandler=new a,_.prototype.keyboardHandler.bindKeys({Tab:function(v){n.snippetManager&&n.snippetManager.expandWithTab(v)||(v.tabstopManager.tabNext(1),v.renderer.scrollCursorIntoView())},"Shift-Tab":function(v){v.tabstopManager.tabNext(-1),v.renderer.scrollCursorIntoView()},Esc:function(v){v.tabstopManager.detach()}});var C=function(v,E){v.row==0&&(v.column+=E.column),v.row+=E.row},M=function(v,E){v.row==E.row&&(v.column-=E.column),v.row-=E.row};f.importCssString(`
.ace_snippet-marker {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    background: rgba(194, 193, 208, 0.09);
    border: 1px dotted rgba(211, 208, 235, 0.62);
    position: absolute;
}`,"snippets.css",!1),n.snippetManager=new h;var b=t("./editor").Editor;(function(){this.insertSnippet=function(v,E){return n.snippetManager.insertSnippet(this,v,E)},this.expandSnippet=function(v){return n.snippetManager.expandWithTab(this,v)}}).call(b.prototype)}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/config","ace/lib/useragent"],function(t,n,p){var f=t("../virtual_renderer").VirtualRenderer,y=t("../editor").Editor,m=t("../range").Range,l=t("../lib/event"),u=t("../lib/lang"),r=t("../lib/dom"),a=t("../config").nls,s=t("./../lib/useragent"),o=function(C){return"suggest-aria-id:".concat(C)},i=s.isSafari?"menu":"listbox",c=s.isSafari?"menuitem":"option",h=s.isSafari?"aria-current":"aria-selected",d=function(C){var M=new f(C);M.$maxLines=4;var b=new y(M);return b.setHighlightActiveLine(!1),b.setShowPrintMargin(!1),b.renderer.setShowGutter(!1),b.renderer.setHighlightGutterLine(!1),b.$mouseHandler.$focusTimeout=0,b.$highlightTagPending=!0,b},_=function(){function C(M){var b=r.createElement("div"),v=d(b);M&&M.appendChild(b),b.style.display="none",v.renderer.content.style.cursor="default",v.renderer.setStyle("ace_autocomplete"),v.renderer.$textLayer.element.setAttribute("role",i),v.renderer.$textLayer.element.setAttribute("aria-roledescription",a("autocomplete.popup.aria-roledescription","Autocomplete suggestions")),v.renderer.$textLayer.element.setAttribute("aria-label",a("autocomplete.popup.aria-label","Autocomplete suggestions")),v.renderer.textarea.setAttribute("aria-hidden","true"),v.setOption("displayIndentGuides",!1),v.setOption("dragDelay",150);var E=function(){};v.focus=E,v.$isFocused=!0,v.renderer.$cursorLayer.restartTimer=E,v.renderer.$cursorLayer.element.style.opacity="0",v.renderer.$maxLines=8,v.renderer.$keepTextAreaAtCursor=!1,v.setHighlightActiveLine(!1),v.session.highlight(""),v.session.$searchHighlight.clazz="ace_highlight-marker",v.on("mousedown",function(x){var S=x.getDocumentPosition();v.selection.moveToPosition(S),w.start.row=w.end.row=S.row,x.stop()});var D,L=new m(-1,0,-1,1/0),w=new m(-1,0,-1,1/0);w.id=v.session.addMarker(w,"ace_active-line","fullLine"),v.setSelectOnHover=function(x){x?L.id&&(v.session.removeMarker(L.id),L.id=null):L.id=v.session.addMarker(L,"ace_line-hover","fullLine")},v.setSelectOnHover(!1),v.on("mousemove",function(x){if(!D){D=x;return}if(!(D.x==x.x&&D.y==x.y)){D=x,D.scrollTop=v.renderer.scrollTop,v.isMouseOver=!0;var S=D.getDocumentPosition().row;L.start.row!=S&&(L.id||v.setRow(S),R(S))}}),v.renderer.on("beforeRender",function(){if(D&&L.start.row!=-1){D.$pos=null;var x=D.getDocumentPosition().row;L.id||v.setRow(x),R(x,!0)}}),v.renderer.on("afterRender",function(){for(var x=v.renderer.$textLayer,S=x.config.firstRow,T=x.config.lastRow;S<=T;S++){var P=x.element.childNodes[S-x.config.firstRow];P.setAttribute("role",c),P.setAttribute("aria-roledescription",a("autocomplete.popup.item.aria-roledescription","item")),P.setAttribute("aria-setsize",v.data.length),P.setAttribute("aria-describedby","doc-tooltip"),P.setAttribute("aria-posinset",S+1);var N=v.getData(S);if(N){var k="".concat(N.caption||N.value).concat(N.meta?", ".concat(N.meta):"");P.setAttribute("aria-label",k)}var O=P.querySelectorAll(".ace_completion-highlight");O.forEach(function($){$.setAttribute("role","mark")})}}),v.renderer.on("afterRender",function(){var x=v.getRow(),S=v.renderer.$textLayer,T=S.element.childNodes[x-S.config.firstRow],P=document.activeElement;if(T!==v.selectedNode&&v.selectedNode&&(r.removeCssClass(v.selectedNode,"ace_selected"),v.selectedNode.removeAttribute(h),v.selectedNode.removeAttribute("id")),P.removeAttribute("aria-activedescendant"),v.selectedNode=T,T){var N=o(x);r.addCssClass(T,"ace_selected"),T.id=N,S.element.setAttribute("aria-activedescendant",N),P.setAttribute("aria-activedescendant",N),T.setAttribute(h,"true")}});var I=function(){R(-1)},R=function(x,S){x!==L.start.row&&(L.start.row=L.end.row=x,S||v.session._emit("changeBackMarker"),v._emit("changeHoverMarker"))};v.getHoveredRow=function(){return L.start.row},l.addListener(v.container,"mouseout",function(){v.isMouseOver=!1,I()}),v.on("hide",I),v.on("changeSelection",I),v.session.doc.getLength=function(){return v.data.length},v.session.doc.getLine=function(x){var S=v.data[x];return typeof S=="string"?S:S&&S.value||""};var A=v.session.bgTokenizer;return A.$tokenizeRow=function(x){var S=v.data[x],T=[];if(!S)return T;typeof S=="string"&&(S={value:S});var P=S.caption||S.value||S.name;function N(G,K){G&&T.push({type:(S.className||"")+(K||""),value:G})}for(var k=P.toLowerCase(),O=(v.filterText||"").toLowerCase(),$=0,V=0,H=0;H<=O.length;H++)if(H!=V&&(S.matchMask&1<<H||H==O.length)){var U=O.slice(V,H);V=H;var z=k.indexOf(U,$);if(z==-1)continue;N(P.slice($,z),""),$=z+U.length,N(P.slice(z,$),"completion-highlight")}return N(P.slice($,P.length),""),T.push({type:"completion-spacer",value:" "}),S.meta&&T.push({type:"completion-meta",value:S.meta}),S.message&&T.push({type:"completion-message",value:S.message}),T},A.$updateOnChange=E,A.start=E,v.session.$computeWidth=function(){return this.screenWidth=0},v.isOpen=!1,v.isTopdown=!1,v.autoSelect=!0,v.filterText="",v.isMouseOver=!1,v.data=[],v.setData=function(x,S){v.filterText=S||"",v.setValue(u.stringRepeat(`
`,x.length),-1),v.data=x||[],v.setRow(0)},v.getData=function(x){return v.data[x]},v.getRow=function(){return w.start.row},v.setRow=function(x){x=Math.max(this.autoSelect?0:-1,Math.min(this.data.length-1,x)),w.start.row!=x&&(v.selection.clearSelection(),w.start.row=w.end.row=x||0,v.session._emit("changeBackMarker"),v.moveCursorTo(x||0,0),v.isOpen&&v._signal("select"))},v.on("changeSelection",function(){v.isOpen&&v.setRow(v.selection.lead.row),v.renderer.scrollCursorIntoView()}),v.hide=function(){this.container.style.display="none",v.anchorPos=null,v.anchor=null,v.isOpen&&(v.isOpen=!1,this._signal("hide"))},v.tryShow=function(x,S,T,P){if(!P&&v.isOpen&&v.anchorPos&&v.anchor&&v.anchorPos.top===x.top&&v.anchorPos.left===x.left&&v.anchor===T)return!0;var N=this.container,k=this.renderer.scrollBar.width||10,O=window.innerHeight-k,$=window.innerWidth-k,V=this.renderer,H=V.$maxLines*S*1.4,U={top:0,bottom:0},z=O-x.top-3*this.$borderSize-S,G=x.top-3*this.$borderSize;T||(G<=z||z>=H?T="bottom":T="top"),T==="top"?(U.bottom=x.top-this.$borderSize,U.top=U.bottom-H):T==="bottom"&&(U.top=x.top+S+this.$borderSize,U.bottom=U.top+H);var K=U.top>=0&&U.bottom<=O;if(!P&&!K)return!1;K?V.$maxPixelHeight=null:T==="top"?V.$maxPixelHeight=G:V.$maxPixelHeight=z,T==="top"?(N.style.top="",N.style.bottom=O+k-U.bottom+"px",v.isTopdown=!1):(N.style.top=U.top+"px",N.style.bottom="",v.isTopdown=!0),N.style.display="";var Y=x.left;return Y+N.offsetWidth>$&&(Y=$-N.offsetWidth),N.style.left=Y+"px",N.style.right="",v.isOpen||(v.isOpen=!0,this._signal("show"),D=null),v.anchorPos=x,v.anchor=T,r.$fixPositionBug(N),!0},v.show=function(x,S,T){this.tryShow(x,S,T?"bottom":void 0,!0)},v.goTo=function(x){var S=this.getRow(),T=this.session.getLength()-1;switch(x){case"up":S=S<=0?T:S-1;break;case"down":S=S>=T?-1:S+1;break;case"start":S=0;break;case"end":S=T;break}this.setRow(S)},v.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},v.$imageSize=0,v.$borderSize=1,v}return C}();r.importCssString(`
.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {
    background-color: #CAD6FA;
    z-index: 1;
}
.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {
    background-color: #3a674e;
}
.ace_editor.ace_autocomplete .ace_line-hover {
    border: 1px solid #abbffe;
    margin-top: -1px;
    background: rgba(233,233,253,0.4);
    position: absolute;
    z-index: 2;
}
.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {
    border: 1px solid rgba(109, 150, 13, 0.8);
    background: rgba(58, 103, 78, 0.62);
}
.ace_completion-meta {
    opacity: 0.5;
    margin-left: 0.9em;
}
.ace_completion-message {
    margin-left: 0.9em;
    color: blue;
}
.ace_editor.ace_autocomplete .ace_completion-highlight{
    color: #2d69c7;
}
.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{
    color: #93ca12;
}
.ace_editor.ace_autocomplete {
    width: 300px;
    z-index: 200000;
    border: 1px lightgray solid;
    position: fixed;
    box-shadow: 2px 3px 5px rgba(0,0,0,.2);
    line-height: 1.4;
    background: #fefefe;
    color: #111;
}
.ace_dark.ace_editor.ace_autocomplete {
    border: 1px #484747 solid;
    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);
    line-height: 1.4;
    background: #25282c;
    color: #c1c1c1;
}
.ace_autocomplete .ace_text-layer  {
    width: calc(100% - 8px);
}
.ace_autocomplete .ace_line {
    display: flex;
    align-items: center;
}
.ace_autocomplete .ace_line > * {
    min-width: 0;
    flex: 0 0 auto;
}
.ace_autocomplete .ace_line .ace_ {
    flex: 0 1 auto;
    overflow: hidden;
    text-overflow: ellipsis;
}
.ace_autocomplete .ace_completion-spacer {
    flex: 1;
}
.ace_autocomplete.ace_loading:after  {
    content: "";
    position: absolute;
    top: 0px;
    height: 2px;
    width: 8%;
    background: blue;
    z-index: 100;
    animation: ace_progress 3s infinite linear;
    animation-delay: 300ms;
    transform: translateX(-100%) scaleX(1);
}
@keyframes ace_progress {
    0% { transform: translateX(-100%) scaleX(1) }
    50% { transform: translateX(625%) scaleX(2) } 
    100% { transform: translateX(1500%) scaleX(3) } 
}
@media (prefers-reduced-motion) {
    .ace_autocomplete.ace_loading:after {
        transform: translateX(625%) scaleX(2);
        animation: none;
     }
}
`,"autocompletion.css",!1),n.AcePopup=_,n.$singleLineEditor=d,n.getAriaId=o}),ace.define("ace/autocomplete/inline_screenreader",["require","exports","module"],function(t,n,p){var f=function(){function y(m){this.editor=m,this.screenReaderDiv=document.createElement("div"),this.screenReaderDiv.classList.add("ace_screenreader-only"),this.editor.container.appendChild(this.screenReaderDiv)}return y.prototype.setScreenReaderContent=function(m){for(!this.popup&&this.editor.completer&&this.editor.completer.popup&&(this.popup=this.editor.completer.popup,this.popup.renderer.on("afterRender",function(){var u=this.popup.getRow(),r=this.popup.renderer.$textLayer,a=r.element.childNodes[u-r.config.firstRow];if(a){for(var s="doc-tooltip ",o=0;o<this._lines.length;o++)s+="ace-inline-screenreader-line-".concat(o," ");a.setAttribute("aria-describedby",s)}}.bind(this)));this.screenReaderDiv.firstChild;)this.screenReaderDiv.removeChild(this.screenReaderDiv.firstChild);this._lines=m.split(/\r\n|\r|\n/);var l=this.createCodeBlock();this.screenReaderDiv.appendChild(l)},y.prototype.destroy=function(){this.screenReaderDiv.remove()},y.prototype.createCodeBlock=function(){var m=document.createElement("pre");m.setAttribute("id","ace-inline-screenreader");for(var l=0;l<this._lines.length;l++){var u=document.createElement("code");u.setAttribute("id","ace-inline-screenreader-line-".concat(l));var r=document.createTextNode(this._lines[l]);u.appendChild(r),m.appendChild(u)}return m},y}();n.AceInlineScreenReader=f}),ace.define("ace/autocomplete/inline",["require","exports","module","ace/snippets","ace/autocomplete/inline_screenreader"],function(t,n,p){var f=t("../snippets").snippetManager,y=t("./inline_screenreader").AceInlineScreenReader,m=function(){function l(){this.editor=null}return l.prototype.show=function(u,r,a){if(a=a||"",u&&this.editor&&this.editor!==u&&(this.hide(),this.editor=null,this.inlineScreenReader=null),!u||!r)return!1;this.inlineScreenReader||(this.inlineScreenReader=new y(u));var s=r.snippet?f.getDisplayTextForSnippet(u,r.snippet):r.value;return r.hideInlinePreview||!s||!s.startsWith(a)?!1:(this.editor=u,this.inlineScreenReader.setScreenReaderContent(s),s=s.slice(a.length),s===""?u.removeGhostText():u.setGhostText(s),!0)},l.prototype.isOpen=function(){return this.editor?!!this.editor.renderer.$ghostText:!1},l.prototype.hide=function(){return this.editor?(this.editor.removeGhostText(),!0):!1},l.prototype.destroy=function(){this.hide(),this.editor=null,this.inlineScreenReader&&(this.inlineScreenReader.destroy(),this.inlineScreenReader=null)},l}();n.AceInline=m}),ace.define("ace/autocomplete/util",["require","exports","module"],function(t,n,p){n.parForEach=function(y,m,l){var u=0,r=y.length;r===0&&l();for(var a=0;a<r;a++)m(y[a],function(s,o){u++,u===r&&l(s,o)})};var f=/[a-zA-Z_0-9\$\-\u00A2-\u2000\u2070-\uFFFF]/;n.retrievePrecedingIdentifier=function(y,m,l){l=l||f;for(var u=[],r=m-1;r>=0&&l.test(y[r]);r--)u.push(y[r]);return u.reverse().join("")},n.retrieveFollowingIdentifier=function(y,m,l){l=l||f;for(var u=[],r=m;r<y.length&&l.test(y[r]);r++)u.push(y[r]);return u},n.getCompletionPrefix=function(y){var m=y.getCursorPosition(),l=y.session.getLine(m.row),u;return y.completers.forEach(function(r){r.identifierRegexps&&r.identifierRegexps.forEach(function(a){!u&&a&&(u=this.retrievePrecedingIdentifier(l,m.column,a))}.bind(this))}.bind(this)),u||this.retrievePrecedingIdentifier(l,m.column)},n.triggerAutocomplete=function(y,l){var l=l??y.session.getPrecedingCharacter();return y.completers.some(function(u){if(u.triggerCharacters&&Array.isArray(u.triggerCharacters))return u.triggerCharacters.includes(l)})}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/inline","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config","ace/lib/event","ace/lib/scroll"],function(t,n,p){var f=t("./keyboard/hash_handler").HashHandler,y=t("./autocomplete/popup").AcePopup,m=t("./autocomplete/inline").AceInline,l=t("./autocomplete/popup").getAriaId,u=t("./autocomplete/util"),r=t("./lib/lang"),a=t("./lib/dom"),s=t("./snippets").snippetManager,o=t("./config"),i=t("./lib/event"),c=t("./lib/scroll").preventParentScroll,h=function(M,b){b.completer&&b.completer.destroy()},d=function(){function M(){this.autoInsert=!1,this.autoSelect=!0,this.autoShown=!1,this.exactMatch=!1,this.inlineEnabled=!1,this.keyboardHandler=new f,this.keyboardHandler.bindKeys(this.commands),this.parentNode=null,this.setSelectOnHover=!1,this.hasSeen=new Set,this.showLoadingState=!1,this.stickySelectionDelay=500,this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.onLayoutChange=this.onLayoutChange.bind(this),this.changeTimer=r.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=r.delayedCall(this.updateDocTooltip.bind(this),50),this.popupTimer=r.delayedCall(this.$updatePopupPosition.bind(this),50),this.stickySelectionTimer=r.delayedCall(function(){this.stickySelection=!0}.bind(this),this.stickySelectionDelay),this.$firstOpenTimer=r.delayedCall(function(){var b=this.completionProvider&&this.completionProvider.initialPosition;this.autoShown||this.popup&&this.popup.isOpen||!b||this.editor.completers.length===0||(this.completions=new C(M.completionsForLoading),this.openPopup(this.editor,b.prefix,!1),this.popup.renderer.setStyle("ace_loading",!0))}.bind(this),this.stickySelectionDelay)}return Object.defineProperty(M,"completionsForLoading",{get:function(){return[{caption:o.nls("autocomplete.loading","Loading..."),value:""}]},enumerable:!1,configurable:!0}),M.prototype.$init=function(){return this.popup=new y(this.parentNode||document.body||document.documentElement),this.popup.on("click",function(b){this.insertMatch(),b.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.$onPopupShow.bind(this)),this.popup.on("hide",this.$onHidePopup.bind(this)),this.popup.on("select",this.$onPopupChange.bind(this)),i.addListener(this.popup.container,"mouseout",this.mouseOutListener.bind(this)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup.renderer.on("afterRender",this.$onPopupRender.bind(this)),this.popup},M.prototype.$initInline=function(){if(!(!this.inlineEnabled||this.inlineRenderer))return this.inlineRenderer=new m,this.inlineRenderer},M.prototype.getPopup=function(){return this.popup||this.$init()},M.prototype.$onHidePopup=function(){this.inlineRenderer&&this.inlineRenderer.hide(),this.hideDocTooltip(),this.stickySelectionTimer.cancel(),this.popupTimer.cancel(),this.stickySelection=!1},M.prototype.$seen=function(b){!this.hasSeen.has(b)&&b&&b.completer&&b.completer.onSeen&&typeof b.completer.onSeen=="function"&&(b.completer.onSeen(this.editor,b),this.hasSeen.add(b))},M.prototype.$onPopupChange=function(b){if(this.inlineRenderer&&this.inlineEnabled){var v=b?null:this.popup.getData(this.popup.getRow());if(this.$updateGhostText(v),this.popup.isMouseOver&&this.setSelectOnHover){this.tooltipTimer.call(null,null);return}this.popupTimer.schedule(),this.tooltipTimer.schedule()}else this.popupTimer.call(null,null),this.tooltipTimer.call(null,null)},M.prototype.$updateGhostText=function(b){var v=this.base.row,E=this.base.column,D=this.editor.getCursorPosition().column,L=this.editor.session.getLine(v).slice(E,D);this.inlineRenderer.show(this.editor,b,L)?this.$seen(b):this.inlineRenderer.hide()},M.prototype.$onPopupRender=function(){var b=this.inlineRenderer&&this.inlineEnabled;if(this.completions&&this.completions.filtered&&this.completions.filtered.length>0)for(var v=this.popup.getFirstVisibleRow();v<=this.popup.getLastVisibleRow();v++){var E=this.popup.getData(v);E&&(!b||E.hideInlinePreview)&&this.$seen(E)}},M.prototype.$onPopupShow=function(b){this.$onPopupChange(b),this.stickySelection=!1,this.stickySelectionDelay>=0&&this.stickySelectionTimer.schedule(this.stickySelectionDelay)},M.prototype.observeLayoutChanges=function(){if(!(this.$elements||!this.editor)){window.addEventListener("resize",this.onLayoutChange,{passive:!0}),window.addEventListener("wheel",this.mousewheelListener);for(var b=this.editor.container.parentNode,v=[];b;)v.push(b),b.addEventListener("scroll",this.onLayoutChange,{passive:!0}),b=b.parentNode;this.$elements=v}},M.prototype.unObserveLayoutChanges=function(){var b=this;window.removeEventListener("resize",this.onLayoutChange,{passive:!0}),window.removeEventListener("wheel",this.mousewheelListener),this.$elements&&this.$elements.forEach(function(v){v.removeEventListener("scroll",b.onLayoutChange,{passive:!0})}),this.$elements=null},M.prototype.onLayoutChange=function(){if(!this.popup.isOpen)return this.unObserveLayoutChanges();this.$updatePopupPosition(),this.updateDocTooltip()},M.prototype.$updatePopupPosition=function(){var b=this.editor,v=b.renderer,E=v.layerConfig.lineHeight,D=v.$cursorLayer.getPixelPosition(this.base,!0);D.left-=this.popup.getTextLeftOffset();var L=b.container.getBoundingClientRect();D.top+=L.top-v.layerConfig.offset,D.left+=L.left-b.renderer.scrollLeft,D.left+=v.gutterWidth;var w={top:D.top,left:D.left};v.$ghostText&&v.$ghostTextWidget&&this.base.row===v.$ghostText.position.row&&(w.top+=v.$ghostTextWidget.el.offsetHeight);var I=b.container.getBoundingClientRect().bottom-E,R=I<w.top?{top:I,left:w.left}:w;this.popup.tryShow(R,E,"bottom")||this.popup.tryShow(D,E,"top")||this.popup.show(D,E)},M.prototype.openPopup=function(b,v,E){this.$firstOpenTimer.cancel(),this.popup||this.$init(),this.inlineEnabled&&!this.inlineRenderer&&this.$initInline(),this.popup.autoSelect=this.autoSelect,this.popup.setSelectOnHover(this.setSelectOnHover);var D=this.popup.getRow(),L=this.popup.data[D];this.popup.setData(this.completions.filtered,this.completions.filterText),this.editor.textInput.setAriaOptions&&this.editor.textInput.setAriaOptions({activeDescendant:l(this.popup.getRow()),inline:this.inlineEnabled}),b.keyBinding.addKeyboardHandler(this.keyboardHandler);var w;this.stickySelection&&(w=this.popup.data.indexOf(L)),(!w||w===-1)&&(w=0),this.popup.setRow(this.autoSelect?w:-1),w===D&&L!==this.completions.filtered[w]&&this.$onPopupChange();var I=this.inlineRenderer&&this.inlineEnabled;if(w===D&&I){var R=this.popup.getData(this.popup.getRow());this.$updateGhostText(R)}E||(this.popup.setTheme(b.getTheme()),this.popup.setFontSize(b.getFontSize()),this.$updatePopupPosition(),this.tooltipNode&&this.updateDocTooltip()),this.changeTimer.cancel(),this.observeLayoutChanges()},M.prototype.detach=function(){this.editor&&(this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener)),this.$firstOpenTimer.cancel(),this.changeTimer.cancel(),this.hideDocTooltip(),this.completionProvider&&this.completionProvider.detach(),this.popup&&this.popup.isOpen&&this.popup.hide(),this.popup&&this.popup.renderer&&this.popup.renderer.off("afterRender",this.$onPopupRender),this.base&&this.base.detach(),this.activated=!1,this.completionProvider=this.completions=this.base=null,this.unObserveLayoutChanges()},M.prototype.changeListener=function(b){var v=this.editor.selection.lead;(v.row!=this.base.row||v.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},M.prototype.blurListener=function(b){var v=document.activeElement,E=this.editor.textInput.getElement(),D=b.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(b.relatedTarget),L=this.popup&&this.popup.container;v!=E&&v.parentNode!=L&&!D&&v!=this.tooltipNode&&b.relatedTarget!=E&&this.detach()},M.prototype.mousedownListener=function(b){this.detach()},M.prototype.mousewheelListener=function(b){this.popup&&!this.popup.isMouseOver&&this.detach()},M.prototype.mouseOutListener=function(b){this.popup.isOpen&&this.$updatePopupPosition()},M.prototype.goTo=function(b){this.popup.goTo(b)},M.prototype.insertMatch=function(b,v){if(b||(b=this.popup.getData(this.popup.getRow())),!b)return!1;if(b.value==="")return this.detach();var E=this.completions,D=this.getCompletionProvider().insertMatch(this.editor,b,E.filterText,v);return this.completions==E&&this.detach(),D},M.prototype.showPopup=function(b,v){this.editor&&this.detach(),this.activated=!0,this.editor=b,b.completer!=this&&(b.completer&&b.completer.detach(),b.completer=this),b.on("changeSelection",this.changeListener),b.on("blur",this.blurListener),b.on("mousedown",this.mousedownListener),b.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,v)},M.prototype.getCompletionProvider=function(b){return this.completionProvider||(this.completionProvider=new _(b)),this.completionProvider},M.prototype.gatherCompletions=function(b,v){return this.getCompletionProvider().gatherCompletions(b,v)},M.prototype.updateCompletions=function(b,v){if(b&&this.base&&this.completions){var D=this.editor.getCursorPosition(),L=this.editor.session.getTextRange({start:this.base,end:D});if(L==this.completions.filterText)return;if(this.completions.setFilter(L),!this.completions.filtered.length)return this.detach();if(this.completions.filtered.length==1&&this.completions.filtered[0].value==L&&!this.completions.filtered[0].snippet)return this.detach();this.openPopup(this.editor,L,b);return}if(v&&v.matches){var D=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(D.row,D.column),this.base.$insertRight=!0,this.completions=new C(v.matches),this.getCompletionProvider().completions=this.completions,this.openPopup(this.editor,"",b)}var E=this.editor.getSession(),D=this.editor.getCursorPosition(),L=u.getCompletionPrefix(this.editor);this.base=E.doc.createAnchor(D.row,D.column-L.length),this.base.$insertRight=!0;var w={exactMatch:this.exactMatch,ignoreCaption:this.ignoreCaption};this.getCompletionProvider({prefix:L,pos:D}).provideCompletions(this.editor,w,function(I,R,A){var x=R.filtered,S=u.getCompletionPrefix(this.editor);if(this.$firstOpenTimer.cancel(),A){if(!x.length){var T=!this.autoShown&&this.emptyMessage;if(typeof T=="function"&&(T=this.emptyMessage(S)),T){var P=[{caption:T,value:""}];this.completions=new C(P),this.openPopup(this.editor,S,b),this.popup.renderer.setStyle("ace_loading",!1),this.popup.renderer.setStyle("ace_empty-message",!0);return}return this.detach()}if(x.length==1&&x[0].value==S&&!x[0].snippet)return this.detach();if(this.autoInsert&&!this.autoShown&&x.length==1)return this.insertMatch(x[0])}this.completions=!A&&this.showLoadingState?new C(M.completionsForLoading.concat(x),R.filterText):R,this.openPopup(this.editor,S,b),this.popup.renderer.setStyle("ace_empty-message",!1),this.popup.renderer.setStyle("ace_loading",!A)}.bind(this)),this.showLoadingState&&!this.autoShown&&!(this.popup&&this.popup.isOpen)&&this.$firstOpenTimer.delay(this.stickySelectionDelay/2)},M.prototype.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},M.prototype.updateDocTooltip=function(){var b=this.popup,v=this.completions&&this.completions.filtered,E=v&&(v[b.getHoveredRow()]||v[b.getRow()]),D=null;if(!E||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();for(var L=this.editor.completers.length,w=0;w<L;w++){var I=this.editor.completers[w];if(I.getDocTooltip&&E.completerId===I.id){D=I.getDocTooltip(E);break}}if(!D&&typeof E!="string"&&(D=E),typeof D=="string"&&(D={docText:D}),!D||!(D.docHTML||D.docText))return this.hideDocTooltip();this.showDocTooltip(D)},M.prototype.showDocTooltip=function(b){this.tooltipNode||(this.tooltipNode=a.createElement("div"),this.tooltipNode.style.margin="0",this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.style.overscrollBehavior="contain",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this),this.tooltipNode.id="doc-tooltip",this.tooltipNode.setAttribute("role","tooltip"),this.tooltipNode.addEventListener("wheel",c));var v=this.editor.renderer.theme;this.tooltipNode.className="ace_tooltip ace_doc-tooltip "+(v.isDark?"ace_dark ":"")+(v.cssClass||"");var E=this.tooltipNode;b.docHTML?E.innerHTML=b.docHTML:b.docText&&(E.textContent=b.docText),E.parentNode||this.popup.container.appendChild(this.tooltipNode);var D=this.popup,L=D.container.getBoundingClientRect(),w=400,I=300,R=D.renderer.scrollBar.width||10,A=L.left,x=window.innerWidth-L.right-R,S=D.isTopdown?L.top:window.innerHeight-R-L.bottom,T=[Math.min(x/w,1),Math.min(A/w,1),Math.min(S/I*.9)],P=Math.max.apply(Math,T),N=E.style;N.display="block",P==T[0]?(N.left=L.right+1+"px",N.right="",N.maxWidth=w*P+"px",N.top=L.top+"px",N.bottom="",N.maxHeight=Math.min(window.innerHeight-R-L.top,I)+"px"):P==T[1]?(N.right=window.innerWidth-L.left+"px",N.left="",N.maxWidth=w*P+"px",N.top=L.top+"px",N.bottom="",N.maxHeight=Math.min(window.innerHeight-R-L.top,I)+"px"):P==T[2]&&(N.left=window.innerWidth-L.left+"px",N.maxWidth=Math.min(w,window.innerWidth)+"px",D.isTopdown?(N.top=L.bottom+"px",N.left=L.left+"px",N.right="",N.bottom="",N.maxHeight=Math.min(window.innerHeight-R-L.bottom,I)+"px"):(N.top=D.container.offsetTop-E.offsetHeight+"px",N.left=L.left+"px",N.right="",N.bottom="",N.maxHeight=Math.min(D.container.offsetTop,I)+"px"))},M.prototype.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),!!this.tooltipNode){var b=this.tooltipNode;!this.editor.isFocused()&&document.activeElement==b&&this.editor.focus(),this.tooltipNode=null,b.parentNode&&b.parentNode.removeChild(b)}},M.prototype.onTooltipClick=function(b){for(var v=b.target;v&&v!=this.tooltipNode;){if(v.nodeName=="A"&&v.href){v.rel="noreferrer",v.target="_blank";break}v=v.parentNode}},M.prototype.destroy=function(){if(this.detach(),this.popup){this.popup.destroy();var b=this.popup.container;b&&b.parentNode&&b.parentNode.removeChild(b)}this.editor&&this.editor.completer==this&&(this.editor.off("destroy",h),this.editor.completer=null),this.inlineRenderer=this.popup=this.editor=null},M.for=function(b){return b.completer instanceof M||(b.completer&&(b.completer.destroy(),b.completer=null),o.get("sharedPopups")?(M.$sharedInstance||(M.$sharedInstance=new M),b.completer=M.$sharedInstance):(b.completer=new M,b.once("destroy",h))),b.completer},M}();d.prototype.commands={Up:function(M){M.completer.goTo("up")},Down:function(M){M.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(M){M.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(M){M.completer.goTo("end")},Esc:function(M){M.completer.detach()},Return:function(M){return M.completer.insertMatch()},"Shift-Return":function(M){M.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(M){var b=M.completer.insertMatch();if(!b&&!M.tabstopManager)M.completer.goTo("down");else return b},Backspace:function(M){M.execCommand("backspace");var b=u.getCompletionPrefix(M);!b&&M.completer&&M.completer.detach()},PageUp:function(M){M.completer.popup.gotoPageUp()},PageDown:function(M){M.completer.popup.gotoPageDown()}},d.startCommand={name:"startAutocomplete",exec:function(M,b){var v=d.for(M);v.autoInsert=!1,v.autoSelect=!0,v.autoShown=!1,v.showPopup(M,b),v.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var _=function(){function M(b){this.initialPosition=b,this.active=!0}return M.prototype.insertByIndex=function(b,v,E){return!this.completions||!this.completions.filtered?!1:this.insertMatch(b,this.completions.filtered[v],E)},M.prototype.insertMatch=function(b,v,E){if(!v)return!1;if(b.startOperation({command:{name:"insertMatch"}}),v.completer&&v.completer.insertMatch)v.completer.insertMatch(b,v);else{if(!this.completions)return!1;var D=this.completions.filterText.length,L=0;if(v.range&&v.range.start.row===v.range.end.row&&(D-=this.initialPosition.prefix.length,D+=this.initialPosition.pos.column-v.range.start.column,L+=v.range.end.column-this.initialPosition.pos.column),D||L){var w;b.selection.getAllRanges?w=b.selection.getAllRanges():w=[b.getSelectionRange()];for(var I=0,R;R=w[I];I++)R.start.column-=D,R.end.column+=L,b.session.remove(R)}v.snippet?s.insertSnippet(b,v.snippet):this.$insertString(b,v),v.completer&&v.completer.onInsert&&typeof v.completer.onInsert=="function"&&v.completer.onInsert(b,v),v.command&&v.command==="startAutocomplete"&&b.execCommand(v.command)}return b.endOperation(),!0},M.prototype.$insertString=function(b,v){var E=v.value||v;b.execCommand("insertstring",E)},M.prototype.gatherCompletions=function(b,v){var E=b.getSession(),D=b.getCursorPosition(),L=u.getCompletionPrefix(b),w=[];this.completers=b.completers;var I=b.completers.length;return b.completers.forEach(function(R,A){R.getCompletions(b,E,D,L,function(x,S){R.hideInlinePreview&&(S=S.map(function(T){return Object.assign(T,{hideInlinePreview:R.hideInlinePreview})})),!x&&S&&(w=w.concat(S)),v(null,{prefix:u.getCompletionPrefix(b),matches:w,finished:--I===0})})}),!0},M.prototype.provideCompletions=function(b,v,E){var D=function(R){var A=R.prefix,x=R.matches;this.completions=new C(x),v.exactMatch&&(this.completions.exactMatch=!0),v.ignoreCaption&&(this.completions.ignoreCaption=!0),this.completions.setFilter(A),(R.finished||this.completions.filtered.length)&&E(null,this.completions,R.finished)}.bind(this),L=!0,w=null;if(this.gatherCompletions(b,function(R,A){if(this.active){R&&(E(R,[],!0),this.detach());var x=A.prefix;if(x.indexOf(A.prefix)===0){if(L){w=A;return}D(A)}}}.bind(this)),L=!1,w){var I=w;w=null,D(I)}},M.prototype.detach=function(){this.active=!1,this.completers&&this.completers.forEach(function(b){typeof b.cancel=="function"&&b.cancel()})},M}(),C=function(){function M(b,v){this.all=b,this.filtered=b,this.filterText=v||"",this.exactMatch=!1,this.ignoreCaption=!1}return M.prototype.setFilter=function(b){if(b.length>this.filterText&&b.lastIndexOf(this.filterText,0)===0)var v=this.filtered;else var v=this.all;this.filterText=b,v=this.filterCompletions(v,this.filterText),v=v.sort(function(D,L){return L.exactMatch-D.exactMatch||L.$score-D.$score||(D.caption||D.value).localeCompare(L.caption||L.value)});var E=null;v=v.filter(function(D){var L=D.snippet||D.caption||D.value;return L===E?!1:(E=L,!0)}),this.filtered=v},M.prototype.filterCompletions=function(b,v){var E=[],D=v.toUpperCase(),L=v.toLowerCase();e:for(var w=0,I;I=b[w];w++){if(I.skipFilter){I.$score=I.score,E.push(I);continue}var R=!this.ignoreCaption&&I.caption||I.value||I.snippet;if(R){var A=-1,x=0,S=0,T,P;if(this.exactMatch){if(v!==R.substr(0,v.length))continue e}else{var N=R.toLowerCase().indexOf(L);if(N>-1)S=N;else for(var k=0;k<v.length;k++){var O=R.indexOf(L[k],A+1),$=R.indexOf(D[k],A+1);if(T=O>=0&&($<0||O<$)?O:$,T<0)continue e;P=T-A-1,P>0&&(A===-1&&(S+=10),S+=P,x=x|1<<k),A=T}}I.matchMask=x,I.exactMatch=S?0:1,I.$score=(I.score||0)-S,E.push(I)}}return E},M}();n.Autocomplete=d,n.CompletionProvider=_,n.FilteredList=C}),ace.define("ace/marker_group",["require","exports","module"],function(t,n,p){var f=function(){function y(m,l){l&&(this.markerType=l.markerType),this.markers=[],this.session=m,m.addDynamicMarker(this)}return y.prototype.getMarkerAtPosition=function(m){return this.markers.find(function(l){return l.range.contains(m.row,m.column)})},y.prototype.markersComparator=function(m,l){return m.range.start.row-l.range.start.row},y.prototype.setMarkers=function(m){this.markers=m.sort(this.markersComparator).slice(0,this.MAX_MARKERS),this.session._signal("changeBackMarker")},y.prototype.update=function(m,l,u,r){if(!(!this.markers||!this.markers.length))for(var a=r.firstRow,s=r.lastRow,o,i=0,c=0,h=0;h<this.markers.length;h++){var d=this.markers[h];if(!(d.range.end.row<a)&&!(d.range.start.row>s)&&(d.range.start.row===c?i++:(c=d.range.start.row,i=0),!(i>200))){var _=d.range.clipRows(a,s);if(!(_.start.row===_.end.row&&_.start.column===_.end.column)){var C=_.toScreenRange(u);if(C.isEmpty()){o=u.getNextFoldLine(_.end.row,o),o&&o.end.row>_.end.row&&(a=o.end.row);continue}this.markerType==="fullLine"?l.drawFullLineMarker(m,C,d.className,r):C.isMultiLine()?this.markerType==="line"?l.drawMultiLineMarker(m,C,d.className,r):l.drawTextMarker(m,C,d.className,r):l.drawSingleLineMarker(m,C,d.className+" ace_br15",r)}}}},y}();f.prototype.MAX_MARKERS=1e4,n.MarkerGroup=f}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(t,n,p){var f=t("../range").Range,y=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;function m(u,r){var a=u.getTextRange(f.fromPoints({row:0,column:0},r));return a.split(y).length-1}function l(u,r){var a=m(u,r),s=u.getValue().split(y),o=Object.create(null),i=s[a];return s.forEach(function(c,h){if(!(!c||c===i)){var d=Math.abs(a-h),_=s.length-d;o[c]?o[c]=Math.max(_,o[c]):o[c]=_}}),o}n.getCompletions=function(u,r,a,s,o){var i=l(r,a),c=Object.keys(i);o(null,c.map(function(h){return{caption:h,value:h,score:i[h],meta:"local"}}))}}),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/marker_group","ace/autocomplete/text_completer","ace/editor","ace/config"],function(t,n,p){var f=t("../snippets").snippetManager,y=t("../autocomplete").Autocomplete,m=t("../config"),l=t("../lib/lang"),u=t("../autocomplete/util"),r=t("../marker_group").MarkerGroup,a=t("../autocomplete/text_completer"),s={getCompletions:function(L,w,I,R,A){if(w.$mode.completer)return w.$mode.completer.getCompletions(L,w,I,R,A);var x=L.session.getState(I.row),S=w.$mode.getCompletions(x,w,I,R);S=S.map(function(T){return T.completerId=s.id,T}),A(null,S)},id:"keywordCompleter"},o=function(L){var w={};return L.replace(/\${(\d+)(:(.*?))?}/g,function(I,R,A,x){return w[R]=x||""}).replace(/\$(\d+?)/g,function(I,R){return w[R]})},i={getCompletions:function(L,w,I,R,A){var x=[],S=w.getTokenAt(I.row,I.column);S&&S.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?x.push("html-tag"):x=f.getActiveScopes(L);var T=f.snippetMap,P=[];x.forEach(function(N){for(var k=T[N]||[],O=k.length;O--;){var $=k[O],V=$.name||$.tabTrigger;V&&P.push({caption:V,snippet:$.content,meta:$.tabTrigger&&!$.name?$.tabTrigger+" ":"snippet",completerId:i.id})}},this),A(null,P)},getDocTooltip:function(L){L.snippet&&!L.docHTML&&(L.docHTML=["<b>",l.escapeHTML(L.caption),"</b>","<hr></hr>",l.escapeHTML(o(L.snippet))].join(""))},id:"snippetCompleter"},c=[i,a,s];n.setCompleters=function(L){c.length=0,L&&c.push.apply(c,L)},n.addCompleter=function(L){c.push(L)},n.textCompleter=a,n.keyWordCompleter=s,n.snippetCompleter=i;var h={name:"expandSnippet",exec:function(L){return f.expandWithTab(L)},bindKey:"Tab"},d=function(L,w){_(w.session.$mode)},_=function(L){typeof L=="string"&&(L=m.$modes[L]),L&&(f.files||(f.files={}),C(L.$id,L.snippetFileId),L.modes&&L.modes.forEach(_))},C=function(L,w){!w||!L||f.files[L]||(f.files[L]={},m.loadModule(w,function(I){I&&(f.files[L]=I,!I.snippets&&I.snippetText&&(I.snippets=f.parseSnippetFile(I.snippetText)),f.register(I.snippets||[],I.scope),I.includeScopes&&(f.snippetMap[I.scope].includeScopes=I.includeScopes,I.includeScopes.forEach(function(R){_("ace/mode/"+R)})))}))},M=function(L){var w=L.editor,I=w.completer&&w.completer.activated;if(L.command.name==="backspace")I&&!u.getCompletionPrefix(w)&&w.completer.detach();else if(L.command.name==="insertstring"&&!I){b=L;var R=L.editor.$liveAutocompletionDelay;R?v.delay(R):E(L)}},b,v=l.delayedCall(function(){E(b)},0),E=function(L){var w=L.editor,I=u.getCompletionPrefix(w),R=L.args,A=u.triggerAutocomplete(w,R);if(I&&I.length>=w.$liveAutocompletionThreshold||A){var x=y.for(w);x.autoShown=!0,x.showPopup(w)}},D=t("../editor").Editor;t("../config").defineOptions(D.prototype,"editor",{enableBasicAutocompletion:{set:function(L){L?(y.for(this),this.completers||(this.completers=Array.isArray(L)?L:c),this.commands.addCommand(y.startCommand)):this.commands.removeCommand(y.startCommand)},value:!1},enableLiveAutocompletion:{set:function(L){L?(this.completers||(this.completers=Array.isArray(L)?L:c),this.commands.on("afterExec",M)):this.commands.off("afterExec",M)},value:!1},liveAutocompletionDelay:{initialValue:0},liveAutocompletionThreshold:{initialValue:0},enableSnippets:{set:function(L){L?(this.commands.addCommand(h),this.on("changeMode",d),d(null,this)):(this.commands.removeCommand(h),this.off("changeMode",d))},value:!1}}),n.MarkerGroup=r}),function(){ace.require(["ace/ext/language_tools"],function(t){g&&(g.exports=t)})}()})(ja);class Ka extends ti{constructor(){super();fe(this,"channelId");fe(this,"editor");fe(this,"programSession");fe(this,"executedSession");fe(this,"stateService");fe(this,"parserService");fe(this,"eventBus");fe(this,"parseDebounceTimer");fe(this,"timeGutterSide","right");fe(this,"activeTab","program");fe(this,"suppressProgramChange",!1);fe(this,"timeGutter");this.timeGutter=new Ga}static get observedAttributes(){return["channel-id","time-gutter-side","active-tab"]}attributeChangedCallback(t,n,p){if(n!==p)switch(t){case"channel-id":this.channelId=p,this.loadChannelProgram();break;case"time-gutter-side":this.timeGutterSide=p||"right",this.updateTimeGutterPosition();break;case"active-tab":this.activeTab=p||"program",this.switchTab();break}}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.parserService=t.get(be.ParserService),this.eventBus=t.get(be.EventBus),this.channelId=this.getAttribute("channel-id")||"channel-1",this.timeGutterSide=this.getAttribute("time-gutter-side")||"right",Wa(),this.setupEventListeners(),this.initializeEditor()}onDisconnected(){this.editor&&this.editor.destroy(),this.parseDebounceTimer&&window.clearTimeout(this.parseDebounceTimer)}setupEventListeners(){this.eventBus.on("parse:completed",t=>{const n=t.payload;n.channelId===this.channelId&&(this.updateMarkers(n.result.faults),n.artifacts?.timingMetadata&&(this.timeGutter.updateTimes(n.artifacts.timingMetadata),this.programSession?.bgTokenizer.fireUpdateEvent(0,this.programSession.getLength())))}),this.eventBus.on("channel:state-changed",t=>{t.payload.channelId===this.channelId&&this.loadChannelProgram()}),this.eventBus.on("keyword:clicked",t=>{const n=t.payload;n.channelId===this.channelId&&this.scrollToLine(n.lineNumber)}),this.eventBus.on("tool:clicked",t=>{const n=t.payload;n.channelId===this.channelId&&this.scrollToLine(n.lineNumber)})}initializeEditor(){const t=this.query(".ace-editor-container");if(!t)return;this.editor=di.edit(t,{theme:"ace/theme/monokai",fontSize:14,showPrintMargin:!1,highlightActiveLine:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!1});const n=di.require("ace/edit_session").EditSession;this.programSession=new n("","ace/mode/nc"),this.programSession.gutterRenderer=this.timeGutter,this.executedSession=new n("","ace/mode/nc"),this.programSession.on("change",()=>{this.activeTab==="program"&&this.handleProgramChange()}),this.programSession.on("changeSelection",()=>{this.activeTab==="program"&&this.handleSelectionChange()}),this.loadChannelProgram(),this.switchTab()}loadChannelProgram(){if(!this.programSession||!this.channelId)return;const t=this.stateService.getChannel(this.channelId);t&&(this.programSession.getValue()!==t.program&&(this.suppressProgramChange=!0,this.programSession.setValue(t.program||""),this.suppressProgramChange=!1),t.executedResult&&this.executedSession)}handleProgramChange(){if(!this.programSession)return;const t=this.programSession.getValue();this.suppressProgramChange||(this.stateService.updateChannel(this.channelId,{program:t}),this.parseDebounceTimer&&window.clearTimeout(this.parseDebounceTimer),this.parseDebounceTimer=window.setTimeout(()=>{this.parseProgram(t)},500))}async parseProgram(t){try{const{result:n,artifacts:p}=await this.parserService.parse(this.channelId,t);this.stateService.updateChannel(this.channelId,{parseResult:n,parseArtifacts:p})}catch(n){console.error("Failed to parse program:",n)}}handleSelectionChange(){if(!this.editor)return;const n=this.editor.getSelection().getCursor();this.eventBus.emit({type:"editor:selection-changed",timestamp:Date.now(),payload:{channelId:this.channelId,line:n.row+1,column:n.column}})}updateMarkers(t){if(!this.programSession)return;const n=this.programSession,p=n.getMarkers(!1);if(p&&Object.keys(p).forEach(y=>{n.removeMarker(parseInt(y,10))}),n.clearAnnotations(),!t||t.length===0)return;const f=[];t.forEach(y=>{const m=y.lineNumber-1,l=di.require("ace/range").Range,u=new l(m,0,m,1/0),r=y.severity==="ERROR"?"ace-error-marker":"ace-warning-marker";n.addMarker(u,r,"fullLine",!1),f.push({row:m,column:y.column,text:y.message,type:y.severity==="ERROR"?"error":"warning"})}),n.setAnnotations(f)}updateTimeGutterPosition(){console.log("Time gutter position:",this.timeGutterSide)}switchTab(){!this.editor||!this.programSession||!this.executedSession||(this.activeTab==="executed"?(this.editor.setSession(this.executedSession),this.editor.setReadOnly(!0)):(this.editor.setSession(this.programSession),this.editor.setReadOnly(!1)),this.updateTabStyles())}updateTabStyles(){this.shadow.querySelectorAll(".tab").forEach(n=>{n.getAttribute("data-tab")===this.activeTab?n.classList.add("active"):n.classList.remove("active")})}scrollToLine(t){this.editor&&this.editor.scrollToLine(t-1,!0,!0,()=>{this.editor?.gotoLine(t,0,!0)})}getValue(){return this.programSession?.getValue()||""}setValue(t){this.programSession&&this.programSession.setValue(t)}render(){this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const t=document.createElement("div");t.className="nc-code-pane";const n=this.createTabBar();t.appendChild(n);const p=document.createElement("div");p.className="ace-editor-container",t.appendChild(p),this.shadow.appendChild(t),setTimeout(()=>{this.editor||this.initializeEditor()},0)}createTabBar(){const t=document.createElement("div");t.className="tab-bar";const n=document.createElement("button");n.className=`tab ${this.activeTab==="program"?"active":""}`,n.textContent="Program",n.setAttribute("data-tab","program"),n.addEventListener("click",()=>{this.setAttribute("active-tab","program")});const p=document.createElement("button");return p.className=`tab ${this.activeTab==="executed"?"active":""}`,p.textContent="Executed",p.setAttribute("data-tab","executed"),p.addEventListener("click",()=>{this.setAttribute("active-tab","executed")}),t.appendChild(n),t.appendChild(p),t}getStyles(){return`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      .nc-code-pane {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        background: #272822;
      }

      .tab-bar {
        display: flex;
        background: #1e1e1e;
        border-bottom: 1px solid #3e3e42;
      }

      .tab {
        padding: 8px 16px;
        background: transparent;
        border: none;
        color: #888;
        cursor: pointer;
        font-size: 13px;
        font-family: inherit;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .tab:hover {
        background: #2a2a2a;
        color: #d4d4d4;
      }

      .tab.active {
        color: #569cd6;
        border-bottom-color: #569cd6;
      }

      .ace-editor-container {
        flex: 1;
        width: 100%;
        height: 100%;
        position: relative;
      }

      /* Custom marker styles */
      :host ::ng-deep .ace-error-marker {
        position: absolute;
        background-color: rgba(255, 0, 0, 0.1);
        border-left: 3px solid #f44336;
      }

      :host ::ng-deep .ace-warning-marker {
        position: absolute;
        background-color: rgba(255, 152, 0, 0.1);
        border-left: 3px solid #ff9800;
      }
    `}}customElements.define("nc-code-pane",Ka);class Ya extends ti{constructor(){super(...arguments);fe(this,"channelId");fe(this,"stateService");fe(this,"eventBus");fe(this,"keywords",[]);fe(this,"selectedKeyword",null)}static get observedAttributes(){return["channel-id"]}attributeChangedCallback(t,n,p){n!==p&&t==="channel-id"&&(this.channelId=p,this.loadKeywords())}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.eventBus=t.get(be.EventBus),this.channelId=this.getAttribute("channel-id")||"channel-1",this.setupEventListeners(),this.loadKeywords()}setupEventListeners(){this.eventBus.on("parse:completed",t=>{const n=t.payload;n.channelId===this.channelId&&(this.keywords=n.artifacts.keywords,this.requestRender())}),this.eventBus.on("editor:selection-changed",t=>{t.payload.channelId===this.channelId&&(this.selectedKeyword=null,this.requestRender())})}loadKeywords(){if(!this.channelId||!this.stateService)return;const t=this.stateService.getChannel(this.channelId);t?.parseArtifacts&&(this.keywords=t.parseArtifacts.keywords,this.requestRender())}handleKeywordClick(t){this.selectedKeyword=t,this.eventBus.emit({type:"keyword:clicked",timestamp:Date.now(),payload:{channelId:this.channelId,keyword:t.keyword,lineNumber:t.lineNumber}}),this.requestRender()}render(){this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const t=document.createElement("div");t.className="nc-keyword-panel";const n=document.createElement("div");if(n.className="panel-header",n.textContent="Keywords & Sync Codes",t.appendChild(n),this.keywords.length===0){const p=document.createElement("div");p.className="empty-state",p.textContent="No keywords found. Enter NC code in the editor.",t.appendChild(p)}else{const p=document.createElement("div");p.className="keyword-list";const f=this.groupKeywords(this.keywords);for(const[y,m]of Object.entries(f)){if(m.length===0)continue;const l=document.createElement("div");l.className="group-header",l.textContent=y,p.appendChild(l),m.forEach(u=>{const r=document.createElement("div");r.className="keyword-item",this.selectedKeyword===u&&r.classList.add("selected");const a=document.createElement("span");a.className="keyword-text",a.textContent=u.keyword;const s=document.createElement("span");s.className="line-number",s.textContent=`L${u.lineNumber}`,r.appendChild(a),r.appendChild(s),r.addEventListener("click",()=>{this.handleKeywordClick(u)}),p.appendChild(r)})}t.appendChild(p)}this.shadow.appendChild(t)}groupKeywords(t){const n={Motion:[],Spindle:[],Tool:[],Misc:[]};return t.forEach(p=>{const f=p.keyword.toUpperCase();/^G[0-3]$/.test(f)?n.Motion?.push(p):/^M[3-5]$/.test(f)?n.Spindle?.push(p):/^T\d+$/.test(f)?n.Tool?.push(p):n.Misc?.push(p)}),n}getStyles(){return`
      :host {
        display: block;
        width: 100%;
        height: 100%;
        overflow: auto;
      }

      .nc-keyword-panel {
        width: 100%;
        height: 100%;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .panel-header {
        padding: 10px 15px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
        font-weight: 500;
        font-size: 13px;
        text-transform: uppercase;
        color: #888;
      }

      .empty-state {
        padding: 20px;
        text-align: center;
        color: #666;
        font-size: 13px;
      }

      .keyword-list {
        padding: 5px 0;
      }

      .group-header {
        padding: 8px 15px;
        font-size: 11px;
        font-weight: 600;
        color: #888;
        text-transform: uppercase;
        background: #252526;
        border-bottom: 1px solid #3e3e42;
        border-top: 1px solid #3e3e42;
        margin-top: 5px;
      }

      .keyword-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 15px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 13px;
      }

      .keyword-item:hover {
        background: #2a2d2e;
      }

      .keyword-item.selected {
        background: #094771;
        border-left: 3px solid #569cd6;
      }

      .keyword-text {
        font-family: 'Courier New', monospace;
        color: #4ec9b0;
        font-weight: 500;
      }

      .line-number {
        font-size: 11px;
        color: #858585;
        font-family: 'Courier New', monospace;
      }
    `}}customElements.define("nc-keyword-panel",Ya);class Za extends ti{constructor(){super(...arguments);fe(this,"channelId");fe(this,"stateService");fe(this,"eventBus");fe(this,"variables",[]);fe(this,"filterText","");fe(this,"isOpen",!1)}static get observedAttributes(){return["channel-id","open"]}attributeChangedCallback(t,n,p){if(n!==p)switch(t){case"channel-id":this.channelId=p,this.loadVariables();break;case"open":this.isOpen=p==="true",this.requestRender();break}}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.eventBus=t.get(be.EventBus),this.channelId=this.getAttribute("channel-id")||"channel-1",this.isOpen=this.getAttribute("open")==="true",this.setupEventListeners(),this.loadVariables()}setupEventListeners(){this.eventBus.on("parse:completed",t=>{const n=t.payload;n.channelId===this.channelId&&this.updateVariables(n.artifacts.variableSnapshot.registers,!1)}),this.eventBus.on("execution:completed",t=>{const n=t.payload;n.channelId===this.channelId&&this.updateVariables(n.result.variableDeltas.registers,!0)})}loadVariables(){if(!this.channelId||!this.stateService)return;const t=this.stateService.getChannel(this.channelId);t?.parseArtifacts?.variableSnapshot&&this.updateVariables(t.parseArtifacts.variableSnapshot.registers,!1)}updateVariables(t,n){const p=[];t.forEach((f,y)=>{p.push({register:y,value:f,updated:n})}),this.variables=p.sort((f,y)=>f.register-y.register),this.requestRender()}handleFilterChange(t){const n=t.target;this.filterText=n.value,this.requestRender()}handleToggle(){this.isOpen=!this.isOpen,this.setAttribute("open",String(this.isOpen))}getFilteredVariables(){if(!this.filterText)return this.variables;const t=this.filterText.toLowerCase();return this.variables.filter(n=>n.register.toString().includes(t)||n.value.toString().includes(t))}render(){this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const t=document.createElement("div");t.className=`nc-variable-list ${this.isOpen?"open":"closed"}`;const n=document.createElement("div");n.className="panel-header",n.addEventListener("click",()=>this.handleToggle());const p=document.createElement("span");p.textContent=`Variables (${this.variables.length})`,n.appendChild(p);const f=document.createElement("span");if(f.className="arrow",f.textContent=this.isOpen?"":"",n.appendChild(f),t.appendChild(n),this.isOpen){const y=document.createElement("div");y.className="filter-container";const m=document.createElement("input");m.type="text",m.className="filter-input",m.placeholder="Filter variables...",m.value=this.filterText,m.addEventListener("input",u=>this.handleFilterChange(u)),y.appendChild(m),t.appendChild(y);const l=this.getFilteredVariables();if(l.length===0){const u=document.createElement("div");u.className="empty-state",u.textContent=this.filterText?"No variables match filter":"No variables defined",t.appendChild(u)}else{const u=document.createElement("div");u.className="variable-list";const r=Math.min(l.length,100);for(let a=0;a<r;a++){const s=l[a];if(!s)continue;const o=document.createElement("div");o.className=`variable-item ${s.updated?"updated":""}`;const i=document.createElement("span");i.className="register",i.textContent=`#${s.register}`;const c=document.createElement("span");c.className="value",c.textContent=s.value.toFixed(3),o.appendChild(i),o.appendChild(c),u.appendChild(o)}if(l.length>r){const a=document.createElement("div");a.className="more-items",a.textContent=`... and ${l.length-r} more`,u.appendChild(a)}t.appendChild(u)}}this.shadow.appendChild(t)}getStyles(){return`
      :host {
        display: block;
        width: 100%;
      }

      .nc-variable-list {
        width: 100%;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        border-top: 1px solid #3e3e42;
      }

      .nc-variable-list.closed {
        max-height: 40px;
      }

      .nc-variable-list.open {
        max-height: 400px;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
        cursor: pointer;
        user-select: none;
        font-size: 13px;
        font-weight: 500;
      }

      .panel-header:hover {
        background: #333;
      }

      .arrow {
        font-size: 10px;
        color: #888;
      }

      .filter-container {
        padding: 10px;
        background: #252526;
      }

      .filter-input {
        width: 100%;
        padding: 6px 10px;
        background: #3c3c3c;
        border: 1px solid #555;
        border-radius: 3px;
        color: #d4d4d4;
        font-size: 13px;
        outline: none;
      }

      .filter-input:focus {
        border-color: #569cd6;
      }

      .empty-state {
        padding: 20px;
        text-align: center;
        color: #666;
        font-size: 13px;
      }

      .variable-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .variable-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 15px;
        font-size: 13px;
        border-bottom: 1px solid #2d2d30;
      }

      .variable-item:hover {
        background: #2a2d2e;
      }

      .variable-item.updated {
        background: #1a3a1a;
        animation: highlight 2s ease-out;
      }

      @keyframes highlight {
        from {
          background: #2a5a2a;
        }
        to {
          background: #1a3a1a;
        }
      }

      .register {
        font-family: 'Courier New', monospace;
        color: #4ec9b0;
        font-weight: 500;
      }

      .value {
        font-family: 'Courier New', monospace;
        color: #b5cea8;
      }

      .more-items {
        padding: 10px 15px;
        text-align: center;
        color: #888;
        font-size: 12px;
        font-style: italic;
      }
    `}}customElements.define("nc-variable-list",Za);class Qa extends ti{constructor(){super(...arguments);fe(this,"channelId");fe(this,"stateService");fe(this,"eventBus");fe(this,"tools",[])}static get observedAttributes(){return["channel-id"]}attributeChangedCallback(t,n,p){n!==p&&t==="channel-id"&&(this.channelId=p,this.loadTools())}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.eventBus=t.get(be.EventBus),this.channelId=this.getAttribute("channel-id")||"channel-1",this.setupEventListeners(),this.loadTools()}setupEventListeners(){this.eventBus.on("parse:completed",t=>{const n=t.payload;n.channelId===this.channelId&&(this.tools=n.artifacts.toolRegisters,this.requestRender())})}loadTools(){if(!this.channelId||!this.stateService)return;const t=this.stateService.getChannel(this.channelId);t?.parseArtifacts?.toolRegisters&&(this.tools=t.parseArtifacts.toolRegisters,this.requestRender())}handleToolClick(t){this.eventBus.emit({type:"tool:clicked",timestamp:Date.now(),payload:{channelId:this.channelId,toolNumber:t.toolNumber,lineNumber:t.lineNumber}})}render(){this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const t=document.createElement("div");t.className="nc-tool-list";const n=document.createElement("div");if(n.className="panel-header",n.textContent=`Tools (${this.tools.length})`,t.appendChild(n),this.tools.length===0){const p=document.createElement("div");p.className="empty-state",p.textContent="No tool changes found",t.appendChild(p)}else{const p=document.createElement("div");p.className="tool-list",this.tools.forEach(f=>{const y=document.createElement("div");y.className="tool-item",y.addEventListener("click",()=>this.handleToolClick(f));const m=document.createElement("div");m.className="tool-header";const l=document.createElement("span");l.className="tool-number",l.textContent=`T${f.toolNumber}`;const u=document.createElement("span");if(u.className="line-number",u.textContent=`L${f.lineNumber}`,m.appendChild(l),m.appendChild(u),y.appendChild(m),f.qParameter!==void 0||f.rParameter!==void 0){const r=document.createElement("div");if(r.className="tool-params",f.qParameter!==void 0){const a=document.createElement("span");a.className="param",a.innerHTML=`<span class="param-name">Q:</span> ${f.qParameter.toFixed(3)}`,r.appendChild(a)}if(f.rParameter!==void 0){const a=document.createElement("span");a.className="param",a.innerHTML=`<span class="param-name">R:</span> ${f.rParameter.toFixed(3)}`,r.appendChild(a)}y.appendChild(r)}p.appendChild(y)}),t.appendChild(p)}this.shadow.appendChild(t)}getStyles(){return`
      :host {
        display: block;
        width: 100%;
        height: 100%;
        overflow: auto;
      }

      .nc-tool-list {
        width: 100%;
        height: 100%;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .panel-header {
        padding: 10px 15px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
        font-weight: 500;
        font-size: 13px;
        text-transform: uppercase;
        color: #888;
      }

      .empty-state {
        padding: 20px;
        text-align: center;
        color: #666;
        font-size: 13px;
      }

      .tool-list {
        padding: 5px 0;
      }

      .tool-item {
        padding: 10px 15px;
        border-bottom: 1px solid #2d2d30;
        cursor: pointer;
        transition: background 0.2s;
      }

      .tool-item:hover {
        background: #2a2d2e;
      }

      .tool-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
      }

      .tool-number {
        font-family: 'Courier New', monospace;
        color: #dcdcaa;
        font-weight: 600;
        font-size: 14px;
      }

      .line-number {
        font-size: 11px;
        color: #858585;
        font-family: 'Courier New', monospace;
      }

      .tool-params {
        display: flex;
        gap: 15px;
        font-size: 12px;
        font-family: 'Courier New', monospace;
      }

      .param {
        color: #ce9178;
      }

      .param-name {
        color: #9cdcfe;
        font-weight: 500;
      }
    `}}customElements.define("nc-tool-list",Qa);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Qr="161",qa=0,cs=1,Ja=2,Bo=1,el=2,Yt=3,dn=0,bt=1,Zt=2,cn=0,Kn=1,hs=2,us=3,ds=4,tl=5,bn=100,nl=101,il=102,fs=103,ps=104,rl=200,sl=201,ol=202,al=203,zr=204,Hr=205,ll=206,cl=207,hl=208,ul=209,dl=210,fl=211,pl=212,gl=213,ml=214,vl=0,yl=1,_l=2,Gi=3,Sl=4,xl=5,bl=6,wl=7,zo=0,Ml=1,El=2,hn=0,Cl=1,Al=2,Tl=3,Ll=4,Rl=5,Dl=6,Ho=300,Qn=301,qn=302,Wr=303,Gr=304,Zi=306,Vr=1e3,Ot=1001,Xr=1002,yt=1003,gs=1004,si=1005,St=1006,lr=1007,Mn=1008,un=1009,Il=1010,Pl=1011,qr=1012,Wo=1013,ln=1014,Qt=1015,fi=1016,Go=1017,Vo=1018,En=1020,Nl=1021,$t=1023,kl=1024,Ol=1025,Cn=1026,Jn=1027,$l=1028,Xo=1029,Fl=1030,jo=1031,Ko=1033,cr=33776,hr=33777,ur=33778,dr=33779,ms=35840,vs=35841,ys=35842,_s=35843,Yo=36196,Ss=37492,xs=37496,bs=37808,ws=37809,Ms=37810,Es=37811,Cs=37812,As=37813,Ts=37814,Ls=37815,Rs=37816,Ds=37817,Is=37818,Ps=37819,Ns=37820,ks=37821,fr=36492,Os=36494,$s=36495,Ul=36283,Fs=36284,Us=36285,Bs=36286,Zo=3e3,An=3001,Bl=3200,zl=3201,Hl=0,Wl=1,It="",ut="srgb",en="srgb-linear",Jr="display-p3",Qi="display-p3-linear",Vi="linear",Je="srgb",Xi="rec709",ji="p3",Rn=7680,zs=519,Gl=512,Vl=513,Xl=514,Qo=515,jl=516,Kl=517,Yl=518,Zl=519,Hs=35044,Ws="300 es",jr=1035,qt=2e3,Ki=2001;class ni{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const p=this._listeners[e];if(p!==void 0){const f=p.indexOf(t);f!==-1&&p.splice(f,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const p=n.slice(0);for(let f=0,y=p.length;f<y;f++)p[f].call(this,e);e.target=null}}}const pt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],pr=Math.PI/180,Kr=180/Math.PI;function pi(){const g=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(pt[g&255]+pt[g>>8&255]+pt[g>>16&255]+pt[g>>24&255]+"-"+pt[e&255]+pt[e>>8&255]+"-"+pt[e>>16&15|64]+pt[e>>24&255]+"-"+pt[t&63|128]+pt[t>>8&255]+"-"+pt[t>>16&255]+pt[t>>24&255]+pt[n&255]+pt[n>>8&255]+pt[n>>16&255]+pt[n>>24&255]).toLowerCase()}function xt(g,e,t){return Math.max(e,Math.min(t,g))}function Ql(g,e){return(g%e+e)%e}function gr(g,e,t){return(1-t)*g+t*e}function Gs(g){return(g&g-1)===0&&g!==0}function Yr(g){return Math.pow(2,Math.floor(Math.log(g)/Math.LN2))}function oi(g,e){switch(e.constructor){case Float32Array:return g;case Uint32Array:return g/4294967295;case Uint16Array:return g/65535;case Uint8Array:return g/255;case Int32Array:return Math.max(g/2147483647,-1);case Int16Array:return Math.max(g/32767,-1);case Int8Array:return Math.max(g/127,-1);default:throw new Error("Invalid component type.")}}function _t(g,e){switch(e.constructor){case Float32Array:return g;case Uint32Array:return Math.round(g*4294967295);case Uint16Array:return Math.round(g*65535);case Uint8Array:return Math.round(g*255);case Int32Array:return Math.round(g*2147483647);case Int16Array:return Math.round(g*32767);case Int8Array:return Math.round(g*127);default:throw new Error("Invalid component type.")}}class We{constructor(e=0,t=0){We.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,p=e.elements;return this.x=p[0]*t+p[3]*n+p[6],this.y=p[1]*t+p[4]*n+p[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(xt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),p=Math.sin(t),f=this.x-e.x,y=this.y-e.y;return this.x=f*n-y*p+e.x,this.y=f*p+y*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ue{constructor(e,t,n,p,f,y,m,l,u){Ue.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,p,f,y,m,l,u)}set(e,t,n,p,f,y,m,l,u){const r=this.elements;return r[0]=e,r[1]=p,r[2]=m,r[3]=t,r[4]=f,r[5]=l,r[6]=n,r[7]=y,r[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,p=t.elements,f=this.elements,y=n[0],m=n[3],l=n[6],u=n[1],r=n[4],a=n[7],s=n[2],o=n[5],i=n[8],c=p[0],h=p[3],d=p[6],_=p[1],C=p[4],M=p[7],b=p[2],v=p[5],E=p[8];return f[0]=y*c+m*_+l*b,f[3]=y*h+m*C+l*v,f[6]=y*d+m*M+l*E,f[1]=u*c+r*_+a*b,f[4]=u*h+r*C+a*v,f[7]=u*d+r*M+a*E,f[2]=s*c+o*_+i*b,f[5]=s*h+o*C+i*v,f[8]=s*d+o*M+i*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],p=e[2],f=e[3],y=e[4],m=e[5],l=e[6],u=e[7],r=e[8];return t*y*r-t*m*u-n*f*r+n*m*l+p*f*u-p*y*l}invert(){const e=this.elements,t=e[0],n=e[1],p=e[2],f=e[3],y=e[4],m=e[5],l=e[6],u=e[7],r=e[8],a=r*y-m*u,s=m*l-r*f,o=u*f-y*l,i=t*a+n*s+p*o;if(i===0)return this.set(0,0,0,0,0,0,0,0,0);const c=1/i;return e[0]=a*c,e[1]=(p*u-r*n)*c,e[2]=(m*n-p*y)*c,e[3]=s*c,e[4]=(r*t-p*l)*c,e[5]=(p*f-m*t)*c,e[6]=o*c,e[7]=(n*l-u*t)*c,e[8]=(y*t-n*f)*c,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,p,f,y,m){const l=Math.cos(f),u=Math.sin(f);return this.set(n*l,n*u,-n*(l*y+u*m)+y+e,-p*u,p*l,-p*(-u*y+l*m)+m+t,0,0,1),this}scale(e,t){return this.premultiply(mr.makeScale(e,t)),this}rotate(e){return this.premultiply(mr.makeRotation(-e)),this}translate(e,t){return this.premultiply(mr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let p=0;p<9;p++)if(t[p]!==n[p])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const mr=new Ue;function qo(g){for(let e=g.length-1;e>=0;--e)if(g[e]>=65535)return!0;return!1}function Yi(g){return document.createElementNS("http://www.w3.org/1999/xhtml",g)}function ql(){const g=Yi("canvas");return g.style.display="block",g}const Vs={};function Yn(g){g in Vs||(Vs[g]=!0,console.warn(g))}const Xs=new Ue().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),js=new Ue().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),xi={[en]:{transfer:Vi,primaries:Xi,toReference:g=>g,fromReference:g=>g},[ut]:{transfer:Je,primaries:Xi,toReference:g=>g.convertSRGBToLinear(),fromReference:g=>g.convertLinearToSRGB()},[Qi]:{transfer:Vi,primaries:ji,toReference:g=>g.applyMatrix3(js),fromReference:g=>g.applyMatrix3(Xs)},[Jr]:{transfer:Je,primaries:ji,toReference:g=>g.convertSRGBToLinear().applyMatrix3(js),fromReference:g=>g.applyMatrix3(Xs).convertLinearToSRGB()}},Jl=new Set([en,Qi]),je={enabled:!0,_workingColorSpace:en,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(g){if(!Jl.has(g))throw new Error(`Unsupported working color space, "${g}".`);this._workingColorSpace=g},convert:function(g,e,t){if(this.enabled===!1||e===t||!e||!t)return g;const n=xi[e].toReference,p=xi[t].fromReference;return p(n(g))},fromWorkingColorSpace:function(g,e){return this.convert(g,this._workingColorSpace,e)},toWorkingColorSpace:function(g,e){return this.convert(g,e,this._workingColorSpace)},getPrimaries:function(g){return xi[g].primaries},getTransfer:function(g){return g===It?Vi:xi[g].transfer}};function Zn(g){return g<.04045?g*.0773993808:Math.pow(g*.9478672986+.0521327014,2.4)}function vr(g){return g<.0031308?g*12.92:1.055*Math.pow(g,.41666)-.055}let Dn;class Jo{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Dn===void 0&&(Dn=Yi("canvas")),Dn.width=e.width,Dn.height=e.height;const n=Dn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Dn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Yi("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const p=n.getImageData(0,0,e.width,e.height),f=p.data;for(let y=0;y<f.length;y++)f[y]=Zn(f[y]/255)*255;return n.putImageData(p,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Zn(t[n]/255)*255):t[n]=Zn(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ec=0;class ea{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ec++}),this.uuid=pi(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},p=this.data;if(p!==null){let f;if(Array.isArray(p)){f=[];for(let y=0,m=p.length;y<m;y++)p[y].isDataTexture?f.push(yr(p[y].image)):f.push(yr(p[y]))}else f=yr(p);n.url=f}return t||(e.images[this.uuid]=n),n}}function yr(g){return typeof HTMLImageElement<"u"&&g instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&g instanceof ImageBitmap?Jo.getDataURL(g):g.data?{data:Array.from(g.data),width:g.width,height:g.height,type:g.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let tc=0;class wt extends ni{constructor(e=wt.DEFAULT_IMAGE,t=wt.DEFAULT_MAPPING,n=Ot,p=Ot,f=St,y=Mn,m=$t,l=un,u=wt.DEFAULT_ANISOTROPY,r=It){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:tc++}),this.uuid=pi(),this.name="",this.source=new ea(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=p,this.magFilter=f,this.minFilter=y,this.anisotropy=u,this.format=m,this.internalFormat=null,this.type=l,this.offset=new We(0,0),this.repeat=new We(1,1),this.center=new We(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ue,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof r=="string"?this.colorSpace=r:(Yn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=r===An?ut:It),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Ho)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Vr:e.x=e.x-Math.floor(e.x);break;case Ot:e.x=e.x<0?0:1;break;case Xr:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Vr:e.y=e.y-Math.floor(e.y);break;case Ot:e.y=e.y<0?0:1;break;case Xr:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Yn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ut?An:Zo}set encoding(e){Yn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===An?ut:It}}wt.DEFAULT_IMAGE=null;wt.DEFAULT_MAPPING=Ho;wt.DEFAULT_ANISOTROPY=1;class ct{constructor(e=0,t=0,n=0,p=1){ct.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=p}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,p){return this.x=e,this.y=t,this.z=n,this.w=p,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,p=this.z,f=this.w,y=e.elements;return this.x=y[0]*t+y[4]*n+y[8]*p+y[12]*f,this.y=y[1]*t+y[5]*n+y[9]*p+y[13]*f,this.z=y[2]*t+y[6]*n+y[10]*p+y[14]*f,this.w=y[3]*t+y[7]*n+y[11]*p+y[15]*f,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,p,f;const l=e.elements,u=l[0],r=l[4],a=l[8],s=l[1],o=l[5],i=l[9],c=l[2],h=l[6],d=l[10];if(Math.abs(r-s)<.01&&Math.abs(a-c)<.01&&Math.abs(i-h)<.01){if(Math.abs(r+s)<.1&&Math.abs(a+c)<.1&&Math.abs(i+h)<.1&&Math.abs(u+o+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const C=(u+1)/2,M=(o+1)/2,b=(d+1)/2,v=(r+s)/4,E=(a+c)/4,D=(i+h)/4;return C>M&&C>b?C<.01?(n=0,p=.707106781,f=.707106781):(n=Math.sqrt(C),p=v/n,f=E/n):M>b?M<.01?(n=.707106781,p=0,f=.707106781):(p=Math.sqrt(M),n=v/p,f=D/p):b<.01?(n=.707106781,p=.707106781,f=0):(f=Math.sqrt(b),n=E/f,p=D/f),this.set(n,p,f,t),this}let _=Math.sqrt((h-i)*(h-i)+(a-c)*(a-c)+(s-r)*(s-r));return Math.abs(_)<.001&&(_=1),this.x=(h-i)/_,this.y=(a-c)/_,this.z=(s-r)/_,this.w=Math.acos((u+o+d-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class nc extends ni{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ct(0,0,e,t),this.scissorTest=!1,this.viewport=new ct(0,0,e,t);const p={width:e,height:t,depth:1};n.encoding!==void 0&&(Yn("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===An?ut:It),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:St,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new wt(p,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ea(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Tn extends nc{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class ta extends wt{constructor(e=null,t=1,n=1,p=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:p},this.magFilter=yt,this.minFilter=yt,this.wrapR=Ot,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ic extends wt{constructor(e=null,t=1,n=1,p=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:p},this.magFilter=yt,this.minFilter=yt,this.wrapR=Ot,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class gi{constructor(e=0,t=0,n=0,p=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=p}static slerpFlat(e,t,n,p,f,y,m){let l=n[p+0],u=n[p+1],r=n[p+2],a=n[p+3];const s=f[y+0],o=f[y+1],i=f[y+2],c=f[y+3];if(m===0){e[t+0]=l,e[t+1]=u,e[t+2]=r,e[t+3]=a;return}if(m===1){e[t+0]=s,e[t+1]=o,e[t+2]=i,e[t+3]=c;return}if(a!==c||l!==s||u!==o||r!==i){let h=1-m;const d=l*s+u*o+r*i+a*c,_=d>=0?1:-1,C=1-d*d;if(C>Number.EPSILON){const b=Math.sqrt(C),v=Math.atan2(b,d*_);h=Math.sin(h*v)/b,m=Math.sin(m*v)/b}const M=m*_;if(l=l*h+s*M,u=u*h+o*M,r=r*h+i*M,a=a*h+c*M,h===1-m){const b=1/Math.sqrt(l*l+u*u+r*r+a*a);l*=b,u*=b,r*=b,a*=b}}e[t]=l,e[t+1]=u,e[t+2]=r,e[t+3]=a}static multiplyQuaternionsFlat(e,t,n,p,f,y){const m=n[p],l=n[p+1],u=n[p+2],r=n[p+3],a=f[y],s=f[y+1],o=f[y+2],i=f[y+3];return e[t]=m*i+r*a+l*o-u*s,e[t+1]=l*i+r*s+u*a-m*o,e[t+2]=u*i+r*o+m*s-l*a,e[t+3]=r*i-m*a-l*s-u*o,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,p){return this._x=e,this._y=t,this._z=n,this._w=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,p=e._y,f=e._z,y=e._order,m=Math.cos,l=Math.sin,u=m(n/2),r=m(p/2),a=m(f/2),s=l(n/2),o=l(p/2),i=l(f/2);switch(y){case"XYZ":this._x=s*r*a+u*o*i,this._y=u*o*a-s*r*i,this._z=u*r*i+s*o*a,this._w=u*r*a-s*o*i;break;case"YXZ":this._x=s*r*a+u*o*i,this._y=u*o*a-s*r*i,this._z=u*r*i-s*o*a,this._w=u*r*a+s*o*i;break;case"ZXY":this._x=s*r*a-u*o*i,this._y=u*o*a+s*r*i,this._z=u*r*i+s*o*a,this._w=u*r*a-s*o*i;break;case"ZYX":this._x=s*r*a-u*o*i,this._y=u*o*a+s*r*i,this._z=u*r*i-s*o*a,this._w=u*r*a+s*o*i;break;case"YZX":this._x=s*r*a+u*o*i,this._y=u*o*a+s*r*i,this._z=u*r*i-s*o*a,this._w=u*r*a-s*o*i;break;case"XZY":this._x=s*r*a-u*o*i,this._y=u*o*a-s*r*i,this._z=u*r*i+s*o*a,this._w=u*r*a+s*o*i;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+y)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,p=Math.sin(n);return this._x=e.x*p,this._y=e.y*p,this._z=e.z*p,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],p=t[4],f=t[8],y=t[1],m=t[5],l=t[9],u=t[2],r=t[6],a=t[10],s=n+m+a;if(s>0){const o=.5/Math.sqrt(s+1);this._w=.25/o,this._x=(r-l)*o,this._y=(f-u)*o,this._z=(y-p)*o}else if(n>m&&n>a){const o=2*Math.sqrt(1+n-m-a);this._w=(r-l)/o,this._x=.25*o,this._y=(p+y)/o,this._z=(f+u)/o}else if(m>a){const o=2*Math.sqrt(1+m-n-a);this._w=(f-u)/o,this._x=(p+y)/o,this._y=.25*o,this._z=(l+r)/o}else{const o=2*Math.sqrt(1+a-n-m);this._w=(y-p)/o,this._x=(f+u)/o,this._y=(l+r)/o,this._z=.25*o}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(xt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const p=Math.min(1,t/n);return this.slerp(e,p),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,p=e._y,f=e._z,y=e._w,m=t._x,l=t._y,u=t._z,r=t._w;return this._x=n*r+y*m+p*u-f*l,this._y=p*r+y*l+f*m-n*u,this._z=f*r+y*u+n*l-p*m,this._w=y*r-n*m-p*l-f*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,p=this._y,f=this._z,y=this._w;let m=y*e._w+n*e._x+p*e._y+f*e._z;if(m<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,m=-m):this.copy(e),m>=1)return this._w=y,this._x=n,this._y=p,this._z=f,this;const l=1-m*m;if(l<=Number.EPSILON){const o=1-t;return this._w=o*y+t*this._w,this._x=o*n+t*this._x,this._y=o*p+t*this._y,this._z=o*f+t*this._z,this.normalize(),this}const u=Math.sqrt(l),r=Math.atan2(u,m),a=Math.sin((1-t)*r)/u,s=Math.sin(t*r)/u;return this._w=y*a+this._w*s,this._x=n*a+this._x*s,this._y=p*a+this._y*s,this._z=f*a+this._z*s,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),p=2*Math.PI*Math.random(),f=2*Math.PI*Math.random();return this.set(t*Math.cos(p),n*Math.sin(f),n*Math.cos(f),t*Math.sin(p))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class q{constructor(e=0,t=0,n=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ks.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ks.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,p=this.z,f=e.elements;return this.x=f[0]*t+f[3]*n+f[6]*p,this.y=f[1]*t+f[4]*n+f[7]*p,this.z=f[2]*t+f[5]*n+f[8]*p,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,p=this.z,f=e.elements,y=1/(f[3]*t+f[7]*n+f[11]*p+f[15]);return this.x=(f[0]*t+f[4]*n+f[8]*p+f[12])*y,this.y=(f[1]*t+f[5]*n+f[9]*p+f[13])*y,this.z=(f[2]*t+f[6]*n+f[10]*p+f[14])*y,this}applyQuaternion(e){const t=this.x,n=this.y,p=this.z,f=e.x,y=e.y,m=e.z,l=e.w,u=2*(y*p-m*n),r=2*(m*t-f*p),a=2*(f*n-y*t);return this.x=t+l*u+y*a-m*r,this.y=n+l*r+m*u-f*a,this.z=p+l*a+f*r-y*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,p=this.z,f=e.elements;return this.x=f[0]*t+f[4]*n+f[8]*p,this.y=f[1]*t+f[5]*n+f[9]*p,this.z=f[2]*t+f[6]*n+f[10]*p,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,p=e.y,f=e.z,y=t.x,m=t.y,l=t.z;return this.x=p*l-f*m,this.y=f*y-n*l,this.z=n*m-p*y,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _r.copy(this).projectOnVector(e),this.sub(_r)}reflect(e){return this.sub(_r.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(xt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,p=this.z-e.z;return t*t+n*n+p*p}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const p=Math.sin(t)*e;return this.x=p*Math.sin(n),this.y=Math.cos(t)*e,this.z=p*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),p=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=p,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _r=new q,Ks=new gi;class mi{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Pt.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Pt.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Pt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const f=n.getAttribute("position");if(t===!0&&f!==void 0&&e.isInstancedMesh!==!0)for(let y=0,m=f.count;y<m;y++)e.isMesh===!0?e.getVertexPosition(y,Pt):Pt.fromBufferAttribute(f,y),Pt.applyMatrix4(e.matrixWorld),this.expandByPoint(Pt);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),bi.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),bi.copy(n.boundingBox)),bi.applyMatrix4(e.matrixWorld),this.union(bi)}const p=e.children;for(let f=0,y=p.length;f<y;f++)this.expandByObject(p[f],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Pt),Pt.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ai),wi.subVectors(this.max,ai),In.subVectors(e.a,ai),Pn.subVectors(e.b,ai),Nn.subVectors(e.c,ai),tn.subVectors(Pn,In),nn.subVectors(Nn,Pn),mn.subVectors(In,Nn);let t=[0,-tn.z,tn.y,0,-nn.z,nn.y,0,-mn.z,mn.y,tn.z,0,-tn.x,nn.z,0,-nn.x,mn.z,0,-mn.x,-tn.y,tn.x,0,-nn.y,nn.x,0,-mn.y,mn.x,0];return!Sr(t,In,Pn,Nn,wi)||(t=[1,0,0,0,1,0,0,0,1],!Sr(t,In,Pn,Nn,wi))?!1:(Mi.crossVectors(tn,nn),t=[Mi.x,Mi.y,Mi.z],Sr(t,In,Pn,Nn,wi))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Pt).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Pt).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Gt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gt),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Gt=[new q,new q,new q,new q,new q,new q,new q,new q],Pt=new q,bi=new mi,In=new q,Pn=new q,Nn=new q,tn=new q,nn=new q,mn=new q,ai=new q,wi=new q,Mi=new q,vn=new q;function Sr(g,e,t,n,p){for(let f=0,y=g.length-3;f<=y;f+=3){vn.fromArray(g,f);const m=p.x*Math.abs(vn.x)+p.y*Math.abs(vn.y)+p.z*Math.abs(vn.z),l=e.dot(vn),u=t.dot(vn),r=n.dot(vn);if(Math.max(-Math.max(l,u,r),Math.min(l,u,r))>m)return!1}return!0}const rc=new mi,li=new q,xr=new q;class qi{constructor(e=new q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):rc.setFromPoints(e).getCenter(n);let p=0;for(let f=0,y=e.length;f<y;f++)p=Math.max(p,n.distanceToSquared(e[f]));return this.radius=Math.sqrt(p),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;li.subVectors(e,this.center);const t=li.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),p=(n-this.radius)*.5;this.center.addScaledVector(li,p/n),this.radius+=p}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(xr.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(li.copy(e.center).add(xr)),this.expandByPoint(li.copy(e.center).sub(xr))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Vt=new q,br=new q,Ei=new q,rn=new q,wr=new q,Ci=new q,Mr=new q;class na{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Vt)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Vt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vt.copy(this.origin).addScaledVector(this.direction,t),Vt.distanceToSquared(e))}distanceSqToSegment(e,t,n,p){br.copy(e).add(t).multiplyScalar(.5),Ei.copy(t).sub(e).normalize(),rn.copy(this.origin).sub(br);const f=e.distanceTo(t)*.5,y=-this.direction.dot(Ei),m=rn.dot(this.direction),l=-rn.dot(Ei),u=rn.lengthSq(),r=Math.abs(1-y*y);let a,s,o,i;if(r>0)if(a=y*l-m,s=y*m-l,i=f*r,a>=0)if(s>=-i)if(s<=i){const c=1/r;a*=c,s*=c,o=a*(a+y*s+2*m)+s*(y*a+s+2*l)+u}else s=f,a=Math.max(0,-(y*s+m)),o=-a*a+s*(s+2*l)+u;else s=-f,a=Math.max(0,-(y*s+m)),o=-a*a+s*(s+2*l)+u;else s<=-i?(a=Math.max(0,-(-y*f+m)),s=a>0?-f:Math.min(Math.max(-f,-l),f),o=-a*a+s*(s+2*l)+u):s<=i?(a=0,s=Math.min(Math.max(-f,-l),f),o=s*(s+2*l)+u):(a=Math.max(0,-(y*f+m)),s=a>0?f:Math.min(Math.max(-f,-l),f),o=-a*a+s*(s+2*l)+u);else s=y>0?-f:f,a=Math.max(0,-(y*s+m)),o=-a*a+s*(s+2*l)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,a),p&&p.copy(br).addScaledVector(Ei,s),o}intersectSphere(e,t){Vt.subVectors(e.center,this.origin);const n=Vt.dot(this.direction),p=Vt.dot(Vt)-n*n,f=e.radius*e.radius;if(p>f)return null;const y=Math.sqrt(f-p),m=n-y,l=n+y;return l<0?null:m<0?this.at(l,t):this.at(m,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,p,f,y,m,l;const u=1/this.direction.x,r=1/this.direction.y,a=1/this.direction.z,s=this.origin;return u>=0?(n=(e.min.x-s.x)*u,p=(e.max.x-s.x)*u):(n=(e.max.x-s.x)*u,p=(e.min.x-s.x)*u),r>=0?(f=(e.min.y-s.y)*r,y=(e.max.y-s.y)*r):(f=(e.max.y-s.y)*r,y=(e.min.y-s.y)*r),n>y||f>p||((f>n||isNaN(n))&&(n=f),(y<p||isNaN(p))&&(p=y),a>=0?(m=(e.min.z-s.z)*a,l=(e.max.z-s.z)*a):(m=(e.max.z-s.z)*a,l=(e.min.z-s.z)*a),n>l||m>p)||((m>n||n!==n)&&(n=m),(l<p||p!==p)&&(p=l),p<0)?null:this.at(n>=0?n:p,t)}intersectsBox(e){return this.intersectBox(e,Vt)!==null}intersectTriangle(e,t,n,p,f){wr.subVectors(t,e),Ci.subVectors(n,e),Mr.crossVectors(wr,Ci);let y=this.direction.dot(Mr),m;if(y>0){if(p)return null;m=1}else if(y<0)m=-1,y=-y;else return null;rn.subVectors(this.origin,e);const l=m*this.direction.dot(Ci.crossVectors(rn,Ci));if(l<0)return null;const u=m*this.direction.dot(wr.cross(rn));if(u<0||l+u>y)return null;const r=-m*rn.dot(Mr);return r<0?null:this.at(r/y,f)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class rt{constructor(e,t,n,p,f,y,m,l,u,r,a,s,o,i,c,h){rt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,p,f,y,m,l,u,r,a,s,o,i,c,h)}set(e,t,n,p,f,y,m,l,u,r,a,s,o,i,c,h){const d=this.elements;return d[0]=e,d[4]=t,d[8]=n,d[12]=p,d[1]=f,d[5]=y,d[9]=m,d[13]=l,d[2]=u,d[6]=r,d[10]=a,d[14]=s,d[3]=o,d[7]=i,d[11]=c,d[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new rt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,p=1/kn.setFromMatrixColumn(e,0).length(),f=1/kn.setFromMatrixColumn(e,1).length(),y=1/kn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*p,t[1]=n[1]*p,t[2]=n[2]*p,t[3]=0,t[4]=n[4]*f,t[5]=n[5]*f,t[6]=n[6]*f,t[7]=0,t[8]=n[8]*y,t[9]=n[9]*y,t[10]=n[10]*y,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,p=e.y,f=e.z,y=Math.cos(n),m=Math.sin(n),l=Math.cos(p),u=Math.sin(p),r=Math.cos(f),a=Math.sin(f);if(e.order==="XYZ"){const s=y*r,o=y*a,i=m*r,c=m*a;t[0]=l*r,t[4]=-l*a,t[8]=u,t[1]=o+i*u,t[5]=s-c*u,t[9]=-m*l,t[2]=c-s*u,t[6]=i+o*u,t[10]=y*l}else if(e.order==="YXZ"){const s=l*r,o=l*a,i=u*r,c=u*a;t[0]=s+c*m,t[4]=i*m-o,t[8]=y*u,t[1]=y*a,t[5]=y*r,t[9]=-m,t[2]=o*m-i,t[6]=c+s*m,t[10]=y*l}else if(e.order==="ZXY"){const s=l*r,o=l*a,i=u*r,c=u*a;t[0]=s-c*m,t[4]=-y*a,t[8]=i+o*m,t[1]=o+i*m,t[5]=y*r,t[9]=c-s*m,t[2]=-y*u,t[6]=m,t[10]=y*l}else if(e.order==="ZYX"){const s=y*r,o=y*a,i=m*r,c=m*a;t[0]=l*r,t[4]=i*u-o,t[8]=s*u+c,t[1]=l*a,t[5]=c*u+s,t[9]=o*u-i,t[2]=-u,t[6]=m*l,t[10]=y*l}else if(e.order==="YZX"){const s=y*l,o=y*u,i=m*l,c=m*u;t[0]=l*r,t[4]=c-s*a,t[8]=i*a+o,t[1]=a,t[5]=y*r,t[9]=-m*r,t[2]=-u*r,t[6]=o*a+i,t[10]=s-c*a}else if(e.order==="XZY"){const s=y*l,o=y*u,i=m*l,c=m*u;t[0]=l*r,t[4]=-a,t[8]=u*r,t[1]=s*a+c,t[5]=y*r,t[9]=o*a-i,t[2]=i*a-o,t[6]=m*r,t[10]=c*a+s}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(sc,e,oc)}lookAt(e,t,n){const p=this.elements;return Et.subVectors(e,t),Et.lengthSq()===0&&(Et.z=1),Et.normalize(),sn.crossVectors(n,Et),sn.lengthSq()===0&&(Math.abs(n.z)===1?Et.x+=1e-4:Et.z+=1e-4,Et.normalize(),sn.crossVectors(n,Et)),sn.normalize(),Ai.crossVectors(Et,sn),p[0]=sn.x,p[4]=Ai.x,p[8]=Et.x,p[1]=sn.y,p[5]=Ai.y,p[9]=Et.y,p[2]=sn.z,p[6]=Ai.z,p[10]=Et.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,p=t.elements,f=this.elements,y=n[0],m=n[4],l=n[8],u=n[12],r=n[1],a=n[5],s=n[9],o=n[13],i=n[2],c=n[6],h=n[10],d=n[14],_=n[3],C=n[7],M=n[11],b=n[15],v=p[0],E=p[4],D=p[8],L=p[12],w=p[1],I=p[5],R=p[9],A=p[13],x=p[2],S=p[6],T=p[10],P=p[14],N=p[3],k=p[7],O=p[11],$=p[15];return f[0]=y*v+m*w+l*x+u*N,f[4]=y*E+m*I+l*S+u*k,f[8]=y*D+m*R+l*T+u*O,f[12]=y*L+m*A+l*P+u*$,f[1]=r*v+a*w+s*x+o*N,f[5]=r*E+a*I+s*S+o*k,f[9]=r*D+a*R+s*T+o*O,f[13]=r*L+a*A+s*P+o*$,f[2]=i*v+c*w+h*x+d*N,f[6]=i*E+c*I+h*S+d*k,f[10]=i*D+c*R+h*T+d*O,f[14]=i*L+c*A+h*P+d*$,f[3]=_*v+C*w+M*x+b*N,f[7]=_*E+C*I+M*S+b*k,f[11]=_*D+C*R+M*T+b*O,f[15]=_*L+C*A+M*P+b*$,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],p=e[8],f=e[12],y=e[1],m=e[5],l=e[9],u=e[13],r=e[2],a=e[6],s=e[10],o=e[14],i=e[3],c=e[7],h=e[11],d=e[15];return i*(+f*l*a-p*u*a-f*m*s+n*u*s+p*m*o-n*l*o)+c*(+t*l*o-t*u*s+f*y*s-p*y*o+p*u*r-f*l*r)+h*(+t*u*a-t*m*o-f*y*a+n*y*o+f*m*r-n*u*r)+d*(-p*m*r-t*l*a+t*m*s+p*y*a-n*y*s+n*l*r)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const p=this.elements;return e.isVector3?(p[12]=e.x,p[13]=e.y,p[14]=e.z):(p[12]=e,p[13]=t,p[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],p=e[2],f=e[3],y=e[4],m=e[5],l=e[6],u=e[7],r=e[8],a=e[9],s=e[10],o=e[11],i=e[12],c=e[13],h=e[14],d=e[15],_=a*h*u-c*s*u+c*l*o-m*h*o-a*l*d+m*s*d,C=i*s*u-r*h*u-i*l*o+y*h*o+r*l*d-y*s*d,M=r*c*u-i*a*u+i*m*o-y*c*o-r*m*d+y*a*d,b=i*a*l-r*c*l-i*m*s+y*c*s+r*m*h-y*a*h,v=t*_+n*C+p*M+f*b;if(v===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/v;return e[0]=_*E,e[1]=(c*s*f-a*h*f-c*p*o+n*h*o+a*p*d-n*s*d)*E,e[2]=(m*h*f-c*l*f+c*p*u-n*h*u-m*p*d+n*l*d)*E,e[3]=(a*l*f-m*s*f-a*p*u+n*s*u+m*p*o-n*l*o)*E,e[4]=C*E,e[5]=(r*h*f-i*s*f+i*p*o-t*h*o-r*p*d+t*s*d)*E,e[6]=(i*l*f-y*h*f-i*p*u+t*h*u+y*p*d-t*l*d)*E,e[7]=(y*s*f-r*l*f+r*p*u-t*s*u-y*p*o+t*l*o)*E,e[8]=M*E,e[9]=(i*a*f-r*c*f-i*n*o+t*c*o+r*n*d-t*a*d)*E,e[10]=(y*c*f-i*m*f+i*n*u-t*c*u-y*n*d+t*m*d)*E,e[11]=(r*m*f-y*a*f-r*n*u+t*a*u+y*n*o-t*m*o)*E,e[12]=b*E,e[13]=(r*c*p-i*a*p+i*n*s-t*c*s-r*n*h+t*a*h)*E,e[14]=(i*m*p-y*c*p-i*n*l+t*c*l+y*n*h-t*m*h)*E,e[15]=(y*a*p-r*m*p+r*n*l-t*a*l-y*n*s+t*m*s)*E,this}scale(e){const t=this.elements,n=e.x,p=e.y,f=e.z;return t[0]*=n,t[4]*=p,t[8]*=f,t[1]*=n,t[5]*=p,t[9]*=f,t[2]*=n,t[6]*=p,t[10]*=f,t[3]*=n,t[7]*=p,t[11]*=f,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],p=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,p))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),p=Math.sin(t),f=1-n,y=e.x,m=e.y,l=e.z,u=f*y,r=f*m;return this.set(u*y+n,u*m-p*l,u*l+p*m,0,u*m+p*l,r*m+n,r*l-p*y,0,u*l-p*m,r*l+p*y,f*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,p,f,y){return this.set(1,n,f,0,e,1,y,0,t,p,1,0,0,0,0,1),this}compose(e,t,n){const p=this.elements,f=t._x,y=t._y,m=t._z,l=t._w,u=f+f,r=y+y,a=m+m,s=f*u,o=f*r,i=f*a,c=y*r,h=y*a,d=m*a,_=l*u,C=l*r,M=l*a,b=n.x,v=n.y,E=n.z;return p[0]=(1-(c+d))*b,p[1]=(o+M)*b,p[2]=(i-C)*b,p[3]=0,p[4]=(o-M)*v,p[5]=(1-(s+d))*v,p[6]=(h+_)*v,p[7]=0,p[8]=(i+C)*E,p[9]=(h-_)*E,p[10]=(1-(s+c))*E,p[11]=0,p[12]=e.x,p[13]=e.y,p[14]=e.z,p[15]=1,this}decompose(e,t,n){const p=this.elements;let f=kn.set(p[0],p[1],p[2]).length();const y=kn.set(p[4],p[5],p[6]).length(),m=kn.set(p[8],p[9],p[10]).length();this.determinant()<0&&(f=-f),e.x=p[12],e.y=p[13],e.z=p[14],Nt.copy(this);const u=1/f,r=1/y,a=1/m;return Nt.elements[0]*=u,Nt.elements[1]*=u,Nt.elements[2]*=u,Nt.elements[4]*=r,Nt.elements[5]*=r,Nt.elements[6]*=r,Nt.elements[8]*=a,Nt.elements[9]*=a,Nt.elements[10]*=a,t.setFromRotationMatrix(Nt),n.x=f,n.y=y,n.z=m,this}makePerspective(e,t,n,p,f,y,m=qt){const l=this.elements,u=2*f/(t-e),r=2*f/(n-p),a=(t+e)/(t-e),s=(n+p)/(n-p);let o,i;if(m===qt)o=-(y+f)/(y-f),i=-2*y*f/(y-f);else if(m===Ki)o=-y/(y-f),i=-y*f/(y-f);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+m);return l[0]=u,l[4]=0,l[8]=a,l[12]=0,l[1]=0,l[5]=r,l[9]=s,l[13]=0,l[2]=0,l[6]=0,l[10]=o,l[14]=i,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,p,f,y,m=qt){const l=this.elements,u=1/(t-e),r=1/(n-p),a=1/(y-f),s=(t+e)*u,o=(n+p)*r;let i,c;if(m===qt)i=(y+f)*a,c=-2*a;else if(m===Ki)i=f*a,c=-1*a;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+m);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-s,l[1]=0,l[5]=2*r,l[9]=0,l[13]=-o,l[2]=0,l[6]=0,l[10]=c,l[14]=-i,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let p=0;p<16;p++)if(t[p]!==n[p])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const kn=new q,Nt=new rt,sc=new q(0,0,0),oc=new q(1,1,1),sn=new q,Ai=new q,Et=new q,Ys=new rt,Zs=new gi;class Ji{constructor(e=0,t=0,n=0,p=Ji.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=p}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,p=this._order){return this._x=e,this._y=t,this._z=n,this._order=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const p=e.elements,f=p[0],y=p[4],m=p[8],l=p[1],u=p[5],r=p[9],a=p[2],s=p[6],o=p[10];switch(t){case"XYZ":this._y=Math.asin(xt(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-r,o),this._z=Math.atan2(-y,f)):(this._x=Math.atan2(s,u),this._z=0);break;case"YXZ":this._x=Math.asin(-xt(r,-1,1)),Math.abs(r)<.9999999?(this._y=Math.atan2(m,o),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-a,f),this._z=0);break;case"ZXY":this._x=Math.asin(xt(s,-1,1)),Math.abs(s)<.9999999?(this._y=Math.atan2(-a,o),this._z=Math.atan2(-y,u)):(this._y=0,this._z=Math.atan2(l,f));break;case"ZYX":this._y=Math.asin(-xt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(s,o),this._z=Math.atan2(l,f)):(this._x=0,this._z=Math.atan2(-y,u));break;case"YZX":this._z=Math.asin(xt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-r,u),this._y=Math.atan2(-a,f)):(this._x=0,this._y=Math.atan2(m,o));break;case"XZY":this._z=Math.asin(-xt(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(s,u),this._y=Math.atan2(m,f)):(this._x=Math.atan2(-r,o),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ys.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ys,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Zs.setFromEuler(this),this.setFromQuaternion(Zs,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ji.DEFAULT_ORDER="XYZ";class ia{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ac=0;const Qs=new q,On=new gi,Xt=new rt,Ti=new q,ci=new q,lc=new q,cc=new gi,qs=new q(1,0,0),Js=new q(0,1,0),eo=new q(0,0,1),hc={type:"added"},uc={type:"removed"};class dt extends ni{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ac++}),this.uuid=pi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dt.DEFAULT_UP.clone();const e=new q,t=new Ji,n=new gi,p=new q(1,1,1);function f(){n.setFromEuler(t,!1)}function y(){t.setFromQuaternion(n,void 0,!1)}t._onChange(f),n._onChange(y),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:p},modelViewMatrix:{value:new rt},normalMatrix:{value:new Ue}}),this.matrix=new rt,this.matrixWorld=new rt,this.matrixAutoUpdate=dt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=dt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ia,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return On.setFromAxisAngle(e,t),this.quaternion.multiply(On),this}rotateOnWorldAxis(e,t){return On.setFromAxisAngle(e,t),this.quaternion.premultiply(On),this}rotateX(e){return this.rotateOnAxis(qs,e)}rotateY(e){return this.rotateOnAxis(Js,e)}rotateZ(e){return this.rotateOnAxis(eo,e)}translateOnAxis(e,t){return Qs.copy(e).applyQuaternion(this.quaternion),this.position.add(Qs.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(qs,e)}translateY(e){return this.translateOnAxis(Js,e)}translateZ(e){return this.translateOnAxis(eo,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Xt.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ti.copy(e):Ti.set(e,t,n);const p=this.parent;this.updateWorldMatrix(!0,!1),ci.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xt.lookAt(ci,Ti,this.up):Xt.lookAt(Ti,ci,this.up),this.quaternion.setFromRotationMatrix(Xt),p&&(Xt.extractRotation(p.matrixWorld),On.setFromRotationMatrix(Xt),this.quaternion.premultiply(On.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(hc)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(uc)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Xt.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Xt.multiply(e.parent.matrixWorld)),e.applyMatrix4(Xt),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,p=this.children.length;n<p;n++){const y=this.children[n].getObjectByProperty(e,t);if(y!==void 0)return y}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const p=this.children;for(let f=0,y=p.length;f<y;f++)p[f].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ci,e,lc),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ci,cc,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,p=t.length;n<p;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,p=t.length;n<p;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,p=t.length;n<p;n++){const f=t[n];(f.matrixWorldAutoUpdate===!0||e===!0)&&f.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const p=this.children;for(let f=0,y=p.length;f<y;f++){const m=p[f];m.matrixWorldAutoUpdate===!0&&m.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const p={};p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.castShadow===!0&&(p.castShadow=!0),this.receiveShadow===!0&&(p.receiveShadow=!0),this.visible===!1&&(p.visible=!1),this.frustumCulled===!1&&(p.frustumCulled=!1),this.renderOrder!==0&&(p.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(p.userData=this.userData),p.layers=this.layers.mask,p.matrix=this.matrix.toArray(),p.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(p.matrixAutoUpdate=!1),this.isInstancedMesh&&(p.type="InstancedMesh",p.count=this.count,p.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(p.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(p.type="BatchedMesh",p.perObjectFrustumCulled=this.perObjectFrustumCulled,p.sortObjects=this.sortObjects,p.drawRanges=this._drawRanges,p.reservedRanges=this._reservedRanges,p.visibility=this._visibility,p.active=this._active,p.bounds=this._bounds.map(m=>({boxInitialized:m.boxInitialized,boxMin:m.box.min.toArray(),boxMax:m.box.max.toArray(),sphereInitialized:m.sphereInitialized,sphereRadius:m.sphere.radius,sphereCenter:m.sphere.center.toArray()})),p.maxGeometryCount=this._maxGeometryCount,p.maxVertexCount=this._maxVertexCount,p.maxIndexCount=this._maxIndexCount,p.geometryInitialized=this._geometryInitialized,p.geometryCount=this._geometryCount,p.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(p.boundingSphere={center:p.boundingSphere.center.toArray(),radius:p.boundingSphere.radius}),this.boundingBox!==null&&(p.boundingBox={min:p.boundingBox.min.toArray(),max:p.boundingBox.max.toArray()}));function f(m,l){return m[l.uuid]===void 0&&(m[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?p.background=this.background.toJSON():this.background.isTexture&&(p.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(p.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){p.geometry=f(e.geometries,this.geometry);const m=this.geometry.parameters;if(m!==void 0&&m.shapes!==void 0){const l=m.shapes;if(Array.isArray(l))for(let u=0,r=l.length;u<r;u++){const a=l[u];f(e.shapes,a)}else f(e.shapes,l)}}if(this.isSkinnedMesh&&(p.bindMode=this.bindMode,p.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(f(e.skeletons,this.skeleton),p.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const m=[];for(let l=0,u=this.material.length;l<u;l++)m.push(f(e.materials,this.material[l]));p.material=m}else p.material=f(e.materials,this.material);if(this.children.length>0){p.children=[];for(let m=0;m<this.children.length;m++)p.children.push(this.children[m].toJSON(e).object)}if(this.animations.length>0){p.animations=[];for(let m=0;m<this.animations.length;m++){const l=this.animations[m];p.animations.push(f(e.animations,l))}}if(t){const m=y(e.geometries),l=y(e.materials),u=y(e.textures),r=y(e.images),a=y(e.shapes),s=y(e.skeletons),o=y(e.animations),i=y(e.nodes);m.length>0&&(n.geometries=m),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),r.length>0&&(n.images=r),a.length>0&&(n.shapes=a),s.length>0&&(n.skeletons=s),o.length>0&&(n.animations=o),i.length>0&&(n.nodes=i)}return n.object=p,n;function y(m){const l=[];for(const u in m){const r=m[u];delete r.metadata,l.push(r)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const p=e.children[n];this.add(p.clone())}return this}}dt.DEFAULT_UP=new q(0,1,0);dt.DEFAULT_MATRIX_AUTO_UPDATE=!0;dt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const kt=new q,jt=new q,Er=new q,Kt=new q,$n=new q,Fn=new q,to=new q,Cr=new q,Ar=new q,Tr=new q;class zt{constructor(e=new q,t=new q,n=new q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,p){p.subVectors(n,t),kt.subVectors(e,t),p.cross(kt);const f=p.lengthSq();return f>0?p.multiplyScalar(1/Math.sqrt(f)):p.set(0,0,0)}static getBarycoord(e,t,n,p,f){kt.subVectors(p,t),jt.subVectors(n,t),Er.subVectors(e,t);const y=kt.dot(kt),m=kt.dot(jt),l=kt.dot(Er),u=jt.dot(jt),r=jt.dot(Er),a=y*u-m*m;if(a===0)return f.set(0,0,0),null;const s=1/a,o=(u*l-m*r)*s,i=(y*r-m*l)*s;return f.set(1-o-i,i,o)}static containsPoint(e,t,n,p){return this.getBarycoord(e,t,n,p,Kt)===null?!1:Kt.x>=0&&Kt.y>=0&&Kt.x+Kt.y<=1}static getInterpolation(e,t,n,p,f,y,m,l){return this.getBarycoord(e,t,n,p,Kt)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(f,Kt.x),l.addScaledVector(y,Kt.y),l.addScaledVector(m,Kt.z),l)}static isFrontFacing(e,t,n,p){return kt.subVectors(n,t),jt.subVectors(e,t),kt.cross(jt).dot(p)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,p){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[p]),this}setFromAttributeAndIndices(e,t,n,p){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,p),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return kt.subVectors(this.c,this.b),jt.subVectors(this.a,this.b),kt.cross(jt).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return zt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return zt.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,p,f){return zt.getInterpolation(e,this.a,this.b,this.c,t,n,p,f)}containsPoint(e){return zt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return zt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,p=this.b,f=this.c;let y,m;$n.subVectors(p,n),Fn.subVectors(f,n),Cr.subVectors(e,n);const l=$n.dot(Cr),u=Fn.dot(Cr);if(l<=0&&u<=0)return t.copy(n);Ar.subVectors(e,p);const r=$n.dot(Ar),a=Fn.dot(Ar);if(r>=0&&a<=r)return t.copy(p);const s=l*a-r*u;if(s<=0&&l>=0&&r<=0)return y=l/(l-r),t.copy(n).addScaledVector($n,y);Tr.subVectors(e,f);const o=$n.dot(Tr),i=Fn.dot(Tr);if(i>=0&&o<=i)return t.copy(f);const c=o*u-l*i;if(c<=0&&u>=0&&i<=0)return m=u/(u-i),t.copy(n).addScaledVector(Fn,m);const h=r*i-o*a;if(h<=0&&a-r>=0&&o-i>=0)return to.subVectors(f,p),m=(a-r)/(a-r+(o-i)),t.copy(p).addScaledVector(to,m);const d=1/(h+c+s);return y=c*d,m=s*d,t.copy(n).addScaledVector($n,y).addScaledVector(Fn,m)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ra={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},on={h:0,s:0,l:0},Li={h:0,s:0,l:0};function Lr(g,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?g+(e-g)*6*t:t<1/2?e:t<2/3?g+(e-g)*6*(2/3-t):g}class He{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const p=e;p&&p.isColor?this.copy(p):typeof p=="number"?this.setHex(p):typeof p=="string"&&this.setStyle(p)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ut){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,je.toWorkingColorSpace(this,t),this}setRGB(e,t,n,p=je.workingColorSpace){return this.r=e,this.g=t,this.b=n,je.toWorkingColorSpace(this,p),this}setHSL(e,t,n,p=je.workingColorSpace){if(e=Ql(e,1),t=xt(t,0,1),n=xt(n,0,1),t===0)this.r=this.g=this.b=n;else{const f=n<=.5?n*(1+t):n+t-n*t,y=2*n-f;this.r=Lr(y,f,e+1/3),this.g=Lr(y,f,e),this.b=Lr(y,f,e-1/3)}return je.toWorkingColorSpace(this,p),this}setStyle(e,t=ut){function n(f){f!==void 0&&parseFloat(f)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let p;if(p=/^(\w+)\(([^\)]*)\)/.exec(e)){let f;const y=p[1],m=p[2];switch(y){case"rgb":case"rgba":if(f=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m))return n(f[4]),this.setRGB(Math.min(255,parseInt(f[1],10))/255,Math.min(255,parseInt(f[2],10))/255,Math.min(255,parseInt(f[3],10))/255,t);if(f=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m))return n(f[4]),this.setRGB(Math.min(100,parseInt(f[1],10))/100,Math.min(100,parseInt(f[2],10))/100,Math.min(100,parseInt(f[3],10))/100,t);break;case"hsl":case"hsla":if(f=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(m))return n(f[4]),this.setHSL(parseFloat(f[1])/360,parseFloat(f[2])/100,parseFloat(f[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(p=/^\#([A-Fa-f\d]+)$/.exec(e)){const f=p[1],y=f.length;if(y===3)return this.setRGB(parseInt(f.charAt(0),16)/15,parseInt(f.charAt(1),16)/15,parseInt(f.charAt(2),16)/15,t);if(y===6)return this.setHex(parseInt(f,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ut){const n=ra[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Zn(e.r),this.g=Zn(e.g),this.b=Zn(e.b),this}copyLinearToSRGB(e){return this.r=vr(e.r),this.g=vr(e.g),this.b=vr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ut){return je.fromWorkingColorSpace(gt.copy(this),e),Math.round(xt(gt.r*255,0,255))*65536+Math.round(xt(gt.g*255,0,255))*256+Math.round(xt(gt.b*255,0,255))}getHexString(e=ut){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=je.workingColorSpace){je.fromWorkingColorSpace(gt.copy(this),t);const n=gt.r,p=gt.g,f=gt.b,y=Math.max(n,p,f),m=Math.min(n,p,f);let l,u;const r=(m+y)/2;if(m===y)l=0,u=0;else{const a=y-m;switch(u=r<=.5?a/(y+m):a/(2-y-m),y){case n:l=(p-f)/a+(p<f?6:0);break;case p:l=(f-n)/a+2;break;case f:l=(n-p)/a+4;break}l/=6}return e.h=l,e.s=u,e.l=r,e}getRGB(e,t=je.workingColorSpace){return je.fromWorkingColorSpace(gt.copy(this),t),e.r=gt.r,e.g=gt.g,e.b=gt.b,e}getStyle(e=ut){je.fromWorkingColorSpace(gt.copy(this),e);const t=gt.r,n=gt.g,p=gt.b;return e!==ut?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${p.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(p*255)})`}offsetHSL(e,t,n){return this.getHSL(on),this.setHSL(on.h+e,on.s+t,on.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(on),e.getHSL(Li);const n=gr(on.h,Li.h,t),p=gr(on.s,Li.s,t),f=gr(on.l,Li.l,t);return this.setHSL(n,p,f),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,p=this.b,f=e.elements;return this.r=f[0]*t+f[3]*n+f[6]*p,this.g=f[1]*t+f[4]*n+f[7]*p,this.b=f[2]*t+f[5]*n+f[8]*p,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const gt=new He;He.NAMES=ra;let dc=0;class vi extends ni{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dc++}),this.uuid=pi(),this.name="",this.type="Material",this.blending=Kn,this.side=dn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=zr,this.blendDst=Hr,this.blendEquation=bn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new He(0,0,0),this.blendAlpha=0,this.depthFunc=Gi,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zs,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rn,this.stencilZFail=Rn,this.stencilZPass=Rn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const p=this[t];if(p===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}p&&p.isColor?p.set(n):p&&p.isVector3&&n&&n.isVector3?p.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Kn&&(n.blending=this.blending),this.side!==dn&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==zr&&(n.blendSrc=this.blendSrc),this.blendDst!==Hr&&(n.blendDst=this.blendDst),this.blendEquation!==bn&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Gi&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==zs&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rn&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Rn&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Rn&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function p(f){const y=[];for(const m in f){const l=f[m];delete l.metadata,y.push(l)}return y}if(t){const f=p(e.textures),y=p(e.images);f.length>0&&(n.textures=f),y.length>0&&(n.images=y)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const p=t.length;n=new Array(p);for(let f=0;f!==p;++f)n[f]=t[f].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class sa extends vi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new He(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=zo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const it=new q,Ri=new We;class Ht{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Hs,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Qt,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Yn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let p=0,f=this.itemSize;p<f;p++)this.array[e+p]=t.array[n+p];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ri.fromBufferAttribute(this,t),Ri.applyMatrix3(e),this.setXY(t,Ri.x,Ri.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)it.fromBufferAttribute(this,t),it.applyMatrix3(e),this.setXYZ(t,it.x,it.y,it.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)it.fromBufferAttribute(this,t),it.applyMatrix4(e),this.setXYZ(t,it.x,it.y,it.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)it.fromBufferAttribute(this,t),it.applyNormalMatrix(e),this.setXYZ(t,it.x,it.y,it.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)it.fromBufferAttribute(this,t),it.transformDirection(e),this.setXYZ(t,it.x,it.y,it.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=oi(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_t(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=oi(t,this.array)),t}setX(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=oi(t,this.array)),t}setY(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=oi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=oi(t,this.array)),t}setW(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),n=_t(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,p){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),n=_t(n,this.array),p=_t(p,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=p,this}setXYZW(e,t,n,p,f){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),n=_t(n,this.array),p=_t(p,this.array),f=_t(f,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=p,this.array[e+3]=f,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Hs&&(e.usage=this.usage),e}}class oa extends Ht{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class aa extends Ht{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class At extends Ht{constructor(e,t,n){super(new Float32Array(e),t,n)}}let fc=0;const Rt=new rt,Rr=new dt,Un=new q,Ct=new mi,hi=new mi,lt=new q;class Ft extends ni{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fc++}),this.uuid=pi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qo(e)?aa:oa)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const f=new Ue().getNormalMatrix(e);n.applyNormalMatrix(f),n.needsUpdate=!0}const p=this.attributes.tangent;return p!==void 0&&(p.transformDirection(e),p.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rt.makeRotationFromQuaternion(e),this.applyMatrix4(Rt),this}rotateX(e){return Rt.makeRotationX(e),this.applyMatrix4(Rt),this}rotateY(e){return Rt.makeRotationY(e),this.applyMatrix4(Rt),this}rotateZ(e){return Rt.makeRotationZ(e),this.applyMatrix4(Rt),this}translate(e,t,n){return Rt.makeTranslation(e,t,n),this.applyMatrix4(Rt),this}scale(e,t,n){return Rt.makeScale(e,t,n),this.applyMatrix4(Rt),this}lookAt(e){return Rr.lookAt(e),Rr.updateMatrix(),this.applyMatrix4(Rr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Un).negate(),this.translate(Un.x,Un.y,Un.z),this}setFromPoints(e){const t=[];for(let n=0,p=e.length;n<p;n++){const f=e[n];t.push(f.x,f.y,f.z||0)}return this.setAttribute("position",new At(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new mi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,p=t.length;n<p;n++){const f=t[n];Ct.setFromBufferAttribute(f),this.morphTargetsRelative?(lt.addVectors(this.boundingBox.min,Ct.min),this.boundingBox.expandByPoint(lt),lt.addVectors(this.boundingBox.max,Ct.max),this.boundingBox.expandByPoint(lt)):(this.boundingBox.expandByPoint(Ct.min),this.boundingBox.expandByPoint(Ct.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new q,1/0);return}if(e){const n=this.boundingSphere.center;if(Ct.setFromBufferAttribute(e),t)for(let f=0,y=t.length;f<y;f++){const m=t[f];hi.setFromBufferAttribute(m),this.morphTargetsRelative?(lt.addVectors(Ct.min,hi.min),Ct.expandByPoint(lt),lt.addVectors(Ct.max,hi.max),Ct.expandByPoint(lt)):(Ct.expandByPoint(hi.min),Ct.expandByPoint(hi.max))}Ct.getCenter(n);let p=0;for(let f=0,y=e.count;f<y;f++)lt.fromBufferAttribute(e,f),p=Math.max(p,n.distanceToSquared(lt));if(t)for(let f=0,y=t.length;f<y;f++){const m=t[f],l=this.morphTargetsRelative;for(let u=0,r=m.count;u<r;u++)lt.fromBufferAttribute(m,u),l&&(Un.fromBufferAttribute(e,u),lt.add(Un)),p=Math.max(p,n.distanceToSquared(lt))}this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,p=t.position.array,f=t.normal.array,y=t.uv.array,m=p.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ht(new Float32Array(4*m),4));const l=this.getAttribute("tangent").array,u=[],r=[];for(let w=0;w<m;w++)u[w]=new q,r[w]=new q;const a=new q,s=new q,o=new q,i=new We,c=new We,h=new We,d=new q,_=new q;function C(w,I,R){a.fromArray(p,w*3),s.fromArray(p,I*3),o.fromArray(p,R*3),i.fromArray(y,w*2),c.fromArray(y,I*2),h.fromArray(y,R*2),s.sub(a),o.sub(a),c.sub(i),h.sub(i);const A=1/(c.x*h.y-h.x*c.y);isFinite(A)&&(d.copy(s).multiplyScalar(h.y).addScaledVector(o,-c.y).multiplyScalar(A),_.copy(o).multiplyScalar(c.x).addScaledVector(s,-h.x).multiplyScalar(A),u[w].add(d),u[I].add(d),u[R].add(d),r[w].add(_),r[I].add(_),r[R].add(_))}let M=this.groups;M.length===0&&(M=[{start:0,count:n.length}]);for(let w=0,I=M.length;w<I;++w){const R=M[w],A=R.start,x=R.count;for(let S=A,T=A+x;S<T;S+=3)C(n[S+0],n[S+1],n[S+2])}const b=new q,v=new q,E=new q,D=new q;function L(w){E.fromArray(f,w*3),D.copy(E);const I=u[w];b.copy(I),b.sub(E.multiplyScalar(E.dot(I))).normalize(),v.crossVectors(D,I);const A=v.dot(r[w])<0?-1:1;l[w*4]=b.x,l[w*4+1]=b.y,l[w*4+2]=b.z,l[w*4+3]=A}for(let w=0,I=M.length;w<I;++w){const R=M[w],A=R.start,x=R.count;for(let S=A,T=A+x;S<T;S+=3)L(n[S+0]),L(n[S+1]),L(n[S+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ht(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let s=0,o=n.count;s<o;s++)n.setXYZ(s,0,0,0);const p=new q,f=new q,y=new q,m=new q,l=new q,u=new q,r=new q,a=new q;if(e)for(let s=0,o=e.count;s<o;s+=3){const i=e.getX(s+0),c=e.getX(s+1),h=e.getX(s+2);p.fromBufferAttribute(t,i),f.fromBufferAttribute(t,c),y.fromBufferAttribute(t,h),r.subVectors(y,f),a.subVectors(p,f),r.cross(a),m.fromBufferAttribute(n,i),l.fromBufferAttribute(n,c),u.fromBufferAttribute(n,h),m.add(r),l.add(r),u.add(r),n.setXYZ(i,m.x,m.y,m.z),n.setXYZ(c,l.x,l.y,l.z),n.setXYZ(h,u.x,u.y,u.z)}else for(let s=0,o=t.count;s<o;s+=3)p.fromBufferAttribute(t,s+0),f.fromBufferAttribute(t,s+1),y.fromBufferAttribute(t,s+2),r.subVectors(y,f),a.subVectors(p,f),r.cross(a),n.setXYZ(s+0,r.x,r.y,r.z),n.setXYZ(s+1,r.x,r.y,r.z),n.setXYZ(s+2,r.x,r.y,r.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)lt.fromBufferAttribute(e,t),lt.normalize(),e.setXYZ(t,lt.x,lt.y,lt.z)}toNonIndexed(){function e(m,l){const u=m.array,r=m.itemSize,a=m.normalized,s=new u.constructor(l.length*r);let o=0,i=0;for(let c=0,h=l.length;c<h;c++){m.isInterleavedBufferAttribute?o=l[c]*m.data.stride+m.offset:o=l[c]*r;for(let d=0;d<r;d++)s[i++]=u[o++]}return new Ht(s,r,a)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ft,n=this.index.array,p=this.attributes;for(const m in p){const l=p[m],u=e(l,n);t.setAttribute(m,u)}const f=this.morphAttributes;for(const m in f){const l=[],u=f[m];for(let r=0,a=u.length;r<a;r++){const s=u[r],o=e(s,n);l.push(o)}t.morphAttributes[m]=l}t.morphTargetsRelative=this.morphTargetsRelative;const y=this.groups;for(let m=0,l=y.length;m<l;m++){const u=y[m];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const u=n[l];e.data.attributes[l]=u.toJSON(e.data)}const p={};let f=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],r=[];for(let a=0,s=u.length;a<s;a++){const o=u[a];r.push(o.toJSON(e.data))}r.length>0&&(p[l]=r,f=!0)}f&&(e.data.morphAttributes=p,e.data.morphTargetsRelative=this.morphTargetsRelative);const y=this.groups;y.length>0&&(e.data.groups=JSON.parse(JSON.stringify(y)));const m=this.boundingSphere;return m!==null&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const p=e.attributes;for(const u in p){const r=p[u];this.setAttribute(u,r.clone(t))}const f=e.morphAttributes;for(const u in f){const r=[],a=f[u];for(let s=0,o=a.length;s<o;s++)r.push(a[s].clone(t));this.morphAttributes[u]=r}this.morphTargetsRelative=e.morphTargetsRelative;const y=e.groups;for(let u=0,r=y.length;u<r;u++){const a=y[u];this.addGroup(a.start,a.count,a.materialIndex)}const m=e.boundingBox;m!==null&&(this.boundingBox=m.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const no=new rt,yn=new na,Di=new qi,io=new q,Bn=new q,zn=new q,Hn=new q,Dr=new q,Ii=new q,Pi=new We,Ni=new We,ki=new We,ro=new q,so=new q,oo=new q,Oi=new q,$i=new q;class Jt extends dt{constructor(e=new Ft,t=new sa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const p=t[n[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,y=p.length;f<y;f++){const m=p[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[m]=f}}}}getVertexPosition(e,t){const n=this.geometry,p=n.attributes.position,f=n.morphAttributes.position,y=n.morphTargetsRelative;t.fromBufferAttribute(p,e);const m=this.morphTargetInfluences;if(f&&m){Ii.set(0,0,0);for(let l=0,u=f.length;l<u;l++){const r=m[l],a=f[l];r!==0&&(Dr.fromBufferAttribute(a,e),y?Ii.addScaledVector(Dr,r):Ii.addScaledVector(Dr.sub(t),r))}t.add(Ii)}return t}raycast(e,t){const n=this.geometry,p=this.material,f=this.matrixWorld;p!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Di.copy(n.boundingSphere),Di.applyMatrix4(f),yn.copy(e.ray).recast(e.near),!(Di.containsPoint(yn.origin)===!1&&(yn.intersectSphere(Di,io)===null||yn.origin.distanceToSquared(io)>(e.far-e.near)**2))&&(no.copy(f).invert(),yn.copy(e.ray).applyMatrix4(no),!(n.boundingBox!==null&&yn.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,yn)))}_computeIntersections(e,t,n){let p;const f=this.geometry,y=this.material,m=f.index,l=f.attributes.position,u=f.attributes.uv,r=f.attributes.uv1,a=f.attributes.normal,s=f.groups,o=f.drawRange;if(m!==null)if(Array.isArray(y))for(let i=0,c=s.length;i<c;i++){const h=s[i],d=y[h.materialIndex],_=Math.max(h.start,o.start),C=Math.min(m.count,Math.min(h.start+h.count,o.start+o.count));for(let M=_,b=C;M<b;M+=3){const v=m.getX(M),E=m.getX(M+1),D=m.getX(M+2);p=Fi(this,d,e,n,u,r,a,v,E,D),p&&(p.faceIndex=Math.floor(M/3),p.face.materialIndex=h.materialIndex,t.push(p))}}else{const i=Math.max(0,o.start),c=Math.min(m.count,o.start+o.count);for(let h=i,d=c;h<d;h+=3){const _=m.getX(h),C=m.getX(h+1),M=m.getX(h+2);p=Fi(this,y,e,n,u,r,a,_,C,M),p&&(p.faceIndex=Math.floor(h/3),t.push(p))}}else if(l!==void 0)if(Array.isArray(y))for(let i=0,c=s.length;i<c;i++){const h=s[i],d=y[h.materialIndex],_=Math.max(h.start,o.start),C=Math.min(l.count,Math.min(h.start+h.count,o.start+o.count));for(let M=_,b=C;M<b;M+=3){const v=M,E=M+1,D=M+2;p=Fi(this,d,e,n,u,r,a,v,E,D),p&&(p.faceIndex=Math.floor(M/3),p.face.materialIndex=h.materialIndex,t.push(p))}}else{const i=Math.max(0,o.start),c=Math.min(l.count,o.start+o.count);for(let h=i,d=c;h<d;h+=3){const _=h,C=h+1,M=h+2;p=Fi(this,y,e,n,u,r,a,_,C,M),p&&(p.faceIndex=Math.floor(h/3),t.push(p))}}}}function pc(g,e,t,n,p,f,y,m){let l;if(e.side===bt?l=n.intersectTriangle(y,f,p,!0,m):l=n.intersectTriangle(p,f,y,e.side===dn,m),l===null)return null;$i.copy(m),$i.applyMatrix4(g.matrixWorld);const u=t.ray.origin.distanceTo($i);return u<t.near||u>t.far?null:{distance:u,point:$i.clone(),object:g}}function Fi(g,e,t,n,p,f,y,m,l,u){g.getVertexPosition(m,Bn),g.getVertexPosition(l,zn),g.getVertexPosition(u,Hn);const r=pc(g,e,t,n,Bn,zn,Hn,Oi);if(r){p&&(Pi.fromBufferAttribute(p,m),Ni.fromBufferAttribute(p,l),ki.fromBufferAttribute(p,u),r.uv=zt.getInterpolation(Oi,Bn,zn,Hn,Pi,Ni,ki,new We)),f&&(Pi.fromBufferAttribute(f,m),Ni.fromBufferAttribute(f,l),ki.fromBufferAttribute(f,u),r.uv1=zt.getInterpolation(Oi,Bn,zn,Hn,Pi,Ni,ki,new We),r.uv2=r.uv1),y&&(ro.fromBufferAttribute(y,m),so.fromBufferAttribute(y,l),oo.fromBufferAttribute(y,u),r.normal=zt.getInterpolation(Oi,Bn,zn,Hn,ro,so,oo,new q),r.normal.dot(n.direction)>0&&r.normal.multiplyScalar(-1));const a={a:m,b:l,c:u,normal:new q,materialIndex:0};zt.getNormal(Bn,zn,Hn,a.normal),r.face=a}return r}class yi extends Ft{constructor(e=1,t=1,n=1,p=1,f=1,y=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:p,heightSegments:f,depthSegments:y};const m=this;p=Math.floor(p),f=Math.floor(f),y=Math.floor(y);const l=[],u=[],r=[],a=[];let s=0,o=0;i("z","y","x",-1,-1,n,t,e,y,f,0),i("z","y","x",1,-1,n,t,-e,y,f,1),i("x","z","y",1,1,e,n,t,p,y,2),i("x","z","y",1,-1,e,n,-t,p,y,3),i("x","y","z",1,-1,e,t,n,p,f,4),i("x","y","z",-1,-1,e,t,-n,p,f,5),this.setIndex(l),this.setAttribute("position",new At(u,3)),this.setAttribute("normal",new At(r,3)),this.setAttribute("uv",new At(a,2));function i(c,h,d,_,C,M,b,v,E,D,L){const w=M/E,I=b/D,R=M/2,A=b/2,x=v/2,S=E+1,T=D+1;let P=0,N=0;const k=new q;for(let O=0;O<T;O++){const $=O*I-A;for(let V=0;V<S;V++){const H=V*w-R;k[c]=H*_,k[h]=$*C,k[d]=x,u.push(k.x,k.y,k.z),k[c]=0,k[h]=0,k[d]=v>0?1:-1,r.push(k.x,k.y,k.z),a.push(V/E),a.push(1-O/D),P+=1}}for(let O=0;O<D;O++)for(let $=0;$<E;$++){const V=s+$+S*O,H=s+$+S*(O+1),U=s+($+1)+S*(O+1),z=s+($+1)+S*O;l.push(V,H,z),l.push(H,U,z),N+=6}m.addGroup(o,N,L),o+=N,s+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ei(g){const e={};for(const t in g){e[t]={};for(const n in g[t]){const p=g[t][n];p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture||p.isQuaternion)?p.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=p.clone():Array.isArray(p)?e[t][n]=p.slice():e[t][n]=p}}return e}function vt(g){const e={};for(let t=0;t<g.length;t++){const n=ei(g[t]);for(const p in n)e[p]=n[p]}return e}function gc(g){const e=[];for(let t=0;t<g.length;t++)e.push(g[t].clone());return e}function la(g){return g.getRenderTarget()===null?g.outputColorSpace:je.workingColorSpace}const mc={clone:ei,merge:vt};var vc=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,yc=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class fn extends vi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=vc,this.fragmentShader=yc,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ei(e.uniforms),this.uniformsGroups=gc(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const p in this.uniforms){const y=this.uniforms[p].value;y&&y.isTexture?t.uniforms[p]={type:"t",value:y.toJSON(e).uuid}:y&&y.isColor?t.uniforms[p]={type:"c",value:y.getHex()}:y&&y.isVector2?t.uniforms[p]={type:"v2",value:y.toArray()}:y&&y.isVector3?t.uniforms[p]={type:"v3",value:y.toArray()}:y&&y.isVector4?t.uniforms[p]={type:"v4",value:y.toArray()}:y&&y.isMatrix3?t.uniforms[p]={type:"m3",value:y.toArray()}:y&&y.isMatrix4?t.uniforms[p]={type:"m4",value:y.toArray()}:t.uniforms[p]={value:y}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const p in this.extensions)this.extensions[p]===!0&&(n[p]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class ca extends dt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new rt,this.projectionMatrix=new rt,this.projectionMatrixInverse=new rt,this.coordinateSystem=qt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const an=new q,ao=new We,lo=new We;class Dt extends ca{constructor(e=50,t=1,n=.1,p=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=p,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Kr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(pr*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Kr*2*Math.atan(Math.tan(pr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){an.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(an.x,an.y).multiplyScalar(-e/an.z),an.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(an.x,an.y).multiplyScalar(-e/an.z)}getViewSize(e,t){return this.getViewBounds(e,ao,lo),t.subVectors(lo,ao)}setViewOffset(e,t,n,p,f,y){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=p,this.view.width=f,this.view.height=y,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(pr*.5*this.fov)/this.zoom,n=2*t,p=this.aspect*n,f=-.5*p;const y=this.view;if(this.view!==null&&this.view.enabled){const l=y.fullWidth,u=y.fullHeight;f+=y.offsetX*p/l,t-=y.offsetY*n/u,p*=y.width/l,n*=y.height/u}const m=this.filmOffset;m!==0&&(f+=e*m/this.getFilmWidth()),this.projectionMatrix.makePerspective(f,f+p,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Wn=-90,Gn=1;class _c extends dt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const p=new Dt(Wn,Gn,e,t);p.layers=this.layers,this.add(p);const f=new Dt(Wn,Gn,e,t);f.layers=this.layers,this.add(f);const y=new Dt(Wn,Gn,e,t);y.layers=this.layers,this.add(y);const m=new Dt(Wn,Gn,e,t);m.layers=this.layers,this.add(m);const l=new Dt(Wn,Gn,e,t);l.layers=this.layers,this.add(l);const u=new Dt(Wn,Gn,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,p,f,y,m,l]=t;for(const u of t)this.remove(u);if(e===qt)n.up.set(0,1,0),n.lookAt(1,0,0),p.up.set(0,1,0),p.lookAt(-1,0,0),f.up.set(0,0,-1),f.lookAt(0,1,0),y.up.set(0,0,1),y.lookAt(0,-1,0),m.up.set(0,1,0),m.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Ki)n.up.set(0,-1,0),n.lookAt(-1,0,0),p.up.set(0,-1,0),p.lookAt(1,0,0),f.up.set(0,0,1),f.lookAt(0,1,0),y.up.set(0,0,-1),y.lookAt(0,-1,0),m.up.set(0,-1,0),m.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:p}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[f,y,m,l,u,r]=this.children,a=e.getRenderTarget(),s=e.getActiveCubeFace(),o=e.getActiveMipmapLevel(),i=e.xr.enabled;e.xr.enabled=!1;const c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,p),e.render(t,f),e.setRenderTarget(n,1,p),e.render(t,y),e.setRenderTarget(n,2,p),e.render(t,m),e.setRenderTarget(n,3,p),e.render(t,l),e.setRenderTarget(n,4,p),e.render(t,u),n.texture.generateMipmaps=c,e.setRenderTarget(n,5,p),e.render(t,r),e.setRenderTarget(a,s,o),e.xr.enabled=i,n.texture.needsPMREMUpdate=!0}}class ha extends wt{constructor(e,t,n,p,f,y,m,l,u,r){e=e!==void 0?e:[],t=t!==void 0?t:Qn,super(e,t,n,p,f,y,m,l,u,r),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Sc extends Tn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},p=[n,n,n,n,n,n];t.encoding!==void 0&&(Yn("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===An?ut:It),this.texture=new ha(p,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:St}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},p=new yi(5,5,5),f=new fn({name:"CubemapFromEquirect",uniforms:ei(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:bt,blending:cn});f.uniforms.tEquirect.value=t;const y=new Jt(p,f),m=t.minFilter;return t.minFilter===Mn&&(t.minFilter=St),new _c(1,10,this).update(e,y),t.minFilter=m,y.geometry.dispose(),y.material.dispose(),this}clear(e,t,n,p){const f=e.getRenderTarget();for(let y=0;y<6;y++)e.setRenderTarget(this,y),e.clear(t,n,p);e.setRenderTarget(f)}}const Ir=new q,xc=new q,bc=new Ue;class Sn{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,p){return this.normal.set(e,t,n),this.constant=p,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const p=Ir.subVectors(n,t).cross(xc.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(p,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Ir),p=this.normal.dot(n);if(p===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const f=-(e.start.dot(this.normal)+this.constant)/p;return f<0||f>1?null:t.copy(e.start).addScaledVector(n,f)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||bc.getNormalMatrix(e),p=this.coplanarPoint(Ir).applyMatrix4(e),f=this.normal.applyMatrix3(n).normalize();return this.constant=-p.dot(f),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _n=new qi,Ui=new q;class es{constructor(e=new Sn,t=new Sn,n=new Sn,p=new Sn,f=new Sn,y=new Sn){this.planes=[e,t,n,p,f,y]}set(e,t,n,p,f,y){const m=this.planes;return m[0].copy(e),m[1].copy(t),m[2].copy(n),m[3].copy(p),m[4].copy(f),m[5].copy(y),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=qt){const n=this.planes,p=e.elements,f=p[0],y=p[1],m=p[2],l=p[3],u=p[4],r=p[5],a=p[6],s=p[7],o=p[8],i=p[9],c=p[10],h=p[11],d=p[12],_=p[13],C=p[14],M=p[15];if(n[0].setComponents(l-f,s-u,h-o,M-d).normalize(),n[1].setComponents(l+f,s+u,h+o,M+d).normalize(),n[2].setComponents(l+y,s+r,h+i,M+_).normalize(),n[3].setComponents(l-y,s-r,h-i,M-_).normalize(),n[4].setComponents(l-m,s-a,h-c,M-C).normalize(),t===qt)n[5].setComponents(l+m,s+a,h+c,M+C).normalize();else if(t===Ki)n[5].setComponents(m,a,c,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_n.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_n.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_n)}intersectsSprite(e){return _n.center.set(0,0,0),_n.radius=.7071067811865476,_n.applyMatrix4(e.matrixWorld),this.intersectsSphere(_n)}intersectsSphere(e){const t=this.planes,n=e.center,p=-e.radius;for(let f=0;f<6;f++)if(t[f].distanceToPoint(n)<p)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const p=t[n];if(Ui.x=p.normal.x>0?e.max.x:e.min.x,Ui.y=p.normal.y>0?e.max.y:e.min.y,Ui.z=p.normal.z>0?e.max.z:e.min.z,p.distanceToPoint(Ui)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ua(){let g=null,e=!1,t=null,n=null;function p(f,y){t(f,y),n=g.requestAnimationFrame(p)}return{start:function(){e!==!0&&t!==null&&(n=g.requestAnimationFrame(p),e=!0)},stop:function(){g.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(f){t=f},setContext:function(f){g=f}}}function wc(g,e){const t=e.isWebGL2,n=new WeakMap;function p(u,r){const a=u.array,s=u.usage,o=a.byteLength,i=g.createBuffer();g.bindBuffer(r,i),g.bufferData(r,a,s),u.onUploadCallback();let c;if(a instanceof Float32Array)c=g.FLOAT;else if(a instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(t)c=g.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else c=g.UNSIGNED_SHORT;else if(a instanceof Int16Array)c=g.SHORT;else if(a instanceof Uint32Array)c=g.UNSIGNED_INT;else if(a instanceof Int32Array)c=g.INT;else if(a instanceof Int8Array)c=g.BYTE;else if(a instanceof Uint8Array)c=g.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)c=g.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);return{buffer:i,type:c,bytesPerElement:a.BYTES_PER_ELEMENT,version:u.version,size:o}}function f(u,r,a){const s=r.array,o=r._updateRange,i=r.updateRanges;if(g.bindBuffer(a,u),o.count===-1&&i.length===0&&g.bufferSubData(a,0,s),i.length!==0){for(let c=0,h=i.length;c<h;c++){const d=i[c];t?g.bufferSubData(a,d.start*s.BYTES_PER_ELEMENT,s,d.start,d.count):g.bufferSubData(a,d.start*s.BYTES_PER_ELEMENT,s.subarray(d.start,d.start+d.count))}r.clearUpdateRanges()}o.count!==-1&&(t?g.bufferSubData(a,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):g.bufferSubData(a,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}function y(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)}function m(u){u.isInterleavedBufferAttribute&&(u=u.data);const r=n.get(u);r&&(g.deleteBuffer(r.buffer),n.delete(u))}function l(u,r){if(u.isGLBufferAttribute){const s=n.get(u);(!s||s.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const a=n.get(u);if(a===void 0)n.set(u,p(u,r));else if(a.version<u.version){if(a.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");f(a.buffer,u,r),a.version=u.version}}return{get:y,remove:m,update:l}}class er extends Ft{constructor(e=1,t=1,n=1,p=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:p};const f=e/2,y=t/2,m=Math.floor(n),l=Math.floor(p),u=m+1,r=l+1,a=e/m,s=t/l,o=[],i=[],c=[],h=[];for(let d=0;d<r;d++){const _=d*s-y;for(let C=0;C<u;C++){const M=C*a-f;i.push(M,-_,0),c.push(0,0,1),h.push(C/m),h.push(1-d/l)}}for(let d=0;d<l;d++)for(let _=0;_<m;_++){const C=_+u*d,M=_+u*(d+1),b=_+1+u*(d+1),v=_+1+u*d;o.push(C,M,v),o.push(M,b,v)}this.setIndex(o),this.setAttribute("position",new At(i,3)),this.setAttribute("normal",new At(c,3)),this.setAttribute("uv",new At(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new er(e.width,e.height,e.widthSegments,e.heightSegments)}}var Mc=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Ec=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Cc=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Ac=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Tc=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Lc=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Rc=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Dc=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ic=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Pc=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,Nc=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,kc=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Oc=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,$c=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Fc=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Uc=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Bc=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zc=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Hc=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Wc=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Gc=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Vc=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Xc=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,jc=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Kc=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Yc=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Zc=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Qc=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,qc=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Jc=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,eh="gl_FragColor = linearToOutputTexel( gl_FragColor );",th=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,nh=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,ih=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,rh=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,sh=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,oh=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ah=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,lh=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,ch=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,hh=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,uh=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,dh=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,fh=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ph=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,gh=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,mh=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,vh=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,yh=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_h=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Sh=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,xh=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,bh=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,wh=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Mh=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Eh=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Ch=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Ah=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Th=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Lh=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Rh=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Dh=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Ih=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Ph=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Nh=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,kh=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Oh=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,$h=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Fh=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Uh=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Bh=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,zh=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Hh=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Wh=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Gh=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Vh=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Xh=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,jh=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Kh=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Yh=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Zh=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Qh=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qh=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Jh=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eu=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tu=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,nu=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,iu=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ru=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,su=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,ou=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,au=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,lu=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,cu=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,hu=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,uu=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,du=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,fu=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pu=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,gu=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,mu=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,vu=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yu=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_u=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Su=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xu=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,bu=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const wu=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Mu=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Eu=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Cu=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Au=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Tu=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Lu=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Ru=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Du=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Iu=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Pu=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Nu=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ku=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ou=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$u=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Fu=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uu=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Bu=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zu=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Hu=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Wu=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Gu=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Vu=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Xu=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ju=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ku=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Yu=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Zu=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Qu=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,qu=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ju=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ed=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,td=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nd=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ne={alphahash_fragment:Mc,alphahash_pars_fragment:Ec,alphamap_fragment:Cc,alphamap_pars_fragment:Ac,alphatest_fragment:Tc,alphatest_pars_fragment:Lc,aomap_fragment:Rc,aomap_pars_fragment:Dc,batching_pars_vertex:Ic,batching_vertex:Pc,begin_vertex:Nc,beginnormal_vertex:kc,bsdfs:Oc,iridescence_fragment:$c,bumpmap_pars_fragment:Fc,clipping_planes_fragment:Uc,clipping_planes_pars_fragment:Bc,clipping_planes_pars_vertex:zc,clipping_planes_vertex:Hc,color_fragment:Wc,color_pars_fragment:Gc,color_pars_vertex:Vc,color_vertex:Xc,common:jc,cube_uv_reflection_fragment:Kc,defaultnormal_vertex:Yc,displacementmap_pars_vertex:Zc,displacementmap_vertex:Qc,emissivemap_fragment:qc,emissivemap_pars_fragment:Jc,colorspace_fragment:eh,colorspace_pars_fragment:th,envmap_fragment:nh,envmap_common_pars_fragment:ih,envmap_pars_fragment:rh,envmap_pars_vertex:sh,envmap_physical_pars_fragment:vh,envmap_vertex:oh,fog_vertex:ah,fog_pars_vertex:lh,fog_fragment:ch,fog_pars_fragment:hh,gradientmap_pars_fragment:uh,lightmap_fragment:dh,lightmap_pars_fragment:fh,lights_lambert_fragment:ph,lights_lambert_pars_fragment:gh,lights_pars_begin:mh,lights_toon_fragment:yh,lights_toon_pars_fragment:_h,lights_phong_fragment:Sh,lights_phong_pars_fragment:xh,lights_physical_fragment:bh,lights_physical_pars_fragment:wh,lights_fragment_begin:Mh,lights_fragment_maps:Eh,lights_fragment_end:Ch,logdepthbuf_fragment:Ah,logdepthbuf_pars_fragment:Th,logdepthbuf_pars_vertex:Lh,logdepthbuf_vertex:Rh,map_fragment:Dh,map_pars_fragment:Ih,map_particle_fragment:Ph,map_particle_pars_fragment:Nh,metalnessmap_fragment:kh,metalnessmap_pars_fragment:Oh,morphcolor_vertex:$h,morphnormal_vertex:Fh,morphtarget_pars_vertex:Uh,morphtarget_vertex:Bh,normal_fragment_begin:zh,normal_fragment_maps:Hh,normal_pars_fragment:Wh,normal_pars_vertex:Gh,normal_vertex:Vh,normalmap_pars_fragment:Xh,clearcoat_normal_fragment_begin:jh,clearcoat_normal_fragment_maps:Kh,clearcoat_pars_fragment:Yh,iridescence_pars_fragment:Zh,opaque_fragment:Qh,packing:qh,premultiplied_alpha_fragment:Jh,project_vertex:eu,dithering_fragment:tu,dithering_pars_fragment:nu,roughnessmap_fragment:iu,roughnessmap_pars_fragment:ru,shadowmap_pars_fragment:su,shadowmap_pars_vertex:ou,shadowmap_vertex:au,shadowmask_pars_fragment:lu,skinbase_vertex:cu,skinning_pars_vertex:hu,skinning_vertex:uu,skinnormal_vertex:du,specularmap_fragment:fu,specularmap_pars_fragment:pu,tonemapping_fragment:gu,tonemapping_pars_fragment:mu,transmission_fragment:vu,transmission_pars_fragment:yu,uv_pars_fragment:_u,uv_pars_vertex:Su,uv_vertex:xu,worldpos_vertex:bu,background_vert:wu,background_frag:Mu,backgroundCube_vert:Eu,backgroundCube_frag:Cu,cube_vert:Au,cube_frag:Tu,depth_vert:Lu,depth_frag:Ru,distanceRGBA_vert:Du,distanceRGBA_frag:Iu,equirect_vert:Pu,equirect_frag:Nu,linedashed_vert:ku,linedashed_frag:Ou,meshbasic_vert:$u,meshbasic_frag:Fu,meshlambert_vert:Uu,meshlambert_frag:Bu,meshmatcap_vert:zu,meshmatcap_frag:Hu,meshnormal_vert:Wu,meshnormal_frag:Gu,meshphong_vert:Vu,meshphong_frag:Xu,meshphysical_vert:ju,meshphysical_frag:Ku,meshtoon_vert:Yu,meshtoon_frag:Zu,points_vert:Qu,points_frag:qu,shadow_vert:Ju,shadow_frag:ed,sprite_vert:td,sprite_frag:nd},ue={common:{diffuse:{value:new He(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ue},alphaMap:{value:null},alphaMapTransform:{value:new Ue},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ue}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ue}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ue}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ue},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ue},normalScale:{value:new We(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ue},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ue}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ue}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ue}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new He(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new He(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ue},alphaTest:{value:0},uvTransform:{value:new Ue}},sprite:{diffuse:{value:new He(16777215)},opacity:{value:1},center:{value:new We(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ue},alphaMap:{value:null},alphaMapTransform:{value:new Ue},alphaTest:{value:0}}},Bt={basic:{uniforms:vt([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.fog]),vertexShader:Ne.meshbasic_vert,fragmentShader:Ne.meshbasic_frag},lambert:{uniforms:vt([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,ue.lights,{emissive:{value:new He(0)}}]),vertexShader:Ne.meshlambert_vert,fragmentShader:Ne.meshlambert_frag},phong:{uniforms:vt([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,ue.lights,{emissive:{value:new He(0)},specular:{value:new He(1118481)},shininess:{value:30}}]),vertexShader:Ne.meshphong_vert,fragmentShader:Ne.meshphong_frag},standard:{uniforms:vt([ue.common,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.roughnessmap,ue.metalnessmap,ue.fog,ue.lights,{emissive:{value:new He(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ne.meshphysical_vert,fragmentShader:Ne.meshphysical_frag},toon:{uniforms:vt([ue.common,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.gradientmap,ue.fog,ue.lights,{emissive:{value:new He(0)}}]),vertexShader:Ne.meshtoon_vert,fragmentShader:Ne.meshtoon_frag},matcap:{uniforms:vt([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,{matcap:{value:null}}]),vertexShader:Ne.meshmatcap_vert,fragmentShader:Ne.meshmatcap_frag},points:{uniforms:vt([ue.points,ue.fog]),vertexShader:Ne.points_vert,fragmentShader:Ne.points_frag},dashed:{uniforms:vt([ue.common,ue.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ne.linedashed_vert,fragmentShader:Ne.linedashed_frag},depth:{uniforms:vt([ue.common,ue.displacementmap]),vertexShader:Ne.depth_vert,fragmentShader:Ne.depth_frag},normal:{uniforms:vt([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,{opacity:{value:1}}]),vertexShader:Ne.meshnormal_vert,fragmentShader:Ne.meshnormal_frag},sprite:{uniforms:vt([ue.sprite,ue.fog]),vertexShader:Ne.sprite_vert,fragmentShader:Ne.sprite_frag},background:{uniforms:{uvTransform:{value:new Ue},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ne.background_vert,fragmentShader:Ne.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ne.backgroundCube_vert,fragmentShader:Ne.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ne.cube_vert,fragmentShader:Ne.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ne.equirect_vert,fragmentShader:Ne.equirect_frag},distanceRGBA:{uniforms:vt([ue.common,ue.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ne.distanceRGBA_vert,fragmentShader:Ne.distanceRGBA_frag},shadow:{uniforms:vt([ue.lights,ue.fog,{color:{value:new He(0)},opacity:{value:1}}]),vertexShader:Ne.shadow_vert,fragmentShader:Ne.shadow_frag}};Bt.physical={uniforms:vt([Bt.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ue},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ue},clearcoatNormalScale:{value:new We(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ue},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ue},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ue},sheen:{value:0},sheenColor:{value:new He(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ue},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ue},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ue},transmissionSamplerSize:{value:new We},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ue},attenuationDistance:{value:0},attenuationColor:{value:new He(0)},specularColor:{value:new He(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ue},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ue},anisotropyVector:{value:new We},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ue}}]),vertexShader:Ne.meshphysical_vert,fragmentShader:Ne.meshphysical_frag};const Bi={r:0,b:0,g:0};function id(g,e,t,n,p,f,y){const m=new He(0);let l=f===!0?0:1,u,r,a=null,s=0,o=null;function i(h,d){let _=!1,C=d.isScene===!0?d.background:null;C&&C.isTexture&&(C=(d.backgroundBlurriness>0?t:e).get(C)),C===null?c(m,l):C&&C.isColor&&(c(C,1),_=!0);const M=g.xr.getEnvironmentBlendMode();M==="additive"?n.buffers.color.setClear(0,0,0,1,y):M==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,y),(g.autoClear||_)&&g.clear(g.autoClearColor,g.autoClearDepth,g.autoClearStencil),C&&(C.isCubeTexture||C.mapping===Zi)?(r===void 0&&(r=new Jt(new yi(1,1,1),new fn({name:"BackgroundCubeMaterial",uniforms:ei(Bt.backgroundCube.uniforms),vertexShader:Bt.backgroundCube.vertexShader,fragmentShader:Bt.backgroundCube.fragmentShader,side:bt,depthTest:!1,depthWrite:!1,fog:!1})),r.geometry.deleteAttribute("normal"),r.geometry.deleteAttribute("uv"),r.onBeforeRender=function(b,v,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(r.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),p.update(r)),r.material.uniforms.envMap.value=C,r.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,r.material.uniforms.backgroundBlurriness.value=d.backgroundBlurriness,r.material.uniforms.backgroundIntensity.value=d.backgroundIntensity,r.material.toneMapped=je.getTransfer(C.colorSpace)!==Je,(a!==C||s!==C.version||o!==g.toneMapping)&&(r.material.needsUpdate=!0,a=C,s=C.version,o=g.toneMapping),r.layers.enableAll(),h.unshift(r,r.geometry,r.material,0,0,null)):C&&C.isTexture&&(u===void 0&&(u=new Jt(new er(2,2),new fn({name:"BackgroundMaterial",uniforms:ei(Bt.background.uniforms),vertexShader:Bt.background.vertexShader,fragmentShader:Bt.background.fragmentShader,side:dn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),p.update(u)),u.material.uniforms.t2D.value=C,u.material.uniforms.backgroundIntensity.value=d.backgroundIntensity,u.material.toneMapped=je.getTransfer(C.colorSpace)!==Je,C.matrixAutoUpdate===!0&&C.updateMatrix(),u.material.uniforms.uvTransform.value.copy(C.matrix),(a!==C||s!==C.version||o!==g.toneMapping)&&(u.material.needsUpdate=!0,a=C,s=C.version,o=g.toneMapping),u.layers.enableAll(),h.unshift(u,u.geometry,u.material,0,0,null))}function c(h,d){h.getRGB(Bi,la(g)),n.buffers.color.setClear(Bi.r,Bi.g,Bi.b,d,y)}return{getClearColor:function(){return m},setClearColor:function(h,d=1){m.set(h),l=d,c(m,l)},getClearAlpha:function(){return l},setClearAlpha:function(h){l=h,c(m,l)},render:i}}function rd(g,e,t,n){const p=g.getParameter(g.MAX_VERTEX_ATTRIBS),f=n.isWebGL2?null:e.get("OES_vertex_array_object"),y=n.isWebGL2||f!==null,m={},l=h(null);let u=l,r=!1;function a(x,S,T,P,N){let k=!1;if(y){const O=c(P,T,S);u!==O&&(u=O,o(u.object)),k=d(x,P,T,N),k&&_(x,P,T,N)}else{const O=S.wireframe===!0;(u.geometry!==P.id||u.program!==T.id||u.wireframe!==O)&&(u.geometry=P.id,u.program=T.id,u.wireframe=O,k=!0)}N!==null&&t.update(N,g.ELEMENT_ARRAY_BUFFER),(k||r)&&(r=!1,D(x,S,T,P),N!==null&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,t.get(N).buffer))}function s(){return n.isWebGL2?g.createVertexArray():f.createVertexArrayOES()}function o(x){return n.isWebGL2?g.bindVertexArray(x):f.bindVertexArrayOES(x)}function i(x){return n.isWebGL2?g.deleteVertexArray(x):f.deleteVertexArrayOES(x)}function c(x,S,T){const P=T.wireframe===!0;let N=m[x.id];N===void 0&&(N={},m[x.id]=N);let k=N[S.id];k===void 0&&(k={},N[S.id]=k);let O=k[P];return O===void 0&&(O=h(s()),k[P]=O),O}function h(x){const S=[],T=[],P=[];for(let N=0;N<p;N++)S[N]=0,T[N]=0,P[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:S,enabledAttributes:T,attributeDivisors:P,object:x,attributes:{},index:null}}function d(x,S,T,P){const N=u.attributes,k=S.attributes;let O=0;const $=T.getAttributes();for(const V in $)if($[V].location>=0){const U=N[V];let z=k[V];if(z===void 0&&(V==="instanceMatrix"&&x.instanceMatrix&&(z=x.instanceMatrix),V==="instanceColor"&&x.instanceColor&&(z=x.instanceColor)),U===void 0||U.attribute!==z||z&&U.data!==z.data)return!0;O++}return u.attributesNum!==O||u.index!==P}function _(x,S,T,P){const N={},k=S.attributes;let O=0;const $=T.getAttributes();for(const V in $)if($[V].location>=0){let U=k[V];U===void 0&&(V==="instanceMatrix"&&x.instanceMatrix&&(U=x.instanceMatrix),V==="instanceColor"&&x.instanceColor&&(U=x.instanceColor));const z={};z.attribute=U,U&&U.data&&(z.data=U.data),N[V]=z,O++}u.attributes=N,u.attributesNum=O,u.index=P}function C(){const x=u.newAttributes;for(let S=0,T=x.length;S<T;S++)x[S]=0}function M(x){b(x,0)}function b(x,S){const T=u.newAttributes,P=u.enabledAttributes,N=u.attributeDivisors;T[x]=1,P[x]===0&&(g.enableVertexAttribArray(x),P[x]=1),N[x]!==S&&((n.isWebGL2?g:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](x,S),N[x]=S)}function v(){const x=u.newAttributes,S=u.enabledAttributes;for(let T=0,P=S.length;T<P;T++)S[T]!==x[T]&&(g.disableVertexAttribArray(T),S[T]=0)}function E(x,S,T,P,N,k,O){O===!0?g.vertexAttribIPointer(x,S,T,N,k):g.vertexAttribPointer(x,S,T,P,N,k)}function D(x,S,T,P){if(n.isWebGL2===!1&&(x.isInstancedMesh||P.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;C();const N=P.attributes,k=T.getAttributes(),O=S.defaultAttributeValues;for(const $ in k){const V=k[$];if(V.location>=0){let H=N[$];if(H===void 0&&($==="instanceMatrix"&&x.instanceMatrix&&(H=x.instanceMatrix),$==="instanceColor"&&x.instanceColor&&(H=x.instanceColor)),H!==void 0){const U=H.normalized,z=H.itemSize,G=t.get(H);if(G===void 0)continue;const K=G.buffer,Y=G.type,Z=G.bytesPerElement,ie=n.isWebGL2===!0&&(Y===g.INT||Y===g.UNSIGNED_INT||H.gpuType===Wo);if(H.isInterleavedBufferAttribute){const oe=H.data,j=oe.stride,ke=H.offset;if(oe.isInstancedInterleavedBuffer){for(let ge=0;ge<V.locationSize;ge++)b(V.location+ge,oe.meshPerAttribute);x.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let ge=0;ge<V.locationSize;ge++)M(V.location+ge);g.bindBuffer(g.ARRAY_BUFFER,K);for(let ge=0;ge<V.locationSize;ge++)E(V.location+ge,z/V.locationSize,Y,U,j*Z,(ke+z/V.locationSize*ge)*Z,ie)}else{if(H.isInstancedBufferAttribute){for(let oe=0;oe<V.locationSize;oe++)b(V.location+oe,H.meshPerAttribute);x.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=H.meshPerAttribute*H.count)}else for(let oe=0;oe<V.locationSize;oe++)M(V.location+oe);g.bindBuffer(g.ARRAY_BUFFER,K);for(let oe=0;oe<V.locationSize;oe++)E(V.location+oe,z/V.locationSize,Y,U,z*Z,z/V.locationSize*oe*Z,ie)}}else if(O!==void 0){const U=O[$];if(U!==void 0)switch(U.length){case 2:g.vertexAttrib2fv(V.location,U);break;case 3:g.vertexAttrib3fv(V.location,U);break;case 4:g.vertexAttrib4fv(V.location,U);break;default:g.vertexAttrib1fv(V.location,U)}}}}v()}function L(){R();for(const x in m){const S=m[x];for(const T in S){const P=S[T];for(const N in P)i(P[N].object),delete P[N];delete S[T]}delete m[x]}}function w(x){if(m[x.id]===void 0)return;const S=m[x.id];for(const T in S){const P=S[T];for(const N in P)i(P[N].object),delete P[N];delete S[T]}delete m[x.id]}function I(x){for(const S in m){const T=m[S];if(T[x.id]===void 0)continue;const P=T[x.id];for(const N in P)i(P[N].object),delete P[N];delete T[x.id]}}function R(){A(),r=!0,u!==l&&(u=l,o(u.object))}function A(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:a,reset:R,resetDefaultState:A,dispose:L,releaseStatesOfGeometry:w,releaseStatesOfProgram:I,initAttributes:C,enableAttribute:M,disableUnusedAttributes:v}}function sd(g,e,t,n){const p=n.isWebGL2;let f;function y(r){f=r}function m(r,a){g.drawArrays(f,r,a),t.update(a,f,1)}function l(r,a,s){if(s===0)return;let o,i;if(p)o=g,i="drawArraysInstanced";else if(o=e.get("ANGLE_instanced_arrays"),i="drawArraysInstancedANGLE",o===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}o[i](f,r,a,s),t.update(a,f,s)}function u(r,a,s){if(s===0)return;const o=e.get("WEBGL_multi_draw");if(o===null)for(let i=0;i<s;i++)this.render(r[i],a[i]);else{o.multiDrawArraysWEBGL(f,r,0,a,0,s);let i=0;for(let c=0;c<s;c++)i+=a[c];t.update(i,f,1)}}this.setMode=y,this.render=m,this.renderInstances=l,this.renderMultiDraw=u}function od(g,e,t){let n;function p(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const E=e.get("EXT_texture_filter_anisotropic");n=g.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function f(E){if(E==="highp"){if(g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.HIGH_FLOAT).precision>0&&g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT).precision>0)return"highp";E="mediump"}return E==="mediump"&&g.getShaderPrecisionFormat(g.VERTEX_SHADER,g.MEDIUM_FLOAT).precision>0&&g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const y=typeof WebGL2RenderingContext<"u"&&g.constructor.name==="WebGL2RenderingContext";let m=t.precision!==void 0?t.precision:"highp";const l=f(m);l!==m&&(console.warn("THREE.WebGLRenderer:",m,"not supported, using",l,"instead."),m=l);const u=y||e.has("WEBGL_draw_buffers"),r=t.logarithmicDepthBuffer===!0,a=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS),s=g.getParameter(g.MAX_VERTEX_TEXTURE_IMAGE_UNITS),o=g.getParameter(g.MAX_TEXTURE_SIZE),i=g.getParameter(g.MAX_CUBE_MAP_TEXTURE_SIZE),c=g.getParameter(g.MAX_VERTEX_ATTRIBS),h=g.getParameter(g.MAX_VERTEX_UNIFORM_VECTORS),d=g.getParameter(g.MAX_VARYING_VECTORS),_=g.getParameter(g.MAX_FRAGMENT_UNIFORM_VECTORS),C=s>0,M=y||e.has("OES_texture_float"),b=C&&M,v=y?g.getParameter(g.MAX_SAMPLES):0;return{isWebGL2:y,drawBuffers:u,getMaxAnisotropy:p,getMaxPrecision:f,precision:m,logarithmicDepthBuffer:r,maxTextures:a,maxVertexTextures:s,maxTextureSize:o,maxCubemapSize:i,maxAttributes:c,maxVertexUniforms:h,maxVaryings:d,maxFragmentUniforms:_,vertexTextures:C,floatFragmentTextures:M,floatVertexTextures:b,maxSamples:v}}function ad(g){const e=this;let t=null,n=0,p=!1,f=!1;const y=new Sn,m=new Ue,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(a,s){const o=a.length!==0||s||n!==0||p;return p=s,n=a.length,o},this.beginShadows=function(){f=!0,r(null)},this.endShadows=function(){f=!1},this.setGlobalState=function(a,s){t=r(a,s,0)},this.setState=function(a,s,o){const i=a.clippingPlanes,c=a.clipIntersection,h=a.clipShadows,d=g.get(a);if(!p||i===null||i.length===0||f&&!h)f?r(null):u();else{const _=f?0:n,C=_*4;let M=d.clippingState||null;l.value=M,M=r(i,s,C,o);for(let b=0;b!==C;++b)M[b]=t[b];d.clippingState=M,this.numIntersection=c?this.numPlanes:0,this.numPlanes+=_}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function r(a,s,o,i){const c=a!==null?a.length:0;let h=null;if(c!==0){if(h=l.value,i!==!0||h===null){const d=o+c*4,_=s.matrixWorldInverse;m.getNormalMatrix(_),(h===null||h.length<d)&&(h=new Float32Array(d));for(let C=0,M=o;C!==c;++C,M+=4)y.copy(a[C]).applyMatrix4(_,m),y.normal.toArray(h,M),h[M+3]=y.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=c,e.numIntersection=0,h}}function ld(g){let e=new WeakMap;function t(y,m){return m===Wr?y.mapping=Qn:m===Gr&&(y.mapping=qn),y}function n(y){if(y&&y.isTexture){const m=y.mapping;if(m===Wr||m===Gr)if(e.has(y)){const l=e.get(y).texture;return t(l,y.mapping)}else{const l=y.image;if(l&&l.height>0){const u=new Sc(l.height);return u.fromEquirectangularTexture(g,y),e.set(y,u),y.addEventListener("dispose",p),t(u.texture,y.mapping)}else return null}}return y}function p(y){const m=y.target;m.removeEventListener("dispose",p);const l=e.get(m);l!==void 0&&(e.delete(m),l.dispose())}function f(){e=new WeakMap}return{get:n,dispose:f}}class da extends ca{constructor(e=-1,t=1,n=1,p=-1,f=.1,y=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=p,this.near=f,this.far=y,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,p,f,y){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=p,this.view.width=f,this.view.height=y,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,p=(this.top+this.bottom)/2;let f=n-e,y=n+e,m=p+t,l=p-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,r=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f+=u*this.view.offsetX,y=f+u*this.view.width,m-=r*this.view.offsetY,l=m-r*this.view.height}this.projectionMatrix.makeOrthographic(f,y,m,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Xn=4,co=[.125,.215,.35,.446,.526,.582],wn=20,Pr=new da,ho=new He;let Nr=null,kr=0,Or=0;const xn=(1+Math.sqrt(5))/2,Vn=1/xn,uo=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,xn,Vn),new q(0,xn,-Vn),new q(Vn,0,xn),new q(-Vn,0,xn),new q(xn,Vn,0),new q(-xn,Vn,0)];class fo{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,p=100){Nr=this._renderer.getRenderTarget(),kr=this._renderer.getActiveCubeFace(),Or=this._renderer.getActiveMipmapLevel(),this._setSize(256);const f=this._allocateTargets();return f.depthBuffer=!0,this._sceneToCubeUV(e,n,p,f),t>0&&this._blur(f,0,0,t),this._applyPMREM(f),this._cleanup(f),f}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=mo(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=go(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Nr,kr,Or),e.scissorTest=!1,zi(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Qn||e.mapping===qn?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Nr=this._renderer.getRenderTarget(),kr=this._renderer.getActiveCubeFace(),Or=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:St,minFilter:St,generateMipmaps:!1,type:fi,format:$t,colorSpace:en,depthBuffer:!1},p=po(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=po(e,t,n);const{_lodMax:f}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=cd(f)),this._blurMaterial=hd(f,e,t)}return p}_compileMaterial(e){const t=new Jt(this._lodPlanes[0],e);this._renderer.compile(t,Pr)}_sceneToCubeUV(e,t,n,p){const m=new Dt(90,1,t,n),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],r=this._renderer,a=r.autoClear,s=r.toneMapping;r.getClearColor(ho),r.toneMapping=hn,r.autoClear=!1;const o=new sa({name:"PMREM.Background",side:bt,depthWrite:!1,depthTest:!1}),i=new Jt(new yi,o);let c=!1;const h=e.background;h?h.isColor&&(o.color.copy(h),e.background=null,c=!0):(o.color.copy(ho),c=!0);for(let d=0;d<6;d++){const _=d%3;_===0?(m.up.set(0,l[d],0),m.lookAt(u[d],0,0)):_===1?(m.up.set(0,0,l[d]),m.lookAt(0,u[d],0)):(m.up.set(0,l[d],0),m.lookAt(0,0,u[d]));const C=this._cubeSize;zi(p,_*C,d>2?C:0,C,C),r.setRenderTarget(p),c&&r.render(i,m),r.render(e,m)}i.geometry.dispose(),i.material.dispose(),r.toneMapping=s,r.autoClear=a,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,p=e.mapping===Qn||e.mapping===qn;p?(this._cubemapMaterial===null&&(this._cubemapMaterial=mo()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=go());const f=p?this._cubemapMaterial:this._equirectMaterial,y=new Jt(this._lodPlanes[0],f),m=f.uniforms;m.envMap.value=e;const l=this._cubeSize;zi(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(y,Pr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let p=1;p<this._lodPlanes.length;p++){const f=Math.sqrt(this._sigmas[p]*this._sigmas[p]-this._sigmas[p-1]*this._sigmas[p-1]),y=uo[(p-1)%uo.length];this._blur(e,p-1,p,f,y)}t.autoClear=n}_blur(e,t,n,p,f){const y=this._pingPongRenderTarget;this._halfBlur(e,y,t,n,p,"latitudinal",f),this._halfBlur(y,e,n,n,p,"longitudinal",f)}_halfBlur(e,t,n,p,f,y,m){const l=this._renderer,u=this._blurMaterial;y!=="latitudinal"&&y!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const r=3,a=new Jt(this._lodPlanes[p],u),s=u.uniforms,o=this._sizeLods[n]-1,i=isFinite(f)?Math.PI/(2*o):2*Math.PI/(2*wn-1),c=f/i,h=isFinite(f)?1+Math.floor(r*c):wn;h>wn&&console.warn(`sigmaRadians, ${f}, is too large and will clip, as it requested ${h} samples when the maximum is set to ${wn}`);const d=[];let _=0;for(let E=0;E<wn;++E){const D=E/c,L=Math.exp(-D*D/2);d.push(L),E===0?_+=L:E<h&&(_+=2*L)}for(let E=0;E<d.length;E++)d[E]=d[E]/_;s.envMap.value=e.texture,s.samples.value=h,s.weights.value=d,s.latitudinal.value=y==="latitudinal",m&&(s.poleAxis.value=m);const{_lodMax:C}=this;s.dTheta.value=i,s.mipInt.value=C-n;const M=this._sizeLods[p],b=3*M*(p>C-Xn?p-C+Xn:0),v=4*(this._cubeSize-M);zi(t,b,v,3*M,2*M),l.setRenderTarget(t),l.render(a,Pr)}}function cd(g){const e=[],t=[],n=[];let p=g;const f=g-Xn+1+co.length;for(let y=0;y<f;y++){const m=Math.pow(2,p);t.push(m);let l=1/m;y>g-Xn?l=co[y-g+Xn-1]:y===0&&(l=0),n.push(l);const u=1/(m-2),r=-u,a=1+u,s=[r,r,a,r,a,a,r,r,a,a,r,a],o=6,i=6,c=3,h=2,d=1,_=new Float32Array(c*i*o),C=new Float32Array(h*i*o),M=new Float32Array(d*i*o);for(let v=0;v<o;v++){const E=v%3*2/3-1,D=v>2?0:-1,L=[E,D,0,E+2/3,D,0,E+2/3,D+1,0,E,D,0,E+2/3,D+1,0,E,D+1,0];_.set(L,c*i*v),C.set(s,h*i*v);const w=[v,v,v,v,v,v];M.set(w,d*i*v)}const b=new Ft;b.setAttribute("position",new Ht(_,c)),b.setAttribute("uv",new Ht(C,h)),b.setAttribute("faceIndex",new Ht(M,d)),e.push(b),p>Xn&&p--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function po(g,e,t){const n=new Tn(g,e,t);return n.texture.mapping=Zi,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function zi(g,e,t,n,p){g.viewport.set(e,t,n,p),g.scissor.set(e,t,n,p)}function hd(g,e,t){const n=new Float32Array(wn),p=new q(0,1,0);return new fn({name:"SphericalGaussianBlur",defines:{n:wn,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${g}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:p}},vertexShader:ts(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function go(){return new fn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ts(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function mo(){return new fn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ts(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function ts(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ud(g){let e=new WeakMap,t=null;function n(m){if(m&&m.isTexture){const l=m.mapping,u=l===Wr||l===Gr,r=l===Qn||l===qn;if(u||r)if(m.isRenderTargetTexture&&m.needsPMREMUpdate===!0){m.needsPMREMUpdate=!1;let a=e.get(m);return t===null&&(t=new fo(g)),a=u?t.fromEquirectangular(m,a):t.fromCubemap(m,a),e.set(m,a),a.texture}else{if(e.has(m))return e.get(m).texture;{const a=m.image;if(u&&a&&a.height>0||r&&a&&p(a)){t===null&&(t=new fo(g));const s=u?t.fromEquirectangular(m):t.fromCubemap(m);return e.set(m,s),m.addEventListener("dispose",f),s.texture}else return null}}}return m}function p(m){let l=0;const u=6;for(let r=0;r<u;r++)m[r]!==void 0&&l++;return l===u}function f(m){const l=m.target;l.removeEventListener("dispose",f);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function y(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:y}}function dd(g){const e={};function t(n){if(e[n]!==void 0)return e[n];let p;switch(n){case"WEBGL_depth_texture":p=g.getExtension("WEBGL_depth_texture")||g.getExtension("MOZ_WEBGL_depth_texture")||g.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":p=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":p=g.getExtension("WEBGL_compressed_texture_s3tc")||g.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||g.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":p=g.getExtension("WEBGL_compressed_texture_pvrtc")||g.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:p=g.getExtension(n)}return e[n]=p,p}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const p=t(n);return p===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),p}}}function fd(g,e,t,n){const p={},f=new WeakMap;function y(a){const s=a.target;s.index!==null&&e.remove(s.index);for(const i in s.attributes)e.remove(s.attributes[i]);for(const i in s.morphAttributes){const c=s.morphAttributes[i];for(let h=0,d=c.length;h<d;h++)e.remove(c[h])}s.removeEventListener("dispose",y),delete p[s.id];const o=f.get(s);o&&(e.remove(o),f.delete(s)),n.releaseStatesOfGeometry(s),s.isInstancedBufferGeometry===!0&&delete s._maxInstanceCount,t.memory.geometries--}function m(a,s){return p[s.id]===!0||(s.addEventListener("dispose",y),p[s.id]=!0,t.memory.geometries++),s}function l(a){const s=a.attributes;for(const i in s)e.update(s[i],g.ARRAY_BUFFER);const o=a.morphAttributes;for(const i in o){const c=o[i];for(let h=0,d=c.length;h<d;h++)e.update(c[h],g.ARRAY_BUFFER)}}function u(a){const s=[],o=a.index,i=a.attributes.position;let c=0;if(o!==null){const _=o.array;c=o.version;for(let C=0,M=_.length;C<M;C+=3){const b=_[C+0],v=_[C+1],E=_[C+2];s.push(b,v,v,E,E,b)}}else if(i!==void 0){const _=i.array;c=i.version;for(let C=0,M=_.length/3-1;C<M;C+=3){const b=C+0,v=C+1,E=C+2;s.push(b,v,v,E,E,b)}}else return;const h=new(qo(s)?aa:oa)(s,1);h.version=c;const d=f.get(a);d&&e.remove(d),f.set(a,h)}function r(a){const s=f.get(a);if(s){const o=a.index;o!==null&&s.version<o.version&&u(a)}else u(a);return f.get(a)}return{get:m,update:l,getWireframeAttribute:r}}function pd(g,e,t,n){const p=n.isWebGL2;let f;function y(o){f=o}let m,l;function u(o){m=o.type,l=o.bytesPerElement}function r(o,i){g.drawElements(f,i,m,o*l),t.update(i,f,1)}function a(o,i,c){if(c===0)return;let h,d;if(p)h=g,d="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",h===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[d](f,i,m,o*l,c),t.update(i,f,c)}function s(o,i,c){if(c===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let d=0;d<c;d++)this.render(o[d]/l,i[d]);else{h.multiDrawElementsWEBGL(f,i,0,m,o,0,c);let d=0;for(let _=0;_<c;_++)d+=i[_];t.update(d,f,1)}}this.setMode=y,this.setIndex=u,this.render=r,this.renderInstances=a,this.renderMultiDraw=s}function gd(g){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(f,y,m){switch(t.calls++,y){case g.TRIANGLES:t.triangles+=m*(f/3);break;case g.LINES:t.lines+=m*(f/2);break;case g.LINE_STRIP:t.lines+=m*(f-1);break;case g.LINE_LOOP:t.lines+=m*f;break;case g.POINTS:t.points+=m*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",y);break}}function p(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:p,update:n}}function md(g,e){return g[0]-e[0]}function vd(g,e){return Math.abs(e[1])-Math.abs(g[1])}function yd(g,e,t){const n={},p=new Float32Array(8),f=new WeakMap,y=new ct,m=[];for(let u=0;u<8;u++)m[u]=[u,0];function l(u,r,a){const s=u.morphTargetInfluences;if(e.isWebGL2===!0){const i=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,c=i!==void 0?i.length:0;let h=f.get(r);if(h===void 0||h.count!==c){let S=function(){A.dispose(),f.delete(r),r.removeEventListener("dispose",S)};var o=S;h!==void 0&&h.texture.dispose();const C=r.morphAttributes.position!==void 0,M=r.morphAttributes.normal!==void 0,b=r.morphAttributes.color!==void 0,v=r.morphAttributes.position||[],E=r.morphAttributes.normal||[],D=r.morphAttributes.color||[];let L=0;C===!0&&(L=1),M===!0&&(L=2),b===!0&&(L=3);let w=r.attributes.position.count*L,I=1;w>e.maxTextureSize&&(I=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const R=new Float32Array(w*I*4*c),A=new ta(R,w,I,c);A.type=Qt,A.needsUpdate=!0;const x=L*4;for(let T=0;T<c;T++){const P=v[T],N=E[T],k=D[T],O=w*I*4*T;for(let $=0;$<P.count;$++){const V=$*x;C===!0&&(y.fromBufferAttribute(P,$),R[O+V+0]=y.x,R[O+V+1]=y.y,R[O+V+2]=y.z,R[O+V+3]=0),M===!0&&(y.fromBufferAttribute(N,$),R[O+V+4]=y.x,R[O+V+5]=y.y,R[O+V+6]=y.z,R[O+V+7]=0),b===!0&&(y.fromBufferAttribute(k,$),R[O+V+8]=y.x,R[O+V+9]=y.y,R[O+V+10]=y.z,R[O+V+11]=k.itemSize===4?y.w:1)}}h={count:c,texture:A,size:new We(w,I)},f.set(r,h),r.addEventListener("dispose",S)}let d=0;for(let C=0;C<s.length;C++)d+=s[C];const _=r.morphTargetsRelative?1:1-d;a.getUniforms().setValue(g,"morphTargetBaseInfluence",_),a.getUniforms().setValue(g,"morphTargetInfluences",s),a.getUniforms().setValue(g,"morphTargetsTexture",h.texture,t),a.getUniforms().setValue(g,"morphTargetsTextureSize",h.size)}else{const i=s===void 0?0:s.length;let c=n[r.id];if(c===void 0||c.length!==i){c=[];for(let M=0;M<i;M++)c[M]=[M,0];n[r.id]=c}for(let M=0;M<i;M++){const b=c[M];b[0]=M,b[1]=s[M]}c.sort(vd);for(let M=0;M<8;M++)M<i&&c[M][1]?(m[M][0]=c[M][0],m[M][1]=c[M][1]):(m[M][0]=Number.MAX_SAFE_INTEGER,m[M][1]=0);m.sort(md);const h=r.morphAttributes.position,d=r.morphAttributes.normal;let _=0;for(let M=0;M<8;M++){const b=m[M],v=b[0],E=b[1];v!==Number.MAX_SAFE_INTEGER&&E?(h&&r.getAttribute("morphTarget"+M)!==h[v]&&r.setAttribute("morphTarget"+M,h[v]),d&&r.getAttribute("morphNormal"+M)!==d[v]&&r.setAttribute("morphNormal"+M,d[v]),p[M]=E,_+=E):(h&&r.hasAttribute("morphTarget"+M)===!0&&r.deleteAttribute("morphTarget"+M),d&&r.hasAttribute("morphNormal"+M)===!0&&r.deleteAttribute("morphNormal"+M),p[M]=0)}const C=r.morphTargetsRelative?1:1-_;a.getUniforms().setValue(g,"morphTargetBaseInfluence",C),a.getUniforms().setValue(g,"morphTargetInfluences",p)}}return{update:l}}function _d(g,e,t,n){let p=new WeakMap;function f(l){const u=n.render.frame,r=l.geometry,a=e.get(l,r);if(p.get(a)!==u&&(e.update(a),p.set(a,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",m)===!1&&l.addEventListener("dispose",m),p.get(l)!==u&&(t.update(l.instanceMatrix,g.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,g.ARRAY_BUFFER),p.set(l,u))),l.isSkinnedMesh){const s=l.skeleton;p.get(s)!==u&&(s.update(),p.set(s,u))}return a}function y(){p=new WeakMap}function m(l){const u=l.target;u.removeEventListener("dispose",m),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:f,dispose:y}}class fa extends wt{constructor(e,t,n,p,f,y,m,l,u,r){if(r=r!==void 0?r:Cn,r!==Cn&&r!==Jn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&r===Cn&&(n=ln),n===void 0&&r===Jn&&(n=En),super(null,p,f,y,m,l,r,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=m!==void 0?m:yt,this.minFilter=l!==void 0?l:yt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const pa=new wt,ga=new fa(1,1);ga.compareFunction=Qo;const ma=new ta,va=new ic,ya=new ha,vo=[],yo=[],_o=new Float32Array(16),So=new Float32Array(9),xo=new Float32Array(4);function ii(g,e,t){const n=g[0];if(n<=0||n>0)return g;const p=e*t;let f=vo[p];if(f===void 0&&(f=new Float32Array(p),vo[p]=f),e!==0){n.toArray(f,0);for(let y=1,m=0;y!==e;++y)m+=t,g[y].toArray(f,m)}return f}function st(g,e){if(g.length!==e.length)return!1;for(let t=0,n=g.length;t<n;t++)if(g[t]!==e[t])return!1;return!0}function ot(g,e){for(let t=0,n=e.length;t<n;t++)g[t]=e[t]}function tr(g,e){let t=yo[e];t===void 0&&(t=new Int32Array(e),yo[e]=t);for(let n=0;n!==e;++n)t[n]=g.allocateTextureUnit();return t}function Sd(g,e){const t=this.cache;t[0]!==e&&(g.uniform1f(this.addr,e),t[0]=e)}function xd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(g.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(st(t,e))return;g.uniform2fv(this.addr,e),ot(t,e)}}function bd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(g.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(g.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(st(t,e))return;g.uniform3fv(this.addr,e),ot(t,e)}}function wd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(g.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(st(t,e))return;g.uniform4fv(this.addr,e),ot(t,e)}}function Md(g,e){const t=this.cache,n=e.elements;if(n===void 0){if(st(t,e))return;g.uniformMatrix2fv(this.addr,!1,e),ot(t,e)}else{if(st(t,n))return;xo.set(n),g.uniformMatrix2fv(this.addr,!1,xo),ot(t,n)}}function Ed(g,e){const t=this.cache,n=e.elements;if(n===void 0){if(st(t,e))return;g.uniformMatrix3fv(this.addr,!1,e),ot(t,e)}else{if(st(t,n))return;So.set(n),g.uniformMatrix3fv(this.addr,!1,So),ot(t,n)}}function Cd(g,e){const t=this.cache,n=e.elements;if(n===void 0){if(st(t,e))return;g.uniformMatrix4fv(this.addr,!1,e),ot(t,e)}else{if(st(t,n))return;_o.set(n),g.uniformMatrix4fv(this.addr,!1,_o),ot(t,n)}}function Ad(g,e){const t=this.cache;t[0]!==e&&(g.uniform1i(this.addr,e),t[0]=e)}function Td(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(g.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(st(t,e))return;g.uniform2iv(this.addr,e),ot(t,e)}}function Ld(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(g.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(st(t,e))return;g.uniform3iv(this.addr,e),ot(t,e)}}function Rd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(g.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(st(t,e))return;g.uniform4iv(this.addr,e),ot(t,e)}}function Dd(g,e){const t=this.cache;t[0]!==e&&(g.uniform1ui(this.addr,e),t[0]=e)}function Id(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(g.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(st(t,e))return;g.uniform2uiv(this.addr,e),ot(t,e)}}function Pd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(g.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(st(t,e))return;g.uniform3uiv(this.addr,e),ot(t,e)}}function Nd(g,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(g.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(st(t,e))return;g.uniform4uiv(this.addr,e),ot(t,e)}}function kd(g,e,t){const n=this.cache,p=t.allocateTextureUnit();n[0]!==p&&(g.uniform1i(this.addr,p),n[0]=p);const f=this.type===g.SAMPLER_2D_SHADOW?ga:pa;t.setTexture2D(e||f,p)}function Od(g,e,t){const n=this.cache,p=t.allocateTextureUnit();n[0]!==p&&(g.uniform1i(this.addr,p),n[0]=p),t.setTexture3D(e||va,p)}function $d(g,e,t){const n=this.cache,p=t.allocateTextureUnit();n[0]!==p&&(g.uniform1i(this.addr,p),n[0]=p),t.setTextureCube(e||ya,p)}function Fd(g,e,t){const n=this.cache,p=t.allocateTextureUnit();n[0]!==p&&(g.uniform1i(this.addr,p),n[0]=p),t.setTexture2DArray(e||ma,p)}function Ud(g){switch(g){case 5126:return Sd;case 35664:return xd;case 35665:return bd;case 35666:return wd;case 35674:return Md;case 35675:return Ed;case 35676:return Cd;case 5124:case 35670:return Ad;case 35667:case 35671:return Td;case 35668:case 35672:return Ld;case 35669:case 35673:return Rd;case 5125:return Dd;case 36294:return Id;case 36295:return Pd;case 36296:return Nd;case 35678:case 36198:case 36298:case 36306:case 35682:return kd;case 35679:case 36299:case 36307:return Od;case 35680:case 36300:case 36308:case 36293:return $d;case 36289:case 36303:case 36311:case 36292:return Fd}}function Bd(g,e){g.uniform1fv(this.addr,e)}function zd(g,e){const t=ii(e,this.size,2);g.uniform2fv(this.addr,t)}function Hd(g,e){const t=ii(e,this.size,3);g.uniform3fv(this.addr,t)}function Wd(g,e){const t=ii(e,this.size,4);g.uniform4fv(this.addr,t)}function Gd(g,e){const t=ii(e,this.size,4);g.uniformMatrix2fv(this.addr,!1,t)}function Vd(g,e){const t=ii(e,this.size,9);g.uniformMatrix3fv(this.addr,!1,t)}function Xd(g,e){const t=ii(e,this.size,16);g.uniformMatrix4fv(this.addr,!1,t)}function jd(g,e){g.uniform1iv(this.addr,e)}function Kd(g,e){g.uniform2iv(this.addr,e)}function Yd(g,e){g.uniform3iv(this.addr,e)}function Zd(g,e){g.uniform4iv(this.addr,e)}function Qd(g,e){g.uniform1uiv(this.addr,e)}function qd(g,e){g.uniform2uiv(this.addr,e)}function Jd(g,e){g.uniform3uiv(this.addr,e)}function ef(g,e){g.uniform4uiv(this.addr,e)}function tf(g,e,t){const n=this.cache,p=e.length,f=tr(t,p);st(n,f)||(g.uniform1iv(this.addr,f),ot(n,f));for(let y=0;y!==p;++y)t.setTexture2D(e[y]||pa,f[y])}function nf(g,e,t){const n=this.cache,p=e.length,f=tr(t,p);st(n,f)||(g.uniform1iv(this.addr,f),ot(n,f));for(let y=0;y!==p;++y)t.setTexture3D(e[y]||va,f[y])}function rf(g,e,t){const n=this.cache,p=e.length,f=tr(t,p);st(n,f)||(g.uniform1iv(this.addr,f),ot(n,f));for(let y=0;y!==p;++y)t.setTextureCube(e[y]||ya,f[y])}function sf(g,e,t){const n=this.cache,p=e.length,f=tr(t,p);st(n,f)||(g.uniform1iv(this.addr,f),ot(n,f));for(let y=0;y!==p;++y)t.setTexture2DArray(e[y]||ma,f[y])}function of(g){switch(g){case 5126:return Bd;case 35664:return zd;case 35665:return Hd;case 35666:return Wd;case 35674:return Gd;case 35675:return Vd;case 35676:return Xd;case 5124:case 35670:return jd;case 35667:case 35671:return Kd;case 35668:case 35672:return Yd;case 35669:case 35673:return Zd;case 5125:return Qd;case 36294:return qd;case 36295:return Jd;case 36296:return ef;case 35678:case 36198:case 36298:case 36306:case 35682:return tf;case 35679:case 36299:case 36307:return nf;case 35680:case 36300:case 36308:case 36293:return rf;case 36289:case 36303:case 36311:case 36292:return sf}}class af{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Ud(t.type)}}class lf{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=of(t.type)}}class cf{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const p=this.seq;for(let f=0,y=p.length;f!==y;++f){const m=p[f];m.setValue(e,t[m.id],n)}}}const $r=/(\w+)(\])?(\[|\.)?/g;function bo(g,e){g.seq.push(e),g.map[e.id]=e}function hf(g,e,t){const n=g.name,p=n.length;for($r.lastIndex=0;;){const f=$r.exec(n),y=$r.lastIndex;let m=f[1];const l=f[2]==="]",u=f[3];if(l&&(m=m|0),u===void 0||u==="["&&y+2===p){bo(t,u===void 0?new af(m,g,e):new lf(m,g,e));break}else{let a=t.map[m];a===void 0&&(a=new cf(m),bo(t,a)),t=a}}}class Wi{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let p=0;p<n;++p){const f=e.getActiveUniform(t,p),y=e.getUniformLocation(t,f.name);hf(f,y,this)}}setValue(e,t,n,p){const f=this.map[t];f!==void 0&&f.setValue(e,n,p)}setOptional(e,t,n){const p=t[n];p!==void 0&&this.setValue(e,n,p)}static upload(e,t,n,p){for(let f=0,y=t.length;f!==y;++f){const m=t[f],l=n[m.id];l.needsUpdate!==!1&&m.setValue(e,l.value,p)}}static seqWithValue(e,t){const n=[];for(let p=0,f=e.length;p!==f;++p){const y=e[p];y.id in t&&n.push(y)}return n}}function wo(g,e,t){const n=g.createShader(e);return g.shaderSource(n,t),g.compileShader(n),n}const uf=37297;let df=0;function ff(g,e){const t=g.split(`
`),n=[],p=Math.max(e-6,0),f=Math.min(e+6,t.length);for(let y=p;y<f;y++){const m=y+1;n.push(`${m===e?">":" "} ${m}: ${t[y]}`)}return n.join(`
`)}function pf(g){const e=je.getPrimaries(je.workingColorSpace),t=je.getPrimaries(g);let n;switch(e===t?n="":e===ji&&t===Xi?n="LinearDisplayP3ToLinearSRGB":e===Xi&&t===ji&&(n="LinearSRGBToLinearDisplayP3"),g){case en:case Qi:return[n,"LinearTransferOETF"];case ut:case Jr:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",g),[n,"LinearTransferOETF"]}}function Mo(g,e,t){const n=g.getShaderParameter(e,g.COMPILE_STATUS),p=g.getShaderInfoLog(e).trim();if(n&&p==="")return"";const f=/ERROR: 0:(\d+)/.exec(p);if(f){const y=parseInt(f[1]);return t.toUpperCase()+`

`+p+`

`+ff(g.getShaderSource(e),y)}else return p}function gf(g,e){const t=pf(e);return`vec4 ${g}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function mf(g,e){let t;switch(e){case Cl:t="Linear";break;case Al:t="Reinhard";break;case Tl:t="OptimizedCineon";break;case Ll:t="ACESFilmic";break;case Dl:t="AgX";break;case Rl:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+g+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function vf(g){return[g.extensionDerivatives||g.envMapCubeUVHeight||g.bumpMap||g.normalMapTangentSpace||g.clearcoatNormalMap||g.flatShading||g.alphaToCoverage||g.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(g.extensionFragDepth||g.logarithmicDepthBuffer)&&g.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",g.extensionDrawBuffers&&g.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(g.extensionShaderTextureLOD||g.envMap||g.transmission)&&g.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(jn).join(`
`)}function yf(g){return[g.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",g.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(jn).join(`
`)}function _f(g){const e=[];for(const t in g){const n=g[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Sf(g,e){const t={},n=g.getProgramParameter(e,g.ACTIVE_ATTRIBUTES);for(let p=0;p<n;p++){const f=g.getActiveAttrib(e,p),y=f.name;let m=1;f.type===g.FLOAT_MAT2&&(m=2),f.type===g.FLOAT_MAT3&&(m=3),f.type===g.FLOAT_MAT4&&(m=4),t[y]={type:f.type,location:g.getAttribLocation(e,y),locationSize:m}}return t}function jn(g){return g!==""}function Eo(g,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return g.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Co(g,e){return g.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const xf=/^[ \t]*#include +<([\w\d./]+)>/gm;function Zr(g){return g.replace(xf,wf)}const bf=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function wf(g,e){let t=Ne[e];if(t===void 0){const n=bf.get(e);if(n!==void 0)t=Ne[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Zr(t)}const Mf=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ao(g){return g.replace(Mf,Ef)}function Ef(g,e,t,n){let p="";for(let f=parseInt(e);f<parseInt(t);f++)p+=n.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return p}function To(g){let e=`precision ${g.precision} float;
	precision ${g.precision} int;
	precision ${g.precision} sampler2D;
	precision ${g.precision} samplerCube;
	`;return g.isWebGL2&&(e+=`precision ${g.precision} sampler3D;
		precision ${g.precision} sampler2DArray;
		precision ${g.precision} sampler2DShadow;
		precision ${g.precision} samplerCubeShadow;
		precision ${g.precision} sampler2DArrayShadow;
		precision ${g.precision} isampler2D;
		precision ${g.precision} isampler3D;
		precision ${g.precision} isamplerCube;
		precision ${g.precision} isampler2DArray;
		precision ${g.precision} usampler2D;
		precision ${g.precision} usampler3D;
		precision ${g.precision} usamplerCube;
		precision ${g.precision} usampler2DArray;
		`),g.precision==="highp"?e+=`
#define HIGH_PRECISION`:g.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:g.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Cf(g){let e="SHADOWMAP_TYPE_BASIC";return g.shadowMapType===Bo?e="SHADOWMAP_TYPE_PCF":g.shadowMapType===el?e="SHADOWMAP_TYPE_PCF_SOFT":g.shadowMapType===Yt&&(e="SHADOWMAP_TYPE_VSM"),e}function Af(g){let e="ENVMAP_TYPE_CUBE";if(g.envMap)switch(g.envMapMode){case Qn:case qn:e="ENVMAP_TYPE_CUBE";break;case Zi:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Tf(g){let e="ENVMAP_MODE_REFLECTION";if(g.envMap)switch(g.envMapMode){case qn:e="ENVMAP_MODE_REFRACTION";break}return e}function Lf(g){let e="ENVMAP_BLENDING_NONE";if(g.envMap)switch(g.combine){case zo:e="ENVMAP_BLENDING_MULTIPLY";break;case Ml:e="ENVMAP_BLENDING_MIX";break;case El:e="ENVMAP_BLENDING_ADD";break}return e}function Rf(g){const e=g.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function Df(g,e,t,n){const p=g.getContext(),f=t.defines;let y=t.vertexShader,m=t.fragmentShader;const l=Cf(t),u=Af(t),r=Tf(t),a=Lf(t),s=Rf(t),o=t.isWebGL2?"":vf(t),i=yf(t),c=_f(f),h=p.createProgram();let d,_,C=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(d=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,c].filter(jn).join(`
`),d.length>0&&(d+=`
`),_=[o,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,c].filter(jn).join(`
`),_.length>0&&(_+=`
`)):(d=[To(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,c,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+r:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(jn).join(`
`),_=[o,To(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,c,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+r:"",t.envMap?"#define "+a:"",s?"#define CUBEUV_TEXEL_WIDTH "+s.texelWidth:"",s?"#define CUBEUV_TEXEL_HEIGHT "+s.texelHeight:"",s?"#define CUBEUV_MAX_MIP "+s.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==hn?"#define TONE_MAPPING":"",t.toneMapping!==hn?Ne.tonemapping_pars_fragment:"",t.toneMapping!==hn?mf("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ne.colorspace_pars_fragment,gf("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(jn).join(`
`)),y=Zr(y),y=Eo(y,t),y=Co(y,t),m=Zr(m),m=Eo(m,t),m=Co(m,t),y=Ao(y),m=Ao(m),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,d=[i,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+d,_=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===Ws?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Ws?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const M=C+d+y,b=C+_+m,v=wo(p,p.VERTEX_SHADER,M),E=wo(p,p.FRAGMENT_SHADER,b);p.attachShader(h,v),p.attachShader(h,E),t.index0AttributeName!==void 0?p.bindAttribLocation(h,0,t.index0AttributeName):t.morphTargets===!0&&p.bindAttribLocation(h,0,"position"),p.linkProgram(h);function D(R){if(g.debug.checkShaderErrors){const A=p.getProgramInfoLog(h).trim(),x=p.getShaderInfoLog(v).trim(),S=p.getShaderInfoLog(E).trim();let T=!0,P=!0;if(p.getProgramParameter(h,p.LINK_STATUS)===!1)if(T=!1,typeof g.debug.onShaderError=="function")g.debug.onShaderError(p,h,v,E);else{const N=Mo(p,v,"vertex"),k=Mo(p,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+p.getError()+" - VALIDATE_STATUS "+p.getProgramParameter(h,p.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+A+`
`+N+`
`+k)}else A!==""?console.warn("THREE.WebGLProgram: Program Info Log:",A):(x===""||S==="")&&(P=!1);P&&(R.diagnostics={runnable:T,programLog:A,vertexShader:{log:x,prefix:d},fragmentShader:{log:S,prefix:_}})}p.deleteShader(v),p.deleteShader(E),L=new Wi(p,h),w=Sf(p,h)}let L;this.getUniforms=function(){return L===void 0&&D(this),L};let w;this.getAttributes=function(){return w===void 0&&D(this),w};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=p.getProgramParameter(h,uf)),I},this.destroy=function(){n.releaseStatesOfProgram(this),p.deleteProgram(h),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=df++,this.cacheKey=e,this.usedTimes=1,this.program=h,this.vertexShader=v,this.fragmentShader=E,this}let If=0;class Pf{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,p=this._getShaderStage(t),f=this._getShaderStage(n),y=this._getShaderCacheForMaterial(e);return y.has(p)===!1&&(y.add(p),p.usedTimes++),y.has(f)===!1&&(y.add(f),f.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Nf(e),t.set(e,n)),n}}class Nf{constructor(e){this.id=If++,this.code=e,this.usedTimes=0}}function kf(g,e,t,n,p,f,y){const m=new ia,l=new Pf,u=new Set,r=[],a=p.isWebGL2,s=p.logarithmicDepthBuffer,o=p.vertexTextures;let i=p.precision;const c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function h(w){return u.add(w),w===0?"uv":`uv${w}`}function d(w,I,R,A,x){const S=A.fog,T=x.geometry,P=w.isMeshStandardMaterial?A.environment:null,N=(w.isMeshStandardMaterial?t:e).get(w.envMap||P),k=N&&N.mapping===Zi?N.image.height:null,O=c[w.type];w.precision!==null&&(i=p.getMaxPrecision(w.precision),i!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",i,"instead."));const $=T.morphAttributes.position||T.morphAttributes.normal||T.morphAttributes.color,V=$!==void 0?$.length:0;let H=0;T.morphAttributes.position!==void 0&&(H=1),T.morphAttributes.normal!==void 0&&(H=2),T.morphAttributes.color!==void 0&&(H=3);let U,z,G,K;if(O){const Ze=Bt[O];U=Ze.vertexShader,z=Ze.fragmentShader}else U=w.vertexShader,z=w.fragmentShader,l.update(w),G=l.getVertexShaderID(w),K=l.getFragmentShaderID(w);const Y=g.getRenderTarget(),Z=x.isInstancedMesh===!0,ie=x.isBatchedMesh===!0,oe=!!w.map,j=!!w.matcap,ke=!!N,ge=!!w.aoMap,me=!!w.lightMap,ve=!!w.bumpMap,Ye=!!w.normalMap,Te=!!w.displacementMap,W=!!w.emissiveMap,F=!!w.metalnessMap,J=!!w.roughnessMap,le=w.anisotropy>0,re=w.clearcoat>0,ae=w.iridescence>0,xe=w.sheen>0,de=w.transmission>0,ye=le&&!!w.anisotropyMap,Ae=re&&!!w.clearcoatMap,Oe=re&&!!w.clearcoatNormalMap,se=re&&!!w.clearcoatRoughnessMap,Xe=ae&&!!w.iridescenceMap,Be=ae&&!!w.iridescenceThicknessMap,Re=xe&&!!w.sheenColorMap,Me=xe&&!!w.sheenRoughnessMap,_e=!!w.specularMap,Pe=!!w.specularColorMap,Ge=!!w.specularIntensityMap,qe=de&&!!w.transmissionMap,ze=de&&!!w.thicknessMap,Ke=!!w.gradientMap,X=!!w.alphaMap,ce=w.alphaTest>0,he=!!w.alphaHash,Se=!!w.extensions;let Ee=hn;w.toneMapped&&(Y===null||Y.isXRRenderTarget===!0)&&(Ee=g.toneMapping);const Ve={isWebGL2:a,shaderID:O,shaderType:w.type,shaderName:w.name,vertexShader:U,fragmentShader:z,defines:w.defines,customVertexShaderID:G,customFragmentShaderID:K,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:i,batching:ie,instancing:Z,instancingColor:Z&&x.instanceColor!==null,supportsVertexTextures:o,outputColorSpace:Y===null?g.outputColorSpace:Y.isXRRenderTarget===!0?Y.texture.colorSpace:en,alphaToCoverage:!!w.alphaToCoverage,map:oe,matcap:j,envMap:ke,envMapMode:ke&&N.mapping,envMapCubeUVHeight:k,aoMap:ge,lightMap:me,bumpMap:ve,normalMap:Ye,displacementMap:o&&Te,emissiveMap:W,normalMapObjectSpace:Ye&&w.normalMapType===Wl,normalMapTangentSpace:Ye&&w.normalMapType===Hl,metalnessMap:F,roughnessMap:J,anisotropy:le,anisotropyMap:ye,clearcoat:re,clearcoatMap:Ae,clearcoatNormalMap:Oe,clearcoatRoughnessMap:se,iridescence:ae,iridescenceMap:Xe,iridescenceThicknessMap:Be,sheen:xe,sheenColorMap:Re,sheenRoughnessMap:Me,specularMap:_e,specularColorMap:Pe,specularIntensityMap:Ge,transmission:de,transmissionMap:qe,thicknessMap:ze,gradientMap:Ke,opaque:w.transparent===!1&&w.blending===Kn&&w.alphaToCoverage===!1,alphaMap:X,alphaTest:ce,alphaHash:he,combine:w.combine,mapUv:oe&&h(w.map.channel),aoMapUv:ge&&h(w.aoMap.channel),lightMapUv:me&&h(w.lightMap.channel),bumpMapUv:ve&&h(w.bumpMap.channel),normalMapUv:Ye&&h(w.normalMap.channel),displacementMapUv:Te&&h(w.displacementMap.channel),emissiveMapUv:W&&h(w.emissiveMap.channel),metalnessMapUv:F&&h(w.metalnessMap.channel),roughnessMapUv:J&&h(w.roughnessMap.channel),anisotropyMapUv:ye&&h(w.anisotropyMap.channel),clearcoatMapUv:Ae&&h(w.clearcoatMap.channel),clearcoatNormalMapUv:Oe&&h(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:se&&h(w.clearcoatRoughnessMap.channel),iridescenceMapUv:Xe&&h(w.iridescenceMap.channel),iridescenceThicknessMapUv:Be&&h(w.iridescenceThicknessMap.channel),sheenColorMapUv:Re&&h(w.sheenColorMap.channel),sheenRoughnessMapUv:Me&&h(w.sheenRoughnessMap.channel),specularMapUv:_e&&h(w.specularMap.channel),specularColorMapUv:Pe&&h(w.specularColorMap.channel),specularIntensityMapUv:Ge&&h(w.specularIntensityMap.channel),transmissionMapUv:qe&&h(w.transmissionMap.channel),thicknessMapUv:ze&&h(w.thicknessMap.channel),alphaMapUv:X&&h(w.alphaMap.channel),vertexTangents:!!T.attributes.tangent&&(Ye||le),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!T.attributes.color&&T.attributes.color.itemSize===4,pointsUvs:x.isPoints===!0&&!!T.attributes.uv&&(oe||X),fog:!!S,useFog:w.fog===!0,fogExp2:!!S&&S.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:s,skinning:x.isSkinnedMesh===!0,morphTargets:T.morphAttributes.position!==void 0,morphNormals:T.morphAttributes.normal!==void 0,morphColors:T.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:H,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:y.numPlanes,numClipIntersection:y.numIntersection,dithering:w.dithering,shadowMapEnabled:g.shadowMap.enabled&&R.length>0,shadowMapType:g.shadowMap.type,toneMapping:Ee,useLegacyLights:g._useLegacyLights,decodeVideoTexture:oe&&w.map.isVideoTexture===!0&&je.getTransfer(w.map.colorSpace)===Je,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Zt,flipSided:w.side===bt,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:Se&&w.extensions.derivatives===!0,extensionFragDepth:Se&&w.extensions.fragDepth===!0,extensionDrawBuffers:Se&&w.extensions.drawBuffers===!0,extensionShaderTextureLOD:Se&&w.extensions.shaderTextureLOD===!0,extensionClipCullDistance:Se&&w.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:Se&&w.extensions.multiDraw===!0&&n.has("WEBGL_multi_draw"),rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return Ve.vertexUv1s=u.has(1),Ve.vertexUv2s=u.has(2),Ve.vertexUv3s=u.has(3),u.clear(),Ve}function _(w){const I=[];if(w.shaderID?I.push(w.shaderID):(I.push(w.customVertexShaderID),I.push(w.customFragmentShaderID)),w.defines!==void 0)for(const R in w.defines)I.push(R),I.push(w.defines[R]);return w.isRawShaderMaterial===!1&&(C(I,w),M(I,w),I.push(g.outputColorSpace)),I.push(w.customProgramCacheKey),I.join()}function C(w,I){w.push(I.precision),w.push(I.outputColorSpace),w.push(I.envMapMode),w.push(I.envMapCubeUVHeight),w.push(I.mapUv),w.push(I.alphaMapUv),w.push(I.lightMapUv),w.push(I.aoMapUv),w.push(I.bumpMapUv),w.push(I.normalMapUv),w.push(I.displacementMapUv),w.push(I.emissiveMapUv),w.push(I.metalnessMapUv),w.push(I.roughnessMapUv),w.push(I.anisotropyMapUv),w.push(I.clearcoatMapUv),w.push(I.clearcoatNormalMapUv),w.push(I.clearcoatRoughnessMapUv),w.push(I.iridescenceMapUv),w.push(I.iridescenceThicknessMapUv),w.push(I.sheenColorMapUv),w.push(I.sheenRoughnessMapUv),w.push(I.specularMapUv),w.push(I.specularColorMapUv),w.push(I.specularIntensityMapUv),w.push(I.transmissionMapUv),w.push(I.thicknessMapUv),w.push(I.combine),w.push(I.fogExp2),w.push(I.sizeAttenuation),w.push(I.morphTargetsCount),w.push(I.morphAttributeCount),w.push(I.numDirLights),w.push(I.numPointLights),w.push(I.numSpotLights),w.push(I.numSpotLightMaps),w.push(I.numHemiLights),w.push(I.numRectAreaLights),w.push(I.numDirLightShadows),w.push(I.numPointLightShadows),w.push(I.numSpotLightShadows),w.push(I.numSpotLightShadowsWithMaps),w.push(I.numLightProbes),w.push(I.shadowMapType),w.push(I.toneMapping),w.push(I.numClippingPlanes),w.push(I.numClipIntersection),w.push(I.depthPacking)}function M(w,I){m.disableAll(),I.isWebGL2&&m.enable(0),I.supportsVertexTextures&&m.enable(1),I.instancing&&m.enable(2),I.instancingColor&&m.enable(3),I.matcap&&m.enable(4),I.envMap&&m.enable(5),I.normalMapObjectSpace&&m.enable(6),I.normalMapTangentSpace&&m.enable(7),I.clearcoat&&m.enable(8),I.iridescence&&m.enable(9),I.alphaTest&&m.enable(10),I.vertexColors&&m.enable(11),I.vertexAlphas&&m.enable(12),I.vertexUv1s&&m.enable(13),I.vertexUv2s&&m.enable(14),I.vertexUv3s&&m.enable(15),I.vertexTangents&&m.enable(16),I.anisotropy&&m.enable(17),I.alphaHash&&m.enable(18),I.batching&&m.enable(19),w.push(m.mask),m.disableAll(),I.fog&&m.enable(0),I.useFog&&m.enable(1),I.flatShading&&m.enable(2),I.logarithmicDepthBuffer&&m.enable(3),I.skinning&&m.enable(4),I.morphTargets&&m.enable(5),I.morphNormals&&m.enable(6),I.morphColors&&m.enable(7),I.premultipliedAlpha&&m.enable(8),I.shadowMapEnabled&&m.enable(9),I.useLegacyLights&&m.enable(10),I.doubleSided&&m.enable(11),I.flipSided&&m.enable(12),I.useDepthPacking&&m.enable(13),I.dithering&&m.enable(14),I.transmission&&m.enable(15),I.sheen&&m.enable(16),I.opaque&&m.enable(17),I.pointsUvs&&m.enable(18),I.decodeVideoTexture&&m.enable(19),I.alphaToCoverage&&m.enable(20),w.push(m.mask)}function b(w){const I=c[w.type];let R;if(I){const A=Bt[I];R=mc.clone(A.uniforms)}else R=w.uniforms;return R}function v(w,I){let R;for(let A=0,x=r.length;A<x;A++){const S=r[A];if(S.cacheKey===I){R=S,++R.usedTimes;break}}return R===void 0&&(R=new Df(g,I,w,f),r.push(R)),R}function E(w){if(--w.usedTimes===0){const I=r.indexOf(w);r[I]=r[r.length-1],r.pop(),w.destroy()}}function D(w){l.remove(w)}function L(){l.dispose()}return{getParameters:d,getProgramCacheKey:_,getUniforms:b,acquireProgram:v,releaseProgram:E,releaseShaderCache:D,programs:r,dispose:L}}function Of(){let g=new WeakMap;function e(f){let y=g.get(f);return y===void 0&&(y={},g.set(f,y)),y}function t(f){g.delete(f)}function n(f,y,m){g.get(f)[y]=m}function p(){g=new WeakMap}return{get:e,remove:t,update:n,dispose:p}}function $f(g,e){return g.groupOrder!==e.groupOrder?g.groupOrder-e.groupOrder:g.renderOrder!==e.renderOrder?g.renderOrder-e.renderOrder:g.material.id!==e.material.id?g.material.id-e.material.id:g.z!==e.z?g.z-e.z:g.id-e.id}function Lo(g,e){return g.groupOrder!==e.groupOrder?g.groupOrder-e.groupOrder:g.renderOrder!==e.renderOrder?g.renderOrder-e.renderOrder:g.z!==e.z?e.z-g.z:g.id-e.id}function Ro(){const g=[];let e=0;const t=[],n=[],p=[];function f(){e=0,t.length=0,n.length=0,p.length=0}function y(a,s,o,i,c,h){let d=g[e];return d===void 0?(d={id:a.id,object:a,geometry:s,material:o,groupOrder:i,renderOrder:a.renderOrder,z:c,group:h},g[e]=d):(d.id=a.id,d.object=a,d.geometry=s,d.material=o,d.groupOrder=i,d.renderOrder=a.renderOrder,d.z=c,d.group=h),e++,d}function m(a,s,o,i,c,h){const d=y(a,s,o,i,c,h);o.transmission>0?n.push(d):o.transparent===!0?p.push(d):t.push(d)}function l(a,s,o,i,c,h){const d=y(a,s,o,i,c,h);o.transmission>0?n.unshift(d):o.transparent===!0?p.unshift(d):t.unshift(d)}function u(a,s){t.length>1&&t.sort(a||$f),n.length>1&&n.sort(s||Lo),p.length>1&&p.sort(s||Lo)}function r(){for(let a=e,s=g.length;a<s;a++){const o=g[a];if(o.id===null)break;o.id=null,o.object=null,o.geometry=null,o.material=null,o.group=null}}return{opaque:t,transmissive:n,transparent:p,init:f,push:m,unshift:l,finish:r,sort:u}}function Ff(){let g=new WeakMap;function e(n,p){const f=g.get(n);let y;return f===void 0?(y=new Ro,g.set(n,[y])):p>=f.length?(y=new Ro,f.push(y)):y=f[p],y}function t(){g=new WeakMap}return{get:e,dispose:t}}function Uf(){const g={};return{get:function(e){if(g[e.id]!==void 0)return g[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new He};break;case"SpotLight":t={position:new q,direction:new q,color:new He,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new He,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new He,groundColor:new He};break;case"RectAreaLight":t={color:new He,position:new q,halfWidth:new q,halfHeight:new q};break}return g[e.id]=t,t}}}function Bf(){const g={};return{get:function(e){if(g[e.id]!==void 0)return g[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We,shadowCameraNear:1,shadowCameraFar:1e3};break}return g[e.id]=t,t}}}let zf=0;function Hf(g,e){return(e.castShadow?2:0)-(g.castShadow?2:0)+(e.map?1:0)-(g.map?1:0)}function Wf(g,e){const t=new Uf,n=Bf(),p={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let r=0;r<9;r++)p.probe.push(new q);const f=new q,y=new rt,m=new rt;function l(r,a){let s=0,o=0,i=0;for(let R=0;R<9;R++)p.probe[R].set(0,0,0);let c=0,h=0,d=0,_=0,C=0,M=0,b=0,v=0,E=0,D=0,L=0;r.sort(Hf);const w=a===!0?Math.PI:1;for(let R=0,A=r.length;R<A;R++){const x=r[R],S=x.color,T=x.intensity,P=x.distance,N=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)s+=S.r*T*w,o+=S.g*T*w,i+=S.b*T*w;else if(x.isLightProbe){for(let k=0;k<9;k++)p.probe[k].addScaledVector(x.sh.coefficients[k],T);L++}else if(x.isDirectionalLight){const k=t.get(x);if(k.color.copy(x.color).multiplyScalar(x.intensity*w),x.castShadow){const O=x.shadow,$=n.get(x);$.shadowBias=O.bias,$.shadowNormalBias=O.normalBias,$.shadowRadius=O.radius,$.shadowMapSize=O.mapSize,p.directionalShadow[c]=$,p.directionalShadowMap[c]=N,p.directionalShadowMatrix[c]=x.shadow.matrix,M++}p.directional[c]=k,c++}else if(x.isSpotLight){const k=t.get(x);k.position.setFromMatrixPosition(x.matrixWorld),k.color.copy(S).multiplyScalar(T*w),k.distance=P,k.coneCos=Math.cos(x.angle),k.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),k.decay=x.decay,p.spot[d]=k;const O=x.shadow;if(x.map&&(p.spotLightMap[E]=x.map,E++,O.updateMatrices(x),x.castShadow&&D++),p.spotLightMatrix[d]=O.matrix,x.castShadow){const $=n.get(x);$.shadowBias=O.bias,$.shadowNormalBias=O.normalBias,$.shadowRadius=O.radius,$.shadowMapSize=O.mapSize,p.spotShadow[d]=$,p.spotShadowMap[d]=N,v++}d++}else if(x.isRectAreaLight){const k=t.get(x);k.color.copy(S).multiplyScalar(T),k.halfWidth.set(x.width*.5,0,0),k.halfHeight.set(0,x.height*.5,0),p.rectArea[_]=k,_++}else if(x.isPointLight){const k=t.get(x);if(k.color.copy(x.color).multiplyScalar(x.intensity*w),k.distance=x.distance,k.decay=x.decay,x.castShadow){const O=x.shadow,$=n.get(x);$.shadowBias=O.bias,$.shadowNormalBias=O.normalBias,$.shadowRadius=O.radius,$.shadowMapSize=O.mapSize,$.shadowCameraNear=O.camera.near,$.shadowCameraFar=O.camera.far,p.pointShadow[h]=$,p.pointShadowMap[h]=N,p.pointShadowMatrix[h]=x.shadow.matrix,b++}p.point[h]=k,h++}else if(x.isHemisphereLight){const k=t.get(x);k.skyColor.copy(x.color).multiplyScalar(T*w),k.groundColor.copy(x.groundColor).multiplyScalar(T*w),p.hemi[C]=k,C++}}_>0&&(e.isWebGL2?g.has("OES_texture_float_linear")===!0?(p.rectAreaLTC1=ue.LTC_FLOAT_1,p.rectAreaLTC2=ue.LTC_FLOAT_2):(p.rectAreaLTC1=ue.LTC_HALF_1,p.rectAreaLTC2=ue.LTC_HALF_2):g.has("OES_texture_float_linear")===!0?(p.rectAreaLTC1=ue.LTC_FLOAT_1,p.rectAreaLTC2=ue.LTC_FLOAT_2):g.has("OES_texture_half_float_linear")===!0?(p.rectAreaLTC1=ue.LTC_HALF_1,p.rectAreaLTC2=ue.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),p.ambient[0]=s,p.ambient[1]=o,p.ambient[2]=i;const I=p.hash;(I.directionalLength!==c||I.pointLength!==h||I.spotLength!==d||I.rectAreaLength!==_||I.hemiLength!==C||I.numDirectionalShadows!==M||I.numPointShadows!==b||I.numSpotShadows!==v||I.numSpotMaps!==E||I.numLightProbes!==L)&&(p.directional.length=c,p.spot.length=d,p.rectArea.length=_,p.point.length=h,p.hemi.length=C,p.directionalShadow.length=M,p.directionalShadowMap.length=M,p.pointShadow.length=b,p.pointShadowMap.length=b,p.spotShadow.length=v,p.spotShadowMap.length=v,p.directionalShadowMatrix.length=M,p.pointShadowMatrix.length=b,p.spotLightMatrix.length=v+E-D,p.spotLightMap.length=E,p.numSpotLightShadowsWithMaps=D,p.numLightProbes=L,I.directionalLength=c,I.pointLength=h,I.spotLength=d,I.rectAreaLength=_,I.hemiLength=C,I.numDirectionalShadows=M,I.numPointShadows=b,I.numSpotShadows=v,I.numSpotMaps=E,I.numLightProbes=L,p.version=zf++)}function u(r,a){let s=0,o=0,i=0,c=0,h=0;const d=a.matrixWorldInverse;for(let _=0,C=r.length;_<C;_++){const M=r[_];if(M.isDirectionalLight){const b=p.directional[s];b.direction.setFromMatrixPosition(M.matrixWorld),f.setFromMatrixPosition(M.target.matrixWorld),b.direction.sub(f),b.direction.transformDirection(d),s++}else if(M.isSpotLight){const b=p.spot[i];b.position.setFromMatrixPosition(M.matrixWorld),b.position.applyMatrix4(d),b.direction.setFromMatrixPosition(M.matrixWorld),f.setFromMatrixPosition(M.target.matrixWorld),b.direction.sub(f),b.direction.transformDirection(d),i++}else if(M.isRectAreaLight){const b=p.rectArea[c];b.position.setFromMatrixPosition(M.matrixWorld),b.position.applyMatrix4(d),m.identity(),y.copy(M.matrixWorld),y.premultiply(d),m.extractRotation(y),b.halfWidth.set(M.width*.5,0,0),b.halfHeight.set(0,M.height*.5,0),b.halfWidth.applyMatrix4(m),b.halfHeight.applyMatrix4(m),c++}else if(M.isPointLight){const b=p.point[o];b.position.setFromMatrixPosition(M.matrixWorld),b.position.applyMatrix4(d),o++}else if(M.isHemisphereLight){const b=p.hemi[h];b.direction.setFromMatrixPosition(M.matrixWorld),b.direction.transformDirection(d),h++}}}return{setup:l,setupView:u,state:p}}function Do(g,e){const t=new Wf(g,e),n=[],p=[];function f(){n.length=0,p.length=0}function y(a){n.push(a)}function m(a){p.push(a)}function l(a){t.setup(n,a)}function u(a){t.setupView(n,a)}return{init:f,state:{lightsArray:n,shadowsArray:p,lights:t},setupLights:l,setupLightsView:u,pushLight:y,pushShadow:m}}function Gf(g,e){let t=new WeakMap;function n(f,y=0){const m=t.get(f);let l;return m===void 0?(l=new Do(g,e),t.set(f,[l])):y>=m.length?(l=new Do(g,e),m.push(l)):l=m[y],l}function p(){t=new WeakMap}return{get:n,dispose:p}}class Vf extends vi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Bl,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Xf extends vi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const jf=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Kf=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Yf(g,e,t){let n=new es;const p=new We,f=new We,y=new ct,m=new Vf({depthPacking:zl}),l=new Xf,u={},r=t.maxTextureSize,a={[dn]:bt,[bt]:dn,[Zt]:Zt},s=new fn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new We},radius:{value:4}},vertexShader:jf,fragmentShader:Kf}),o=s.clone();o.defines.HORIZONTAL_PASS=1;const i=new Ft;i.setAttribute("position",new Ht(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const c=new Jt(i,s),h=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Bo;let d=this.type;this.render=function(v,E,D){if(h.enabled===!1||h.autoUpdate===!1&&h.needsUpdate===!1||v.length===0)return;const L=g.getRenderTarget(),w=g.getActiveCubeFace(),I=g.getActiveMipmapLevel(),R=g.state;R.setBlending(cn),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);const A=d!==Yt&&this.type===Yt,x=d===Yt&&this.type!==Yt;for(let S=0,T=v.length;S<T;S++){const P=v[S],N=P.shadow;if(N===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(N.autoUpdate===!1&&N.needsUpdate===!1)continue;p.copy(N.mapSize);const k=N.getFrameExtents();if(p.multiply(k),f.copy(N.mapSize),(p.x>r||p.y>r)&&(p.x>r&&(f.x=Math.floor(r/k.x),p.x=f.x*k.x,N.mapSize.x=f.x),p.y>r&&(f.y=Math.floor(r/k.y),p.y=f.y*k.y,N.mapSize.y=f.y)),N.map===null||A===!0||x===!0){const $=this.type!==Yt?{minFilter:yt,magFilter:yt}:{};N.map!==null&&N.map.dispose(),N.map=new Tn(p.x,p.y,$),N.map.texture.name=P.name+".shadowMap",N.camera.updateProjectionMatrix()}g.setRenderTarget(N.map),g.clear();const O=N.getViewportCount();for(let $=0;$<O;$++){const V=N.getViewport($);y.set(f.x*V.x,f.y*V.y,f.x*V.z,f.y*V.w),R.viewport(y),N.updateMatrices(P,$),n=N.getFrustum(),M(E,D,N.camera,P,this.type)}N.isPointLightShadow!==!0&&this.type===Yt&&_(N,D),N.needsUpdate=!1}d=this.type,h.needsUpdate=!1,g.setRenderTarget(L,w,I)};function _(v,E){const D=e.update(c);s.defines.VSM_SAMPLES!==v.blurSamples&&(s.defines.VSM_SAMPLES=v.blurSamples,o.defines.VSM_SAMPLES=v.blurSamples,s.needsUpdate=!0,o.needsUpdate=!0),v.mapPass===null&&(v.mapPass=new Tn(p.x,p.y)),s.uniforms.shadow_pass.value=v.map.texture,s.uniforms.resolution.value=v.mapSize,s.uniforms.radius.value=v.radius,g.setRenderTarget(v.mapPass),g.clear(),g.renderBufferDirect(E,null,D,s,c,null),o.uniforms.shadow_pass.value=v.mapPass.texture,o.uniforms.resolution.value=v.mapSize,o.uniforms.radius.value=v.radius,g.setRenderTarget(v.map),g.clear(),g.renderBufferDirect(E,null,D,o,c,null)}function C(v,E,D,L){let w=null;const I=D.isPointLight===!0?v.customDistanceMaterial:v.customDepthMaterial;if(I!==void 0)w=I;else if(w=D.isPointLight===!0?l:m,g.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const R=w.uuid,A=E.uuid;let x=u[R];x===void 0&&(x={},u[R]=x);let S=x[A];S===void 0&&(S=w.clone(),x[A]=S,E.addEventListener("dispose",b)),w=S}if(w.visible=E.visible,w.wireframe=E.wireframe,L===Yt?w.side=E.shadowSide!==null?E.shadowSide:E.side:w.side=E.shadowSide!==null?E.shadowSide:a[E.side],w.alphaMap=E.alphaMap,w.alphaTest=E.alphaTest,w.map=E.map,w.clipShadows=E.clipShadows,w.clippingPlanes=E.clippingPlanes,w.clipIntersection=E.clipIntersection,w.displacementMap=E.displacementMap,w.displacementScale=E.displacementScale,w.displacementBias=E.displacementBias,w.wireframeLinewidth=E.wireframeLinewidth,w.linewidth=E.linewidth,D.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const R=g.properties.get(w);R.light=D}return w}function M(v,E,D,L,w){if(v.visible===!1)return;if(v.layers.test(E.layers)&&(v.isMesh||v.isLine||v.isPoints)&&(v.castShadow||v.receiveShadow&&w===Yt)&&(!v.frustumCulled||n.intersectsObject(v))){v.modelViewMatrix.multiplyMatrices(D.matrixWorldInverse,v.matrixWorld);const A=e.update(v),x=v.material;if(Array.isArray(x)){const S=A.groups;for(let T=0,P=S.length;T<P;T++){const N=S[T],k=x[N.materialIndex];if(k&&k.visible){const O=C(v,k,L,w);v.onBeforeShadow(g,v,E,D,A,O,N),g.renderBufferDirect(D,null,A,O,v,N),v.onAfterShadow(g,v,E,D,A,O,N)}}}else if(x.visible){const S=C(v,x,L,w);v.onBeforeShadow(g,v,E,D,A,S,null),g.renderBufferDirect(D,null,A,S,v,null),v.onAfterShadow(g,v,E,D,A,S,null)}}const R=v.children;for(let A=0,x=R.length;A<x;A++)M(R[A],E,D,L,w)}function b(v){v.target.removeEventListener("dispose",b);for(const D in u){const L=u[D],w=v.target.uuid;w in L&&(L[w].dispose(),delete L[w])}}}function Zf(g,e,t){const n=t.isWebGL2;function p(){let X=!1;const ce=new ct;let he=null;const Se=new ct(0,0,0,0);return{setMask:function(Ee){he!==Ee&&!X&&(g.colorMask(Ee,Ee,Ee,Ee),he=Ee)},setLocked:function(Ee){X=Ee},setClear:function(Ee,Ve,Ze,ht,Tt){Tt===!0&&(Ee*=ht,Ve*=ht,Ze*=ht),ce.set(Ee,Ve,Ze,ht),Se.equals(ce)===!1&&(g.clearColor(Ee,Ve,Ze,ht),Se.copy(ce))},reset:function(){X=!1,he=null,Se.set(-1,0,0,0)}}}function f(){let X=!1,ce=null,he=null,Se=null;return{setTest:function(Ee){Ee?Z(g.DEPTH_TEST):ie(g.DEPTH_TEST)},setMask:function(Ee){ce!==Ee&&!X&&(g.depthMask(Ee),ce=Ee)},setFunc:function(Ee){if(he!==Ee){switch(Ee){case vl:g.depthFunc(g.NEVER);break;case yl:g.depthFunc(g.ALWAYS);break;case _l:g.depthFunc(g.LESS);break;case Gi:g.depthFunc(g.LEQUAL);break;case Sl:g.depthFunc(g.EQUAL);break;case xl:g.depthFunc(g.GEQUAL);break;case bl:g.depthFunc(g.GREATER);break;case wl:g.depthFunc(g.NOTEQUAL);break;default:g.depthFunc(g.LEQUAL)}he=Ee}},setLocked:function(Ee){X=Ee},setClear:function(Ee){Se!==Ee&&(g.clearDepth(Ee),Se=Ee)},reset:function(){X=!1,ce=null,he=null,Se=null}}}function y(){let X=!1,ce=null,he=null,Se=null,Ee=null,Ve=null,Ze=null,ht=null,Tt=null;return{setTest:function(Qe){X||(Qe?Z(g.STENCIL_TEST):ie(g.STENCIL_TEST))},setMask:function(Qe){ce!==Qe&&!X&&(g.stencilMask(Qe),ce=Qe)},setFunc:function(Qe,mt,Ut){(he!==Qe||Se!==mt||Ee!==Ut)&&(g.stencilFunc(Qe,mt,Ut),he=Qe,Se=mt,Ee=Ut)},setOp:function(Qe,mt,Ut){(Ve!==Qe||Ze!==mt||ht!==Ut)&&(g.stencilOp(Qe,mt,Ut),Ve=Qe,Ze=mt,ht=Ut)},setLocked:function(Qe){X=Qe},setClear:function(Qe){Tt!==Qe&&(g.clearStencil(Qe),Tt=Qe)},reset:function(){X=!1,ce=null,he=null,Se=null,Ee=null,Ve=null,Ze=null,ht=null,Tt=null}}}const m=new p,l=new f,u=new y,r=new WeakMap,a=new WeakMap;let s={},o={},i=new WeakMap,c=[],h=null,d=!1,_=null,C=null,M=null,b=null,v=null,E=null,D=null,L=new He(0,0,0),w=0,I=!1,R=null,A=null,x=null,S=null,T=null;const P=g.getParameter(g.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,k=0;const O=g.getParameter(g.VERSION);O.indexOf("WebGL")!==-1?(k=parseFloat(/^WebGL (\d)/.exec(O)[1]),N=k>=1):O.indexOf("OpenGL ES")!==-1&&(k=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),N=k>=2);let $=null,V={};const H=g.getParameter(g.SCISSOR_BOX),U=g.getParameter(g.VIEWPORT),z=new ct().fromArray(H),G=new ct().fromArray(U);function K(X,ce,he,Se){const Ee=new Uint8Array(4),Ve=g.createTexture();g.bindTexture(X,Ve),g.texParameteri(X,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(X,g.TEXTURE_MAG_FILTER,g.NEAREST);for(let Ze=0;Ze<he;Ze++)n&&(X===g.TEXTURE_3D||X===g.TEXTURE_2D_ARRAY)?g.texImage3D(ce,0,g.RGBA,1,1,Se,0,g.RGBA,g.UNSIGNED_BYTE,Ee):g.texImage2D(ce+Ze,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,Ee);return Ve}const Y={};Y[g.TEXTURE_2D]=K(g.TEXTURE_2D,g.TEXTURE_2D,1),Y[g.TEXTURE_CUBE_MAP]=K(g.TEXTURE_CUBE_MAP,g.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Y[g.TEXTURE_2D_ARRAY]=K(g.TEXTURE_2D_ARRAY,g.TEXTURE_2D_ARRAY,1,1),Y[g.TEXTURE_3D]=K(g.TEXTURE_3D,g.TEXTURE_3D,1,1)),m.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Z(g.DEPTH_TEST),l.setFunc(Gi),Te(!1),W(cs),Z(g.CULL_FACE),ve(cn);function Z(X){s[X]!==!0&&(g.enable(X),s[X]=!0)}function ie(X){s[X]!==!1&&(g.disable(X),s[X]=!1)}function oe(X,ce){return o[X]!==ce?(g.bindFramebuffer(X,ce),o[X]=ce,n&&(X===g.DRAW_FRAMEBUFFER&&(o[g.FRAMEBUFFER]=ce),X===g.FRAMEBUFFER&&(o[g.DRAW_FRAMEBUFFER]=ce)),!0):!1}function j(X,ce){let he=c,Se=!1;if(X)if(he=i.get(ce),he===void 0&&(he=[],i.set(ce,he)),X.isWebGLMultipleRenderTargets){const Ee=X.texture;if(he.length!==Ee.length||he[0]!==g.COLOR_ATTACHMENT0){for(let Ve=0,Ze=Ee.length;Ve<Ze;Ve++)he[Ve]=g.COLOR_ATTACHMENT0+Ve;he.length=Ee.length,Se=!0}}else he[0]!==g.COLOR_ATTACHMENT0&&(he[0]=g.COLOR_ATTACHMENT0,Se=!0);else he[0]!==g.BACK&&(he[0]=g.BACK,Se=!0);Se&&(t.isWebGL2?g.drawBuffers(he):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(he))}function ke(X){return h!==X?(g.useProgram(X),h=X,!0):!1}const ge={[bn]:g.FUNC_ADD,[nl]:g.FUNC_SUBTRACT,[il]:g.FUNC_REVERSE_SUBTRACT};if(n)ge[fs]=g.MIN,ge[ps]=g.MAX;else{const X=e.get("EXT_blend_minmax");X!==null&&(ge[fs]=X.MIN_EXT,ge[ps]=X.MAX_EXT)}const me={[rl]:g.ZERO,[sl]:g.ONE,[ol]:g.SRC_COLOR,[zr]:g.SRC_ALPHA,[dl]:g.SRC_ALPHA_SATURATE,[hl]:g.DST_COLOR,[ll]:g.DST_ALPHA,[al]:g.ONE_MINUS_SRC_COLOR,[Hr]:g.ONE_MINUS_SRC_ALPHA,[ul]:g.ONE_MINUS_DST_COLOR,[cl]:g.ONE_MINUS_DST_ALPHA,[fl]:g.CONSTANT_COLOR,[pl]:g.ONE_MINUS_CONSTANT_COLOR,[gl]:g.CONSTANT_ALPHA,[ml]:g.ONE_MINUS_CONSTANT_ALPHA};function ve(X,ce,he,Se,Ee,Ve,Ze,ht,Tt,Qe){if(X===cn){d===!0&&(ie(g.BLEND),d=!1);return}if(d===!1&&(Z(g.BLEND),d=!0),X!==tl){if(X!==_||Qe!==I){if((C!==bn||v!==bn)&&(g.blendEquation(g.FUNC_ADD),C=bn,v=bn),Qe)switch(X){case Kn:g.blendFuncSeparate(g.ONE,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA);break;case hs:g.blendFunc(g.ONE,g.ONE);break;case us:g.blendFuncSeparate(g.ZERO,g.ONE_MINUS_SRC_COLOR,g.ZERO,g.ONE);break;case ds:g.blendFuncSeparate(g.ZERO,g.SRC_COLOR,g.ZERO,g.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}else switch(X){case Kn:g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA);break;case hs:g.blendFunc(g.SRC_ALPHA,g.ONE);break;case us:g.blendFuncSeparate(g.ZERO,g.ONE_MINUS_SRC_COLOR,g.ZERO,g.ONE);break;case ds:g.blendFunc(g.ZERO,g.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}M=null,b=null,E=null,D=null,L.set(0,0,0),w=0,_=X,I=Qe}return}Ee=Ee||ce,Ve=Ve||he,Ze=Ze||Se,(ce!==C||Ee!==v)&&(g.blendEquationSeparate(ge[ce],ge[Ee]),C=ce,v=Ee),(he!==M||Se!==b||Ve!==E||Ze!==D)&&(g.blendFuncSeparate(me[he],me[Se],me[Ve],me[Ze]),M=he,b=Se,E=Ve,D=Ze),(ht.equals(L)===!1||Tt!==w)&&(g.blendColor(ht.r,ht.g,ht.b,Tt),L.copy(ht),w=Tt),_=X,I=!1}function Ye(X,ce){X.side===Zt?ie(g.CULL_FACE):Z(g.CULL_FACE);let he=X.side===bt;ce&&(he=!he),Te(he),X.blending===Kn&&X.transparent===!1?ve(cn):ve(X.blending,X.blendEquation,X.blendSrc,X.blendDst,X.blendEquationAlpha,X.blendSrcAlpha,X.blendDstAlpha,X.blendColor,X.blendAlpha,X.premultipliedAlpha),l.setFunc(X.depthFunc),l.setTest(X.depthTest),l.setMask(X.depthWrite),m.setMask(X.colorWrite);const Se=X.stencilWrite;u.setTest(Se),Se&&(u.setMask(X.stencilWriteMask),u.setFunc(X.stencilFunc,X.stencilRef,X.stencilFuncMask),u.setOp(X.stencilFail,X.stencilZFail,X.stencilZPass)),J(X.polygonOffset,X.polygonOffsetFactor,X.polygonOffsetUnits),X.alphaToCoverage===!0?Z(g.SAMPLE_ALPHA_TO_COVERAGE):ie(g.SAMPLE_ALPHA_TO_COVERAGE)}function Te(X){R!==X&&(X?g.frontFace(g.CW):g.frontFace(g.CCW),R=X)}function W(X){X!==qa?(Z(g.CULL_FACE),X!==A&&(X===cs?g.cullFace(g.BACK):X===Ja?g.cullFace(g.FRONT):g.cullFace(g.FRONT_AND_BACK))):ie(g.CULL_FACE),A=X}function F(X){X!==x&&(N&&g.lineWidth(X),x=X)}function J(X,ce,he){X?(Z(g.POLYGON_OFFSET_FILL),(S!==ce||T!==he)&&(g.polygonOffset(ce,he),S=ce,T=he)):ie(g.POLYGON_OFFSET_FILL)}function le(X){X?Z(g.SCISSOR_TEST):ie(g.SCISSOR_TEST)}function re(X){X===void 0&&(X=g.TEXTURE0+P-1),$!==X&&(g.activeTexture(X),$=X)}function ae(X,ce,he){he===void 0&&($===null?he=g.TEXTURE0+P-1:he=$);let Se=V[he];Se===void 0&&(Se={type:void 0,texture:void 0},V[he]=Se),(Se.type!==X||Se.texture!==ce)&&($!==he&&(g.activeTexture(he),$=he),g.bindTexture(X,ce||Y[X]),Se.type=X,Se.texture=ce)}function xe(){const X=V[$];X!==void 0&&X.type!==void 0&&(g.bindTexture(X.type,null),X.type=void 0,X.texture=void 0)}function de(){try{g.compressedTexImage2D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function ye(){try{g.compressedTexImage3D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Ae(){try{g.texSubImage2D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Oe(){try{g.texSubImage3D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function se(){try{g.compressedTexSubImage2D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Xe(){try{g.compressedTexSubImage3D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Be(){try{g.texStorage2D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Re(){try{g.texStorage3D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Me(){try{g.texImage2D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function _e(){try{g.texImage3D.apply(g,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Pe(X){z.equals(X)===!1&&(g.scissor(X.x,X.y,X.z,X.w),z.copy(X))}function Ge(X){G.equals(X)===!1&&(g.viewport(X.x,X.y,X.z,X.w),G.copy(X))}function qe(X,ce){let he=a.get(ce);he===void 0&&(he=new WeakMap,a.set(ce,he));let Se=he.get(X);Se===void 0&&(Se=g.getUniformBlockIndex(ce,X.name),he.set(X,Se))}function ze(X,ce){const Se=a.get(ce).get(X);r.get(ce)!==Se&&(g.uniformBlockBinding(ce,Se,X.__bindingPointIndex),r.set(ce,Se))}function Ke(){g.disable(g.BLEND),g.disable(g.CULL_FACE),g.disable(g.DEPTH_TEST),g.disable(g.POLYGON_OFFSET_FILL),g.disable(g.SCISSOR_TEST),g.disable(g.STENCIL_TEST),g.disable(g.SAMPLE_ALPHA_TO_COVERAGE),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.ONE,g.ZERO),g.blendFuncSeparate(g.ONE,g.ZERO,g.ONE,g.ZERO),g.blendColor(0,0,0,0),g.colorMask(!0,!0,!0,!0),g.clearColor(0,0,0,0),g.depthMask(!0),g.depthFunc(g.LESS),g.clearDepth(1),g.stencilMask(4294967295),g.stencilFunc(g.ALWAYS,0,4294967295),g.stencilOp(g.KEEP,g.KEEP,g.KEEP),g.clearStencil(0),g.cullFace(g.BACK),g.frontFace(g.CCW),g.polygonOffset(0,0),g.activeTexture(g.TEXTURE0),g.bindFramebuffer(g.FRAMEBUFFER,null),n===!0&&(g.bindFramebuffer(g.DRAW_FRAMEBUFFER,null),g.bindFramebuffer(g.READ_FRAMEBUFFER,null)),g.useProgram(null),g.lineWidth(1),g.scissor(0,0,g.canvas.width,g.canvas.height),g.viewport(0,0,g.canvas.width,g.canvas.height),s={},$=null,V={},o={},i=new WeakMap,c=[],h=null,d=!1,_=null,C=null,M=null,b=null,v=null,E=null,D=null,L=new He(0,0,0),w=0,I=!1,R=null,A=null,x=null,S=null,T=null,z.set(0,0,g.canvas.width,g.canvas.height),G.set(0,0,g.canvas.width,g.canvas.height),m.reset(),l.reset(),u.reset()}return{buffers:{color:m,depth:l,stencil:u},enable:Z,disable:ie,bindFramebuffer:oe,drawBuffers:j,useProgram:ke,setBlending:ve,setMaterial:Ye,setFlipSided:Te,setCullFace:W,setLineWidth:F,setPolygonOffset:J,setScissorTest:le,activeTexture:re,bindTexture:ae,unbindTexture:xe,compressedTexImage2D:de,compressedTexImage3D:ye,texImage2D:Me,texImage3D:_e,updateUBOMapping:qe,uniformBlockBinding:ze,texStorage2D:Be,texStorage3D:Re,texSubImage2D:Ae,texSubImage3D:Oe,compressedTexSubImage2D:se,compressedTexSubImage3D:Xe,scissor:Pe,viewport:Ge,reset:Ke}}function Qf(g,e,t,n,p,f,y){const m=p.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),r=new WeakMap;let a;const s=new WeakMap;let o=!1;try{o=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function i(W,F){return o?new OffscreenCanvas(W,F):Yi("canvas")}function c(W,F,J,le){let re=1;if((W.width>le||W.height>le)&&(re=le/Math.max(W.width,W.height)),re<1||F===!0)if(typeof HTMLImageElement<"u"&&W instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&W instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&W instanceof ImageBitmap){const ae=F?Yr:Math.floor,xe=ae(re*W.width),de=ae(re*W.height);a===void 0&&(a=i(xe,de));const ye=J?i(xe,de):a;return ye.width=xe,ye.height=de,ye.getContext("2d").drawImage(W,0,0,xe,de),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+W.width+"x"+W.height+") to ("+xe+"x"+de+")."),ye}else return"data"in W&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+W.width+"x"+W.height+")."),W;return W}function h(W){return Gs(W.width)&&Gs(W.height)}function d(W){return m?!1:W.wrapS!==Ot||W.wrapT!==Ot||W.minFilter!==yt&&W.minFilter!==St}function _(W,F){return W.generateMipmaps&&F&&W.minFilter!==yt&&W.minFilter!==St}function C(W){g.generateMipmap(W)}function M(W,F,J,le,re=!1){if(m===!1)return F;if(W!==null){if(g[W]!==void 0)return g[W];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+W+"'")}let ae=F;if(F===g.RED&&(J===g.FLOAT&&(ae=g.R32F),J===g.HALF_FLOAT&&(ae=g.R16F),J===g.UNSIGNED_BYTE&&(ae=g.R8)),F===g.RED_INTEGER&&(J===g.UNSIGNED_BYTE&&(ae=g.R8UI),J===g.UNSIGNED_SHORT&&(ae=g.R16UI),J===g.UNSIGNED_INT&&(ae=g.R32UI),J===g.BYTE&&(ae=g.R8I),J===g.SHORT&&(ae=g.R16I),J===g.INT&&(ae=g.R32I)),F===g.RG&&(J===g.FLOAT&&(ae=g.RG32F),J===g.HALF_FLOAT&&(ae=g.RG16F),J===g.UNSIGNED_BYTE&&(ae=g.RG8)),F===g.RGBA){const xe=re?Vi:je.getTransfer(le);J===g.FLOAT&&(ae=g.RGBA32F),J===g.HALF_FLOAT&&(ae=g.RGBA16F),J===g.UNSIGNED_BYTE&&(ae=xe===Je?g.SRGB8_ALPHA8:g.RGBA8),J===g.UNSIGNED_SHORT_4_4_4_4&&(ae=g.RGBA4),J===g.UNSIGNED_SHORT_5_5_5_1&&(ae=g.RGB5_A1)}return(ae===g.R16F||ae===g.R32F||ae===g.RG16F||ae===g.RG32F||ae===g.RGBA16F||ae===g.RGBA32F)&&e.get("EXT_color_buffer_float"),ae}function b(W,F,J){return _(W,J)===!0||W.isFramebufferTexture&&W.minFilter!==yt&&W.minFilter!==St?Math.log2(Math.max(F.width,F.height))+1:W.mipmaps!==void 0&&W.mipmaps.length>0?W.mipmaps.length:W.isCompressedTexture&&Array.isArray(W.image)?F.mipmaps.length:1}function v(W){return W===yt||W===gs||W===si?g.NEAREST:g.LINEAR}function E(W){const F=W.target;F.removeEventListener("dispose",E),L(F),F.isVideoTexture&&r.delete(F)}function D(W){const F=W.target;F.removeEventListener("dispose",D),I(F)}function L(W){const F=n.get(W);if(F.__webglInit===void 0)return;const J=W.source,le=s.get(J);if(le){const re=le[F.__cacheKey];re.usedTimes--,re.usedTimes===0&&w(W),Object.keys(le).length===0&&s.delete(J)}n.remove(W)}function w(W){const F=n.get(W);g.deleteTexture(F.__webglTexture);const J=W.source,le=s.get(J);delete le[F.__cacheKey],y.memory.textures--}function I(W){const F=W.texture,J=n.get(W),le=n.get(F);if(le.__webglTexture!==void 0&&(g.deleteTexture(le.__webglTexture),y.memory.textures--),W.depthTexture&&W.depthTexture.dispose(),W.isWebGLCubeRenderTarget)for(let re=0;re<6;re++){if(Array.isArray(J.__webglFramebuffer[re]))for(let ae=0;ae<J.__webglFramebuffer[re].length;ae++)g.deleteFramebuffer(J.__webglFramebuffer[re][ae]);else g.deleteFramebuffer(J.__webglFramebuffer[re]);J.__webglDepthbuffer&&g.deleteRenderbuffer(J.__webglDepthbuffer[re])}else{if(Array.isArray(J.__webglFramebuffer))for(let re=0;re<J.__webglFramebuffer.length;re++)g.deleteFramebuffer(J.__webglFramebuffer[re]);else g.deleteFramebuffer(J.__webglFramebuffer);if(J.__webglDepthbuffer&&g.deleteRenderbuffer(J.__webglDepthbuffer),J.__webglMultisampledFramebuffer&&g.deleteFramebuffer(J.__webglMultisampledFramebuffer),J.__webglColorRenderbuffer)for(let re=0;re<J.__webglColorRenderbuffer.length;re++)J.__webglColorRenderbuffer[re]&&g.deleteRenderbuffer(J.__webglColorRenderbuffer[re]);J.__webglDepthRenderbuffer&&g.deleteRenderbuffer(J.__webglDepthRenderbuffer)}if(W.isWebGLMultipleRenderTargets)for(let re=0,ae=F.length;re<ae;re++){const xe=n.get(F[re]);xe.__webglTexture&&(g.deleteTexture(xe.__webglTexture),y.memory.textures--),n.remove(F[re])}n.remove(F),n.remove(W)}let R=0;function A(){R=0}function x(){const W=R;return W>=p.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+W+" texture units while this GPU supports only "+p.maxTextures),R+=1,W}function S(W){const F=[];return F.push(W.wrapS),F.push(W.wrapT),F.push(W.wrapR||0),F.push(W.magFilter),F.push(W.minFilter),F.push(W.anisotropy),F.push(W.internalFormat),F.push(W.format),F.push(W.type),F.push(W.generateMipmaps),F.push(W.premultiplyAlpha),F.push(W.flipY),F.push(W.unpackAlignment),F.push(W.colorSpace),F.join()}function T(W,F){const J=n.get(W);if(W.isVideoTexture&&Ye(W),W.isRenderTargetTexture===!1&&W.version>0&&J.__version!==W.version){const le=W.image;if(le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{z(J,W,F);return}}t.bindTexture(g.TEXTURE_2D,J.__webglTexture,g.TEXTURE0+F)}function P(W,F){const J=n.get(W);if(W.version>0&&J.__version!==W.version){z(J,W,F);return}t.bindTexture(g.TEXTURE_2D_ARRAY,J.__webglTexture,g.TEXTURE0+F)}function N(W,F){const J=n.get(W);if(W.version>0&&J.__version!==W.version){z(J,W,F);return}t.bindTexture(g.TEXTURE_3D,J.__webglTexture,g.TEXTURE0+F)}function k(W,F){const J=n.get(W);if(W.version>0&&J.__version!==W.version){G(J,W,F);return}t.bindTexture(g.TEXTURE_CUBE_MAP,J.__webglTexture,g.TEXTURE0+F)}const O={[Vr]:g.REPEAT,[Ot]:g.CLAMP_TO_EDGE,[Xr]:g.MIRRORED_REPEAT},$={[yt]:g.NEAREST,[gs]:g.NEAREST_MIPMAP_NEAREST,[si]:g.NEAREST_MIPMAP_LINEAR,[St]:g.LINEAR,[lr]:g.LINEAR_MIPMAP_NEAREST,[Mn]:g.LINEAR_MIPMAP_LINEAR},V={[Gl]:g.NEVER,[Zl]:g.ALWAYS,[Vl]:g.LESS,[Qo]:g.LEQUAL,[Xl]:g.EQUAL,[Yl]:g.GEQUAL,[jl]:g.GREATER,[Kl]:g.NOTEQUAL};function H(W,F,J){if(F.type===Qt&&e.has("OES_texture_float_linear")===!1&&(F.magFilter===St||F.magFilter===lr||F.magFilter===si||F.magFilter===Mn||F.minFilter===St||F.minFilter===lr||F.minFilter===si||F.minFilter===Mn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),J?(g.texParameteri(W,g.TEXTURE_WRAP_S,O[F.wrapS]),g.texParameteri(W,g.TEXTURE_WRAP_T,O[F.wrapT]),(W===g.TEXTURE_3D||W===g.TEXTURE_2D_ARRAY)&&g.texParameteri(W,g.TEXTURE_WRAP_R,O[F.wrapR]),g.texParameteri(W,g.TEXTURE_MAG_FILTER,$[F.magFilter]),g.texParameteri(W,g.TEXTURE_MIN_FILTER,$[F.minFilter])):(g.texParameteri(W,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(W,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),(W===g.TEXTURE_3D||W===g.TEXTURE_2D_ARRAY)&&g.texParameteri(W,g.TEXTURE_WRAP_R,g.CLAMP_TO_EDGE),(F.wrapS!==Ot||F.wrapT!==Ot)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),g.texParameteri(W,g.TEXTURE_MAG_FILTER,v(F.magFilter)),g.texParameteri(W,g.TEXTURE_MIN_FILTER,v(F.minFilter)),F.minFilter!==yt&&F.minFilter!==St&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),F.compareFunction&&(g.texParameteri(W,g.TEXTURE_COMPARE_MODE,g.COMPARE_REF_TO_TEXTURE),g.texParameteri(W,g.TEXTURE_COMPARE_FUNC,V[F.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const le=e.get("EXT_texture_filter_anisotropic");if(F.magFilter===yt||F.minFilter!==si&&F.minFilter!==Mn||F.type===Qt&&e.has("OES_texture_float_linear")===!1||m===!1&&F.type===fi&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||n.get(F).__currentAnisotropy)&&(g.texParameterf(W,le.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,p.getMaxAnisotropy())),n.get(F).__currentAnisotropy=F.anisotropy)}}function U(W,F){let J=!1;W.__webglInit===void 0&&(W.__webglInit=!0,F.addEventListener("dispose",E));const le=F.source;let re=s.get(le);re===void 0&&(re={},s.set(le,re));const ae=S(F);if(ae!==W.__cacheKey){re[ae]===void 0&&(re[ae]={texture:g.createTexture(),usedTimes:0},y.memory.textures++,J=!0),re[ae].usedTimes++;const xe=re[W.__cacheKey];xe!==void 0&&(re[W.__cacheKey].usedTimes--,xe.usedTimes===0&&w(F)),W.__cacheKey=ae,W.__webglTexture=re[ae].texture}return J}function z(W,F,J){let le=g.TEXTURE_2D;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(le=g.TEXTURE_2D_ARRAY),F.isData3DTexture&&(le=g.TEXTURE_3D);const re=U(W,F),ae=F.source;t.bindTexture(le,W.__webglTexture,g.TEXTURE0+J);const xe=n.get(ae);if(ae.version!==xe.__version||re===!0){t.activeTexture(g.TEXTURE0+J);const de=je.getPrimaries(je.workingColorSpace),ye=F.colorSpace===It?null:je.getPrimaries(F.colorSpace),Ae=F.colorSpace===It||de===ye?g.NONE:g.BROWSER_DEFAULT_WEBGL;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,F.flipY),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),g.pixelStorei(g.UNPACK_ALIGNMENT,F.unpackAlignment),g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ae);const Oe=d(F)&&h(F.image)===!1;let se=c(F.image,Oe,!1,p.maxTextureSize);se=Te(F,se);const Xe=h(se)||m,Be=f.convert(F.format,F.colorSpace);let Re=f.convert(F.type),Me=M(F.internalFormat,Be,Re,F.colorSpace,F.isVideoTexture);H(le,F,Xe);let _e;const Pe=F.mipmaps,Ge=m&&F.isVideoTexture!==!0&&Me!==Yo,qe=xe.__version===void 0||re===!0,ze=ae.dataReady,Ke=b(F,se,Xe);if(F.isDepthTexture)Me=g.DEPTH_COMPONENT,m?F.type===Qt?Me=g.DEPTH_COMPONENT32F:F.type===ln?Me=g.DEPTH_COMPONENT24:F.type===En?Me=g.DEPTH24_STENCIL8:Me=g.DEPTH_COMPONENT16:F.type===Qt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===Cn&&Me===g.DEPTH_COMPONENT&&F.type!==qr&&F.type!==ln&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=ln,Re=f.convert(F.type)),F.format===Jn&&Me===g.DEPTH_COMPONENT&&(Me=g.DEPTH_STENCIL,F.type!==En&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=En,Re=f.convert(F.type))),qe&&(Ge?t.texStorage2D(g.TEXTURE_2D,1,Me,se.width,se.height):t.texImage2D(g.TEXTURE_2D,0,Me,se.width,se.height,0,Be,Re,null));else if(F.isDataTexture)if(Pe.length>0&&Xe){Ge&&qe&&t.texStorage2D(g.TEXTURE_2D,Ke,Me,Pe[0].width,Pe[0].height);for(let X=0,ce=Pe.length;X<ce;X++)_e=Pe[X],Ge?ze&&t.texSubImage2D(g.TEXTURE_2D,X,0,0,_e.width,_e.height,Be,Re,_e.data):t.texImage2D(g.TEXTURE_2D,X,Me,_e.width,_e.height,0,Be,Re,_e.data);F.generateMipmaps=!1}else Ge?(qe&&t.texStorage2D(g.TEXTURE_2D,Ke,Me,se.width,se.height),ze&&t.texSubImage2D(g.TEXTURE_2D,0,0,0,se.width,se.height,Be,Re,se.data)):t.texImage2D(g.TEXTURE_2D,0,Me,se.width,se.height,0,Be,Re,se.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){Ge&&qe&&t.texStorage3D(g.TEXTURE_2D_ARRAY,Ke,Me,Pe[0].width,Pe[0].height,se.depth);for(let X=0,ce=Pe.length;X<ce;X++)_e=Pe[X],F.format!==$t?Be!==null?Ge?ze&&t.compressedTexSubImage3D(g.TEXTURE_2D_ARRAY,X,0,0,0,_e.width,_e.height,se.depth,Be,_e.data,0,0):t.compressedTexImage3D(g.TEXTURE_2D_ARRAY,X,Me,_e.width,_e.height,se.depth,0,_e.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ge?ze&&t.texSubImage3D(g.TEXTURE_2D_ARRAY,X,0,0,0,_e.width,_e.height,se.depth,Be,Re,_e.data):t.texImage3D(g.TEXTURE_2D_ARRAY,X,Me,_e.width,_e.height,se.depth,0,Be,Re,_e.data)}else{Ge&&qe&&t.texStorage2D(g.TEXTURE_2D,Ke,Me,Pe[0].width,Pe[0].height);for(let X=0,ce=Pe.length;X<ce;X++)_e=Pe[X],F.format!==$t?Be!==null?Ge?ze&&t.compressedTexSubImage2D(g.TEXTURE_2D,X,0,0,_e.width,_e.height,Be,_e.data):t.compressedTexImage2D(g.TEXTURE_2D,X,Me,_e.width,_e.height,0,_e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ge?ze&&t.texSubImage2D(g.TEXTURE_2D,X,0,0,_e.width,_e.height,Be,Re,_e.data):t.texImage2D(g.TEXTURE_2D,X,Me,_e.width,_e.height,0,Be,Re,_e.data)}else if(F.isDataArrayTexture)Ge?(qe&&t.texStorage3D(g.TEXTURE_2D_ARRAY,Ke,Me,se.width,se.height,se.depth),ze&&t.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,0,se.width,se.height,se.depth,Be,Re,se.data)):t.texImage3D(g.TEXTURE_2D_ARRAY,0,Me,se.width,se.height,se.depth,0,Be,Re,se.data);else if(F.isData3DTexture)Ge?(qe&&t.texStorage3D(g.TEXTURE_3D,Ke,Me,se.width,se.height,se.depth),ze&&t.texSubImage3D(g.TEXTURE_3D,0,0,0,0,se.width,se.height,se.depth,Be,Re,se.data)):t.texImage3D(g.TEXTURE_3D,0,Me,se.width,se.height,se.depth,0,Be,Re,se.data);else if(F.isFramebufferTexture){if(qe)if(Ge)t.texStorage2D(g.TEXTURE_2D,Ke,Me,se.width,se.height);else{let X=se.width,ce=se.height;for(let he=0;he<Ke;he++)t.texImage2D(g.TEXTURE_2D,he,Me,X,ce,0,Be,Re,null),X>>=1,ce>>=1}}else if(Pe.length>0&&Xe){Ge&&qe&&t.texStorage2D(g.TEXTURE_2D,Ke,Me,Pe[0].width,Pe[0].height);for(let X=0,ce=Pe.length;X<ce;X++)_e=Pe[X],Ge?ze&&t.texSubImage2D(g.TEXTURE_2D,X,0,0,Be,Re,_e):t.texImage2D(g.TEXTURE_2D,X,Me,Be,Re,_e);F.generateMipmaps=!1}else Ge?(qe&&t.texStorage2D(g.TEXTURE_2D,Ke,Me,se.width,se.height),ze&&t.texSubImage2D(g.TEXTURE_2D,0,0,0,Be,Re,se)):t.texImage2D(g.TEXTURE_2D,0,Me,Be,Re,se);_(F,Xe)&&C(le),xe.__version=ae.version,F.onUpdate&&F.onUpdate(F)}W.__version=F.version}function G(W,F,J){if(F.image.length!==6)return;const le=U(W,F),re=F.source;t.bindTexture(g.TEXTURE_CUBE_MAP,W.__webglTexture,g.TEXTURE0+J);const ae=n.get(re);if(re.version!==ae.__version||le===!0){t.activeTexture(g.TEXTURE0+J);const xe=je.getPrimaries(je.workingColorSpace),de=F.colorSpace===It?null:je.getPrimaries(F.colorSpace),ye=F.colorSpace===It||xe===de?g.NONE:g.BROWSER_DEFAULT_WEBGL;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,F.flipY),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),g.pixelStorei(g.UNPACK_ALIGNMENT,F.unpackAlignment),g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,ye);const Ae=F.isCompressedTexture||F.image[0].isCompressedTexture,Oe=F.image[0]&&F.image[0].isDataTexture,se=[];for(let X=0;X<6;X++)!Ae&&!Oe?se[X]=c(F.image[X],!1,!0,p.maxCubemapSize):se[X]=Oe?F.image[X].image:F.image[X],se[X]=Te(F,se[X]);const Xe=se[0],Be=h(Xe)||m,Re=f.convert(F.format,F.colorSpace),Me=f.convert(F.type),_e=M(F.internalFormat,Re,Me,F.colorSpace),Pe=m&&F.isVideoTexture!==!0,Ge=ae.__version===void 0||le===!0,qe=re.dataReady;let ze=b(F,Xe,Be);H(g.TEXTURE_CUBE_MAP,F,Be);let Ke;if(Ae){Pe&&Ge&&t.texStorage2D(g.TEXTURE_CUBE_MAP,ze,_e,Xe.width,Xe.height);for(let X=0;X<6;X++){Ke=se[X].mipmaps;for(let ce=0;ce<Ke.length;ce++){const he=Ke[ce];F.format!==$t?Re!==null?Pe?qe&&t.compressedTexSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce,0,0,he.width,he.height,Re,he.data):t.compressedTexImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce,_e,he.width,he.height,0,he.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pe?qe&&t.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce,0,0,he.width,he.height,Re,Me,he.data):t.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce,_e,he.width,he.height,0,Re,Me,he.data)}}}else{Ke=F.mipmaps,Pe&&Ge&&(Ke.length>0&&ze++,t.texStorage2D(g.TEXTURE_CUBE_MAP,ze,_e,se[0].width,se[0].height));for(let X=0;X<6;X++)if(Oe){Pe?qe&&t.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,se[X].width,se[X].height,Re,Me,se[X].data):t.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,_e,se[X].width,se[X].height,0,Re,Me,se[X].data);for(let ce=0;ce<Ke.length;ce++){const Se=Ke[ce].image[X].image;Pe?qe&&t.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce+1,0,0,Se.width,Se.height,Re,Me,Se.data):t.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce+1,_e,Se.width,Se.height,0,Re,Me,Se.data)}}else{Pe?qe&&t.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,Re,Me,se[X]):t.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,_e,Re,Me,se[X]);for(let ce=0;ce<Ke.length;ce++){const he=Ke[ce];Pe?qe&&t.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce+1,0,0,Re,Me,he.image[X]):t.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+X,ce+1,_e,Re,Me,he.image[X])}}}_(F,Be)&&C(g.TEXTURE_CUBE_MAP),ae.__version=re.version,F.onUpdate&&F.onUpdate(F)}W.__version=F.version}function K(W,F,J,le,re,ae){const xe=f.convert(J.format,J.colorSpace),de=f.convert(J.type),ye=M(J.internalFormat,xe,de,J.colorSpace);if(!n.get(F).__hasExternalTextures){const Oe=Math.max(1,F.width>>ae),se=Math.max(1,F.height>>ae);re===g.TEXTURE_3D||re===g.TEXTURE_2D_ARRAY?t.texImage3D(re,ae,ye,Oe,se,F.depth,0,xe,de,null):t.texImage2D(re,ae,ye,Oe,se,0,xe,de,null)}t.bindFramebuffer(g.FRAMEBUFFER,W),ve(F)?l.framebufferTexture2DMultisampleEXT(g.FRAMEBUFFER,le,re,n.get(J).__webglTexture,0,me(F)):(re===g.TEXTURE_2D||re>=g.TEXTURE_CUBE_MAP_POSITIVE_X&&re<=g.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&g.framebufferTexture2D(g.FRAMEBUFFER,le,re,n.get(J).__webglTexture,ae),t.bindFramebuffer(g.FRAMEBUFFER,null)}function Y(W,F,J){if(g.bindRenderbuffer(g.RENDERBUFFER,W),F.depthBuffer&&!F.stencilBuffer){let le=m===!0?g.DEPTH_COMPONENT24:g.DEPTH_COMPONENT16;if(J||ve(F)){const re=F.depthTexture;re&&re.isDepthTexture&&(re.type===Qt?le=g.DEPTH_COMPONENT32F:re.type===ln&&(le=g.DEPTH_COMPONENT24));const ae=me(F);ve(F)?l.renderbufferStorageMultisampleEXT(g.RENDERBUFFER,ae,le,F.width,F.height):g.renderbufferStorageMultisample(g.RENDERBUFFER,ae,le,F.width,F.height)}else g.renderbufferStorage(g.RENDERBUFFER,le,F.width,F.height);g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,W)}else if(F.depthBuffer&&F.stencilBuffer){const le=me(F);J&&ve(F)===!1?g.renderbufferStorageMultisample(g.RENDERBUFFER,le,g.DEPTH24_STENCIL8,F.width,F.height):ve(F)?l.renderbufferStorageMultisampleEXT(g.RENDERBUFFER,le,g.DEPTH24_STENCIL8,F.width,F.height):g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_STENCIL,F.width,F.height),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,W)}else{const le=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let re=0;re<le.length;re++){const ae=le[re],xe=f.convert(ae.format,ae.colorSpace),de=f.convert(ae.type),ye=M(ae.internalFormat,xe,de,ae.colorSpace),Ae=me(F);J&&ve(F)===!1?g.renderbufferStorageMultisample(g.RENDERBUFFER,Ae,ye,F.width,F.height):ve(F)?l.renderbufferStorageMultisampleEXT(g.RENDERBUFFER,Ae,ye,F.width,F.height):g.renderbufferStorage(g.RENDERBUFFER,ye,F.width,F.height)}}g.bindRenderbuffer(g.RENDERBUFFER,null)}function Z(W,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(g.FRAMEBUFFER,W),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),T(F.depthTexture,0);const le=n.get(F.depthTexture).__webglTexture,re=me(F);if(F.depthTexture.format===Cn)ve(F)?l.framebufferTexture2DMultisampleEXT(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,le,0,re):g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,le,0);else if(F.depthTexture.format===Jn)ve(F)?l.framebufferTexture2DMultisampleEXT(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,le,0,re):g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,le,0);else throw new Error("Unknown depthTexture format")}function ie(W){const F=n.get(W),J=W.isWebGLCubeRenderTarget===!0;if(W.depthTexture&&!F.__autoAllocateDepthBuffer){if(J)throw new Error("target.depthTexture not supported in Cube render targets");Z(F.__webglFramebuffer,W)}else if(J){F.__webglDepthbuffer=[];for(let le=0;le<6;le++)t.bindFramebuffer(g.FRAMEBUFFER,F.__webglFramebuffer[le]),F.__webglDepthbuffer[le]=g.createRenderbuffer(),Y(F.__webglDepthbuffer[le],W,!1)}else t.bindFramebuffer(g.FRAMEBUFFER,F.__webglFramebuffer),F.__webglDepthbuffer=g.createRenderbuffer(),Y(F.__webglDepthbuffer,W,!1);t.bindFramebuffer(g.FRAMEBUFFER,null)}function oe(W,F,J){const le=n.get(W);F!==void 0&&K(le.__webglFramebuffer,W,W.texture,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,0),J!==void 0&&ie(W)}function j(W){const F=W.texture,J=n.get(W),le=n.get(F);W.addEventListener("dispose",D),W.isWebGLMultipleRenderTargets!==!0&&(le.__webglTexture===void 0&&(le.__webglTexture=g.createTexture()),le.__version=F.version,y.memory.textures++);const re=W.isWebGLCubeRenderTarget===!0,ae=W.isWebGLMultipleRenderTargets===!0,xe=h(W)||m;if(re){J.__webglFramebuffer=[];for(let de=0;de<6;de++)if(m&&F.mipmaps&&F.mipmaps.length>0){J.__webglFramebuffer[de]=[];for(let ye=0;ye<F.mipmaps.length;ye++)J.__webglFramebuffer[de][ye]=g.createFramebuffer()}else J.__webglFramebuffer[de]=g.createFramebuffer()}else{if(m&&F.mipmaps&&F.mipmaps.length>0){J.__webglFramebuffer=[];for(let de=0;de<F.mipmaps.length;de++)J.__webglFramebuffer[de]=g.createFramebuffer()}else J.__webglFramebuffer=g.createFramebuffer();if(ae)if(p.drawBuffers){const de=W.texture;for(let ye=0,Ae=de.length;ye<Ae;ye++){const Oe=n.get(de[ye]);Oe.__webglTexture===void 0&&(Oe.__webglTexture=g.createTexture(),y.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(m&&W.samples>0&&ve(W)===!1){const de=ae?F:[F];J.__webglMultisampledFramebuffer=g.createFramebuffer(),J.__webglColorRenderbuffer=[],t.bindFramebuffer(g.FRAMEBUFFER,J.__webglMultisampledFramebuffer);for(let ye=0;ye<de.length;ye++){const Ae=de[ye];J.__webglColorRenderbuffer[ye]=g.createRenderbuffer(),g.bindRenderbuffer(g.RENDERBUFFER,J.__webglColorRenderbuffer[ye]);const Oe=f.convert(Ae.format,Ae.colorSpace),se=f.convert(Ae.type),Xe=M(Ae.internalFormat,Oe,se,Ae.colorSpace,W.isXRRenderTarget===!0),Be=me(W);g.renderbufferStorageMultisample(g.RENDERBUFFER,Be,Xe,W.width,W.height),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0+ye,g.RENDERBUFFER,J.__webglColorRenderbuffer[ye])}g.bindRenderbuffer(g.RENDERBUFFER,null),W.depthBuffer&&(J.__webglDepthRenderbuffer=g.createRenderbuffer(),Y(J.__webglDepthRenderbuffer,W,!0)),t.bindFramebuffer(g.FRAMEBUFFER,null)}}if(re){t.bindTexture(g.TEXTURE_CUBE_MAP,le.__webglTexture),H(g.TEXTURE_CUBE_MAP,F,xe);for(let de=0;de<6;de++)if(m&&F.mipmaps&&F.mipmaps.length>0)for(let ye=0;ye<F.mipmaps.length;ye++)K(J.__webglFramebuffer[de][ye],W,F,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+de,ye);else K(J.__webglFramebuffer[de],W,F,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+de,0);_(F,xe)&&C(g.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ae){const de=W.texture;for(let ye=0,Ae=de.length;ye<Ae;ye++){const Oe=de[ye],se=n.get(Oe);t.bindTexture(g.TEXTURE_2D,se.__webglTexture),H(g.TEXTURE_2D,Oe,xe),K(J.__webglFramebuffer,W,Oe,g.COLOR_ATTACHMENT0+ye,g.TEXTURE_2D,0),_(Oe,xe)&&C(g.TEXTURE_2D)}t.unbindTexture()}else{let de=g.TEXTURE_2D;if((W.isWebGL3DRenderTarget||W.isWebGLArrayRenderTarget)&&(m?de=W.isWebGL3DRenderTarget?g.TEXTURE_3D:g.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(de,le.__webglTexture),H(de,F,xe),m&&F.mipmaps&&F.mipmaps.length>0)for(let ye=0;ye<F.mipmaps.length;ye++)K(J.__webglFramebuffer[ye],W,F,g.COLOR_ATTACHMENT0,de,ye);else K(J.__webglFramebuffer,W,F,g.COLOR_ATTACHMENT0,de,0);_(F,xe)&&C(de),t.unbindTexture()}W.depthBuffer&&ie(W)}function ke(W){const F=h(W)||m,J=W.isWebGLMultipleRenderTargets===!0?W.texture:[W.texture];for(let le=0,re=J.length;le<re;le++){const ae=J[le];if(_(ae,F)){const xe=W.isWebGLCubeRenderTarget?g.TEXTURE_CUBE_MAP:g.TEXTURE_2D,de=n.get(ae).__webglTexture;t.bindTexture(xe,de),C(xe),t.unbindTexture()}}}function ge(W){if(m&&W.samples>0&&ve(W)===!1){const F=W.isWebGLMultipleRenderTargets?W.texture:[W.texture],J=W.width,le=W.height;let re=g.COLOR_BUFFER_BIT;const ae=[],xe=W.stencilBuffer?g.DEPTH_STENCIL_ATTACHMENT:g.DEPTH_ATTACHMENT,de=n.get(W),ye=W.isWebGLMultipleRenderTargets===!0;if(ye)for(let Ae=0;Ae<F.length;Ae++)t.bindFramebuffer(g.FRAMEBUFFER,de.__webglMultisampledFramebuffer),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0+Ae,g.RENDERBUFFER,null),t.bindFramebuffer(g.FRAMEBUFFER,de.__webglFramebuffer),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0+Ae,g.TEXTURE_2D,null,0);t.bindFramebuffer(g.READ_FRAMEBUFFER,de.__webglMultisampledFramebuffer),t.bindFramebuffer(g.DRAW_FRAMEBUFFER,de.__webglFramebuffer);for(let Ae=0;Ae<F.length;Ae++){ae.push(g.COLOR_ATTACHMENT0+Ae),W.depthBuffer&&ae.push(xe);const Oe=de.__ignoreDepthValues!==void 0?de.__ignoreDepthValues:!1;if(Oe===!1&&(W.depthBuffer&&(re|=g.DEPTH_BUFFER_BIT),W.stencilBuffer&&(re|=g.STENCIL_BUFFER_BIT)),ye&&g.framebufferRenderbuffer(g.READ_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.RENDERBUFFER,de.__webglColorRenderbuffer[Ae]),Oe===!0&&(g.invalidateFramebuffer(g.READ_FRAMEBUFFER,[xe]),g.invalidateFramebuffer(g.DRAW_FRAMEBUFFER,[xe])),ye){const se=n.get(F[Ae]).__webglTexture;g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,se,0)}g.blitFramebuffer(0,0,J,le,0,0,J,le,re,g.NEAREST),u&&g.invalidateFramebuffer(g.READ_FRAMEBUFFER,ae)}if(t.bindFramebuffer(g.READ_FRAMEBUFFER,null),t.bindFramebuffer(g.DRAW_FRAMEBUFFER,null),ye)for(let Ae=0;Ae<F.length;Ae++){t.bindFramebuffer(g.FRAMEBUFFER,de.__webglMultisampledFramebuffer),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0+Ae,g.RENDERBUFFER,de.__webglColorRenderbuffer[Ae]);const Oe=n.get(F[Ae]).__webglTexture;t.bindFramebuffer(g.FRAMEBUFFER,de.__webglFramebuffer),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0+Ae,g.TEXTURE_2D,Oe,0)}t.bindFramebuffer(g.DRAW_FRAMEBUFFER,de.__webglMultisampledFramebuffer)}}function me(W){return Math.min(p.maxSamples,W.samples)}function ve(W){const F=n.get(W);return m&&W.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function Ye(W){const F=y.render.frame;r.get(W)!==F&&(r.set(W,F),W.update())}function Te(W,F){const J=W.colorSpace,le=W.format,re=W.type;return W.isCompressedTexture===!0||W.isVideoTexture===!0||W.format===jr||J!==en&&J!==It&&(je.getTransfer(J)===Je?m===!1?e.has("EXT_sRGB")===!0&&le===$t?(W.format=jr,W.minFilter=St,W.generateMipmaps=!1):F=Jo.sRGBToLinear(F):(le!==$t||re!==un)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",J)),F}this.allocateTextureUnit=x,this.resetTextureUnits=A,this.setTexture2D=T,this.setTexture2DArray=P,this.setTexture3D=N,this.setTextureCube=k,this.rebindTextures=oe,this.setupRenderTarget=j,this.updateRenderTargetMipmap=ke,this.updateMultisampleRenderTarget=ge,this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=K,this.useMultisampledRTT=ve}function qf(g,e,t){const n=t.isWebGL2;function p(f,y=It){let m;const l=je.getTransfer(y);if(f===un)return g.UNSIGNED_BYTE;if(f===Go)return g.UNSIGNED_SHORT_4_4_4_4;if(f===Vo)return g.UNSIGNED_SHORT_5_5_5_1;if(f===Il)return g.BYTE;if(f===Pl)return g.SHORT;if(f===qr)return g.UNSIGNED_SHORT;if(f===Wo)return g.INT;if(f===ln)return g.UNSIGNED_INT;if(f===Qt)return g.FLOAT;if(f===fi)return n?g.HALF_FLOAT:(m=e.get("OES_texture_half_float"),m!==null?m.HALF_FLOAT_OES:null);if(f===Nl)return g.ALPHA;if(f===$t)return g.RGBA;if(f===kl)return g.LUMINANCE;if(f===Ol)return g.LUMINANCE_ALPHA;if(f===Cn)return g.DEPTH_COMPONENT;if(f===Jn)return g.DEPTH_STENCIL;if(f===jr)return m=e.get("EXT_sRGB"),m!==null?m.SRGB_ALPHA_EXT:null;if(f===$l)return g.RED;if(f===Xo)return g.RED_INTEGER;if(f===Fl)return g.RG;if(f===jo)return g.RG_INTEGER;if(f===Ko)return g.RGBA_INTEGER;if(f===cr||f===hr||f===ur||f===dr)if(l===Je)if(m=e.get("WEBGL_compressed_texture_s3tc_srgb"),m!==null){if(f===cr)return m.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(f===hr)return m.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(f===ur)return m.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(f===dr)return m.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(m=e.get("WEBGL_compressed_texture_s3tc"),m!==null){if(f===cr)return m.COMPRESSED_RGB_S3TC_DXT1_EXT;if(f===hr)return m.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(f===ur)return m.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(f===dr)return m.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(f===ms||f===vs||f===ys||f===_s)if(m=e.get("WEBGL_compressed_texture_pvrtc"),m!==null){if(f===ms)return m.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(f===vs)return m.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(f===ys)return m.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(f===_s)return m.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(f===Yo)return m=e.get("WEBGL_compressed_texture_etc1"),m!==null?m.COMPRESSED_RGB_ETC1_WEBGL:null;if(f===Ss||f===xs)if(m=e.get("WEBGL_compressed_texture_etc"),m!==null){if(f===Ss)return l===Je?m.COMPRESSED_SRGB8_ETC2:m.COMPRESSED_RGB8_ETC2;if(f===xs)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:m.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(f===bs||f===ws||f===Ms||f===Es||f===Cs||f===As||f===Ts||f===Ls||f===Rs||f===Ds||f===Is||f===Ps||f===Ns||f===ks)if(m=e.get("WEBGL_compressed_texture_astc"),m!==null){if(f===bs)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:m.COMPRESSED_RGBA_ASTC_4x4_KHR;if(f===ws)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:m.COMPRESSED_RGBA_ASTC_5x4_KHR;if(f===Ms)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:m.COMPRESSED_RGBA_ASTC_5x5_KHR;if(f===Es)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:m.COMPRESSED_RGBA_ASTC_6x5_KHR;if(f===Cs)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:m.COMPRESSED_RGBA_ASTC_6x6_KHR;if(f===As)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:m.COMPRESSED_RGBA_ASTC_8x5_KHR;if(f===Ts)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:m.COMPRESSED_RGBA_ASTC_8x6_KHR;if(f===Ls)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:m.COMPRESSED_RGBA_ASTC_8x8_KHR;if(f===Rs)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:m.COMPRESSED_RGBA_ASTC_10x5_KHR;if(f===Ds)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:m.COMPRESSED_RGBA_ASTC_10x6_KHR;if(f===Is)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:m.COMPRESSED_RGBA_ASTC_10x8_KHR;if(f===Ps)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:m.COMPRESSED_RGBA_ASTC_10x10_KHR;if(f===Ns)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:m.COMPRESSED_RGBA_ASTC_12x10_KHR;if(f===ks)return l===Je?m.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:m.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(f===fr||f===Os||f===$s)if(m=e.get("EXT_texture_compression_bptc"),m!==null){if(f===fr)return l===Je?m.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:m.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(f===Os)return m.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(f===$s)return m.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(f===Ul||f===Fs||f===Us||f===Bs)if(m=e.get("EXT_texture_compression_rgtc"),m!==null){if(f===fr)return m.COMPRESSED_RED_RGTC1_EXT;if(f===Fs)return m.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(f===Us)return m.COMPRESSED_RED_GREEN_RGTC2_EXT;if(f===Bs)return m.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return f===En?n?g.UNSIGNED_INT_24_8:(m=e.get("WEBGL_depth_texture"),m!==null?m.UNSIGNED_INT_24_8_WEBGL:null):g[f]!==void 0?g[f]:null}return{convert:p}}class Jf extends Dt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ui extends dt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ep={type:"move"};class Fr{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ui,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ui,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ui,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let p=null,f=null,y=null;const m=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){y=!0;for(const c of e.hand.values()){const h=t.getJointPose(c,n),d=this._getHandJoint(u,c);h!==null&&(d.matrix.fromArray(h.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,d.jointRadius=h.radius),d.visible=h!==null}const r=u.joints["index-finger-tip"],a=u.joints["thumb-tip"],s=r.position.distanceTo(a.position),o=.02,i=.005;u.inputState.pinching&&s>o+i?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&s<=o-i&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(f=t.getPose(e.gripSpace,n),f!==null&&(l.matrix.fromArray(f.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,f.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(f.linearVelocity)):l.hasLinearVelocity=!1,f.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(f.angularVelocity)):l.hasAngularVelocity=!1));m!==null&&(p=t.getPose(e.targetRaySpace,n),p===null&&f!==null&&(p=f),p!==null&&(m.matrix.fromArray(p.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,p.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(p.linearVelocity)):m.hasLinearVelocity=!1,p.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(p.angularVelocity)):m.hasAngularVelocity=!1,this.dispatchEvent(ep)))}return m!==null&&(m.visible=p!==null),l!==null&&(l.visible=f!==null),u!==null&&(u.visible=y!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new ui;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}const tp=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,np=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class ip{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const p=new wt,f=e.properties.get(p);f.__webglTexture=t.texture,(t.depthNear!=n.depthNear||t.depthFar!=n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=p}}render(e,t){if(this.texture!==null){if(this.mesh===null){const n=t.cameras[0].viewport,p=new fn({extensions:{fragDepth:!0},vertexShader:tp,fragmentShader:np,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Jt(new er(20,20),p)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class rp extends ni{constructor(e,t){super();const n=this;let p=null,f=1,y=null,m="local-floor",l=1,u=null,r=null,a=null,s=null,o=null,i=null;const c=new ip,h=t.getContextAttributes();let d=null,_=null;const C=[],M=[],b=new We;let v=null;const E=new Dt;E.layers.enable(1),E.viewport=new ct;const D=new Dt;D.layers.enable(2),D.viewport=new ct;const L=[E,D],w=new Jf;w.layers.enable(1),w.layers.enable(2);let I=null,R=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(U){let z=C[U];return z===void 0&&(z=new Fr,C[U]=z),z.getTargetRaySpace()},this.getControllerGrip=function(U){let z=C[U];return z===void 0&&(z=new Fr,C[U]=z),z.getGripSpace()},this.getHand=function(U){let z=C[U];return z===void 0&&(z=new Fr,C[U]=z),z.getHandSpace()};function A(U){const z=M.indexOf(U.inputSource);if(z===-1)return;const G=C[z];G!==void 0&&(G.update(U.inputSource,U.frame,u||y),G.dispatchEvent({type:U.type,data:U.inputSource}))}function x(){p.removeEventListener("select",A),p.removeEventListener("selectstart",A),p.removeEventListener("selectend",A),p.removeEventListener("squeeze",A),p.removeEventListener("squeezestart",A),p.removeEventListener("squeezeend",A),p.removeEventListener("end",x),p.removeEventListener("inputsourceschange",S);for(let U=0;U<C.length;U++){const z=M[U];z!==null&&(M[U]=null,C[U].disconnect(z))}I=null,R=null,c.reset(),e.setRenderTarget(d),o=null,s=null,a=null,p=null,_=null,H.stop(),n.isPresenting=!1,e.setPixelRatio(v),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(U){f=U,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(U){m=U,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||y},this.setReferenceSpace=function(U){u=U},this.getBaseLayer=function(){return s!==null?s:o},this.getBinding=function(){return a},this.getFrame=function(){return i},this.getSession=function(){return p},this.setSession=async function(U){if(p=U,p!==null){if(d=e.getRenderTarget(),p.addEventListener("select",A),p.addEventListener("selectstart",A),p.addEventListener("selectend",A),p.addEventListener("squeeze",A),p.addEventListener("squeezestart",A),p.addEventListener("squeezeend",A),p.addEventListener("end",x),p.addEventListener("inputsourceschange",S),h.xrCompatible!==!0&&await t.makeXRCompatible(),v=e.getPixelRatio(),e.getSize(b),p.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const z={antialias:p.renderState.layers===void 0?h.antialias:!0,alpha:!0,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:f};o=new XRWebGLLayer(p,t,z),p.updateRenderState({baseLayer:o}),e.setPixelRatio(1),e.setSize(o.framebufferWidth,o.framebufferHeight,!1),_=new Tn(o.framebufferWidth,o.framebufferHeight,{format:$t,type:un,colorSpace:e.outputColorSpace,stencilBuffer:h.stencil})}else{let z=null,G=null,K=null;h.depth&&(K=h.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,z=h.stencil?Jn:Cn,G=h.stencil?En:ln);const Y={colorFormat:t.RGBA8,depthFormat:K,scaleFactor:f};a=new XRWebGLBinding(p,t),s=a.createProjectionLayer(Y),p.updateRenderState({layers:[s]}),e.setPixelRatio(1),e.setSize(s.textureWidth,s.textureHeight,!1),_=new Tn(s.textureWidth,s.textureHeight,{format:$t,type:un,depthTexture:new fa(s.textureWidth,s.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,z),stencilBuffer:h.stencil,colorSpace:e.outputColorSpace,samples:h.antialias?4:0});const Z=e.properties.get(_);Z.__ignoreDepthValues=s.ignoreDepthValues}_.isXRRenderTarget=!0,this.setFoveation(l),u=null,y=await p.requestReferenceSpace(m),H.setContext(p),H.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(p!==null)return p.environmentBlendMode};function S(U){for(let z=0;z<U.removed.length;z++){const G=U.removed[z],K=M.indexOf(G);K>=0&&(M[K]=null,C[K].disconnect(G))}for(let z=0;z<U.added.length;z++){const G=U.added[z];let K=M.indexOf(G);if(K===-1){for(let Z=0;Z<C.length;Z++)if(Z>=M.length){M.push(G),K=Z;break}else if(M[Z]===null){M[Z]=G,K=Z;break}if(K===-1)break}const Y=C[K];Y&&Y.connect(G)}}const T=new q,P=new q;function N(U,z,G){T.setFromMatrixPosition(z.matrixWorld),P.setFromMatrixPosition(G.matrixWorld);const K=T.distanceTo(P),Y=z.projectionMatrix.elements,Z=G.projectionMatrix.elements,ie=Y[14]/(Y[10]-1),oe=Y[14]/(Y[10]+1),j=(Y[9]+1)/Y[5],ke=(Y[9]-1)/Y[5],ge=(Y[8]-1)/Y[0],me=(Z[8]+1)/Z[0],ve=ie*ge,Ye=ie*me,Te=K/(-ge+me),W=Te*-ge;z.matrixWorld.decompose(U.position,U.quaternion,U.scale),U.translateX(W),U.translateZ(Te),U.matrixWorld.compose(U.position,U.quaternion,U.scale),U.matrixWorldInverse.copy(U.matrixWorld).invert();const F=ie+Te,J=oe+Te,le=ve-W,re=Ye+(K-W),ae=j*oe/J*F,xe=ke*oe/J*F;U.projectionMatrix.makePerspective(le,re,ae,xe,F,J),U.projectionMatrixInverse.copy(U.projectionMatrix).invert()}function k(U,z){z===null?U.matrixWorld.copy(U.matrix):U.matrixWorld.multiplyMatrices(z.matrixWorld,U.matrix),U.matrixWorldInverse.copy(U.matrixWorld).invert()}this.updateCamera=function(U){if(p===null)return;c.texture!==null&&(U.near=c.depthNear,U.far=c.depthFar),w.near=D.near=E.near=U.near,w.far=D.far=E.far=U.far,(I!==w.near||R!==w.far)&&(p.updateRenderState({depthNear:w.near,depthFar:w.far}),I=w.near,R=w.far,E.near=I,E.far=R,D.near=I,D.far=R,E.updateProjectionMatrix(),D.updateProjectionMatrix(),U.updateProjectionMatrix());const z=U.parent,G=w.cameras;k(w,z);for(let K=0;K<G.length;K++)k(G[K],z);G.length===2?N(w,E,D):w.projectionMatrix.copy(E.projectionMatrix),O(U,w,z)};function O(U,z,G){G===null?U.matrix.copy(z.matrixWorld):(U.matrix.copy(G.matrixWorld),U.matrix.invert(),U.matrix.multiply(z.matrixWorld)),U.matrix.decompose(U.position,U.quaternion,U.scale),U.updateMatrixWorld(!0),U.projectionMatrix.copy(z.projectionMatrix),U.projectionMatrixInverse.copy(z.projectionMatrixInverse),U.isPerspectiveCamera&&(U.fov=Kr*2*Math.atan(1/U.projectionMatrix.elements[5]),U.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(s===null&&o===null))return l},this.setFoveation=function(U){l=U,s!==null&&(s.fixedFoveation=U),o!==null&&o.fixedFoveation!==void 0&&(o.fixedFoveation=U)},this.hasDepthSensing=function(){return c.texture!==null};let $=null;function V(U,z){if(r=z.getViewerPose(u||y),i=z,r!==null){const G=r.views;o!==null&&(e.setRenderTargetFramebuffer(_,o.framebuffer),e.setRenderTarget(_));let K=!1;G.length!==w.cameras.length&&(w.cameras.length=0,K=!0);for(let Z=0;Z<G.length;Z++){const ie=G[Z];let oe=null;if(o!==null)oe=o.getViewport(ie);else{const ke=a.getViewSubImage(s,ie);oe=ke.viewport,Z===0&&(e.setRenderTargetTextures(_,ke.colorTexture,s.ignoreDepthValues?void 0:ke.depthStencilTexture),e.setRenderTarget(_))}let j=L[Z];j===void 0&&(j=new Dt,j.layers.enable(Z),j.viewport=new ct,L[Z]=j),j.matrix.fromArray(ie.transform.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale),j.projectionMatrix.fromArray(ie.projectionMatrix),j.projectionMatrixInverse.copy(j.projectionMatrix).invert(),j.viewport.set(oe.x,oe.y,oe.width,oe.height),Z===0&&(w.matrix.copy(j.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),K===!0&&w.cameras.push(j)}const Y=p.enabledFeatures;if(Y&&Y.includes("depth-sensing")){const Z=a.getDepthInformation(G[0]);Z&&Z.isValid&&Z.texture&&c.init(e,Z,p.renderState)}}for(let G=0;G<C.length;G++){const K=M[G],Y=C[G];K!==null&&Y!==void 0&&Y.update(K,z,u||y)}c.render(e,w),$&&$(U,z),z.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:z}),i=null}const H=new ua;H.setAnimationLoop(V),this.setAnimationLoop=function(U){$=U},this.dispose=function(){}}}function sp(g,e){function t(h,d){h.matrixAutoUpdate===!0&&h.updateMatrix(),d.value.copy(h.matrix)}function n(h,d){d.color.getRGB(h.fogColor.value,la(g)),d.isFog?(h.fogNear.value=d.near,h.fogFar.value=d.far):d.isFogExp2&&(h.fogDensity.value=d.density)}function p(h,d,_,C,M){d.isMeshBasicMaterial||d.isMeshLambertMaterial?f(h,d):d.isMeshToonMaterial?(f(h,d),a(h,d)):d.isMeshPhongMaterial?(f(h,d),r(h,d)):d.isMeshStandardMaterial?(f(h,d),s(h,d),d.isMeshPhysicalMaterial&&o(h,d,M)):d.isMeshMatcapMaterial?(f(h,d),i(h,d)):d.isMeshDepthMaterial?f(h,d):d.isMeshDistanceMaterial?(f(h,d),c(h,d)):d.isMeshNormalMaterial?f(h,d):d.isLineBasicMaterial?(y(h,d),d.isLineDashedMaterial&&m(h,d)):d.isPointsMaterial?l(h,d,_,C):d.isSpriteMaterial?u(h,d):d.isShadowMaterial?(h.color.value.copy(d.color),h.opacity.value=d.opacity):d.isShaderMaterial&&(d.uniformsNeedUpdate=!1)}function f(h,d){h.opacity.value=d.opacity,d.color&&h.diffuse.value.copy(d.color),d.emissive&&h.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity),d.map&&(h.map.value=d.map,t(d.map,h.mapTransform)),d.alphaMap&&(h.alphaMap.value=d.alphaMap,t(d.alphaMap,h.alphaMapTransform)),d.bumpMap&&(h.bumpMap.value=d.bumpMap,t(d.bumpMap,h.bumpMapTransform),h.bumpScale.value=d.bumpScale,d.side===bt&&(h.bumpScale.value*=-1)),d.normalMap&&(h.normalMap.value=d.normalMap,t(d.normalMap,h.normalMapTransform),h.normalScale.value.copy(d.normalScale),d.side===bt&&h.normalScale.value.negate()),d.displacementMap&&(h.displacementMap.value=d.displacementMap,t(d.displacementMap,h.displacementMapTransform),h.displacementScale.value=d.displacementScale,h.displacementBias.value=d.displacementBias),d.emissiveMap&&(h.emissiveMap.value=d.emissiveMap,t(d.emissiveMap,h.emissiveMapTransform)),d.specularMap&&(h.specularMap.value=d.specularMap,t(d.specularMap,h.specularMapTransform)),d.alphaTest>0&&(h.alphaTest.value=d.alphaTest);const _=e.get(d).envMap;if(_&&(h.envMap.value=_,h.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.reflectivity.value=d.reflectivity,h.ior.value=d.ior,h.refractionRatio.value=d.refractionRatio),d.lightMap){h.lightMap.value=d.lightMap;const C=g._useLegacyLights===!0?Math.PI:1;h.lightMapIntensity.value=d.lightMapIntensity*C,t(d.lightMap,h.lightMapTransform)}d.aoMap&&(h.aoMap.value=d.aoMap,h.aoMapIntensity.value=d.aoMapIntensity,t(d.aoMap,h.aoMapTransform))}function y(h,d){h.diffuse.value.copy(d.color),h.opacity.value=d.opacity,d.map&&(h.map.value=d.map,t(d.map,h.mapTransform))}function m(h,d){h.dashSize.value=d.dashSize,h.totalSize.value=d.dashSize+d.gapSize,h.scale.value=d.scale}function l(h,d,_,C){h.diffuse.value.copy(d.color),h.opacity.value=d.opacity,h.size.value=d.size*_,h.scale.value=C*.5,d.map&&(h.map.value=d.map,t(d.map,h.uvTransform)),d.alphaMap&&(h.alphaMap.value=d.alphaMap,t(d.alphaMap,h.alphaMapTransform)),d.alphaTest>0&&(h.alphaTest.value=d.alphaTest)}function u(h,d){h.diffuse.value.copy(d.color),h.opacity.value=d.opacity,h.rotation.value=d.rotation,d.map&&(h.map.value=d.map,t(d.map,h.mapTransform)),d.alphaMap&&(h.alphaMap.value=d.alphaMap,t(d.alphaMap,h.alphaMapTransform)),d.alphaTest>0&&(h.alphaTest.value=d.alphaTest)}function r(h,d){h.specular.value.copy(d.specular),h.shininess.value=Math.max(d.shininess,1e-4)}function a(h,d){d.gradientMap&&(h.gradientMap.value=d.gradientMap)}function s(h,d){h.metalness.value=d.metalness,d.metalnessMap&&(h.metalnessMap.value=d.metalnessMap,t(d.metalnessMap,h.metalnessMapTransform)),h.roughness.value=d.roughness,d.roughnessMap&&(h.roughnessMap.value=d.roughnessMap,t(d.roughnessMap,h.roughnessMapTransform)),e.get(d).envMap&&(h.envMapIntensity.value=d.envMapIntensity)}function o(h,d,_){h.ior.value=d.ior,d.sheen>0&&(h.sheenColor.value.copy(d.sheenColor).multiplyScalar(d.sheen),h.sheenRoughness.value=d.sheenRoughness,d.sheenColorMap&&(h.sheenColorMap.value=d.sheenColorMap,t(d.sheenColorMap,h.sheenColorMapTransform)),d.sheenRoughnessMap&&(h.sheenRoughnessMap.value=d.sheenRoughnessMap,t(d.sheenRoughnessMap,h.sheenRoughnessMapTransform))),d.clearcoat>0&&(h.clearcoat.value=d.clearcoat,h.clearcoatRoughness.value=d.clearcoatRoughness,d.clearcoatMap&&(h.clearcoatMap.value=d.clearcoatMap,t(d.clearcoatMap,h.clearcoatMapTransform)),d.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap.value=d.clearcoatRoughnessMap,t(d.clearcoatRoughnessMap,h.clearcoatRoughnessMapTransform)),d.clearcoatNormalMap&&(h.clearcoatNormalMap.value=d.clearcoatNormalMap,t(d.clearcoatNormalMap,h.clearcoatNormalMapTransform),h.clearcoatNormalScale.value.copy(d.clearcoatNormalScale),d.side===bt&&h.clearcoatNormalScale.value.negate())),d.iridescence>0&&(h.iridescence.value=d.iridescence,h.iridescenceIOR.value=d.iridescenceIOR,h.iridescenceThicknessMinimum.value=d.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum.value=d.iridescenceThicknessRange[1],d.iridescenceMap&&(h.iridescenceMap.value=d.iridescenceMap,t(d.iridescenceMap,h.iridescenceMapTransform)),d.iridescenceThicknessMap&&(h.iridescenceThicknessMap.value=d.iridescenceThicknessMap,t(d.iridescenceThicknessMap,h.iridescenceThicknessMapTransform))),d.transmission>0&&(h.transmission.value=d.transmission,h.transmissionSamplerMap.value=_.texture,h.transmissionSamplerSize.value.set(_.width,_.height),d.transmissionMap&&(h.transmissionMap.value=d.transmissionMap,t(d.transmissionMap,h.transmissionMapTransform)),h.thickness.value=d.thickness,d.thicknessMap&&(h.thicknessMap.value=d.thicknessMap,t(d.thicknessMap,h.thicknessMapTransform)),h.attenuationDistance.value=d.attenuationDistance,h.attenuationColor.value.copy(d.attenuationColor)),d.anisotropy>0&&(h.anisotropyVector.value.set(d.anisotropy*Math.cos(d.anisotropyRotation),d.anisotropy*Math.sin(d.anisotropyRotation)),d.anisotropyMap&&(h.anisotropyMap.value=d.anisotropyMap,t(d.anisotropyMap,h.anisotropyMapTransform))),h.specularIntensity.value=d.specularIntensity,h.specularColor.value.copy(d.specularColor),d.specularColorMap&&(h.specularColorMap.value=d.specularColorMap,t(d.specularColorMap,h.specularColorMapTransform)),d.specularIntensityMap&&(h.specularIntensityMap.value=d.specularIntensityMap,t(d.specularIntensityMap,h.specularIntensityMapTransform))}function i(h,d){d.matcap&&(h.matcap.value=d.matcap)}function c(h,d){const _=e.get(d).light;h.referencePosition.value.setFromMatrixPosition(_.matrixWorld),h.nearDistance.value=_.shadow.camera.near,h.farDistance.value=_.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:p}}function op(g,e,t,n){let p={},f={},y=[];const m=t.isWebGL2?g.getParameter(g.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(_,C){const M=C.program;n.uniformBlockBinding(_,M)}function u(_,C){let M=p[_.id];M===void 0&&(i(_),M=r(_),p[_.id]=M,_.addEventListener("dispose",h));const b=C.program;n.updateUBOMapping(_,b);const v=e.render.frame;f[_.id]!==v&&(s(_),f[_.id]=v)}function r(_){const C=a();_.__bindingPointIndex=C;const M=g.createBuffer(),b=_.__size,v=_.usage;return g.bindBuffer(g.UNIFORM_BUFFER,M),g.bufferData(g.UNIFORM_BUFFER,b,v),g.bindBuffer(g.UNIFORM_BUFFER,null),g.bindBufferBase(g.UNIFORM_BUFFER,C,M),M}function a(){for(let _=0;_<m;_++)if(y.indexOf(_)===-1)return y.push(_),_;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function s(_){const C=p[_.id],M=_.uniforms,b=_.__cache;g.bindBuffer(g.UNIFORM_BUFFER,C);for(let v=0,E=M.length;v<E;v++){const D=Array.isArray(M[v])?M[v]:[M[v]];for(let L=0,w=D.length;L<w;L++){const I=D[L];if(o(I,v,L,b)===!0){const R=I.__offset,A=Array.isArray(I.value)?I.value:[I.value];let x=0;for(let S=0;S<A.length;S++){const T=A[S],P=c(T);typeof T=="number"||typeof T=="boolean"?(I.__data[0]=T,g.bufferSubData(g.UNIFORM_BUFFER,R+x,I.__data)):T.isMatrix3?(I.__data[0]=T.elements[0],I.__data[1]=T.elements[1],I.__data[2]=T.elements[2],I.__data[3]=0,I.__data[4]=T.elements[3],I.__data[5]=T.elements[4],I.__data[6]=T.elements[5],I.__data[7]=0,I.__data[8]=T.elements[6],I.__data[9]=T.elements[7],I.__data[10]=T.elements[8],I.__data[11]=0):(T.toArray(I.__data,x),x+=P.storage/Float32Array.BYTES_PER_ELEMENT)}g.bufferSubData(g.UNIFORM_BUFFER,R,I.__data)}}}g.bindBuffer(g.UNIFORM_BUFFER,null)}function o(_,C,M,b){const v=_.value,E=C+"_"+M;if(b[E]===void 0)return typeof v=="number"||typeof v=="boolean"?b[E]=v:b[E]=v.clone(),!0;{const D=b[E];if(typeof v=="number"||typeof v=="boolean"){if(D!==v)return b[E]=v,!0}else if(D.equals(v)===!1)return D.copy(v),!0}return!1}function i(_){const C=_.uniforms;let M=0;const b=16;for(let E=0,D=C.length;E<D;E++){const L=Array.isArray(C[E])?C[E]:[C[E]];for(let w=0,I=L.length;w<I;w++){const R=L[w],A=Array.isArray(R.value)?R.value:[R.value];for(let x=0,S=A.length;x<S;x++){const T=A[x],P=c(T),N=M%b;N!==0&&b-N<P.boundary&&(M+=b-N),R.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=M,M+=P.storage}}}const v=M%b;return v>0&&(M+=b-v),_.__size=M,_.__cache={},this}function c(_){const C={boundary:0,storage:0};return typeof _=="number"||typeof _=="boolean"?(C.boundary=4,C.storage=4):_.isVector2?(C.boundary=8,C.storage=8):_.isVector3||_.isColor?(C.boundary=16,C.storage=12):_.isVector4?(C.boundary=16,C.storage=16):_.isMatrix3?(C.boundary=48,C.storage=48):_.isMatrix4?(C.boundary=64,C.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),C}function h(_){const C=_.target;C.removeEventListener("dispose",h);const M=y.indexOf(C.__bindingPointIndex);y.splice(M,1),g.deleteBuffer(p[C.id]),delete p[C.id],delete f[C.id]}function d(){for(const _ in p)g.deleteBuffer(p[_]);y=[],p={},f={}}return{bind:l,update:u,dispose:d}}class _a{constructor(e={}){const{canvas:t=ql(),context:n=null,depth:p=!0,stencil:f=!0,alpha:y=!1,antialias:m=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:r="default",failIfMajorPerformanceCaveat:a=!1}=e;this.isWebGLRenderer=!0;let s;n!==null?s=n.getContextAttributes().alpha:s=y;const o=new Uint32Array(4),i=new Int32Array(4);let c=null,h=null;const d=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ut,this._useLegacyLights=!1,this.toneMapping=hn,this.toneMappingExposure=1;const C=this;let M=!1,b=0,v=0,E=null,D=-1,L=null;const w=new ct,I=new ct;let R=null;const A=new He(0);let x=0,S=t.width,T=t.height,P=1,N=null,k=null;const O=new ct(0,0,S,T),$=new ct(0,0,S,T);let V=!1;const H=new es;let U=!1,z=!1,G=null;const K=new rt,Y=new We,Z=new q,ie={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return E===null?P:1}let j=n;function ke(B,Q){for(let te=0;te<B.length;te++){const ne=B[te],ee=t.getContext(ne,Q);if(ee!==null)return ee}return null}try{const B={alpha:!0,depth:p,stencil:f,antialias:m,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:r,failIfMajorPerformanceCaveat:a};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Qr}`),t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",X,!1),t.addEventListener("webglcontextcreationerror",ce,!1),j===null){const Q=["webgl2","webgl","experimental-webgl"];if(C.isWebGL1Renderer===!0&&Q.shift(),j=ke(Q,B),j===null)throw ke(Q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&j instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),j.getShaderPrecisionFormat===void 0&&(j.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let ge,me,ve,Ye,Te,W,F,J,le,re,ae,xe,de,ye,Ae,Oe,se,Xe,Be,Re,Me,_e,Pe,Ge;function qe(){ge=new dd(j),me=new od(j,ge,e),ge.init(me),_e=new qf(j,ge,me),ve=new Zf(j,ge,me),Ye=new gd(j),Te=new Of,W=new Qf(j,ge,ve,Te,me,_e,Ye),F=new ld(C),J=new ud(C),le=new wc(j,me),Pe=new rd(j,ge,le,me),re=new fd(j,le,Ye,Pe),ae=new _d(j,re,le,Ye),Be=new yd(j,me,W),Oe=new ad(Te),xe=new kf(C,F,J,ge,me,Pe,Oe),de=new sp(C,Te),ye=new Ff,Ae=new Gf(ge,me),Xe=new id(C,F,J,ve,ae,s,l),se=new Yf(C,ae,me),Ge=new op(j,Ye,me,ve),Re=new sd(j,ge,Ye,me),Me=new pd(j,ge,Ye,me),Ye.programs=xe.programs,C.capabilities=me,C.extensions=ge,C.properties=Te,C.renderLists=ye,C.shadowMap=se,C.state=ve,C.info=Ye}qe();const ze=new rp(C,j);this.xr=ze,this.getContext=function(){return j},this.getContextAttributes=function(){return j.getContextAttributes()},this.forceContextLoss=function(){const B=ge.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){const B=ge.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(B){B!==void 0&&(P=B,this.setSize(S,T,!1))},this.getSize=function(B){return B.set(S,T)},this.setSize=function(B,Q,te=!0){if(ze.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}S=B,T=Q,t.width=Math.floor(B*P),t.height=Math.floor(Q*P),te===!0&&(t.style.width=B+"px",t.style.height=Q+"px"),this.setViewport(0,0,B,Q)},this.getDrawingBufferSize=function(B){return B.set(S*P,T*P).floor()},this.setDrawingBufferSize=function(B,Q,te){S=B,T=Q,P=te,t.width=Math.floor(B*te),t.height=Math.floor(Q*te),this.setViewport(0,0,B,Q)},this.getCurrentViewport=function(B){return B.copy(w)},this.getViewport=function(B){return B.copy(O)},this.setViewport=function(B,Q,te,ne){B.isVector4?O.set(B.x,B.y,B.z,B.w):O.set(B,Q,te,ne),ve.viewport(w.copy(O).multiplyScalar(P).floor())},this.getScissor=function(B){return B.copy($)},this.setScissor=function(B,Q,te,ne){B.isVector4?$.set(B.x,B.y,B.z,B.w):$.set(B,Q,te,ne),ve.scissor(I.copy($).multiplyScalar(P).floor())},this.getScissorTest=function(){return V},this.setScissorTest=function(B){ve.setScissorTest(V=B)},this.setOpaqueSort=function(B){N=B},this.setTransparentSort=function(B){k=B},this.getClearColor=function(B){return B.copy(Xe.getClearColor())},this.setClearColor=function(){Xe.setClearColor.apply(Xe,arguments)},this.getClearAlpha=function(){return Xe.getClearAlpha()},this.setClearAlpha=function(){Xe.setClearAlpha.apply(Xe,arguments)},this.clear=function(B=!0,Q=!0,te=!0){let ne=0;if(B){let ee=!1;if(E!==null){const pe=E.texture.format;ee=pe===Ko||pe===jo||pe===Xo}if(ee){const pe=E.texture.type,we=pe===un||pe===ln||pe===qr||pe===En||pe===Go||pe===Vo,Ce=Xe.getClearColor(),Le=Xe.getClearAlpha(),$e=Ce.r,De=Ce.g,Ie=Ce.b;we?(o[0]=$e,o[1]=De,o[2]=Ie,o[3]=Le,j.clearBufferuiv(j.COLOR,0,o)):(i[0]=$e,i[1]=De,i[2]=Ie,i[3]=Le,j.clearBufferiv(j.COLOR,0,i))}else ne|=j.COLOR_BUFFER_BIT}Q&&(ne|=j.DEPTH_BUFFER_BIT),te&&(ne|=j.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),j.clear(ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",X,!1),t.removeEventListener("webglcontextcreationerror",ce,!1),ye.dispose(),Ae.dispose(),Te.dispose(),F.dispose(),J.dispose(),ae.dispose(),Pe.dispose(),Ge.dispose(),xe.dispose(),ze.dispose(),ze.removeEventListener("sessionstart",Tt),ze.removeEventListener("sessionend",Qe),G&&(G.dispose(),G=null),mt.stop()};function Ke(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function X(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const B=Ye.autoReset,Q=se.enabled,te=se.autoUpdate,ne=se.needsUpdate,ee=se.type;qe(),Ye.autoReset=B,se.enabled=Q,se.autoUpdate=te,se.needsUpdate=ne,se.type=ee}function ce(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function he(B){const Q=B.target;Q.removeEventListener("dispose",he),Se(Q)}function Se(B){Ee(B),Te.remove(B)}function Ee(B){const Q=Te.get(B).programs;Q!==void 0&&(Q.forEach(function(te){xe.releaseProgram(te)}),B.isShaderMaterial&&xe.releaseShaderCache(B))}this.renderBufferDirect=function(B,Q,te,ne,ee,pe){Q===null&&(Q=ie);const we=ee.isMesh&&ee.matrixWorld.determinant()<0,Ce=Ma(B,Q,te,ne,ee);ve.setMaterial(ne,we);let Le=te.index,$e=1;if(ne.wireframe===!0){if(Le=re.getWireframeAttribute(te),Le===void 0)return;$e=2}const De=te.drawRange,Ie=te.attributes.position;let nt=De.start*$e,Mt=(De.start+De.count)*$e;pe!==null&&(nt=Math.max(nt,pe.start*$e),Mt=Math.min(Mt,(pe.start+pe.count)*$e)),Le!==null?(nt=Math.max(nt,0),Mt=Math.min(Mt,Le.count)):Ie!=null&&(nt=Math.max(nt,0),Mt=Math.min(Mt,Ie.count));const at=Mt-nt;if(at<0||at===1/0)return;Pe.setup(ee,ne,Ce,te,Le);let Wt,et=Re;if(Le!==null&&(Wt=le.get(Le),et=Me,et.setIndex(Wt)),ee.isMesh)ne.wireframe===!0?(ve.setLineWidth(ne.wireframeLinewidth*oe()),et.setMode(j.LINES)):et.setMode(j.TRIANGLES);else if(ee.isLine){let Fe=ne.linewidth;Fe===void 0&&(Fe=1),ve.setLineWidth(Fe*oe()),ee.isLineSegments?et.setMode(j.LINES):ee.isLineLoop?et.setMode(j.LINE_LOOP):et.setMode(j.LINE_STRIP)}else ee.isPoints?et.setMode(j.POINTS):ee.isSprite&&et.setMode(j.TRIANGLES);if(ee.isBatchedMesh)et.renderMultiDraw(ee._multiDrawStarts,ee._multiDrawCounts,ee._multiDrawCount);else if(ee.isInstancedMesh)et.renderInstances(nt,at,ee.count);else if(te.isInstancedBufferGeometry){const Fe=te._maxInstanceCount!==void 0?te._maxInstanceCount:1/0,ir=Math.min(te.instanceCount,Fe);et.renderInstances(nt,at,ir)}else et.render(nt,at)};function Ve(B,Q,te){B.transparent===!0&&B.side===Zt&&B.forceSinglePass===!1?(B.side=bt,B.needsUpdate=!0,Si(B,Q,te),B.side=dn,B.needsUpdate=!0,Si(B,Q,te),B.side=Zt):Si(B,Q,te)}this.compile=function(B,Q,te=null){te===null&&(te=B),h=Ae.get(te),h.init(),_.push(h),te.traverseVisible(function(ee){ee.isLight&&ee.layers.test(Q.layers)&&(h.pushLight(ee),ee.castShadow&&h.pushShadow(ee))}),B!==te&&B.traverseVisible(function(ee){ee.isLight&&ee.layers.test(Q.layers)&&(h.pushLight(ee),ee.castShadow&&h.pushShadow(ee))}),h.setupLights(C._useLegacyLights);const ne=new Set;return B.traverse(function(ee){const pe=ee.material;if(pe)if(Array.isArray(pe))for(let we=0;we<pe.length;we++){const Ce=pe[we];Ve(Ce,te,ee),ne.add(Ce)}else Ve(pe,te,ee),ne.add(pe)}),_.pop(),h=null,ne},this.compileAsync=function(B,Q,te=null){const ne=this.compile(B,Q,te);return new Promise(ee=>{function pe(){if(ne.forEach(function(we){Te.get(we).currentProgram.isReady()&&ne.delete(we)}),ne.size===0){ee(B);return}setTimeout(pe,10)}ge.get("KHR_parallel_shader_compile")!==null?pe():setTimeout(pe,10)})};let Ze=null;function ht(B){Ze&&Ze(B)}function Tt(){mt.stop()}function Qe(){mt.start()}const mt=new ua;mt.setAnimationLoop(ht),typeof self<"u"&&mt.setContext(self),this.setAnimationLoop=function(B){Ze=B,ze.setAnimationLoop(B),B===null?mt.stop():mt.start()},ze.addEventListener("sessionstart",Tt),ze.addEventListener("sessionend",Qe),this.render=function(B,Q){if(Q!==void 0&&Q.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),Q.parent===null&&Q.matrixWorldAutoUpdate===!0&&Q.updateMatrixWorld(),ze.enabled===!0&&ze.isPresenting===!0&&(ze.cameraAutoUpdate===!0&&ze.updateCamera(Q),Q=ze.getCamera()),B.isScene===!0&&B.onBeforeRender(C,B,Q,E),h=Ae.get(B,_.length),h.init(),_.push(h),K.multiplyMatrices(Q.projectionMatrix,Q.matrixWorldInverse),H.setFromProjectionMatrix(K),z=this.localClippingEnabled,U=Oe.init(this.clippingPlanes,z),c=ye.get(B,d.length),c.init(),d.push(c),Ut(B,Q,0,C.sortObjects),c.finish(),C.sortObjects===!0&&c.sort(N,k),this.info.render.frame++,U===!0&&Oe.beginShadows();const te=h.state.shadowsArray;if(se.render(te,B,Q),U===!0&&Oe.endShadows(),this.info.autoReset===!0&&this.info.reset(),(ze.enabled===!1||ze.isPresenting===!1||ze.hasDepthSensing()===!1)&&Xe.render(c,B),h.setupLights(C._useLegacyLights),Q.isArrayCamera){const ne=Q.cameras;for(let ee=0,pe=ne.length;ee<pe;ee++){const we=ne[ee];ns(c,B,we,we.viewport)}}else ns(c,B,Q);E!==null&&(W.updateMultisampleRenderTarget(E),W.updateRenderTargetMipmap(E)),B.isScene===!0&&B.onAfterRender(C,B,Q),Pe.resetDefaultState(),D=-1,L=null,_.pop(),_.length>0?h=_[_.length-1]:h=null,d.pop(),d.length>0?c=d[d.length-1]:c=null};function Ut(B,Q,te,ne){if(B.visible===!1)return;if(B.layers.test(Q.layers)){if(B.isGroup)te=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(Q);else if(B.isLight)h.pushLight(B),B.castShadow&&h.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||H.intersectsSprite(B)){ne&&Z.setFromMatrixPosition(B.matrixWorld).applyMatrix4(K);const we=ae.update(B),Ce=B.material;Ce.visible&&c.push(B,we,Ce,te,Z.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(!B.frustumCulled||H.intersectsObject(B))){const we=ae.update(B),Ce=B.material;if(ne&&(B.boundingSphere!==void 0?(B.boundingSphere===null&&B.computeBoundingSphere(),Z.copy(B.boundingSphere.center)):(we.boundingSphere===null&&we.computeBoundingSphere(),Z.copy(we.boundingSphere.center)),Z.applyMatrix4(B.matrixWorld).applyMatrix4(K)),Array.isArray(Ce)){const Le=we.groups;for(let $e=0,De=Le.length;$e<De;$e++){const Ie=Le[$e],nt=Ce[Ie.materialIndex];nt&&nt.visible&&c.push(B,we,nt,te,Z.z,Ie)}}else Ce.visible&&c.push(B,we,Ce,te,Z.z,null)}}const pe=B.children;for(let we=0,Ce=pe.length;we<Ce;we++)Ut(pe[we],Q,te,ne)}function ns(B,Q,te,ne){const ee=B.opaque,pe=B.transmissive,we=B.transparent;h.setupLightsView(te),U===!0&&Oe.setGlobalState(C.clippingPlanes,te),pe.length>0&&wa(ee,pe,Q,te),ne&&ve.viewport(w.copy(ne)),ee.length>0&&_i(ee,Q,te),pe.length>0&&_i(pe,Q,te),we.length>0&&_i(we,Q,te),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function wa(B,Q,te,ne){if((te.isScene===!0?te.overrideMaterial:null)!==null)return;const pe=me.isWebGL2;G===null&&(G=new Tn(1,1,{generateMipmaps:!0,type:ge.has("EXT_color_buffer_half_float")?fi:un,minFilter:Mn,samples:pe?4:0})),C.getDrawingBufferSize(Y),pe?G.setSize(Y.x,Y.y):G.setSize(Yr(Y.x),Yr(Y.y));const we=C.getRenderTarget();C.setRenderTarget(G),C.getClearColor(A),x=C.getClearAlpha(),x<1&&C.setClearColor(16777215,.5),C.clear();const Ce=C.toneMapping;C.toneMapping=hn,_i(B,te,ne),W.updateMultisampleRenderTarget(G),W.updateRenderTargetMipmap(G);let Le=!1;for(let $e=0,De=Q.length;$e<De;$e++){const Ie=Q[$e],nt=Ie.object,Mt=Ie.geometry,at=Ie.material,Wt=Ie.group;if(at.side===Zt&&nt.layers.test(ne.layers)){const et=at.side;at.side=bt,at.needsUpdate=!0,is(nt,te,ne,Mt,at,Wt),at.side=et,at.needsUpdate=!0,Le=!0}}Le===!0&&(W.updateMultisampleRenderTarget(G),W.updateRenderTargetMipmap(G)),C.setRenderTarget(we),C.setClearColor(A,x),C.toneMapping=Ce}function _i(B,Q,te){const ne=Q.isScene===!0?Q.overrideMaterial:null;for(let ee=0,pe=B.length;ee<pe;ee++){const we=B[ee],Ce=we.object,Le=we.geometry,$e=ne===null?we.material:ne,De=we.group;Ce.layers.test(te.layers)&&is(Ce,Q,te,Le,$e,De)}}function is(B,Q,te,ne,ee,pe){B.onBeforeRender(C,Q,te,ne,ee,pe),B.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),ee.onBeforeRender(C,Q,te,ne,B,pe),ee.transparent===!0&&ee.side===Zt&&ee.forceSinglePass===!1?(ee.side=bt,ee.needsUpdate=!0,C.renderBufferDirect(te,Q,ne,ee,B,pe),ee.side=dn,ee.needsUpdate=!0,C.renderBufferDirect(te,Q,ne,ee,B,pe),ee.side=Zt):C.renderBufferDirect(te,Q,ne,ee,B,pe),B.onAfterRender(C,Q,te,ne,ee,pe)}function Si(B,Q,te){Q.isScene!==!0&&(Q=ie);const ne=Te.get(B),ee=h.state.lights,pe=h.state.shadowsArray,we=ee.state.version,Ce=xe.getParameters(B,ee.state,pe,Q,te),Le=xe.getProgramCacheKey(Ce);let $e=ne.programs;ne.environment=B.isMeshStandardMaterial?Q.environment:null,ne.fog=Q.fog,ne.envMap=(B.isMeshStandardMaterial?J:F).get(B.envMap||ne.environment),$e===void 0&&(B.addEventListener("dispose",he),$e=new Map,ne.programs=$e);let De=$e.get(Le);if(De!==void 0){if(ne.currentProgram===De&&ne.lightsStateVersion===we)return ss(B,Ce),De}else Ce.uniforms=xe.getUniforms(B),B.onBuild(te,Ce,C),B.onBeforeCompile(Ce,C),De=xe.acquireProgram(Ce,Le),$e.set(Le,De),ne.uniforms=Ce.uniforms;const Ie=ne.uniforms;return(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(Ie.clippingPlanes=Oe.uniform),ss(B,Ce),ne.needsLights=Ca(B),ne.lightsStateVersion=we,ne.needsLights&&(Ie.ambientLightColor.value=ee.state.ambient,Ie.lightProbe.value=ee.state.probe,Ie.directionalLights.value=ee.state.directional,Ie.directionalLightShadows.value=ee.state.directionalShadow,Ie.spotLights.value=ee.state.spot,Ie.spotLightShadows.value=ee.state.spotShadow,Ie.rectAreaLights.value=ee.state.rectArea,Ie.ltc_1.value=ee.state.rectAreaLTC1,Ie.ltc_2.value=ee.state.rectAreaLTC2,Ie.pointLights.value=ee.state.point,Ie.pointLightShadows.value=ee.state.pointShadow,Ie.hemisphereLights.value=ee.state.hemi,Ie.directionalShadowMap.value=ee.state.directionalShadowMap,Ie.directionalShadowMatrix.value=ee.state.directionalShadowMatrix,Ie.spotShadowMap.value=ee.state.spotShadowMap,Ie.spotLightMatrix.value=ee.state.spotLightMatrix,Ie.spotLightMap.value=ee.state.spotLightMap,Ie.pointShadowMap.value=ee.state.pointShadowMap,Ie.pointShadowMatrix.value=ee.state.pointShadowMatrix),ne.currentProgram=De,ne.uniformsList=null,De}function rs(B){if(B.uniformsList===null){const Q=B.currentProgram.getUniforms();B.uniformsList=Wi.seqWithValue(Q.seq,B.uniforms)}return B.uniformsList}function ss(B,Q){const te=Te.get(B);te.outputColorSpace=Q.outputColorSpace,te.batching=Q.batching,te.instancing=Q.instancing,te.instancingColor=Q.instancingColor,te.skinning=Q.skinning,te.morphTargets=Q.morphTargets,te.morphNormals=Q.morphNormals,te.morphColors=Q.morphColors,te.morphTargetsCount=Q.morphTargetsCount,te.numClippingPlanes=Q.numClippingPlanes,te.numIntersection=Q.numClipIntersection,te.vertexAlphas=Q.vertexAlphas,te.vertexTangents=Q.vertexTangents,te.toneMapping=Q.toneMapping}function Ma(B,Q,te,ne,ee){Q.isScene!==!0&&(Q=ie),W.resetTextureUnits();const pe=Q.fog,we=ne.isMeshStandardMaterial?Q.environment:null,Ce=E===null?C.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:en,Le=(ne.isMeshStandardMaterial?J:F).get(ne.envMap||we),$e=ne.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,De=!!te.attributes.tangent&&(!!ne.normalMap||ne.anisotropy>0),Ie=!!te.morphAttributes.position,nt=!!te.morphAttributes.normal,Mt=!!te.morphAttributes.color;let at=hn;ne.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(at=C.toneMapping);const Wt=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,et=Wt!==void 0?Wt.length:0,Fe=Te.get(ne),ir=h.state.lights;if(U===!0&&(z===!0||B!==L)){const Lt=B===L&&ne.id===D;Oe.setState(ne,B,Lt)}let tt=!1;ne.version===Fe.__version?(Fe.needsLights&&Fe.lightsStateVersion!==ir.state.version||Fe.outputColorSpace!==Ce||ee.isBatchedMesh&&Fe.batching===!1||!ee.isBatchedMesh&&Fe.batching===!0||ee.isInstancedMesh&&Fe.instancing===!1||!ee.isInstancedMesh&&Fe.instancing===!0||ee.isSkinnedMesh&&Fe.skinning===!1||!ee.isSkinnedMesh&&Fe.skinning===!0||ee.isInstancedMesh&&Fe.instancingColor===!0&&ee.instanceColor===null||ee.isInstancedMesh&&Fe.instancingColor===!1&&ee.instanceColor!==null||Fe.envMap!==Le||ne.fog===!0&&Fe.fog!==pe||Fe.numClippingPlanes!==void 0&&(Fe.numClippingPlanes!==Oe.numPlanes||Fe.numIntersection!==Oe.numIntersection)||Fe.vertexAlphas!==$e||Fe.vertexTangents!==De||Fe.morphTargets!==Ie||Fe.morphNormals!==nt||Fe.morphColors!==Mt||Fe.toneMapping!==at||me.isWebGL2===!0&&Fe.morphTargetsCount!==et)&&(tt=!0):(tt=!0,Fe.__version=ne.version);let pn=Fe.currentProgram;tt===!0&&(pn=Si(ne,Q,ee));let os=!1,ri=!1,rr=!1;const ft=pn.getUniforms(),gn=Fe.uniforms;if(ve.useProgram(pn.program)&&(os=!0,ri=!0,rr=!0),ne.id!==D&&(D=ne.id,ri=!0),os||L!==B){ft.setValue(j,"projectionMatrix",B.projectionMatrix),ft.setValue(j,"viewMatrix",B.matrixWorldInverse);const Lt=ft.map.cameraPosition;Lt!==void 0&&Lt.setValue(j,Z.setFromMatrixPosition(B.matrixWorld)),me.logarithmicDepthBuffer&&ft.setValue(j,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),(ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshLambertMaterial||ne.isMeshBasicMaterial||ne.isMeshStandardMaterial||ne.isShaderMaterial)&&ft.setValue(j,"isOrthographic",B.isOrthographicCamera===!0),L!==B&&(L=B,ri=!0,rr=!0)}if(ee.isSkinnedMesh){ft.setOptional(j,ee,"bindMatrix"),ft.setOptional(j,ee,"bindMatrixInverse");const Lt=ee.skeleton;Lt&&(me.floatVertexTextures?(Lt.boneTexture===null&&Lt.computeBoneTexture(),ft.setValue(j,"boneTexture",Lt.boneTexture,W)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}ee.isBatchedMesh&&(ft.setOptional(j,ee,"batchingTexture"),ft.setValue(j,"batchingTexture",ee._matricesTexture,W));const sr=te.morphAttributes;if((sr.position!==void 0||sr.normal!==void 0||sr.color!==void 0&&me.isWebGL2===!0)&&Be.update(ee,te,pn),(ri||Fe.receiveShadow!==ee.receiveShadow)&&(Fe.receiveShadow=ee.receiveShadow,ft.setValue(j,"receiveShadow",ee.receiveShadow)),ne.isMeshGouraudMaterial&&ne.envMap!==null&&(gn.envMap.value=Le,gn.flipEnvMap.value=Le.isCubeTexture&&Le.isRenderTargetTexture===!1?-1:1),ri&&(ft.setValue(j,"toneMappingExposure",C.toneMappingExposure),Fe.needsLights&&Ea(gn,rr),pe&&ne.fog===!0&&de.refreshFogUniforms(gn,pe),de.refreshMaterialUniforms(gn,ne,P,T,G),Wi.upload(j,rs(Fe),gn,W)),ne.isShaderMaterial&&ne.uniformsNeedUpdate===!0&&(Wi.upload(j,rs(Fe),gn,W),ne.uniformsNeedUpdate=!1),ne.isSpriteMaterial&&ft.setValue(j,"center",ee.center),ft.setValue(j,"modelViewMatrix",ee.modelViewMatrix),ft.setValue(j,"normalMatrix",ee.normalMatrix),ft.setValue(j,"modelMatrix",ee.matrixWorld),ne.isShaderMaterial||ne.isRawShaderMaterial){const Lt=ne.uniformsGroups;for(let or=0,Aa=Lt.length;or<Aa;or++)if(me.isWebGL2){const as=Lt[or];Ge.update(as,pn),Ge.bind(as,pn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return pn}function Ea(B,Q){B.ambientLightColor.needsUpdate=Q,B.lightProbe.needsUpdate=Q,B.directionalLights.needsUpdate=Q,B.directionalLightShadows.needsUpdate=Q,B.pointLights.needsUpdate=Q,B.pointLightShadows.needsUpdate=Q,B.spotLights.needsUpdate=Q,B.spotLightShadows.needsUpdate=Q,B.rectAreaLights.needsUpdate=Q,B.hemisphereLights.needsUpdate=Q}function Ca(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(B,Q,te){Te.get(B.texture).__webglTexture=Q,Te.get(B.depthTexture).__webglTexture=te;const ne=Te.get(B);ne.__hasExternalTextures=!0,ne.__hasExternalTextures&&(ne.__autoAllocateDepthBuffer=te===void 0,ne.__autoAllocateDepthBuffer||ge.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ne.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(B,Q){const te=Te.get(B);te.__webglFramebuffer=Q,te.__useDefaultFramebuffer=Q===void 0},this.setRenderTarget=function(B,Q=0,te=0){E=B,b=Q,v=te;let ne=!0,ee=null,pe=!1,we=!1;if(B){const Le=Te.get(B);Le.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer(j.FRAMEBUFFER,null),ne=!1):Le.__webglFramebuffer===void 0?W.setupRenderTarget(B):Le.__hasExternalTextures&&W.rebindTextures(B,Te.get(B.texture).__webglTexture,Te.get(B.depthTexture).__webglTexture);const $e=B.texture;($e.isData3DTexture||$e.isDataArrayTexture||$e.isCompressedArrayTexture)&&(we=!0);const De=Te.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Array.isArray(De[Q])?ee=De[Q][te]:ee=De[Q],pe=!0):me.isWebGL2&&B.samples>0&&W.useMultisampledRTT(B)===!1?ee=Te.get(B).__webglMultisampledFramebuffer:Array.isArray(De)?ee=De[te]:ee=De,w.copy(B.viewport),I.copy(B.scissor),R=B.scissorTest}else w.copy(O).multiplyScalar(P).floor(),I.copy($).multiplyScalar(P).floor(),R=V;if(ve.bindFramebuffer(j.FRAMEBUFFER,ee)&&me.drawBuffers&&ne&&ve.drawBuffers(B,ee),ve.viewport(w),ve.scissor(I),ve.setScissorTest(R),pe){const Le=Te.get(B.texture);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+Q,Le.__webglTexture,te)}else if(we){const Le=Te.get(B.texture),$e=Q||0;j.framebufferTextureLayer(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,Le.__webglTexture,te||0,$e)}D=-1},this.readRenderTargetPixels=function(B,Q,te,ne,ee,pe,we){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ce=Te.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&we!==void 0&&(Ce=Ce[we]),Ce){ve.bindFramebuffer(j.FRAMEBUFFER,Ce);try{const Le=B.texture,$e=Le.format,De=Le.type;if($e!==$t&&_e.convert($e)!==j.getParameter(j.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ie=De===fi&&(ge.has("EXT_color_buffer_half_float")||me.isWebGL2&&ge.has("EXT_color_buffer_float"));if(De!==un&&_e.convert(De)!==j.getParameter(j.IMPLEMENTATION_COLOR_READ_TYPE)&&!(De===Qt&&(me.isWebGL2||ge.has("OES_texture_float")||ge.has("WEBGL_color_buffer_float")))&&!Ie){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Q>=0&&Q<=B.width-ne&&te>=0&&te<=B.height-ee&&j.readPixels(Q,te,ne,ee,_e.convert($e),_e.convert(De),pe)}finally{const Le=E!==null?Te.get(E).__webglFramebuffer:null;ve.bindFramebuffer(j.FRAMEBUFFER,Le)}}},this.copyFramebufferToTexture=function(B,Q,te=0){const ne=Math.pow(2,-te),ee=Math.floor(Q.image.width*ne),pe=Math.floor(Q.image.height*ne);W.setTexture2D(Q,0),j.copyTexSubImage2D(j.TEXTURE_2D,te,0,0,B.x,B.y,ee,pe),ve.unbindTexture()},this.copyTextureToTexture=function(B,Q,te,ne=0){const ee=Q.image.width,pe=Q.image.height,we=_e.convert(te.format),Ce=_e.convert(te.type);W.setTexture2D(te,0),j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,te.flipY),j.pixelStorei(j.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),j.pixelStorei(j.UNPACK_ALIGNMENT,te.unpackAlignment),Q.isDataTexture?j.texSubImage2D(j.TEXTURE_2D,ne,B.x,B.y,ee,pe,we,Ce,Q.image.data):Q.isCompressedTexture?j.compressedTexSubImage2D(j.TEXTURE_2D,ne,B.x,B.y,Q.mipmaps[0].width,Q.mipmaps[0].height,we,Q.mipmaps[0].data):j.texSubImage2D(j.TEXTURE_2D,ne,B.x,B.y,we,Ce,Q.image),ne===0&&te.generateMipmaps&&j.generateMipmap(j.TEXTURE_2D),ve.unbindTexture()},this.copyTextureToTexture3D=function(B,Q,te,ne,ee=0){if(C.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const pe=B.max.x-B.min.x+1,we=B.max.y-B.min.y+1,Ce=B.max.z-B.min.z+1,Le=_e.convert(ne.format),$e=_e.convert(ne.type);let De;if(ne.isData3DTexture)W.setTexture3D(ne,0),De=j.TEXTURE_3D;else if(ne.isDataArrayTexture||ne.isCompressedArrayTexture)W.setTexture2DArray(ne,0),De=j.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,ne.flipY),j.pixelStorei(j.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ne.premultiplyAlpha),j.pixelStorei(j.UNPACK_ALIGNMENT,ne.unpackAlignment);const Ie=j.getParameter(j.UNPACK_ROW_LENGTH),nt=j.getParameter(j.UNPACK_IMAGE_HEIGHT),Mt=j.getParameter(j.UNPACK_SKIP_PIXELS),at=j.getParameter(j.UNPACK_SKIP_ROWS),Wt=j.getParameter(j.UNPACK_SKIP_IMAGES),et=te.isCompressedTexture?te.mipmaps[ee]:te.image;j.pixelStorei(j.UNPACK_ROW_LENGTH,et.width),j.pixelStorei(j.UNPACK_IMAGE_HEIGHT,et.height),j.pixelStorei(j.UNPACK_SKIP_PIXELS,B.min.x),j.pixelStorei(j.UNPACK_SKIP_ROWS,B.min.y),j.pixelStorei(j.UNPACK_SKIP_IMAGES,B.min.z),te.isDataTexture||te.isData3DTexture?j.texSubImage3D(De,ee,Q.x,Q.y,Q.z,pe,we,Ce,Le,$e,et.data):te.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),j.compressedTexSubImage3D(De,ee,Q.x,Q.y,Q.z,pe,we,Ce,Le,et.data)):j.texSubImage3D(De,ee,Q.x,Q.y,Q.z,pe,we,Ce,Le,$e,et),j.pixelStorei(j.UNPACK_ROW_LENGTH,Ie),j.pixelStorei(j.UNPACK_IMAGE_HEIGHT,nt),j.pixelStorei(j.UNPACK_SKIP_PIXELS,Mt),j.pixelStorei(j.UNPACK_SKIP_ROWS,at),j.pixelStorei(j.UNPACK_SKIP_IMAGES,Wt),ee===0&&ne.generateMipmaps&&j.generateMipmap(De),ve.unbindTexture()},this.initTexture=function(B){B.isCubeTexture?W.setTextureCube(B,0):B.isData3DTexture?W.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?W.setTexture2DArray(B,0):W.setTexture2D(B,0),ve.unbindTexture()},this.resetState=function(){b=0,v=0,E=null,ve.reset(),Pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Jr?"display-p3":"srgb",t.unpackColorSpace=je.workingColorSpace===Qi?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===ut?An:Zo}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===An?ut:en}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class ap extends _a{}ap.prototype.isWebGL1Renderer=!0;class lp extends dt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class nr extends vi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new He(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Io=new q,Po=new q,No=new rt,Ur=new na,Hi=new qi;class Sa extends dt{constructor(e=new Ft,t=new nr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let p=1,f=t.count;p<f;p++)Io.fromBufferAttribute(t,p-1),Po.fromBufferAttribute(t,p),n[p]=n[p-1],n[p]+=Io.distanceTo(Po);e.setAttribute("lineDistance",new At(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,p=this.matrixWorld,f=e.params.Line.threshold,y=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Hi.copy(n.boundingSphere),Hi.applyMatrix4(p),Hi.radius+=f,e.ray.intersectsSphere(Hi)===!1)return;No.copy(p).invert(),Ur.copy(e.ray).applyMatrix4(No);const m=f/((this.scale.x+this.scale.y+this.scale.z)/3),l=m*m,u=new q,r=new q,a=new q,s=new q,o=this.isLineSegments?2:1,i=n.index,h=n.attributes.position;if(i!==null){const d=Math.max(0,y.start),_=Math.min(i.count,y.start+y.count);for(let C=d,M=_-1;C<M;C+=o){const b=i.getX(C),v=i.getX(C+1);if(u.fromBufferAttribute(h,b),r.fromBufferAttribute(h,v),Ur.distanceSqToSegment(u,r,s,a)>l)continue;s.applyMatrix4(this.matrixWorld);const D=e.ray.origin.distanceTo(s);D<e.near||D>e.far||t.push({distance:D,point:a.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this})}}else{const d=Math.max(0,y.start),_=Math.min(h.count,y.start+y.count);for(let C=d,M=_-1;C<M;C+=o){if(u.fromBufferAttribute(h,C),r.fromBufferAttribute(h,C+1),Ur.distanceSqToSegment(u,r,s,a)>l)continue;s.applyMatrix4(this.matrixWorld);const v=e.ray.origin.distanceTo(s);v<e.near||v>e.far||t.push({distance:v,point:a.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const p=t[n[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let f=0,y=p.length;f<y;f++){const m=p[f].name||String(f);this.morphTargetInfluences.push(0),this.morphTargetDictionary[m]=f}}}}}const ko=new q,Oo=new q;class xa extends Sa{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let p=0,f=t.count;p<f;p+=2)ko.fromBufferAttribute(t,p),Oo.fromBufferAttribute(t,p+1),n[p]=p===0?0:n[p-1],n[p+1]=n[p]+ko.distanceTo(Oo);e.setAttribute("lineDistance",new At(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ba extends dt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new He(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const Br=new rt,$o=new q,Fo=new q;class cp{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new We(512,512),this.map=null,this.mapPass=null,this.matrix=new rt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new es,this._frameExtents=new We(1,1),this._viewportCount=1,this._viewports=[new ct(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;$o.setFromMatrixPosition(e.matrixWorld),t.position.copy($o),Fo.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Fo),t.updateMatrixWorld(),Br.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Br),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Br)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class hp extends cp{constructor(){super(new da(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class up extends ba{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(dt.DEFAULT_UP),this.updateMatrix(),this.target=new dt,this.shadow=new hp}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class dp extends ba{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class fp extends xa{constructor(e=10,t=10,n=4473924,p=8947848){n=new He(n),p=new He(p);const f=t/2,y=e/t,m=e/2,l=[],u=[];for(let s=0,o=0,i=-m;s<=t;s++,i+=y){l.push(-m,0,i,m,0,i),l.push(i,0,-m,i,0,m);const c=s===f?n:p;c.toArray(u,o),o+=3,c.toArray(u,o),o+=3,c.toArray(u,o),o+=3,c.toArray(u,o),o+=3}const r=new Ft;r.setAttribute("position",new At(l,3)),r.setAttribute("color",new At(u,3));const a=new nr({vertexColors:!0,toneMapped:!1});super(r,a),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class pp extends xa{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],p=new Ft;p.setAttribute("position",new At(t,3)),p.setAttribute("color",new At(n,3));const f=new nr({vertexColors:!0,toneMapped:!1});super(p,f),this.type="AxesHelper"}setColors(e,t,n){const p=new He,f=this.geometry.attributes.color.array;return p.set(e),p.toArray(f,0),p.toArray(f,3),p.set(t),p.toArray(f,6),p.toArray(f,9),p.set(n),p.toArray(f,12),p.toArray(f,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Qr}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Qr);class gp extends ti{constructor(){super(...arguments);fe(this,"stateService");fe(this,"eventBus");fe(this,"scene");fe(this,"camera");fe(this,"renderer");fe(this,"animationId");fe(this,"channelMeshes",new Map);fe(this,"animateScene",()=>{this.animationId=requestAnimationFrame(this.animateScene);const t=Date.now()*1e-4;this.camera.position.x=Math.cos(t)*150,this.camera.position.z=Math.sin(t)*150,this.camera.lookAt(0,0,0),this.renderer.render(this.scene,this.camera)})}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.eventBus=t.get(be.EventBus),this.setupEventListeners(),this.initializeScene(),this.startAnimation()}onDisconnected(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer&&this.renderer.dispose()}setupEventListeners(){this.eventBus.on("execution:completed",t=>{const n=t.payload;this.updatePlot(n.channelId,n.result.plotData.segments)}),this.eventBus.on("channel:state-changed",()=>{this.updateVisibleChannels()})}initializeScene(){const t=this.query(".plot-container");if(!t)return;this.scene=new lp,this.scene.background=new He(1973790);const n=t.clientWidth||400,p=t.clientHeight||400;this.camera=new Dt(75,n/p,.1,2e3),this.camera.position.set(100,100,100),this.camera.lookAt(0,0,0),this.renderer=new _a({antialias:!0}),this.renderer.setSize(n,p),t.appendChild(this.renderer.domElement);const f=new dp(16777215,.5);this.scene.add(f);const y=new up(16777215,.8);y.position.set(50,100,50),this.scene.add(y);const m=new fp(200,20,4473924,2236962);this.scene.add(m);const l=new pp(50);this.scene.add(l),window.addEventListener("resize",()=>this.handleResize())}startAnimation(){this.animateScene()}handleResize(){const t=this.query(".plot-container");if(!t)return;const n=t.clientWidth,p=t.clientHeight;this.camera.aspect=n/p,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,p)}updatePlot(t,n){const p=this.channelMeshes.get(t);p&&this.scene.remove(p);const f=new ui,y=[5163440,14474410,13537656],m=parseInt(t.split("-")[1]||"1")-1,l=y[m]||5163440;n.forEach(u=>{if(u.points.length<2)return;const r=[];u.points.forEach(i=>{r.push(new q(i.x,i.z,-i.y))});const a=new Ft().setFromPoints(r),s=new nr({color:l,linewidth:u.type==="RAPID"?1:2}),o=new Sa(a,s);f.add(o)}),this.channelMeshes.set(t,f),this.scene.add(f)}updateVisibleChannels(){const t=this.stateService.getActiveChannels(),n=new Set(t.map(p=>p.id));this.channelMeshes.forEach((p,f)=>{p.visible=n.has(f)})}render(){this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const t=document.createElement("div");t.className="nc-toolpath-plot";const n=document.createElement("div");n.className="plot-header",n.textContent="Toolpath Visualization",t.appendChild(n);const p=document.createElement("div");p.className="plot-container",t.appendChild(p);const f=this.createControls();t.appendChild(f),this.shadow.appendChild(t),setTimeout(()=>{this.renderer||(this.initializeScene(),this.startAnimation())},0)}createControls(){const t=document.createElement("div");t.className="plot-controls";const n=document.createElement("button");return n.className="control-btn",n.textContent="Reset View",n.addEventListener("click",()=>this.resetView()),t.appendChild(n),t}resetView(){this.camera.position.set(100,100,100),this.camera.lookAt(0,0,0)}getStyles(){return`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      .nc-toolpath-plot {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        background: #1e1e1e;
        color: #d4d4d4;
      }

      .plot-header {
        padding: 10px 15px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
        font-weight: 500;
        font-size: 13px;
        text-transform: uppercase;
        color: #888;
      }

      .plot-container {
        flex: 1;
        position: relative;
        overflow: hidden;
      }

      .plot-container canvas {
        display: block;
        width: 100%;
        height: 100%;
      }

      .plot-controls {
        padding: 10px;
        background: #252526;
        border-top: 1px solid #3e3e42;
        display: flex;
        gap: 10px;
      }

      .control-btn {
        padding: 6px 12px;
        background: #0e639c;
        border: none;
        border-radius: 3px;
        color: white;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .control-btn:hover {
        background: #1177bb;
      }
    `}}customElements.define("nc-toolpath-plot",gp);class mp extends ti{constructor(){super(...arguments);fe(this,"stateService");fe(this,"machineService");fe(this,"eventBus");fe(this,"channelIds",["channel-1","channel-2","channel-3"]);fe(this,"channelStateCache",new Map);fe(this,"plotPanelWidth",450);fe(this,"plotPanelMinWidth",320);fe(this,"plotPanelMaxWidth",900);fe(this,"plotPanelVisible",!0);fe(this,"plotWrapperElement");fe(this,"mainContentElement")}onConnected(){const t=Ln();this.stateService=t.get(be.StateService),this.machineService=t.get(be.MachineService),this.eventBus=t.get(be.EventBus),this.setupEventListeners(),this.initializeChannels()}async initializeChannels(){await this.loadMachines();const t={"channel-1":`G90 G54
G0 X0 Y0 Z10
M3 S1000
G1 Z-5 F100
G1 X50 Y0 F300
G1 X50 Y50
G1 X0 Y50
G1 X0 Y0
G0 Z10
M5
M30`,"channel-2":`G90 G55
G0 X100 Y100 Z20
M3 S1500
T1
G1 Z-10 F150
G2 X120 Y120 I20 J0 F250
G1 X100 Y100
G0 Z20
M5
M30`};for(const n of this.channelIds)try{if(this.stateService.createChannel(n),n==="channel-1"||n==="channel-2"){this.stateService.activateChannel(n);const p=t[n]||"";p&&this.stateService.updateChannel(n,{program:p})}}catch(p){console.error(`Failed to create channel ${n}:`,p)}this.requestRender()}setupEventListeners(){this.eventBus.on("channel:state-changed",t=>{const n=t.payload,p=this.channelStateCache.get(n.channelId);this.channelStateCache.set(n.channelId,this.cloneChannelState(n.state)),this.shouldRenderForChannelStateChange(p,n.state)&&this.requestRender()}),this.eventBus.on("machine:changed",()=>{this.requestRender()})}async loadMachines(){try{await this.machineService.fetchMachines();const t=this.machineService.getAllMachines();for(const n of t)this.stateService.registerMachine(n);t.length>0&&this.stateService.setGlobalMachine(t[0].id),this.requestRender()}catch(t){console.warn("Failed to load machines from server, using mock data:",t);const n=[{id:"ISO_MILL",name:"ISO_MILL",controlType:"MILL",availableChannels:2,axes:[{name:"X",type:"LINEAR",minPosition:-500,maxPosition:500,units:"MM"},{name:"Y",type:"LINEAR",minPosition:-500,maxPosition:500,units:"MM"},{name:"Z",type:"LINEAR",minPosition:-300,maxPosition:300,units:"MM"}],feedLimits:{minFeed:1,maxFeed:5e3,rapidFeed:2e4,units:"MM_PER_MIN"},defaultTools:[]},{id:"FANUC_T",name:"FANUC_T",controlType:"TURN",availableChannels:1,axes:[{name:"X",type:"LINEAR",minPosition:-200,maxPosition:200,units:"MM"},{name:"Z",type:"LINEAR",minPosition:-500,maxPosition:0,units:"MM"}],feedLimits:{minFeed:1,maxFeed:3e3,rapidFeed:15e3,units:"MM_PER_MIN"},defaultTools:[]}];for(const p of n)this.stateService.registerMachine(p);n.length>0&&this.stateService.setGlobalMachine(n[0].id),this.requestRender()}}render(){if(!this.stateService){this.shadow.innerHTML='<div style="padding: 20px; color: #888;">Initializing...</div>';return}const t=this.stateService.getAllChannels(),n=this.stateService.getAllMachines(),p=this.stateService.getGlobalMachine();this.shadow.innerHTML="",this.shadow.appendChild(this.createStyles(this.getStyles()));const f=document.createElement("div");f.className="nc-editor-app";const y=this.createTopBar(n,p);f.appendChild(y);const m=document.createElement("div");m.className="main-content",this.mainContentElement=m;const l=this.createChannelTaskList(t);m.appendChild(l);const u=document.createElement("div");u.className="channel-area";const r=this.createChannelGrid(t);u.appendChild(r),m.appendChild(u);const a=document.createElement("div");a.className="plot-resizer",a.addEventListener("mousedown",h=>this.startPlotResize(h));const s=document.createElement("button");s.type="button",s.className="plot-toggle",s.textContent=this.plotPanelVisible?"Hide plot ":"Show plot ",s.addEventListener("click",h=>{h.stopPropagation(),this.plotPanelVisible=!this.plotPanelVisible,this.requestRender()}),a.appendChild(s),m.appendChild(a);const o=document.createElement("div");o.className="plot-wrapper",this.plotPanelVisible||o.classList.add("collapsed"),o.style.width=this.plotPanelVisible?`${this.plotPanelWidth}px`:"0",this.plotWrapperElement=o;const i=document.createElement("nc-toolpath-plot");i.className="plot-area",o.appendChild(i),m.appendChild(o),f.appendChild(m);const c=this.createStatusBar();f.appendChild(c),this.shadow.appendChild(f),this.cacheInitialChannelStates(t)}createTopBar(t,n){const p=document.createElement("div");p.className="top-bar";const f=document.createElement("h1");f.textContent="NC-Edit7",p.appendChild(f);const y=document.createElement("div");y.className="machine-selector";const m=document.createElement("label");m.textContent="Machine: ",y.appendChild(m);const l=document.createElement("select");l.className="machine-select";for(const u of t){const r=document.createElement("option");r.value=u.id,r.textContent=`${u.name} (${u.controlType})`,r.selected=u.id===n,l.appendChild(r)}return l.addEventListener("change",()=>{l.value&&this.stateService.setGlobalMachine(l.value)}),y.appendChild(l),p.appendChild(y),p}createChannelTaskList(t){const n=document.createElement("div");n.className="channel-task-list";const p=document.createElement("h3");p.textContent="Channels",n.appendChild(p);const f=document.createElement("div");f.className="channel-toggles";for(const y of t){const m=document.createElement("label");m.className="channel-toggle";const l=document.createElement("input");l.type="checkbox",l.checked=y.isActive,l.addEventListener("change",()=>{this.stateService.toggleChannel(y.id)});const u=document.createElement("span");u.textContent=y.id,m.appendChild(l),m.appendChild(u),f.appendChild(m)}return n.appendChild(f),n}shouldRenderForChannelStateChange(t,n){return!t||t.isActive!==n.isActive||t.machineId!==n.machineId||t.executedResult!==n.executedResult||!this.areUiConfigsEqual(t.uiConfig,n.uiConfig)}areUiConfigsEqual(t,n){return t.keywordPanelSide===n.keywordPanelSide&&t.timeGutterSide===n.timeGutterSide&&t.variableDrawerOpen===n.variableDrawerOpen&&t.toolOverlayOpen===n.toolOverlayOpen&&t.activeTab===n.activeTab}cacheInitialChannelStates(t){for(const n of t)this.channelStateCache.set(n.id,this.cloneChannelState(n))}cloneChannelState(t){return{...t,uiConfig:{...t.uiConfig}}}createChannelGrid(t){const n=document.createElement("div");n.className="channel-grid";const p=t.filter(f=>f.isActive);if(p.length===0){const f=document.createElement("div");f.className="placeholder",f.textContent="No channels active. Enable channels from the task list.",n.appendChild(f)}else for(const f of p){const y=this.createChannelPane(f);n.appendChild(y)}return n}createChannelPane(t){const n=document.createElement("div");n.className="channel-pane",n.dataset.channelId=t.id;const p=document.createElement("div");p.className="channel-header",p.textContent=`${t.id} - ${t.machineId}`,n.appendChild(p);const f=document.createElement("div");f.className="channel-content";const y=document.createElement("div");y.className="left-panel";const m=document.createElement("nc-keyword-panel");m.setAttribute("channel-id",t.id),m.style.flex="1",m.style.minHeight="0",y.appendChild(m);const l=document.createElement("nc-tool-list");l.setAttribute("channel-id",t.id),l.style.flex="1",l.style.minHeight="0",y.appendChild(l),f.appendChild(y);const u=document.createElement("div");u.className="editor-area";const r=document.createElement("nc-code-pane");r.setAttribute("channel-id",t.id),r.setAttribute("active-tab",t.uiConfig.activeTab),r.style.flex="1",u.appendChild(r);const a=document.createElement("nc-variable-list");return a.setAttribute("channel-id",t.id),a.setAttribute("open",String(t.uiConfig.variableDrawerOpen)),u.appendChild(a),f.appendChild(u),n.appendChild(f),n}createStatusBar(){const t=document.createElement("div");return t.className="status-bar",t.textContent="Ready",t}startPlotResize(t){if(t.button!==0)return;t.preventDefault(),this.plotPanelVisible=!0;const n=f=>{if(!this.mainContentElement)return;const m=this.mainContentElement.getBoundingClientRect().right-f.clientX;this.setPlotPanelWidth(m)},p=()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",p)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",p)}setPlotPanelWidth(t){const n=Math.max(this.plotPanelMinWidth,Math.min(this.plotPanelMaxWidth,t));this.plotPanelWidth=n,this.plotWrapperElement&&(this.plotWrapperElement.style.width=`${n}px`,this.plotWrapperElement.classList.remove("collapsed"))}getStyles(){return`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      .nc-editor-app {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
      }

      .top-bar h1 {
        font-size: 20px;
        margin: 0;
        color: #569cd6;
      }

      .machine-selector {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .machine-select {
        padding: 5px 10px;
        background: #3c3c3c;
        color: #d4d4d4;
        border: 1px solid #555;
        border-radius: 3px;
        font-size: 14px;
        cursor: pointer;
      }

      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .channel-task-list {
        width: 200px;
        padding: 15px;
        background: #252526;
        border-right: 1px solid #3e3e42;
        overflow-y: auto;
      }

      .channel-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .channel-task-list h3 {
        margin: 0 0 15px 0;
        font-size: 14px;
        text-transform: uppercase;
        color: #888;
      }

      .channel-toggles {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .channel-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 5px;
        border-radius: 3px;
        transition: background 0.2s;
      }

      .channel-toggle:hover {
        background: #2a2d2e;
      }

      .channel-toggle input[type="checkbox"] {
        cursor: pointer;
      }

      .channel-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 15px;
        flex: 1;
        padding: 15px;
        overflow: auto;
      }

      .channel-pane {
        background: #1e1e1e;
        border: 1px solid #3e3e42;
        border-radius: 4px;
        display: flex;
        flex-direction: column;
        min-height: 400px;
        overflow: hidden;
      }

      .channel-header {
        padding: 10px 15px;
        background: #2d2d30;
        border-bottom: 1px solid #3e3e42;
        font-weight: 500;
      }

      .channel-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .left-panel {
        width: 250px;
        display: flex;
        flex-direction: column;
        border-right: 1px solid #3e3e42;
        overflow: hidden;
      }

      .editor-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #888;
        font-size: 16px;
      }

      .plot-resizer {
        width: 32px;
        min-width: 32px;
        cursor: ew-resize;
        background: #151515;
        display: flex;
        align-items: center;
        justify-content: center;
        border-left: 1px solid #3e3e42;
        border-right: 1px solid #3e3e42;
        position: relative;
      }

      .plot-toggle {
        background: #2d2d30;
        border: 1px solid #3e3e42;
        border-radius: 4px;
        color: #d4d4d4;
        padding: 4px 8px;
        font-size: 11px;
        cursor: pointer;
      }

      .plot-resizer:hover .plot-toggle {
        background: #3c3c3c;
      }

      .plot-wrapper {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: width 0.2s ease;
        flex-shrink: 0;
      }

      .plot-wrapper.collapsed {
        width: 0 !important;
      }

      .plot-area {
        flex: 1;
        min-width: 300px;
        background: #252526;
        border-left: 1px solid #3e3e42;
      }

      .status-bar {
        padding: 5px 20px;
        background: #007acc;
        color: white;
        font-size: 12px;
        border-top: 1px solid #3e3e42;
      }
    `}}customElements.define("nc-editor-app",mp);async function vp(){console.log("NC-Edit7 starting...");try{const g=Ln();g.registerClass(be.EventBus,Da,{singleton:!0}),g.register(be.StateService,()=>{const a=g.get(be.EventBus);return new Ia(a)},{singleton:!0,dependencies:[be.EventBus]}),g.register(be.BackendGateway,()=>new Pa,{singleton:!0}),g.register(be.CloudAgentService,()=>{const a=g.get(be.BackendGateway),s=g.get(be.EventBus);return new Ba(a,s,{enabled:!0,autoDelegate:!0})},{singleton:!0,dependencies:[be.BackendGateway,be.EventBus]}),g.register(be.MachineService,()=>{const a=g.get(be.BackendGateway),s=g.get(be.EventBus);return new Na(a,s)},{singleton:!0,dependencies:[be.BackendGateway,be.EventBus]}),g.register(be.ParserService,()=>{const a=g.get(be.EventBus),s=g.get(be.CloudAgentService);return new ka(a,s)},{singleton:!0,dependencies:[be.EventBus,be.CloudAgentService]}),g.register(be.ExecutedProgramService,()=>{const a=g.get(be.BackendGateway),s=g.get(be.StateService),o=g.get(be.EventBus),i=g.get(be.CloudAgentService);return new Oa(a,s,o,i)},{singleton:!0,dependencies:[be.BackendGateway,be.StateService,be.EventBus,be.CloudAgentService]}),g.registerClass(be.PlotService,$a,{singleton:!0}),g.registerClass(be.UserPreferenceService,Fa,{singleton:!0}),g.register(be.DiagnosticsService,()=>{const a=g.get(be.EventBus);return new Ua(a)},{singleton:!0,dependencies:[be.EventBus]}),await g.initializeAll(),console.log("Services initialized successfully");const e=g.get(be.EventBus),t=g.get(be.StateService),n=g.get(be.BackendGateway),p=g.get(be.MachineService),f=g.get(be.ParserService),y=g.get(be.PlotService),m=g.get(be.UserPreferenceService),l=g.get(be.DiagnosticsService),u=g.get(be.CloudAgentService);console.log("All services initialized:",{eventBus:e,stateService:t,backendGateway:n,machineService:p,parserService:f,plotService:y,userPrefService:m,diagnosticsService:l,cloudAgentService:u});const r=document.getElementById("app");r&&(r.innerHTML="<nc-editor-app></nc-editor-app>"),console.log("NC-Edit7 bootstrap complete")}catch(g){console.error("Failed to bootstrap NC-Edit7:",g);const e=document.getElementById("app");e&&(e.innerHTML="<nc-editor-app></nc-editor-app>")}}vp();
//# sourceMappingURL=index-ITj66DDk.js.map
